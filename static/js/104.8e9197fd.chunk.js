"use strict";(self.webpackChunksimple_trade_tracker=self.webpackChunksimple_trade_tracker||[]).push([[104],{16857:(e,t,r)=>{r.d(t,{A:()=>p});r(65043);var a=r(60267),n=r(53969),s=r(55895),o=r(26529),i=r(29651),l=r(93201),d=r(82327),c=r(70579);const p=e=>{let{progress:t,isMet:r,tooltipText:p="Shows progress towards your target goal"}=e;const h=(0,a.A)(),x=(0,c.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",bgcolor:r?(0,i.X4)(h.palette.success.main,.9):(0,i.X4)(h.palette.primary.main,.1),color:r?"white":"primary.main",borderRadius:"12px",width:"auto",height:22,ml:1,px:.8,border:`1px solid ${(0,i.X4)(h.palette.primary.main,.2)}`},children:[r?(0,c.jsx)(l.A,{sx:{fontSize:"0.875rem",mr:.3}}):(0,c.jsx)(d.A,{sx:{fontSize:"0.875rem",mr:.3}}),(0,c.jsxs)(s.A,{variant:"caption",sx:{fontWeight:600,fontSize:r?"0.5rem":"0.7rem"},children:[Math.max(t,0).toFixed(0),"%"]})]});return(0,c.jsx)(o.A,{title:p,arrow:!0,placement:"top",children:x})}},20872:(e,t,r)=>{r.d(t,{UY:()=>de,fc:()=>R,ng:()=>ue,Ld:()=>ce,KG:()=>Q,hQ:()=>J,Q_:()=>me,Y$:()=>Y,jH:()=>q});var a=r(65043),n=r(50108),s=r(877),o=r(87734),i=r(52185),l=r(6026),d=r(86150),c=r(73243),p=r(13839),h=r(60267),x=r(94799),g=r(55895),m=r(53969),u=r(29651),y=r(39993),f=r(23893),A=r(70579);const b=e=>{const{x:t,y:r,payload:a}=e,n=a.value,s=(0,f.Fl)(n);return(0,A.jsx)("g",{transform:`translate(${t},${r})`,children:(0,A.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:"#666",fontSize:12,children:s})})},j=e=>{let{active:t,payload:r,label:a,type:n}=e;const s=(0,h.A)();if(t&&r&&r.length){const e=r[0].payload;return(0,A.jsxs)(x.A,{sx:{p:1.5,boxShadow:s.shadows[3]},children:[(0,A.jsx)(g.A,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:a}),(0,A.jsx)(g.A,{variant:"body2",sx:{color:e.dailyChange>0?"#4caf50":e.dailyChange<0?"#f44336":"text.secondary",fontWeight:"bold"},children:(0,f.Fl)(e.dailyChange)}),(0,A.jsxs)(g.A,{variant:"body2",color:"text.secondary",children:["Cumulative P&L: ",(0,f.Fl)(e.cumulativePnL)]}),e.trades&&e.trades.length>0&&(0,A.jsxs)(g.A,{variant:"body2",sx:{color:s.palette.primary.main,fontSize:"0.75rem",mt:.5},children:["Click to view ",e.trades.length," trade",e.trades.length>1?"s":""]})]})}return null},v=e=>{let{chartData:t,targetValue:r,monthlyTarget:a,setMultipleTradesDialog:x,timePeriod:f}=e;const v=(0,h.A)(),w="#4caf50",k="#f44336",C="#9e9e9e";return(0,A.jsxs)(m.A,{children:[(0,A.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,A.jsx)(g.A,{variant:"h6",children:"Cumulative P&L"}),a&&null!==r&&(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",bgcolor:(0,u.X4)(v.palette.primary.main,.1),px:1.5,py:.5,borderRadius:1,fontSize:"0.875rem"},children:["Target: ",a,"% ($",null===r||void 0===r?void 0:r.toFixed(2),")"]})]}),(0,A.jsx)(n.u,{width:"100%",height:300,children:(0,A.jsxs)(s.Q,{data:t,children:[(0,A.jsxs)("defs",{children:[(0,A.jsxs)("linearGradient",{id:"colorPnLWin",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,A.jsx)("stop",{offset:"5%",stopColor:w,stopOpacity:.2}),(0,A.jsx)("stop",{offset:"95%",stopColor:w,stopOpacity:0})]}),(0,A.jsxs)("linearGradient",{id:"colorPnLLoss",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,A.jsx)("stop",{offset:"5%",stopColor:k,stopOpacity:.2}),(0,A.jsx)("stop",{offset:"95%",stopColor:k,stopOpacity:0})]})]}),(0,A.jsx)(o.d,{strokeDasharray:"3 3",vertical:!1}),(0,A.jsx)(i.W,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:v.palette.text.secondary,fontSize:"year"===f?8:12}}),(0,A.jsx)(l.h,{axisLine:!1,tickLine:!1,tick:(0,A.jsx)(b,{})}),(0,A.jsx)(d.m,{content:e=>(0,A.jsx)(j,{...e,type:"cumulative"})}),null!==r&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(c.e,{y:r,stroke:v.palette.primary.main,strokeDasharray:"4 4",strokeWidth:2}),(0,A.jsx)(p.G,{type:"monotone",dataKey:"cumulativePnL",stroke:"none",fill:v.palette.primary.main,fillOpacity:.05,baseValue:r})]}),(0,A.jsx)(c.e,{y:0,stroke:C,strokeDasharray:"3 3"}),(0,A.jsx)(p.G,{type:"monotone",dataKey:"cumulativePnL",stroke:w,fill:"url(#colorPnLWin)",strokeWidth:2,name:"Cumulative P&L",style:{cursor:"pointer"},activeDot:e=>{const{cx:r,cy:a,index:n}=e;return(0,A.jsx)("circle",{cx:r,cy:a,r:6,stroke:v.palette.background.paper,strokeWidth:2,fill:v.palette.primary.main,style:{cursor:"pointer"},onClick:()=>{console.log("Dot clicked, Index:",n);const e=t[n];if(e&&e.trades&&e.trades.length>0){const t=(0,y.A)(e.fullDate,"MMMM d, yyyy");x({open:!0,trades:e.trades,date:t,expandedTradeId:1===e.trades.length?e.trades[0].id:null})}}})},dot:{r:3,fill:w,stroke:v.palette.background.paper,strokeWidth:1}})]})})]})};var w=r(82291),k=r(38643),C=r(17869);const T=e=>{const{x:t,y:r,payload:a}=e,n=a.value,s=(0,f.Fl)(n);return(0,A.jsx)("g",{transform:`translate(${t},${r})`,children:(0,A.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:"#666",fontSize:12,children:s})})},S=e=>{let{active:t,payload:r,label:a,type:n}=e;const s=(0,h.A)();if(t&&r&&r.length){const e=r[0].payload;return(0,A.jsxs)(x.A,{sx:{p:1.5,boxShadow:s.shadows[3]},children:[(0,A.jsx)(g.A,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:a}),(0,A.jsx)(g.A,{variant:"body2",sx:{color:e.isWin?"#4caf50":e.isLoss?"#f44336":"text.secondary",fontWeight:"bold"},children:(0,f.Fl)(e.pnl)}),(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:e.isWin?"Win":e.isLoss?"Loss":"Break Even"}),e.trades&&e.trades.length>0&&(0,A.jsxs)(g.A,{variant:"body2",sx:{color:s.palette.primary.main,fontSize:"0.75rem",mt:.5},children:["Click to view ",e.trades.length," trade",e.trades.length>1?"s":""]})]})}return null},M=e=>{let{chartData:t,drawdownViolationValue:r,setMultipleTradesDialog:a,timePeriod:s}=e;const p=(0,h.A)(),x="#4caf50",u="#f44336",b="#9e9e9e",j="#ff9800";return(0,A.jsxs)(m.A,{children:[(0,A.jsx)(g.A,{variant:"h6",sx:{mb:2},children:"Daily P&L"}),(0,A.jsx)(n.u,{width:"100%",height:300,children:(0,A.jsxs)(w.E,{data:t,children:[(0,A.jsx)(o.d,{strokeDasharray:"3 3",vertical:!1}),(0,A.jsx)(i.W,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:p.palette.text.secondary,fontSize:"year"===s?8:12}}),(0,A.jsx)(l.h,{axisLine:!1,tickLine:!1,tick:(0,A.jsx)(T,{})}),(0,A.jsx)(d.m,{content:e=>(0,A.jsx)(S,{...e,type:"daily"})}),(0,A.jsx)(c.e,{y:0,stroke:b,strokeDasharray:"3 3"}),(0,A.jsx)(c.e,{y:r,stroke:p.palette.error.main,strokeDasharray:"3 3",strokeWidth:2,label:{position:"right",value:`Max Drawdown: ${(0,f.Fl)(r)}`,fill:p.palette.error.main,fontSize:12,fontWeight:"bold"}}),(0,A.jsx)(k.y,{dataKey:"pnl",name:"Daily P&L",radius:[4,4,0,0],onClick:e=>{if(console.log("Bar clicked:",e),e&&e.payload){const t=e.payload;if(t.trades&&t.trades.length>0){const e=(0,y.A)(t.fullDate,"MMMM d, yyyy");a({open:!0,trades:t.trades,date:e,expandedTradeId:1===t.trades.length?t.trades[0].id:null})}}},style:{cursor:"pointer"},children:t.map(((e,t)=>(0,A.jsx)(C.f,{fill:e.isWin?x:e.isLoss?u:j,fillOpacity:.8},`cell-${t}`)))})]})})]})};var D=r(33309),I=r(12843);const W=e=>{let{children:t,value:r,index:a}=e;return(0,A.jsx)("div",{role:"tabpanel",hidden:r!==a,id:`pnl-tabpanel-${a}`,"aria-labelledby":`pnl-tab-${a}`,children:r===a&&(0,A.jsx)(m.A,{children:t})})},R=e=>{let{chartData:t,targetValue:r,monthlyTarget:n,drawdownViolationValue:s,setMultipleTradesDialog:o,timePeriod:i}=e;const l=(0,h.A)(),[d,c]=(0,a.useState)(0);return(0,A.jsxs)(x.A,{sx:{p:0,mb:3,borderRadius:2},children:[(0,A.jsx)(m.A,{sx:{px:3,pt:3},children:(0,A.jsx)(m.A,{sx:{display:"flex",justifyContent:"start",mb:2},children:(0,A.jsxs)(D.A,{value:d,onChange:(e,t)=>{c(t)},sx:{minHeight:40,backgroundColor:"light"===l.palette.mode?"#f0f0f0":(0,u.X4)(l.palette.background.paper,.4),borderRadius:"20px",padding:"4px","& .MuiTabs-flexContainer":{gap:"4px"},"& .MuiTabs-indicator":{display:"none"}},children:[(0,A.jsx)(I.A,{label:"Cumulative P&L",sx:{minHeight:32,my:.2,textTransform:"none",fontSize:"0.875rem",fontWeight:500,color:"text.secondary",borderRadius:"16px",padding:"6px 18px","&.Mui-selected":{color:"dark"===l.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:l.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,u.X4)(l.palette.primary.main,.05),color:"primary.main"}}}),(0,A.jsx)(I.A,{label:"Daily P&L",sx:{minHeight:32,my:.2,textTransform:"none",fontSize:"0.875rem",fontWeight:500,color:"text.secondary",borderRadius:"16px",padding:"6px 18px","&.Mui-selected":{color:"dark"===l.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:l.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,u.X4)(l.palette.primary.main,.05),color:"primary.main"}}})]})})}),(0,A.jsxs)(m.A,{sx:{px:3,pb:3},children:[(0,A.jsx)(W,{value:d,index:0,children:(0,A.jsx)(v,{chartData:t,targetValue:r,monthlyTarget:n,setMultipleTradesDialog:o,timePeriod:i})}),(0,A.jsx)(W,{value:d,index:1,children:(0,A.jsx)(M,{chartData:t,drawdownViolationValue:s,setMultipleTradesDialog:o,timePeriod:i})})]})]})};var P=r(60163),z=r(4240),F=r(21327),E=r(12097),L=r(81084),$=r(99565),X=r(24343),N=r(83759),O=r(45384),B=r(46577);const U=e=>{let{open:t,onClose:r,title:n="Filter by Tags",allTags:s,selectedTags:o,onTagsChange:i,showClearButton:l=!0,showApplyButton:d=!0}=e;const c=(0,h.A)(),[p,x]=(0,a.useState)(""),u=(0,a.useMemo)((()=>(0,L.GI)(s)),[s]),y=(0,a.useMemo)((()=>p?(0,L.o)(s,p):s),[s,p]),f=(0,A.jsx)(g.A,{variant:"h6",children:n}),b=l||d?(0,A.jsxs)(m.A,{children:[l&&(0,A.jsx)(E.A,{onClick:()=>{i([])},color:"inherit",children:"Clear All"}),d&&(0,A.jsx)(E.A,{onClick:r,color:"primary",children:"Apply"})]}):void 0;return(0,A.jsxs)(O.mY,{open:t,onClose:r,title:f,actions:b,maxWidth:"sm",fullWidth:!0,children:[(0,A.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[u.length>0&&(0,A.jsx)(O.pp,{label:"Filter by Tag Group",value:p,onChange:e=>x(e.target.value),options:[{value:"",label:"All Tags"},...u.map((e=>({value:e,label:e})))],size:"small"}),(0,A.jsx)($.A,{multiple:!0,options:y,value:o,onChange:(e,t)=>i(t),slotProps:{listbox:{sx:{...(0,B.J)(c)}}},renderInput:e=>(0,A.jsx)(X.A,{...e,variant:"outlined",label:"Select Tags",placeholder:"Choose tags to filter",fullWidth:!0}),renderTags:(e,t)=>e.map(((e,r)=>(0,A.jsx)(N.A,{label:(0,L.t)(e,!0),...t({index:r}),sx:(0,L.dO)(e,c),title:(0,L.dn)(e)?`Group: ${(0,L.Oo)(e)}`:void 0}))),renderOption:(e,t)=>(0,A.jsx)("li",{...e,children:(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,L.dn)(t)&&(0,A.jsx)(N.A,{label:(0,L.Oo)(t),size:"small",sx:{...(0,L.dO)(t,c),height:"18px",fontSize:"0.7rem"}}),(0,L.t)(t,!0)]})})})]}),(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:o.length>0?`Selected ${o.length} tag${o.length>1?"s":""}`:"Select tags to filter. When no tags are selected, all items will be shown."})]})},Y=e=>{let{winLossData:t,comparisonWinLossData:r,allTags:s,comparisonTags:o,setComparisonTags:i,onPieClick:l,tagStats:c=[]}=e;const p=(0,h.A)(),[y,f]=(0,a.useState)(!1);a.useEffect((()=>{const e=document.createElement("style");return e.innerHTML="\n      .recharts-sector:focus,\n      .recharts-sector:focus-visible,\n      .recharts-pie:focus,\n      .recharts-pie:focus-visible,\n      .recharts-pie-sector:focus,\n      .recharts-pie-sector:focus-visible,\n      .recharts-layer:focus,\n      .recharts-layer:focus-visible,\n      .recharts-surface:focus,\n      .recharts-surface:focus-visible {\n        outline: none !important;\n        stroke: none !important;\n        stroke-width: 0 !important;\n        box-shadow: none !important;\n      }\n\n      /* Target all SVG elements in the chart */\n      .recharts-wrapper svg *:focus,\n      .recharts-wrapper svg *:focus-visible,\n      .win-loss-chart-container svg *:focus,\n      .win-loss-chart-container svg *:focus-visible {\n        outline: none !important;\n        stroke-width: 0 !important;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}}),[]);const b={win:"dark"===p.palette.mode?"#66bb6a":"#4caf50",loss:"dark"===p.palette.mode?"#ef5350":"#f44336",zero:"dark"===p.palette.mode?"#bdbdbd":"#9e9e9e",breakEven:"dark"===p.palette.mode?"#ffb74d":"#ff9800"},j=100,v=60,w=3,k=4,T=(p.palette.mode,o.length>0?(()=>{if(!o||0===o.length)return[];if(!r||!r.some((e=>e.value>0)))return[];const e=new Map;if(c&&c.length>0){const t=c.filter((e=>o.includes(e.tag)));t.length>0?t.forEach((t=>{e.set(t.tag,t.totalTrades)})):o.forEach((t=>{const r=t.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0)%10+1;e.set(t,r)}))}else o.forEach((t=>{const r=t.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0)%10+1;e.set(t,r)}));return Array.from(e.entries()).map((e=>{let[t,r]=e;return{name:t,value:r}}))})():t);return(0,A.jsxs)(x.A,{elevation:"dark"===p.palette.mode?2:1,sx:{p:3,borderRadius:2,height:"100%",display:"flex",flexDirection:"column",bgcolor:p.palette.background.paper},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,pb:1.5},children:[(0,A.jsx)(g.A,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:o.length>0?(0,A.jsx)(A.Fragment,{children:"Tag Distribution"}):(0,A.jsx)(A.Fragment,{children:"Win/Loss Distribution"})}),(0,A.jsx)(E.A,{variant:"outlined",size:"small",onClick:()=>f(!0),sx:{textTransform:"none"},children:o.length>0?`Compare: ${o.length} tags`:"Compare Tags"}),(0,A.jsx)(U,{open:y,onClose:()=>f(!1),title:"Select Tags to Compare",allTags:s,selectedTags:o,onTagsChange:e=>i(e),showApplyButton:!0,showClearButton:!0})]}),(0,A.jsx)(m.A,{sx:{flex:1,minHeight:300},className:"win-loss-chart-container",children:o.length>0&&0===T.length?(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",flexDirection:"column",gap:2},children:[(0,A.jsx)(g.A,{variant:"body1",color:"text.secondary",children:"No trades found with the selected tags"}),(0,A.jsx)(g.A,{variant:"caption",color:"text.secondary",children:"Try selecting different tags for comparison"})]}):(0,A.jsx)(n.u,{width:"100%",height:"100%",children:(0,A.jsxs)(P.r,{style:{outline:"none"},tabIndex:-1,margin:{top:5,right:5,bottom:5,left:5},children:[(0,A.jsx)(d.m,{content:e=>{let{active:t,payload:r}=e;if(t&&r&&r.length){const e=r[0].payload;return(0,A.jsxs)(x.A,{sx:{p:1.5,boxShadow:p.shadows[3]},children:[(0,A.jsx)(g.A,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:e.name}),(0,A.jsxs)(g.A,{variant:"body2",sx:{color:o.length>0?(0,L.yC)(e.name):"Wins"===e.name?b.win:"Losses"===e.name?b.loss:"Breakeven"===e.name?b.breakEven:b.zero,fontWeight:"bold"},children:[e.value," trade",1!==e.value?"s":""]}),(0,A.jsxs)(g.A,{variant:"body2",color:"text.secondary",children:[(e.value/T.reduce(((e,t)=>e+t.value),0)*100).toFixed(1),"% of total"]}),l&&(0,A.jsx)(g.A,{variant:"body2",sx:{color:p.palette.primary.main,fontSize:"0.75rem",mt:.5},children:"Click to view trades"})]})}return null}}),(0,A.jsx)(z.F,{data:T,cx:"50%",cy:"50%",labelLine:!1,outerRadius:j,strokeWidth:0,innerRadius:v,fill:"#8884d8",dataKey:"value",label:e=>{let{name:t,percent:r}=e;return r<.05?null:`${t} ${(100*r).toFixed(0)}%`},paddingAngle:w,cornerRadius:k,onClick:e=>{l&&l(e.name)},cursor:"pointer",style:{outline:"none",filter:"drop-shadow(0px 2px 5px rgba(0,0,0,0.1))"},tabIndex:-1,children:T.map(((e,t)=>{let r;return r=o.length>0?(0,L.yC)(e.name):"Wins"===e.name?b.win:"Losses"===e.name?b.loss:"Breakeven"===e.name?b.breakEven:b.zero,(0,A.jsx)(C.f,{fill:r,strokeWidth:1,stroke:p.palette.background.paper,style:{outline:"none",transition:"opacity 0.3s"}},`cell-${t}`)}))}),(0,A.jsx)(F.s,{verticalAlign:"bottom",align:"center",layout:"horizontal",iconSize:12,iconType:"circle",wrapperStyle:{paddingTop:15,fontSize:"0.85rem",fontWeight:500}})]})})}),!(o.length>0&&0===T.length)&&(0,A.jsxs)(m.A,{sx:{display:"flex",justifyContent:"center",mt:2,pt:1.5,flexDirection:"column",alignItems:"center",marginTop:"auto"},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:o.length>0?"Showing distribution of selected tags":"Showing win/loss distribution for all trades"}),l&&(0,A.jsx)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5,bgcolor:(0,u.X4)(p.palette.primary.main,.08),px:1.5,py:.5,borderRadius:1},children:(0,A.jsx)(g.A,{variant:"caption",color:"primary",sx:{fontWeight:500},children:"Click on a segment to view trades"})})]})]})};var H=r(70298),G=r(26529),_=r(17347);const q=e=>{let{winLossStats:t,trades:r,onTradeClick:n}=e;const s=(0,h.A)(),o=a.useMemo((()=>{const e=r.filter((e=>"win"===e.type));return 0===e.length?null:e.reduce(((e,t)=>t.amount>e.amount?t:e),e[0])}),[r]),i=a.useMemo((()=>{const e=r.filter((e=>"loss"===e.type));return 0===e.length?null:e.reduce(((e,t)=>t.amount<e.amount?t:e),e[0])}),[r]);return(0,A.jsx)(m.A,{children:(t.winners.total>0||t.losers.total>0)&&(0,A.jsxs)(m.A,{sx:{display:"flex",gap:2,mb:3},children:[(0,A.jsxs)(x.A,{sx:{flex:1,p:2,border:`4px solid ${(0,u.X4)(s.palette.success.main,.1)}`,borderRadius:2},children:[(0,A.jsx)(g.A,{variant:"subtitle1",sx:{color:s.palette.success.main,mb:2},children:"Winners"}),(0,A.jsxs)(H.A,{spacing:1.5,children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Total winners"}),(0,A.jsx)(G.A,{title:"Total number of winning trades in the selected period",arrow:!0,children:(0,A.jsx)(_.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"body2",children:t.winners.total})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Best win"}),(0,A.jsx)(G.A,{title:"Your largest winning trade as a percentage of your account",arrow:!0,children:(0,A.jsx)(_.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"body2",children:o?(0,f.vv)(o.amount):"0"})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Average win"}),(0,A.jsx)(G.A,{title:"The average size of your winning trades as a percentage of your account",arrow:!0,children:(0,A.jsx)(_.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"body2",children:(0,f.vv)(t.winners.avgAmount)})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Max consecutive wins"}),(0,A.jsx)(G.A,{title:"Your longest streak of consecutive winning trades",arrow:!0,children:(0,A.jsx)(_.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"body2",children:t.winners.maxConsecutive})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Avg consecutive wins"}),(0,A.jsx)(G.A,{title:"The average number of wins you achieve in a row before a loss",arrow:!0,children:(0,A.jsx)(_.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"body2",children:t.winners.avgConsecutive.toFixed(1)})]})]})]}),(0,A.jsxs)(x.A,{sx:{flex:1,p:2,border:`4px solid ${(0,u.X4)(s.palette.error.main,.1)}`,borderRadius:2},children:[(0,A.jsx)(g.A,{variant:"subtitle1",sx:{color:s.palette.error.main,mb:2},children:"Losers"}),(0,A.jsxs)(H.A,{spacing:1.5,children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Total losers"}),(0,A.jsx)(G.A,{title:"Total number of losing trades in the selected period",arrow:!0,children:(0,A.jsx)(_.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"body2",children:t.losers.total})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Worst loss"}),(0,A.jsx)(G.A,{title:"Your largest losing trade as a percentage of your account",arrow:!0,children:(0,A.jsx)(_.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"body2",children:i?(0,f.vv)(Math.abs(i.amount)):"0"})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Average loss"}),(0,A.jsx)(G.A,{title:"The average size of your losing trades as a percentage of your account",arrow:!0,children:(0,A.jsx)(_.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"body2",children:(0,f.vv)(Math.abs(t.losers.avgAmount))})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Max consecutive losses"}),(0,A.jsx)(G.A,{title:"Your longest streak of consecutive losing trades",arrow:!0,children:(0,A.jsx)(_.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"body2",children:t.losers.maxConsecutive})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Avg consecutive losses"}),(0,A.jsx)(G.A,{title:"The average number of losses you have in a row before a win",arrow:!0,children:(0,A.jsx)(_.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"body2",children:t.losers.avgConsecutive.toFixed(1)})]})]})]})]})})};var V=r(2431);const J=e=>{let{trades:t,selectedDate:r,timePeriod:s,allTags:c,primaryTags:p,secondaryTags:y,setPrimaryTags:b,setSecondaryTags:j,filteredTagStats:v,setMultipleTradesDialog:C}=e;const T=(0,h.A)(),[S,M]=(0,a.useState)(!1),[D,I]=(0,a.useState)(!1),W="#4caf50",R="#f44336";return(0,A.jsxs)(m.A,{children:[(0,A.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,A.jsx)(g.A,{variant:"h6",children:"Tag Performance Analysis"}),(0,A.jsx)(G.A,{title:"Analyze how different tags perform. Select primary tags to filter, and optionally secondary tags to see how they perform in combination.",arrow:!0,placement:"top",children:(0,A.jsx)(_.A,{sx:{fontSize:16,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",gap:1},children:[(0,A.jsx)(G.A,{title:"Select primary tags to filter trades that have ANY of these tags. These are your main strategies or setups to analyze.",arrow:!0,placement:"top",children:(0,A.jsx)(E.A,{variant:"outlined",size:"small",onClick:()=>M(!0),sx:{textTransform:"none"},children:p.length>0?`Primary: ${p.length} tags`:"Select Primary Tags"})}),(0,A.jsx)(G.A,{title:"Select secondary tags to further filter trades that have ALL of these tags. Use this to analyze specific conditions within your primary strategies.",arrow:!0,placement:"top",children:(0,A.jsx)(E.A,{variant:"outlined",size:"small",onClick:()=>I(!0),color:y.length>0?"secondary":"primary",sx:{textTransform:"none",borderColor:y.length>0?"secondary.main":void 0},children:y.length>0?`Secondary: ${y.length} tags`:"Select Secondary Tags"})}),(0,A.jsx)(U,{open:S,onClose:()=>M(!1),title:"Select Primary Tags",allTags:c,selectedTags:p,onTagsChange:e=>b(e),showApplyButton:!0,showClearButton:!0}),(0,A.jsx)(U,{open:D,onClose:()=>I(!1),title:"Select Secondary Tags",allTags:c,selectedTags:y,onTagsChange:e=>j(e),showApplyButton:!0,showClearButton:!0})]})]}),0===p.length&&0===y.length?(0,A.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:300,bgcolor:(0,u.X4)(T.palette.background.paper,.4),borderRadius:2,p:3},children:[(0,A.jsx)(g.A,{variant:"h6",color:"text.secondary",sx:{mb:1},children:"No Tags Selected"}),(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",align:"center",children:"Please select primary or secondary tags to view performance analysis."})]}):(0,A.jsx)(n.u,{width:"100%",height:300,children:(0,A.jsxs)(w.E,{data:v,margin:{top:20,right:30,left:20,bottom:5},maxBarSize:50,children:[(0,A.jsx)(o.d,{strokeDasharray:"3 3",vertical:!1}),(0,A.jsx)(i.W,{dataKey:"tag",axisLine:!1,tickLine:!1,tick:{fill:T.palette.text.secondary,fontSize:12}}),(0,A.jsx)(l.h,{axisLine:!1,tickLine:!1,tick:{fill:T.palette.text.secondary,fontSize:12}}),(0,A.jsx)(d.m,{content:e=>{let{active:t,payload:r,label:a}=e;if(t&&r&&r.length){const e=r[0].payload;return(0,A.jsxs)(x.A,{sx:{p:1.5,bgcolor:"background.paper"},children:[(0,A.jsx)(g.A,{variant:"body2",sx:{fontWeight:"bold"},children:a}),(0,A.jsxs)(g.A,{variant:"body2",sx:{color:W},children:["Wins: ",e.wins]}),(0,A.jsxs)(g.A,{variant:"body2",sx:{color:R},children:["Losses: ",e.losses]}),(0,A.jsxs)(g.A,{variant:"body2",color:"text.secondary",children:["Win Rate: ",e.winRate,"%"]}),(0,A.jsxs)(g.A,{variant:"body2",sx:{color:e.totalPnL>0?W:R,fontWeight:"bold",mt:.5},children:["P&L: ",(0,f.Fl)(e.totalPnL)]})]})}return null}}),(0,A.jsx)(F.s,{}),(0,A.jsx)(k.y,{dataKey:"wins",name:"Wins",stackId:"trades",fill:W,radius:[4,4,0,0],onClick:e=>{if(e&&e.payload){const a=e.payload.tag,n=t.filter((e=>{var t;return(null===(t=e.tags)||void 0===t?void 0:t.includes(a))&&"win"===e.type&&("month"===s?(0,V.A)(new Date(e.date),r):"year"!==s||new Date(e.date).getFullYear()===r.getFullYear())}));n.length>0&&C({open:!0,trades:n,date:`Winning trades with tag: ${a}`,expandedTradeId:1===n.length?n[0].id:null})}},style:{cursor:"pointer"}}),(0,A.jsx)(k.y,{dataKey:"losses",name:"Losses",stackId:"trades",fill:R,radius:[4,4,0,0],onClick:e=>{if(e&&e.payload){const a=e.payload.tag,n=t.filter((e=>{var t;return(null===(t=e.tags)||void 0===t?void 0:t.includes(a))&&"loss"===e.type&&("month"===s?(0,V.A)(new Date(e.date),r):"year"!==s||new Date(e.date).getFullYear()===r.getFullYear())}));n.length>0&&C({open:!0,trades:n,date:`Losing trades with tag: ${a}`,expandedTradeId:1===n.length?n[0].id:null})}},style:{cursor:"pointer"}})]})})]})};var K=r(23275);const Z=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Q=e=>{let{trades:t,selectedDate:r,timePeriod:s,allTags:c,primaryTags:p,secondaryTags:y,setPrimaryTags:b,setSecondaryTags:j,setMultipleTradesDialog:v}=e;const T=(0,h.A)(),[S,M]=(0,a.useState)(!1),[D,I]=(0,a.useState)(!1),[W,R]=(0,a.useState)("winRate"),P=a.useMemo((()=>({win:T.palette.success.main,loss:T.palette.error.main,neutral:T.palette.grey[500],sunday:"#FF6384",monday:"#36A2EB",tuesday:"#FFCE56",wednesday:"#4BC0C0",thursday:"#9966FF",friday:"#FF9F40",saturday:"#C9CBCF"})),[T]),z=a.useMemo((()=>{if(0===p.length)return[];const e=t.filter((e=>{if(!e.tags||0===e.tags.length)return!1;return!!p.some((t=>{var r;return null===(r=e.tags)||void 0===r?void 0:r.includes(t)}))&&(!(y.length>0)||y.every((t=>{var r;return null===(r=e.tags)||void 0===r?void 0:r.includes(t)})))}));return Z.map(((t,r)=>{const a=e.filter((e=>{const t=new Date(e.date);return(0,K.A)(t)===r})),n=a.length,s=a.filter((e=>"win"===e.type)).length,o=a.filter((e=>"loss"===e.type)).length,i=n>0?s/n*100:0,l=a.reduce(((e,t)=>e+t.amount),0);return{day:t,dayIndex:r,totalTrades:n,winTrades:s,lossTrades:o,winRate:i,pnl:l,trades:a}}))}),[t,p,y]),L=a.useMemo((()=>z.map((e=>({day:e.day.substring(0,3),fullDay:e.day,value:"winRate"===W?e.winRate:e.pnl,totalTrades:e.totalTrades,winTrades:e.winTrades,lossTrades:e.lossTrades,winRate:e.winRate,pnl:e.pnl,trades:e.trades,color:P[e.day.toLowerCase()]||P.neutral})))),[z,W,P]),$=e=>{let{active:t,payload:r,label:a}=e;if(t&&r&&r.length){const e=r[0].payload;return(0,A.jsxs)(x.A,{sx:{p:1.5,bgcolor:"background.paper"},children:[(0,A.jsx)(g.A,{variant:"body2",sx:{fontWeight:"bold"},children:e.fullDay}),(0,A.jsxs)(g.A,{variant:"body2",children:["Total Trades: ",e.totalTrades]}),(0,A.jsxs)(g.A,{variant:"body2",sx:{color:P.win},children:["Wins: ",e.winTrades]}),(0,A.jsxs)(g.A,{variant:"body2",sx:{color:P.loss},children:["Losses: ",e.lossTrades]}),(0,A.jsxs)(g.A,{variant:"body2",children:["Win Rate: ",e.winRate.toFixed(1),"%"]}),(0,A.jsxs)(g.A,{variant:"body2",children:["P&L: ",(0,f.vv)(e.pnl)]})]})}return null};return(0,A.jsxs)(m.A,{children:[(0,A.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,A.jsx)(g.A,{variant:"h6",children:"Tag Performance by Day of Week"}),(0,A.jsx)(G.A,{title:"Analyze how selected tags perform on different days of the week. This helps identify which strategies work better on specific days.",arrow:!0,placement:"top",children:(0,A.jsx)(_.A,{sx:{fontSize:16,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",gap:1},children:[(0,A.jsx)(E.A,{variant:"winRate"===W?"contained":"outlined",size:"small",onClick:()=>R("winRate"),sx:{textTransform:"none"},children:"Win Rate"}),(0,A.jsx)(E.A,{variant:"pnl"===W?"contained":"outlined",size:"small",onClick:()=>R("pnl"),sx:{textTransform:"none"},children:"P&L"}),(0,A.jsx)(G.A,{title:"Select primary tags to filter trades that have ANY of these tags. These are your main strategies or setups to analyze.",arrow:!0,placement:"top",children:(0,A.jsx)(E.A,{variant:"outlined",size:"small",onClick:()=>M(!0),sx:{textTransform:"none"},children:p.length>0?`Primary: ${p.length} tags`:"Select Primary Tags"})}),(0,A.jsx)(G.A,{title:"Select secondary tags to further filter trades that have ALL of these tags. Use this to analyze specific conditions within your primary strategies.",arrow:!0,placement:"top",children:(0,A.jsx)(E.A,{variant:"outlined",size:"small",onClick:()=>I(!0),color:y.length>0?"secondary":"primary",sx:{textTransform:"none",borderColor:y.length>0?"secondary.main":void 0},children:y.length>0?`Secondary: ${y.length} tags`:"Select Secondary Tags"})}),(0,A.jsx)(U,{open:S,onClose:()=>M(!1),title:"Select Primary Tags",allTags:c,selectedTags:p,onTagsChange:e=>b(e),showApplyButton:!0,showClearButton:!0}),(0,A.jsx)(U,{open:D,onClose:()=>I(!1),title:"Select Secondary Tags",allTags:c,selectedTags:y,onTagsChange:e=>j(e),showApplyButton:!0,showClearButton:!0})]})]}),0===p.length?(0,A.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:300,bgcolor:(0,u.X4)(T.palette.background.paper,.4),borderRadius:2,p:3},children:[(0,A.jsx)(g.A,{variant:"h6",color:"text.secondary",sx:{mb:1},children:"No Tags Selected"}),(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",align:"center",children:"Please select primary tags to view day of week performance analysis."})]}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(m.A,{sx:{mb:2},children:[(0,A.jsxs)(g.A,{variant:"body2",color:"text.secondary",sx:{lineHeight:1.6},children:["This chart shows how your selected trading strategies (tags) perform on different days of the week.","winRate"===W?" Higher bars indicate better win rates on those days. ":" Higher bars indicate better profitability on those days. ","Click on any bar to see the specific trades for that day."]}),L.some((e=>e.totalTrades>0))?(0,A.jsx)(g.A,{variant:"body2",color:"primary",sx:{mt:1,fontWeight:500},children:"winRate"===W?`Best day for selected strategies: ${L.reduce(((e,t)=>t.totalTrades>0&&t.winRate>e.winRate?t:e),{winRate:0,fullDay:"None"}).fullDay}`:`Most profitable day: ${L.reduce(((e,t)=>t.totalTrades>0&&t.pnl>e.pnl?t:e),{pnl:-1/0,fullDay:"None"}).fullDay}`}):null]}),(0,A.jsx)(n.u,{width:"100%",height:300,children:(0,A.jsxs)(w.E,{data:L,margin:{top:20,right:30,left:20,bottom:5},maxBarSize:50,children:[(0,A.jsx)(o.d,{strokeDasharray:"3 3",vertical:!1}),(0,A.jsx)(i.W,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fill:T.palette.text.secondary,fontSize:12}}),(0,A.jsx)(l.h,{axisLine:!1,tickLine:!1,tick:{fill:T.palette.text.secondary,fontSize:12},domain:"winRate"===W?[0,100]:["auto","auto"],tickFormatter:"winRate"===W?e=>`${e}%`:e=>(0,f.vv)(e).replace("$","")}),(0,A.jsx)(d.m,{content:(0,A.jsx)($,{})}),(0,A.jsx)(F.s,{}),(0,A.jsx)(k.y,{dataKey:"value",name:"winRate"===W?"Win Rate":"P&L",fill:T.palette.primary.main,radius:[4,4,0,0],onClick:e=>{if(e&&e.payload){const t=e.payload.trades;t.length>0&&v({open:!0,trades:t,date:`${"winRate"===W?"Win Rate":"P&L"} for ${e.payload.fullDay}`,expandedTradeId:1===t.length?t[0].id:null})}},style:{cursor:"pointer"},children:L.map(((e,t)=>(0,A.jsx)(C.f,{fill:e.color},`cell-${t}`)))})]})})]})]})};var ee=r(28259),te=r(87443),re=r(10756),ae=r(86172),ne=r(81341),se=r(34375),oe=r(6013),ie=r(92248),le=r(69863);const de=e=>{let{dailySummaryData:t,trades:r,setMultipleTradesDialog:n}=e;const s=(0,h.A)(),o=a.useMemo((()=>t&&0!==t.length?t.reduce(((e,t)=>e+t.pnl),0):0),[t]);return(0,A.jsxs)(x.A,{sx:{p:3,borderRadius:2,height:"100%",display:"flex",flexDirection:"column"},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,A.jsx)(g.A,{variant:"h6",children:"Daily Summary"}),(0,A.jsx)(G.A,{title:"Daily trading summary showing trades, session, and P&L for each day",arrow:!0,placement:"top",children:(0,A.jsx)(_.A,{sx:{fontSize:16,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),t&&t.length>0&&(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1,bgcolor:(0,u.X4)(o>0?s.palette.success.main:o<0?s.palette.error.main:s.palette.grey[500],.1),px:1.5,py:.5,borderRadius:2,border:`1px solid ${(0,u.X4)(o>0?s.palette.success.main:o<0?s.palette.error.main:s.palette.grey[500],.2)}`},children:[o>0?(0,A.jsx)(oe.A,{sx:{color:s.palette.success.main}}):o<0?(0,A.jsx)(ie.A,{sx:{color:s.palette.error.main}}):(0,A.jsx)(le.A,{sx:{color:s.palette.grey[500]}}),(0,A.jsxs)(g.A,{variant:"subtitle1",sx:{fontWeight:600,color:o>0?s.palette.success.main:o<0?s.palette.error.main:"text.secondary"},children:["Total P&L: ",(0,f.Fl)(o)]})]})]}),(0,A.jsx)(ee.A,{sx:{flex:1,overflow:"auto",...(0,B.J)(s)},children:(0,A.jsxs)(te.A,{stickyHeader:!0,size:"small",children:[(0,A.jsx)(re.A,{children:(0,A.jsxs)(ae.A,{children:[(0,A.jsx)(ne.A,{sx:{fontWeight:600,backgroundColor:s.palette.background.paper,borderBottom:`2px solid ${s.palette.divider}`,color:"text.secondary"},children:"DATE"}),(0,A.jsx)(ne.A,{align:"right",sx:{fontWeight:600,backgroundColor:s.palette.background.paper,borderBottom:`2px solid ${s.palette.divider}`,color:"text.secondary"},children:"TRADES"}),(0,A.jsx)(ne.A,{align:"center",sx:{fontWeight:600,backgroundColor:s.palette.background.paper,borderBottom:`2px solid ${s.palette.divider}`,color:"text.secondary"},children:"SESSION"}),(0,A.jsx)(ne.A,{align:"right",sx:{fontWeight:600,backgroundColor:s.palette.background.paper,borderBottom:`2px solid ${s.palette.divider}`,color:"text.secondary"},children:"P/L"})]})}),(0,A.jsx)(se.A,{children:t.map((e=>(0,A.jsxs)(ae.A,{onClick:()=>{const t=r.filter((t=>(0,y.A)(new Date(t.date),"yyyy-MM-dd")===(0,y.A)(e.date,"yyyy-MM-dd")));t.length>0&&n({open:!0,trades:t,date:(0,y.A)(e.date,"dd/MM/yyyy"),expandedTradeId:1===t.length?t[0].id:null})},sx:{"&:last-child td, &:last-child th":{border:0},"&:hover":{backgroundColor:(0,u.X4)(s.palette.primary.main,.04),cursor:"pointer"},bgcolor:e.pnl>0?(0,u.X4)(s.palette.success.main,.05):e.pnl<0?(0,u.X4)(s.palette.error.main,.05):"transparent"},children:[(0,A.jsx)(ne.A,{sx:{fontWeight:500,color:"text.primary"},children:(0,y.A)(e.date,"dd/MM/yyyy")}),(0,A.jsx)(ne.A,{align:"right",sx:{fontWeight:500,color:"text.primary"},children:e.trades}),(0,A.jsx)(ne.A,{align:"center",children:e.session?(0,A.jsx)(g.A,{sx:{color:"text.primary",fontWeight:500},children:e.session}):(0,A.jsx)(g.A,{sx:{color:"text.secondary",fontStyle:"italic"},children:"\u2014"})}),(0,A.jsx)(ne.A,{align:"right",sx:{color:e.pnl>0?s.palette.success.main:e.pnl<0?s.palette.error.main:"text.secondary",fontWeight:600,fontSize:"0.875rem"},children:(0,f.Fl)(e.pnl)})]},(0,y.A)(e.date,"yyyy-MM-dd"))))})]})})]})},ce=e=>{let{sessionStats:t,trades:r,selectedDate:a,timePeriod:n,setMultipleTradesDialog:s}=e;const o=(0,h.A)(),i="#4caf50",l="#f44336",d={Asia:"#2962ff",London:"#388e3c","NY AM":"#f57c00","NY PM":"#9c27b0"};return(0,A.jsxs)(x.A,{elevation:"dark"===o.palette.mode?2:1,sx:{p:3,borderRadius:2,height:"100%",display:"flex",flexDirection:"column",bgcolor:o.palette.background.paper},children:[(0,A.jsx)(g.A,{variant:"h6",sx:{mb:2},children:"Session Performance"}),(0,A.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",gap:3,flex:1,minHeight:300},children:[(0,A.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",gap:2,flexWrap:"wrap"},children:t.map((e=>(0,A.jsxs)(x.A,{sx:{p:2,border:`1px solid ${(0,u.X4)(d[e.session],.3)}`,borderRadius:2,bgcolor:"dark"===o.palette.mode?"rgba(0, 0, 0, 0.2)":"rgba(0, 0, 0, 0.02)",opacity:0===e.totalTrades?.5:1,cursor:e.totalTrades>0?"pointer":"default",transition:"all 0.2s","&:hover":{boxShadow:e.totalTrades>0?o.shadows[2]:"none",bgcolor:e.totalTrades>0?(0,u.X4)(o.palette.primary.main,.05):"dark"===o.palette.mode?"rgba(0, 0, 0, 0.2)":"rgba(0, 0, 0, 0.02)"}},onClick:()=>{if(e.totalTrades>0){const t=r.filter((t=>t.session===e.session&&("month"===n?(0,V.A)(new Date(t.date),a):"year"!==n||new Date(t.date).getFullYear()===a.getFullYear())));s({open:!0,trades:t,date:`${e.session} Session Trades`,expandedTradeId:1===t.length?t[0].id:null})}},children:[(0,A.jsx)(g.A,{variant:"subtitle2",gutterBottom:!0,sx:{color:d[e.session]},children:e.session}),(0,A.jsxs)(H.A,{spacing:1,children:[(0,A.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Total Trades"}),(0,A.jsx)(g.A,{variant:"body2",children:e.totalTrades})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Win Rate"}),(0,A.jsxs)(g.A,{variant:"body2",sx:{color:e.winRate>=50?o.palette.success.main:o.palette.error.main},children:[e.winRate.toFixed(1),"%"]})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"P&L"}),(0,A.jsx)(g.A,{variant:"body2",sx:{color:e.totalPnL>0?o.palette.success.main:o.palette.error.main,fontWeight:500},children:(0,f.Fl)(e.totalPnL)})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,A.jsx)(g.A,{variant:"caption",color:"text.secondary",children:"Avg P&L per Trade"}),(0,A.jsx)(g.A,{variant:"body2",sx:{ml:1,color:e.averagePnL>0?o.palette.success.main:o.palette.error.main},children:(0,f.Fl)(e.averagePnL)})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Account %"}),(0,A.jsxs)(g.A,{variant:"body2",sx:{color:e.pnlPercentage>0?o.palette.success.main:o.palette.error.main},children:[e.pnlPercentage.toFixed(2),"%"]})]}),(0,A.jsxs)(m.A,{sx:{display:"flex",gap:1,mt:1},children:[(0,A.jsx)(m.A,{sx:{flex:e.winners,height:6,bgcolor:i,borderRadius:1}}),(0,A.jsx)(m.A,{sx:{flex:e.losers,height:6,bgcolor:l,borderRadius:1}})]}),(0,A.jsx)(m.A,{sx:{height:3,bgcolor:(0,u.X4)(d[e.session],.2),borderRadius:1,mt:1}})]})]},e.session)))}),t.some((e=>e.totalTrades>0))&&(0,A.jsxs)(m.A,{sx:{p:2,bgcolor:"dark"===o.palette.mode?"rgba(33, 150, 243, 0.1)":"rgba(33, 150, 243, 0.05)",border:`1px solid ${(0,u.X4)(o.palette.info.main,.2)}`,borderRadius:2,mt:1},children:[(0,A.jsx)(g.A,{variant:"subtitle2",sx:{color:o.palette.info.main,fontWeight:600,mb:1,display:"flex",alignItems:"center",gap:1},children:"\ud83d\udca1 Pro Tip"}),(0,A.jsx)(g.A,{variant:"body2",color:"text.secondary",children:(()=>{const e=t.filter((e=>e.totalTrades>0));if(0===e.length)return"No trading data available for analysis.";const r=e.reduce(((e,t)=>t.totalPnL>e.totalPnL?t:e)),a=e.reduce(((e,t)=>t.winRate>e.winRate?t:e)),n=e.reduce(((e,t)=>t.averagePnL>e.averagePnL?t:e));if(r.totalPnL>0)return r.session===a.session&&r.session===n.session?`${r.session} session is your strongest performer with the highest total P&L (${(0,f.Fl)(r.totalPnL)}), best win rate (${r.winRate.toFixed(1)}%), and highest average per trade (${(0,f.Fl)(r.averagePnL)}). Consider focusing more trades during this session.`:r.session===a.session?`${r.session} session has both the highest total P&L (${(0,f.Fl)(r.totalPnL)}) and best win rate (${r.winRate.toFixed(1)}%). ${n.session} session has the best average per trade (${(0,f.Fl)(n.averagePnL)}).`:`${r.session} session is most profitable overall (${(0,f.Fl)(r.totalPnL)}), while ${a.session} session has the highest win rate (${a.winRate.toFixed(1)}%). Consider analyzing what makes each session successful.`;{const t=e.reduce(((e,t)=>t.totalPnL>e.totalPnL?t:e));return`All sessions are currently showing losses. ${t.session} session has the smallest loss (${(0,f.Fl)(t.totalPnL)}). Consider reviewing your strategy and risk management.`}})()})]})]})]})};var pe=r(85662),he=r(24915),xe=r(90668),ge=r(58309);const me=e=>{let{open:t,trades:r,date:n,expandedTradeId:s,onClose:o,onTradeExpand:i,onZoomImage:l,accountBalance:d,allTrades:c,onUpdateTradeProperty:p,onEditClick:h,onDeleteClick:x,onDeleteMultiple:u,onOpenGalleryMode:y,calendarId:f}=e;const b=a.useMemo((()=>r.reduce(((e,t)=>e+t.amount),0)),[r]),j=(0,A.jsxs)(g.A,{variant:"h6",children:[r.length," ",1===r.length?"Trade":"Trades"," for ",n]}),v=y&&r.length>0?(0,A.jsx)(G.A,{title:"View trades in gallery mode",children:(0,A.jsx)(E.A,{variant:"contained",size:"large",startIcon:(0,A.jsx)(pe.A,{}),onClick:()=>{if(y&&r.length>0){const e=`${n} - ${r.length} Trade${r.length>1?"s":""}`;y(r,s||r[0].id,e),o()}},sx:{textTransform:"none",fontWeight:600,borderRadius:1.5,px:3},children:"Gallery View"})}):void 0;return(0,A.jsx)(O.mY,{open:t,onClose:o,maxWidth:"sm",fullWidth:!0,title:j,actions:v,children:(0,A.jsxs)(m.A,{sx:{p:2},children:[(0,A.jsx)(xe.A,{title:"",accountBalance:d+(0,ge.Kv)((0,ge.b4)(n),c),formInputVisible:!0,totalPnL:b,onPrevDay:()=>{},onNextDay:()=>{}}),(0,A.jsx)(he.A,{sx:{mt:0},trades:r,expandedTradeId:s,onTradeClick:i,onEditClick:h||(()=>{}),onDeleteClick:x||(()=>{}),onDeleteMultiple:u,onZoomedImage:l,onUpdateTradeProperty:p,hideActions:!h&&!x,enableBulkSelection:r.length>1&&!!u,calendarId:f,onOpenGalleryMode:y})]})})},ue=e=>{let{riskRewardStats:t}=e;const r=(0,h.A)();return 0===t.data.length?null:(0,A.jsxs)(x.A,{sx:{p:2,mb:2,borderRadius:2},children:[(0,A.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,A.jsxs)(m.A,{children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[(0,A.jsx)(g.A,{variant:"body2",sx:{color:"text.secondary"},children:"Average RR"}),(0,A.jsx)(G.A,{title:"Average Risk to reward ratio (RR) per trade. An RR of 2 means that for every 1$ you risk you will make 2$.",arrow:!0,placement:"top",children:(0,A.jsx)(_.A,{sx:{fontSize:16,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"h4",sx:{fontWeight:500,color:"text.primary"},children:t.average.toFixed(2)})]}),(0,A.jsxs)(m.A,{children:[(0,A.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[(0,A.jsx)(g.A,{variant:"body2",sx:{color:"text.secondary"},children:"Max RR"}),(0,A.jsx)(G.A,{title:"Maximum Risk to reward Ratio between all your trades. You can use the small graph at the bottom of this card to see the RR of every one of your trades.",arrow:!0,placement:"top",children:(0,A.jsx)(_.A,{sx:{fontSize:16,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,A.jsx)(g.A,{variant:"h4",sx:{fontWeight:500,color:"text.primary"},children:t.max.toFixed(2)})]})]}),(0,A.jsx)(m.A,{sx:{height:60,mt:2},children:(0,A.jsx)(n.u,{width:"100%",height:"100%",children:(0,A.jsxs)(s.Q,{data:t.data,margin:{top:0,right:0,left:0,bottom:0},children:[(0,A.jsx)("defs",{children:(0,A.jsxs)("linearGradient",{id:"rrGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,A.jsx)("stop",{offset:"5%",stopColor:r.palette.primary.main,stopOpacity:.3}),(0,A.jsx)("stop",{offset:"95%",stopColor:r.palette.primary.main,stopOpacity:0})]})}),(0,A.jsx)(p.G,{type:"monotone",dataKey:"rr",stroke:r.palette.primary.main,strokeWidth:2,fill:"url(#rrGradient)",dot:!1})]})})})]})}},23893:(e,t,r)=>{r.d(t,{Fl:()=>a,vv:()=>n});const a=e=>Math.abs(e)>=1e3?`$${(e/1e3).toFixed(1)}k`:`$${e.toFixed(2)}`,n=e=>`$${e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},24915:(e,t,r)=>{r.d(t,{A:()=>M});var a=r(65043),n=r(53969),s=r(55895),o=r(83759),i=r(12097),l=r(70298),d=r(38865),c=r(26529),p=r(42579),h=r(80172),x=r(27230),g=r(12324),m=r(20312),u=r(94045),y=r(70149),f=r(27496),A=r(64),b=r(25272),j=r(61773),v=r(5362),w=r(64924),k=r(81084),C=r(60267),T=r(14204),S=r(70579);const M=e=>{let{trades:t,expandedTradeId:r,onTradeClick:M,onEditClick:D,onDeleteClick:I,onDeleteMultiple:W,onZoomedImage:R,onUpdateTradeProperty:P,hideActions:z=!1,enableBulkSelection:F=!1,sx:E,deletingTradeIds:L=[],calendarId:$,onOpenGalleryMode:X}=e;const N=(0,C.A)(),[O,B]=(0,a.useState)([]),U=e=>L.includes(e),Y=e=>O.includes(e);return(0,S.jsxs)(n.A,{sx:{mt:2,...E},children:[(0,S.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[(0,S.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[(0,S.jsx)(s.A,{variant:"subtitle1",sx:{mr:1},children:"Trades"}),t.length>0&&(0,S.jsx)(o.A,{label:t.length,size:"small",color:"primary",sx:{height:20,minWidth:40,"& .MuiChip-label":{px:1,fontSize:"0.75rem",color:"primary.main"},background:"none",border:"2px dotted",borderColor:"primary.main"}}),F&&O.length>0&&(0,S.jsx)(o.A,{label:`${O.length} selected`,size:"small",color:"secondary",sx:{height:20,ml:1,"& .MuiChip-label":{px:1,fontSize:"0.75rem"}}})]}),F&&t.length>0&&(0,S.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,S.jsx)(i.A,{size:"small",startIcon:(0,S.jsx)(x.A,{}),onClick:()=>{O.length===t.length?B([]):B(t.map((e=>e.id)))},sx:{minWidth:"auto",fontSize:"0.75rem"},children:O.length===t.length?"None":"All"}),O.length>0&&(0,S.jsxs)(i.A,{size:"small",color:"error",startIcon:(0,S.jsx)(g.A,{}),onClick:()=>{W&&O.length>0&&(W(O),B([]))},sx:{minWidth:"auto",fontSize:"0.75rem"},children:["Delete (",O.length,")"]})]})]}),0===t.length?(0,S.jsx)(s.A,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:"No trades for this day"}):(0,S.jsx)(l.A,{spacing:1,children:t.map((e=>(0,S.jsxs)(a.Fragment,{children:[(0,S.jsxs)(w.uf,{$type:e.type,onClick:U(e.id)?void 0:()=>M(e.id),sx:{cursor:U(e.id)?"default":"pointer",...e.isTemporary&&{opacity:.7,border:"1px dashed",borderColor:"divider",backgroundColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.02)"},...U(e.id)&&{opacity:.6,pointerEvents:"none"},...F&&Y(e.id)&&{backgroundColor:e=>"dark"===e.palette.mode?"rgba(144, 202, 249, 0.08)":"rgba(25, 118, 210, 0.08)",borderColor:"primary.main"}},children:[F&&(0,S.jsx)(n.A,{sx:{mr:1,display:"flex",alignItems:"flex-start",pt:.5},onClick:e=>e.stopPropagation(),children:(0,S.jsx)(d.A,{size:"small",checked:Y(e.id),onChange:t=>{var r,a;t.stopPropagation(),r=e.id,a=t.target.checked,B(a?e=>[...e,r]:e=>e.filter((e=>e!==r)))},onClick:e=>e.stopPropagation(),disabled:U(e.id),sx:{p:.5}})}),(0,S.jsxs)(w.j3,{children:[(0,S.jsx)(n.A,{sx:{display:"flex",alignItems:"flex-start",gap:.5,justifyContent:"space-between"},children:(0,S.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column"},children:[e.name&&(0,S.jsx)(n.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:(0,S.jsx)(s.A,{variant:"body2",sx:{fontWeight:600},children:e.isTemporary?e.name:`\ud83d\udcc8 ${e.name.replace(/^\ud83d\udcc8 /,"")}`})}),(0,S.jsxs)(s.A,{variant:"body1",sx:{fontWeight:500,color:"win"===e.type?"success.main":"loss"===e.type?"error.main":"info.main"},children:["$",Math.abs(e.amount).toLocaleString()]}),(0,S.jsxs)(n.A,{sx:{display:"flex",flexDirection:"row",gap:1.5,alignItems:"center",mt:.5,flexWrap:"wrap"},children:[e.images&&e.images.length>0&&(0,S.jsx)(c.A,{title:`${e.images.length} image${e.images.length>1?"s":""}`,children:(0,S.jsx)(n.A,{sx:{display:"flex",alignItems:"center"},children:(0,S.jsx)(m.A,{fontSize:"small",sx:{opacity:.8,fontSize:"1rem",verticalAlign:"middle",color:N.palette.primary.main}})})}),e.notes&&(0,S.jsx)(c.A,{title:e.notes,children:(0,S.jsx)(n.A,{sx:{display:"flex",alignItems:"center"},children:(0,S.jsx)(u.A,{fontSize:"small",sx:{opacity:.8,fontSize:"1rem",verticalAlign:"middle",color:N.palette.info.main}})})}),e.riskToReward&&(0,S.jsx)(c.A,{title:`Risk to Reward: ${e.riskToReward}`,children:(0,S.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,S.jsx)(y.A,{fontSize:"small",sx:{opacity:.8,fontSize:"1rem",verticalAlign:"middle",color:N.palette.warning.main}}),(0,S.jsxs)(s.A,{variant:"caption",sx:{fontSize:"0.7rem",color:"text.secondary",fontWeight:500,bgcolor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.04)",px:.5,py:.2,borderRadius:.5},children:[e.riskToReward,"R"]})]})}),e.session&&(0,S.jsx)(c.A,{title:`Session: ${e.session}`,children:(0,S.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,S.jsx)(f.A,{fontSize:"small",sx:{opacity:.8,fontSize:"1rem",verticalAlign:"middle",color:N.palette.secondary.main}}),(0,S.jsx)(s.A,{variant:"caption",sx:{fontSize:"0.7rem",color:"text.secondary",fontWeight:500,bgcolor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.04)",px:.5,py:.2,borderRadius:.5},children:e.session})]})})]})]})}),e.tags&&e.tags.length>0&&(()=>{const t=e.tags.filter((e=>!e.startsWith("Partials:"))),r={},a=[];return t.forEach((e=>{if((0,k.dn)(e)){const t=(0,k.Oo)(e);r[t]||(r[t]=[]),r[t].push(e)}else a.push(e)})),(0,S.jsxs)(n.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:[Object.entries(r).map((e=>{let[t,r]=e;return(0,S.jsx)(c.A,{title:(0,S.jsx)(n.A,{sx:{p:.5},children:r.map((e=>(0,S.jsx)(s.A,{variant:"body2",children:(0,k.t)(e,!0)},e)))}),arrow:!0,children:(0,S.jsx)(o.A,{label:t,size:"small",sx:{...(0,k.dO)(r[0],N),height:"20px",fontWeight:600,"& .MuiChip-label":{px:1,fontSize:"0.7rem"}}})},t)})),a.map(((e,t)=>(0,S.jsx)(o.A,{label:(0,k.t)(e),size:"small",sx:{...(0,k.dO)(e,N),height:"20px","& .MuiChip-label":{px:1,fontSize:"0.7rem"}}},t)))]})})(),(0,S.jsx)(n.A,{sx:{flex:1,display:"flex",justifyContent:"flex-end"},children:!U(e.id)&&(0,S.jsx)(n.A,{sx:{mt:.5,mr:1},children:r===e.id?(0,S.jsx)(A.A,{fontSize:"small",sx:{color:"text.secondary"}}):(0,S.jsx)(b.A,{fontSize:"small",sx:{color:"text.secondary"}})})})]}),!z&&(0,S.jsxs)(w.wt,{children:[!U(e.id)&&(0,S.jsx)(p.A,{size:"small",onClick:t=>{t.stopPropagation(),D(e)},children:(0,S.jsx)(j.A,{fontSize:"small"})}),(0,S.jsx)(p.A,{size:"small",onClick:t=>{t.stopPropagation(),I(e.id)},disabled:U(e.id),sx:{position:"relative",...U(e.id)&&{"&.Mui-disabled":{color:"error.main",opacity:.7}}},children:U(e.id)?(0,S.jsx)(h.A,{size:16,color:"error"}):(0,S.jsx)(v.A,{fontSize:"small"})})]})]}),r===e.id&&(0,S.jsx)(T.A,{tradeData:e,isExpanded:!0,setZoomedImage:R,onUpdateTradeProperty:P,calendarId:$,trades:t,onOpenGalleryMode:X})]},e.id)))})]})}},30994:(e,t,r)=>{r.d(t,{A:()=>Le});var a=r(65043),n=r(53969),s=r(60267),o=r(94799),i=r(55895),l=r(91449),d=r(70298),c=r(33309),p=r(12843),h=r(80172),x=r(38517),g=r(81911),m=r(42579),u=r(78776),y=r(29651),f=r(27421),A=r(32322),b=r(19170),j=r(23275),v=r(49221);const w={weights:{consistency:40,riskManagement:25,performance:20,discipline:15},thresholds:{minTradesForScore:3,lookbackPeriod:30,consistencyTolerance:15},targets:{winRate:60,profitFactor:1.5,maxDrawdown:5,avgRiskReward:2},selectedTags:[],excludedTagsFromPatterns:[]};var k=r(98349);const C=new class{constructor(){this.minTradesForAnalysis=5,this.minTradesForCombination=3,this.recentPeriodDays=30,this.historicalPeriodDays=90}analyzeTagPatterns(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,r=arguments.length>2?arguments[2]:void 0;const a=(0,b.A)(t,this.recentPeriodDays),n=(0,b.A)(t,this.historicalPeriodDays),s=e.filter((e=>(0,k.A)(new Date(e.date),a))),o=e.filter((e=>(0,k.A)(new Date(e.date),n)&&!(0,k.A)(new Date(e.date),a))),i=this.generateTagCombinations(e,null===r||void 0===r?void 0:r.excludedTagsFromPatterns).map((t=>this.analyzeTagCombination(t,s,o,e))).filter((e=>e.totalTrades>=this.minTradesForCombination)),l=[...i].sort(((e,t)=>{const r=t.winRate-e.winRate;return Math.abs(r)<5?t.totalTrades-e.totalTrades:r})).slice(0,10),d=i.filter((e=>"declining"===e.trend&&e.totalTrades>=this.minTradesForAnalysis)).sort(((e,t)=>e.recentWinRate-e.historicalWinRate-(t.recentWinRate-t.historicalWinRate))).slice(0,5),c=this.generateInsights(l,d,e),p=this.generateMarketConditionAlerts(i,e);return{insights:[...c,...p],topCombinations:l,decliningCombinations:d,marketConditionAlerts:p}}generateTagCombinations(e,t){const r=new Set,a=new Set,n=new Set;e.forEach((e=>{if(e.tags&&e.tags.length>0){const s=e.tags.filter((e=>!e.startsWith("Partials:")&&(!t||!t.includes(e))));if(s.forEach((e=>r.add(e))),s.length>=2)for(let e=0;e<s.length;e++)for(let t=e+1;t<s.length;t++){const r=[s[e],s[t]].sort().join("|");a.add(r)}if(s.length>=3)for(let e=0;e<s.length;e++)for(let t=e+1;t<s.length;t++)for(let r=t+1;r<s.length;r++){const a=[s[e],s[t],s[r]].sort().join("|");n.add(a)}}}));const s=[];return r.forEach((e=>s.push([e]))),a.forEach((e=>s.push(e.split("|")))),e.length>50&&n.forEach((e=>s.push(e.split("|")))),s}analyzeTagCombination(e,t,r,a){const n=a.filter((t=>t.tags&&e.every((e=>t.tags.includes(e))))),s=t.filter((t=>t.tags&&e.every((e=>t.tags.includes(e))))),o=r.filter((t=>t.tags&&e.every((e=>t.tags.includes(e))))),i=n.filter((e=>"win"===e.type)).length,l=n.filter((e=>"loss"===e.type)).length,d=i+l,c=d>0?i/d*100:0,p=n.reduce(((e,t)=>e+t.amount),0),h=n.length>0?p/n.length:0,x=s.filter((e=>"win"===e.type)).length,g=x+s.filter((e=>"loss"===e.type)).length,m=g>0?x/g*100:0,u=o.filter((e=>"win"===e.type)).length,y=u+o.filter((e=>"loss"===e.type)).length,f=y>0?u/y*100:0;let A="stable";if(g>=3&&y>=3){const e=m-f;e>10?A="improving":e<-10&&(A="declining")}return{tags:e,winRate:c,totalTrades:n.length,wins:i,losses:l,totalPnL:p,avgPnL:h,trend:A,recentWinRate:m,historicalWinRate:f}}generateInsights(e,t,r){const a=[];return e.slice(0,3).forEach(((e,t)=>{e.winRate>70&&e.totalTrades>=this.minTradesForAnalysis&&a.push({type:"high_performance",title:`High-Performance Pattern #${t+1}`,description:`The combination "${e.tags.join(" + ")}" shows exceptional performance with ${e.winRate.toFixed(1)}% win rate across ${e.totalTrades} trades.`,tagCombination:e.tags,winRate:e.winRate,confidence:Math.min(95,50+2*e.totalTrades),recommendation:`Consider focusing more on trades that match this pattern. Your success rate with "${e.tags.join(" + ")}" is significantly above average.`,severity:e.winRate>80?"high":"medium"})})),t.forEach(((e,t)=>{const r=e.historicalWinRate-e.recentWinRate;r>15&&a.push({type:"declining_pattern",title:"Declining Pattern Alert",description:`The combination "${e.tags.join(" + ")}" has declined from ${e.historicalWinRate.toFixed(1)}% to ${e.recentWinRate.toFixed(1)}% win rate recently.`,tagCombination:e.tags,winRate:e.recentWinRate,confidence:Math.min(90,40+3*e.totalTrades),recommendation:`Review your approach with "${e.tags.join(" + ")}" trades. Market conditions may have changed, requiring strategy adjustment.`,severity:r>25?"high":"medium"})})),a}generateMarketConditionAlerts(e,t){const r=[];return e.filter((e=>e.tags.some((e=>["Asia","London","NY AM","NY PM"].includes(e))))).forEach((e=>{if("declining"===e.trend&&e.totalTrades>=5){const t=e.tags.find((e=>["Asia","London","NY AM","NY PM"].includes(e)));t&&r.push({type:"market_condition",title:`${t} Session Performance Decline`,description:`Your performance during ${t} session with "${e.tags.filter((e=>e!==t)).join(" + ")}" has declined recently.`,tagCombination:e.tags,winRate:e.recentWinRate,confidence:75,recommendation:`Consider adjusting your strategy for ${t} session or reducing position sizes during this time until performance improves.`,severity:"medium"})}})),r.slice(0,2)}getTagCombinationStats(e,t){const r=(0,b.A)(new Date,this.recentPeriodDays),a=(0,b.A)(new Date,this.historicalPeriodDays),n=e.filter((e=>(0,k.A)(new Date(e.date),r))),s=e.filter((e=>(0,k.A)(new Date(e.date),a)&&!(0,k.A)(new Date(e.date),r)));return this.analyzeTagCombination(t,n,s,e)}};var T=r(5410),S=r(33498),M=r(7609),D=r(407),I=r(72275),W=r(2431),R=r(12382);const P=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w;this.settings=void 0,this.dynamicRiskSettings=void 0,this.settings=e}updateDynamicRiskSettings(e){this.dynamicRiskSettings=e}async calculateScore(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"weekly",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;const n=this.getTradesForPeriod(e,t,r);await new Promise((e=>setTimeout(e,0)));const s=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,a=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;if(0===t.length)return{preferredSessions:[],commonTags:[],avgTradesPerDay:0,avgTradesPerWeek:0,avgPositionSize:0,avgRiskReward:0,winRate:0,profitFactor:0,maxDrawdown:0,tradingDays:[]};const s=(0,b.A)(e,r),o=t.filter((e=>new Date(e.date)>=s)),i=o.reduce(((e,t)=>(t.session&&(e[t.session]=(e[t.session]||0)+1),e)),{}),l=Object.entries(i).sort(((e,t)=>{let[,r]=e,[,a]=t;return a-r})).slice(0,2).map((e=>{let[t]=e;return t})),d=o.reduce(((e,t)=>(t.tags&&t.tags.forEach((t=>{a&&0!==a.length&&!a.includes(t)||(e[t]=(e[t]||0)+1)})),e)),{}),c=Object.entries(d).sort(((e,t)=>{let[,r]=e,[,a]=t;return a-r})).slice(0,5).map((e=>{let[t]=e;return t})),p=r,h=o.length/p,x=7*h,g=o.length>0?n?o.reduce(((e,r)=>e+(0,v.G7)(r,t,n)),0)/o.length:Math.abs(o.reduce(((e,t)=>e+t.amount),0))/o.length:0,m=o.filter((e=>e.riskToReward&&e.riskToReward>0)),u=m.length>0?m.reduce(((e,t)=>e+(t.riskToReward||0)),0)/m.length:0,y=(0,A.l6)(o),f=n?(()=>{const e=o.map((e=>({...e,amount:(0,v.G7)(e,t,n)})));return(0,A.AO)(e)})():(0,A.AO)(o);let w=0,k=0,C=0;o.forEach((e=>{const r=n?(0,v.G7)(e,t,n):e.amount;C+=r,C>k&&(k=C);const a=(k-C)/Math.max(k,1)*100;a>w&&(w=a)}));const T=o.reduce(((e,t)=>{const r=(0,j.A)(new Date(t.date));return e[r]=(e[r]||0)+1,e}),{}),S=Object.entries(T).filter((e=>{let[,t]=e;return t>=.5*h})).map((e=>{let[t]=e;return parseInt(t)})).sort(((e,t)=>e-t));return{preferredSessions:l,commonTags:c,avgTradesPerDay:h,avgTradesPerWeek:x,avgPositionSize:g,avgRiskReward:u,winRate:y,profitFactor:f,maxDrawdown:w,tradingDays:S}}(r,this.getHistoricalTrades(e,r),this.settings.thresholds.lookbackPeriod,this.settings.selectedTags,this.dynamicRiskSettings);await new Promise((e=>setTimeout(e,0)));const o=((e,t,r,a,n)=>{if(e.length<r.thresholds.minTradesForScore)return{score:0,factors:{sessionConsistency:0,tagConsistency:0,timingConsistency:0,sizeConsistency:0}};const s=e.filter((e=>e.session)),o=s.length>0&&t.preferredSessions.length>0?s.filter((e=>t.preferredSessions.includes(e.session))).length/s.length*100:50,i=e.filter((e=>e.tags&&e.tags.length>0)),l=i.length>0&&t.commonTags.length>0?i.filter((e=>e.tags.some((e=>t.commonTags.includes(e))))).length/i.length*100:50,d=e.length>0&&t.tradingDays.length>0?e.filter((e=>t.tradingDays.includes((0,j.A)(new Date(e.date))))).length/e.length*100:50,c=e.length>0?n&&a?e.reduce(((e,t)=>e+(0,v.G7)(t,a,n)),0)/e.length:Math.abs(e.reduce(((e,t)=>e+t.amount),0))/e.length:0,p=t.avgPositionSize>0?Math.abs(c-t.avgPositionSize)/t.avgPositionSize:0,h=Math.max(0,100-100*p),x={sessionConsistency:isNaN(o)?50:o,tagConsistency:isNaN(l)?50:l,timingConsistency:isNaN(d)?50:d,sizeConsistency:isNaN(h)?50:h},g=(x.sessionConsistency+x.tagConsistency+x.timingConsistency+x.sizeConsistency)/4;return{score:isNaN(g)?0:g,factors:x}})(n,s,this.settings,e,this.dynamicRiskSettings),i=((e,t,r,a,n)=>{if(e.length<r.thresholds.minTradesForScore)return{score:0,factors:{riskRewardRatio:0,positionSizing:0,maxDrawdownAdherence:0,stopLossUsage:0}};const s=e.filter((e=>e.riskToReward&&e.riskToReward>0)),o=s.length>0?s.reduce(((e,t)=>e+(t.riskToReward||0)),0)/s.length:0,i=r.targets.avgRiskReward>0?Math.abs(o-r.targets.avgRiskReward)/r.targets.avgRiskReward:0,l=o>0?Math.max(0,100-100*i):50,d=n&&a?e.map((e=>(0,v.G7)(e,a,n))):e.map((e=>Math.abs(e.amount))),c=d.length>0?d.reduce(((e,t)=>e+t),0)/d.length:0,p=d.length>0?d.reduce(((e,t)=>e+Math.pow(t-c,2)),0)/d.length:0,h=Math.sqrt(p),x=c>0?Math.max(0,100-h/c*100):50;let g=0,m=0,u=0;e.forEach((e=>{const t=n&&a?(0,v.G7)(e,a,n):e.amount;u+=t,u>m&&(m=u);const r=m>0?(m-u)/m*100:0;r>g&&(g=r)}));const y=g<=r.targets.maxDrawdown?100:Math.max(0,100-10*(g-r.targets.maxDrawdown)),f=e.filter((e=>"loss"===e.type)),A=f.length>0?n&&a?Math.abs(f.reduce(((e,t)=>e+(0,v.G7)(t,a,n)),0))/f.length:Math.abs(f.reduce(((e,t)=>e+t.amount),0))/f.length:0,b=e.filter((e=>"win"===e.type)),j=b.length>0?n&&a?b.reduce(((e,t)=>e+(0,v.G7)(t,a,n)),0)/b.length:b.reduce(((e,t)=>e+t.amount),0)/b.length:0,w=j>0&&A>0?Math.min(100,j/A*50):50,k={riskRewardRatio:isNaN(l)?50:l,positionSizing:isNaN(x)?50:x,maxDrawdownAdherence:isNaN(y)?50:y,stopLossUsage:isNaN(w)?50:w},C=(k.riskRewardRatio+k.positionSizing+k.maxDrawdownAdherence+k.stopLossUsage)/4;return{score:isNaN(C)?0:C,factors:k}})(n,0,this.settings,e,this.dynamicRiskSettings),l=((e,t,r,a,n)=>{if(e.length<r.thresholds.minTradesForScore)return{score:0,factors:{winRateConsistency:0,profitFactorStability:0,returnsConsistency:0,volatilityControl:0}};const s=(0,A.l6)(e),o=n&&a?(()=>{const t=e.map((e=>({...e,amount:(0,v.G7)(e,a,n)})));return(0,A.AO)(t)})():(0,A.AO)(e),i=t.winRate>0?Math.abs(s-t.winRate)/t.winRate:0,l=t.winRate>0?Math.max(0,100-100*i):50,d=t.profitFactor>0?Math.abs(o-t.profitFactor)/t.profitFactor:0,c=t.profitFactor>0?Math.max(0,100-100*d):50,p=n&&a?e.map((e=>(0,v.G7)(e,a,n))):e.map((e=>e.amount)),h=p.length>0?p.reduce(((e,t)=>e+t),0)/p.length:0,x=p.length>0?p.reduce(((e,t)=>e+Math.pow(t-h,2)),0)/p.length:0,g=Math.sqrt(x),m=Math.abs(h)>0?Math.max(0,100-g/Math.abs(h)*50):50;let u=0,y=0,f=0;e.forEach((e=>{const t=n&&a?(0,v.G7)(e,a,n):e.amount;f+=t,f>y&&(y=f);const r=y>0?(y-f)/y*100:0;r>u&&(u=r)}));const b=t.maxDrawdown>0&&u<=1.2*t.maxDrawdown?100:t.maxDrawdown>0?Math.max(0,100-5*(u-t.maxDrawdown)):50,j={winRateConsistency:isNaN(l)?50:l,profitFactorStability:isNaN(c)?50:c,returnsConsistency:isNaN(m)?50:m,volatilityControl:isNaN(b)?50:b},w=(j.winRateConsistency+j.profitFactorStability+j.returnsConsistency+j.volatilityControl)/4;return{score:isNaN(w)?0:w,factors:j}})(n,s,this.settings,e,this.dynamicRiskSettings),d=((e,t,r,a,n)=>{if(e.length<r.thresholds.minTradesForScore)return{score:0,factors:{tradingPlanAdherence:0,emotionalControl:0,overtrading:0,ruleFollowing:0}};const s=e.filter((e=>e.session)),o=s.length>0&&t.preferredSessions.length>0?e.filter((e=>e.session&&t.preferredSessions.includes(e.session))).length/s.length*100:50,i=e.filter((e=>e.tags&&e.tags.length>0)),l=(o+(i.length>0&&t.commonTags.length>0?e.filter((e=>e.tags&&e.tags.some((e=>t.commonTags.includes(e))))).length/i.length*100:50))/2,d=n&&a?e.map((e=>(0,v.G7)(e,a,n))):e.map((e=>Math.abs(e.amount))),c=d.length>0?d.reduce(((e,t)=>e+t),0)/d.length:0,p=d.length>0?d.reduce(((e,t)=>e+Math.pow(t-c,2)),0)/d.length:0,h=c>0?Math.sqrt(p)/c:0,x=Math.max(0,100-200*h),g=e.length/30,m=t.avgTradesPerDay,u=m>0?g/m:g/.1,y=u<=1.5?100:Math.max(0,100-50*(u-1.5)),f=e.length>0?e.filter((e=>e.session&&e.tags&&e.tags.length>0&&(e.riskToReward||"breakeven"===e.type))).length/e.length*100:0,A={tradingPlanAdherence:isNaN(l)?50:l,emotionalControl:isNaN(x)?50:x,overtrading:isNaN(y)?50:y,ruleFollowing:isNaN(f)?50:f},b=(A.tradingPlanAdherence+A.emotionalControl+A.overtrading+A.ruleFollowing)/4;return{score:isNaN(b)?0:b,factors:A}})(n,s,this.settings,e,this.dynamicRiskSettings),c=(o.score*this.settings.weights.consistency+i.score*this.settings.weights.riskManagement+l.score*this.settings.weights.performance+d.score*this.settings.weights.discipline)/100,p=isNaN(c)?0:c,h={consistency:isNaN(o.score)?0:o.score,riskManagement:isNaN(i.score)?0:i.score,performance:isNaN(l.score)?0:l.score,discipline:isNaN(d.score)?0:d.score,overall:p},x={consistency:o,riskManagement:i,performance:l,discipline:d},g=this.calculateTrend(e,t,r),m=e.length>=10?C.analyzeTagPatterns(e,r,a):void 0,{recommendations:u,strengths:y,weaknesses:f}=((e,t,r)=>{const a=[],n=[],s=[];return e.consistency.score<70?(e.consistency.factors.sessionConsistency<70&&(a.push("Focus on trading during your most profitable sessions"),s.push("Inconsistent session timing")),e.consistency.factors.tagConsistency<70&&(a.push("Stick to your proven trading strategies and setups"),s.push("Deviating from successful patterns"))):n.push("Consistent trading approach"),e.riskManagement.score<70?(e.riskManagement.factors.maxDrawdownAdherence<70&&(a.push("Reduce position sizes to control drawdown"),s.push("Excessive drawdown risk")),e.riskManagement.factors.riskRewardRatio<70&&(a.push("Improve risk/reward ratios on your trades"),s.push("Poor risk/reward management"))):n.push("Strong risk management"),e.performance.score<70?e.performance.factors.winRateConsistency<70&&(a.push("Focus on quality setups to maintain win rate"),s.push("Declining win rate")):n.push("Consistent performance"),e.discipline.score<70?(e.discipline.factors.overtrading<70&&(a.push("Reduce trading frequency and focus on quality"),s.push("Overtrading detected")),e.discipline.factors.emotionalControl<70&&(a.push("Work on emotional control and position sizing"),s.push("Emotional trading patterns"))):n.push("Good trading discipline"),r&&r.insights&&r.insights.slice(0,2).forEach((e=>{"high_performance"===e.type?(a.push(`Focus on "${e.tagCombination.join(" + ")}" pattern (${e.winRate.toFixed(1)}% win rate)`),n.push(`Strong performance with ${e.tagCombination.join(" + ")} combination`)):"declining_pattern"===e.type&&(a.push(`Review "${e.tagCombination.join(" + ")}" strategy - performance declining`),s.push(`Declining performance in ${e.tagCombination.join(" + ")} trades`))})),{recommendations:a,strengths:n,weaknesses:s}})(x,0,m);return{currentScore:h,breakdown:x,pattern:s,recommendations:u,strengths:y,weaknesses:f,trend:g,tagPatternAnalysis:m}}async getScoreHistory(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;const n=[],s=new Date;for(let o=0;o<r;o++){let r;switch(t){case"daily":r=(0,b.A)(s,o);break;case"weekly":r=(0,T.A)(s,o);break;case"monthly":r=(0,S.A)(s,o);break;case"yearly":r=(0,M.A)(s,o)}const i=this.getTradesForPeriod(e,t,r);if(i.length>=this.settings.thresholds.minTradesForScore){const s=await this.calculateScore(e,t,r,a);n.push({date:r,period:t,metrics:s.currentScore,breakdown:s.breakdown,tradeCount:i.length})}o%3===0&&await new Promise((e=>setTimeout(e,0)))}return n.reverse()}getTradesForPeriod(e,t,r){return e.filter((e=>{const a=new Date(e.date);switch(t){case"daily":return(0,D.A)(a,r);case"weekly":return(0,I.A)(a,r,{weekStartsOn:0});case"monthly":return(0,W.A)(a,r);case"yearly":return(0,R.A)(a,r);default:return!1}}))}getHistoricalTrades(e,t){const r=(0,b.A)(t,this.settings.thresholds.lookbackPeriod);return e.filter((e=>{const a=new Date(e.date);return a>=r&&a<=t}))}calculateTrend(e,t,r){try{const a=new Date;if(!this.isCurrentPeriod(r,t,a))return"stable";const n=this.getTradesForPeriod(e,t,r),s=new Date(r);switch(t){case"daily":s.setDate(s.getDate()-1);break;case"weekly":s.setDate(s.getDate()-7);break;case"monthly":s.setMonth(s.getMonth()-1);break;case"yearly":s.setFullYear(s.getFullYear()-1)}const o=this.getTradesForPeriod(e,t,s);if(n.length<2||o.length<2)return"stable";const i=this.calculateSimpleScore(n),l=i-this.calculateSimpleScore(o),d=5;return l>d?"improving":l<-d?"declining":"stable"}catch(a){return console.error("Error calculating trend:",a),"stable"}}isCurrentPeriod(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date;switch(t){case"daily":return(0,D.A)(e,r);case"weekly":return(0,I.A)(e,r,{weekStartsOn:0});case"monthly":return(0,W.A)(e,r);case"yearly":return(0,R.A)(e,r);default:return!1}}calculateSimpleScore(e){if(0===e.length)return 0;const t=e.filter((e=>"win"===e.type)).length/e.length*100,r=e.reduce(((e,t)=>e+t.amount),0)/e.length;return(t+(r>0?Math.min(100,10*r):Math.max(0,50+10*r)))/2}updateSettings(e){this.settings={...this.settings,...e}}getSettings(){return{...this.settings}}async calculateMultiPeriodScore(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w;const[a,n,s,o]=await Promise.all([this.calculateScore(e,"daily",t,r),this.calculateScore(e,"weekly",t,r),this.calculateScore(e,"monthly",t,r),this.calculateScore(e,"yearly",t,r)]);return{daily:a,weekly:n,monthly:s,yearly:o}}async getScoreSummary(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w;const r=await this.calculateScore(e,"weekly",new Date,t),a=[{name:"Consistency",value:r.currentScore.consistency},{name:"Risk Management",value:r.currentScore.riskManagement},{name:"Performance",value:r.currentScore.performance},{name:"Discipline",value:r.currentScore.discipline}].reduce(((e,t)=>t.value<e.value?t:e)),n=`${a.name}: ${a.value.toFixed(0)}%`,s=r.recommendations[0]||"Keep following your trading plan";return{currentWeekly:r.currentScore,trend:r.trend,keyMetric:n,recommendation:s}}};var z=r(46577),F=r(26020),E=r(91244),L=r(16128),$=r(26529),X=r(83759),N=r(6013),O=r(92248),B=r(69863),U=r(30143),Y=r(23792),H=r(82518),G=r(9700),_=r(82327),q=r(12690),V=r(70579);const J=e=>{let{score:t,trend:r,period:a,compact:o=!1,recommendedScore:l=75}=e;const c=(0,s.A)(),p=e=>e>=50?c.palette.success.main:e>=30?c.palette.warning.main:c.palette.error.main,h=()=>{switch(r){case"improving":return(0,V.jsx)(N.A,{sx:{color:c.palette.success.main}});case"declining":return(0,V.jsx)(O.A,{sx:{color:c.palette.error.main}});default:return(0,V.jsx)(B.A,{sx:{color:c.palette.text.secondary}})}},x=()=>{switch(r){case"improving":return c.palette.success.main;case"declining":return c.palette.error.main;default:return c.palette.text.secondary}},g=e=>e>=l,m=e=>{const t=e-l;return t>=0?{status:"achieved",message:`${t.toFixed(0)}% above target`,color:c.palette.success.main}:{status:"below",message:`${Math.abs(t).toFixed(0)}% below target`,color:c.palette.warning.main}},u=e=>{let{value:t,height:r,showTarget:a=!0}=e;return(0,V.jsxs)(n.A,{sx:{position:"relative",width:"100%"},children:[(0,V.jsx)(F.A,{variant:"determinate",value:isNaN(t)?0:t,sx:{height:r,borderRadius:r/2,backgroundColor:"dark"===c.palette.mode?(0,y.X4)(c.palette.common.white,.1):c.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:p(t),borderRadius:r/2}}}),a&&(0,V.jsx)(n.A,{sx:{position:"absolute",left:`${l}%`,top:0,height:"100%",width:2,backgroundColor:c.palette.info.main,borderRadius:1,"&::before":{content:'""',position:"absolute",top:-2,left:-2,width:6,height:6,backgroundColor:c.palette.info.main,borderRadius:"50%"}}})]})},f=e=>{switch(e.toLowerCase()){case"consistency":return"Consistency Score measures how well you stick to your established trading patterns:\n\n\u2022 Pattern Adherence (40%): How closely your trades match your historical successful patterns\n\u2022 Session Consistency (30%): Trading during your most profitable time periods\n\u2022 Strategy Consistency (30%): Using your most successful trading strategies\n\nHigher scores indicate better discipline in following proven patterns.";case"risk mgmt":case"risk management":return"Risk Management Score evaluates your discipline in managing risk and position sizing:\n\n\u2022 Position Sizing (35%): Consistency in risk per trade vs your target\n\u2022 Stop Loss Usage (25%): Proper use of stop losses on trades\n\u2022 Risk/Reward Ratio (25%): Achieving your target risk/reward ratios\n\u2022 Drawdown Control (15%): Keeping drawdowns within acceptable limits\n\nHigher scores indicate better risk control and capital preservation.";case"performance":return"Performance Score measures the consistency of your trading results vs historical patterns:\n\n\u2022 Win Rate Consistency (40%): How close your win rate is to your historical average\n\u2022 Profit Factor Stability (35%): Maintaining consistent profit factors over time\n\u2022 Return Consistency (25%): Steady returns without extreme volatility\n\nHigher scores indicate more predictable and stable trading performance.";case"discipline":return"Discipline Score evaluates your emotional control and trading discipline:\n\n\u2022 Trade Frequency (30%): Avoiding overtrading or undertrading\n\u2022 Plan Adherence (25%): Following your predetermined trading plan\n\u2022 Emotional Control (25%): Avoiding revenge trading and FOMO\n\u2022 Exit Discipline (20%): Taking profits and losses according to plan\n\nHigher scores indicate better emotional control and systematic trading.";default:return"This score component measures specific aspects of your trading performance and discipline."}},A=[{name:"Consistency",value:t.consistency,icon:(0,V.jsx)(U.A,{}),description:"How well you stick to your trading patterns"},{name:"Risk Mgmt",value:t.riskManagement,icon:(0,V.jsx)(Y.A,{}),description:"Risk management and position sizing discipline"},{name:"Performance",value:t.performance,icon:(0,V.jsx)(H.A,{}),description:"Performance consistency vs historical patterns"},{name:"Discipline",value:t.discipline,icon:(0,V.jsx)(G.A,{}),description:"Trading discipline and emotional control"}];return o?(0,V.jsx)(E.A,{sx:{minWidth:200,backgroundColor:"dark"===c.palette.mode?(0,y.X4)(c.palette.background.paper,.8):c.palette.background.paper,borderRadius:2,boxShadow:c.shadows[2],border:`1px solid ${"dark"===c.palette.mode?(0,y.X4)(c.palette.common.white,.1):(0,y.X4)(c.palette.common.black,.1)}`,transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:c.shadows[4]}},children:(0,V.jsxs)(L.A,{sx:{p:2,"&:last-child":{pb:2}},children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:1,children:[(0,V.jsxs)(i.A,{variant:"subtitle2",sx:{color:c.palette.text.secondary,fontWeight:500},children:[a.charAt(0).toUpperCase()+a.slice(1)," Score"]}),h()]}),(0,V.jsxs)(i.A,{variant:"h4",sx:{color:p(t.overall),fontWeight:"bold",mb:.5},children:[isNaN(t.overall)?"0":t.overall.toFixed(0),"%"]}),(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:1,children:[(0,V.jsx)(i.A,{variant:"caption",sx:{color:x(),fontWeight:500,display:"flex",alignItems:"center",gap:.5},children:r.charAt(0).toUpperCase()+r.slice(1)}),(0,V.jsx)($.A,{title:`Target: ${l}%`,children:(0,V.jsx)(_.A,{sx:{fontSize:14,color:g(t.overall)?c.palette.success.main:c.palette.info.main}})})]}),(0,V.jsx)(u,{value:t.overall,height:6})]})}):(0,V.jsx)(E.A,{sx:{backgroundColor:"dark"===c.palette.mode?(0,y.X4)(c.palette.background.paper,.8):c.palette.background.paper,borderRadius:2,boxShadow:c.shadows[2],border:`1px solid ${"dark"===c.palette.mode?(0,y.X4)(c.palette.common.white,.1):(0,y.X4)(c.palette.common.black,.1)}`,transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:c.shadows[4]}},children:(0,V.jsxs)(L.A,{sx:{p:3},children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:2,children:[(0,V.jsxs)(i.A,{variant:"h6",sx:{color:c.palette.text.primary,fontWeight:600},children:["\ud83d\udcca ",a.charAt(0).toUpperCase()+a.slice(1)," Trading Score"]}),(0,V.jsx)(X.A,{icon:h(),label:r.charAt(0).toUpperCase()+r.slice(1),size:"small",sx:{backgroundColor:(0,y.X4)(x(),.1),color:x(),fontWeight:500,border:`1px solid ${(0,y.X4)(x(),.3)}`,"& .MuiChip-icon":{color:x()}}})]}),(0,V.jsxs)(n.A,{sx:{textAlign:"center",mb:3},children:[(0,V.jsxs)(i.A,{variant:"h2",sx:{color:p(t.overall),fontWeight:"bold",mb:1},children:[isNaN(t.overall)?"0":t.overall.toFixed(0),"%"]}),(0,V.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Overall Trading Score"}),(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"center",spacing:1,mb:1,children:[(0,V.jsx)(_.A,{sx:{fontSize:16,color:c.palette.info.main}}),(0,V.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:["Target: ",l,"%"]}),(0,V.jsx)(X.A,{label:m(t.overall).message,size:"small",sx:{backgroundColor:(0,y.X4)(m(t.overall).color,.1),color:m(t.overall).color,fontWeight:500,fontSize:"0.7rem"}})]}),(0,V.jsx)(u,{value:t.overall,height:8})]}),(0,V.jsx)(d.A,{spacing:2,children:A.map((e=>(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:.5,children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,V.jsx)(n.A,{sx:{color:c.palette.text.secondary},children:e.icon}),(0,V.jsx)(i.A,{variant:"body2",fontWeight:"medium",children:e.name}),["Risk Management","Performance","Discipline"].includes(e.name)&&(0,V.jsx)($.A,{title:(0,V.jsx)(n.A,{sx:{p:1,maxWidth:400},children:(0,V.jsx)(i.A,{variant:"body2",sx:{whiteSpace:"pre-line"},children:f(e.name)})}),placement:"top",arrow:!0,children:(0,V.jsx)(q.A,{sx:{fontSize:16,color:c.palette.text.secondary,cursor:"help","&:hover":{color:c.palette.primary.main}}})})]}),(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,V.jsxs)(i.A,{variant:"body2",fontWeight:"bold",sx:{color:p(e.value)},children:[isNaN(e.value)?"0":e.value.toFixed(0),"%"]}),g(e.value)&&(0,V.jsx)($.A,{title:"Meeting target",children:(0,V.jsx)(_.A,{sx:{fontSize:12,color:c.palette.success.main}})})]})]}),(0,V.jsx)(u,{value:e.value,height:4})]},e.name)))})]})})};var K=r(95315),Z=r(82394),Q=r(66185),ee=r(21798),te=r(71407),re=r(6428),ae=r(93201),ne=r(71101),se=r(89935),oe=r(25272),ie=r(81084);const le=e=>{let{breakdown:t,pattern:r,recommendations:o,strengths:c,weaknesses:p}=e;const h=(0,s.A)(),[x,g]=(0,a.useState)(""),m=e=>e>=50?h.palette.success.main:e>=30?h.palette.warning.main:h.palette.error.main,u=[{id:"consistency",name:"Consistency",icon:(0,V.jsx)(U.A,{}),score:t.consistency.score,factors:t.consistency.factors,description:"How well you stick to your established trading patterns"},{id:"riskManagement",name:"Risk Management",icon:(0,V.jsx)(Y.A,{}),score:t.riskManagement.score,factors:t.riskManagement.factors,description:"Your discipline in managing risk and position sizing"},{id:"performance",name:"Performance",icon:(0,V.jsx)(H.A,{}),score:t.performance.score,factors:t.performance.factors,description:"Consistency of performance vs your historical patterns"},{id:"discipline",name:"Discipline",icon:(0,V.jsx)(G.A,{}),score:t.discipline.score,factors:t.discipline.factors,description:"Trading discipline and emotional control"}],f=e=>e.replace(/([A-Z])/g," $1").replace(/^./,(e=>e.toUpperCase())).trim(),A=e=>{switch(e.toLowerCase()){case"consistency":return"Consistency Score measures how well you stick to your established trading patterns:\n\n\u2022 Session Consistency (25%): % of trades in your top 2 preferred sessions\n\u2022 Tag Consistency (25%): % of trades using your top 5 common strategies\n\u2022 Timing Consistency (25%): % of trades on your preferred trading days\n\u2022 Size Consistency (25%): Deviation from historical average position size\n\nCalculation: Average of all four factors. Uses 30-day lookback for historical patterns.\nHigher scores indicate better discipline in following proven patterns.";case"risk management":return"Risk Management Score evaluates your discipline in managing risk and position sizing:\n\n\u2022 Risk/Reward Ratio (25%): Deviation from target R:R settings\n\u2022 Position Sizing (25%): Variance in trade sizes (coefficient of variation)\n\u2022 Max Drawdown Adherence (25%): Staying within drawdown limits\n\u2022 Stop Loss Usage (25%): Win/loss ratio indicating stop discipline\n\nCalculation: Average of all four factors. Uses normalized amounts for dynamic risk.\nHigher scores indicate better risk control and capital preservation.";case"performance":return"Performance Score measures the consistency of your trading results vs historical patterns:\n\n\u2022 Win Rate Consistency (25%): Deviation from historical win rate\n\u2022 Profit Factor Stability (25%): Deviation from historical profit factor\n\u2022 Returns Consistency (25%): Variance in trade returns (coefficient of variation)\n\u2022 Volatility Control (25%): Current vs historical maximum drawdown\n\nCalculation: Average of all four factors. Uses normalized amounts for dynamic risk.\nHigher scores indicate more predictable and stable trading performance.";case"discipline":return"Discipline Score evaluates your emotional control and trading discipline:\n\n\u2022 Trading Plan Adherence (25%): Average of session and tag adherence\n\u2022 Emotional Control (25%): Position size variance (coefficient of variation)\n\u2022 Overtrading (25%): Current vs historical trading frequency\n\u2022 Rule Following (25%): % of trades with complete data entry\n\nCalculation: Average of all four factors. Uses normalized amounts for emotional control.\nHigher scores indicate better emotional control and systematic trading.";default:return"This score component measures specific aspects of your trading performance and discipline."}},b=(e,t)=>{if("discipline"===e.toLowerCase())switch(t.toLowerCase()){case"overtrading":return"Measures if you are taking too many trades relative to your historical average.\n\nCalculation: Compares your current trading frequency (trades per day) to your historical pattern. Score = 100 if frequency ratio \u2264 1.5x, then decreases as ratio increases.\n\nHigher scores = appropriate frequency (better). Lower scores = overtrading detected (worse).";case"emotionalcontrol":return"Evaluates your ability to stick to your trading plan without letting emotions drive decisions.\n\nCalculation: Measures variance in your position sizes (normalized for dynamic risk). Uses coefficient of variation: StdDev/Average. Score = 100 - (coefficient \xd7 200).\n\nHigher scores = good emotional control (better). Lower scores = emotional trading patterns (worse).";case"tradingplanadhrence":case"tradingplanadherence":case"planadhrence":case"plan_adherence":return"Measures how well you follow your predetermined trading rules and strategies.\n\nCalculation: Average of session adherence (% of trades in your preferred sessions) and tag adherence (% of trades using your common strategies).\n\nHigher scores = better plan execution (better). Lower scores = poor discipline (worse).";case"rulefollowing":case"rule_following":return"Evaluates how consistently you fill out required trade information.\n\nCalculation: Percentage of trades that have session, tags, and risk/reward data filled out (breakeven trades exempt from risk/reward requirement).\n\nHigher scores = complete data entry (better). Lower scores = incomplete records (worse).";case"exitdiscipline":case"exit_discipline":return"Evaluates your ability to take profits and cut losses according to your plan.\n\nCalculation: Analyzes exit timing patterns and adherence to predetermined exit rules.\n\nHigher scores = good exit discipline (better). Lower scores = poor exit timing (worse).";default:return"This factor measures a specific aspect of your trading discipline and emotional control."}if("consistency"===e.toLowerCase())switch(t.toLowerCase()){case"sessionconsistency":case"session_consistency":return"Measures how consistently you trade during your most profitable sessions.\n\nCalculation: (Trades in preferred sessions / Total trades with session data) \xd7 100. Preferred sessions are your top 2 most-traded sessions from historical data.\n\nHigher scores = better session discipline (better). Lower scores = inconsistent timing (worse).";case"tagconsistency":case"tag_consistency":return"Evaluates how consistently you use your most successful trading strategies and setups.\n\nCalculation: (Trades using common tags / Total trades with tags) \xd7 100. Common tags are your top 5 most-used strategy tags from historical data.\n\nHigher scores = sticking to proven patterns (better). Lower scores = random experimentation (worse).";case"timingconsistency":case"timing_consistency":return"Measures how consistently you trade on your preferred days of the week.\n\nCalculation: (Trades on preferred days / Total trades) \xd7 100. Preferred days are determined from your historical trading pattern (days with significant activity).\n\nHigher scores = following established schedule (better). Lower scores = impulsive trading (worse).";case"sizeconsistency":case"size_consistency":return"Evaluates the consistency of your position sizes relative to your historical average.\n\nCalculation: Compares current average trade size to historical pattern. Score = 100 - (deviation percentage \xd7 100). Uses normalized amounts for dynamic risk.\n\nHigher scores = disciplined sizing (better). Lower scores = emotional deviations (worse).";default:return"This factor measures a specific aspect of your trading consistency and pattern adherence."}if("risk management"===e.toLowerCase())switch(t.toLowerCase()){case"riskrewardratio":case"risk_reward_ratio":return"Measures how well your actual risk/reward ratios match your target settings.\n\nCalculation: Compares average R:R of trades with R:R data to your target R:R setting. Score = 100 - (deviation percentage \xd7 100).\n\nHigher scores = better adherence to targets (better). Lower scores = deviation from targets (worse).";case"positionsizing":case"position_sizing":return"Measures how consistent your trade sizes are relative to each other.\n\nCalculation: Uses coefficient of variation (StdDev/Average) of trade sizes. Score = 100 - (coefficient \xd7 100). Uses normalized amounts for dynamic risk.\n\nHigher scores = consistent position sizing (better risk control). Lower scores = highly variable trade sizes (poor risk management).";case"maxdrawdownadherence":case"max_drawdown_adherence":return"Measures how well you stay within your maximum drawdown limits.\n\nCalculation: Tracks running P&L to find maximum drawdown percentage. Score = 100 if \u2264 target, then decreases by 10 points per 1% over target. Uses normalized amounts for dynamic risk.\n\nHigher scores = better capital preservation (better). Lower scores = excessive drawdown risk (worse).";case"stoplossusage":case"stop_loss_usage":return"Approximates your use of stop losses by analyzing the ratio between average wins and losses.\n\nCalculation: (Average win / Average loss) \xd7 50, capped at 100. Uses normalized amounts for dynamic risk. Assumes good stop loss discipline creates reasonable win/loss ratios.\n\nHigher scores = better stop loss discipline (better). Lower scores = poor risk control (worse).";default:return"This factor measures a specific aspect of your risk management and capital preservation."}if("performance"===e.toLowerCase())switch(t.toLowerCase()){case"winrateconsistency":case"win_rate_consistency":return"Measures how consistent your current win rate is compared to your historical average.\n\nCalculation: Compares current win rate (wins/total trades) to historical pattern. Score = 100 - (deviation percentage \xd7 100).\n\nHigher scores = maintaining consistent win rate (better). Lower scores = declining or volatile win rate (worse).";case"profitfactorstability":case"profit_factor_stability":return"Evaluates how stable your profit factor is compared to your historical pattern.\n\nCalculation: Profit factor = Total profits / Total losses. Compares current to historical pattern. Score = 100 - (deviation percentage \xd7 100). Uses normalized amounts for dynamic risk.\n\nHigher scores = stable profitability (better). Lower scores = declining profit factor (worse).";case"returnsconsistency":case"returns_consistency":return"Measures the consistency of your trade returns by analyzing the variance in your trade amounts.\n\nCalculation: Uses coefficient of variation (StdDev/Average) of trade returns. Score = 100 - (coefficient \xd7 50). Uses normalized amounts for dynamic risk.\n\nHigher scores = consistent returns (better). Lower scores = erratic performance (worse).";case"volatilitycontrol":case"volatility_control":return"Evaluates your ability to control drawdowns and maintain stable equity curves compared to your historical patterns.\n\nCalculation: Compares current maximum drawdown to historical pattern. Score = 100 if within 120% of historical, then decreases by 5 points per 1% excess. Uses normalized amounts for dynamic risk.\n\nHigher scores = good volatility control (better). Lower scores = excessive volatility (worse).";default:return"This factor measures a specific aspect of your trading performance consistency."}return"This factor contributes to your overall score in this category."};return(0,V.jsx)(E.A,{sx:{backgroundColor:"dark"===h.palette.mode?(0,y.X4)(h.palette.background.paper,.8):h.palette.background.paper,borderRadius:2,boxShadow:h.shadows[2],border:`1px solid ${"dark"===h.palette.mode?(0,y.X4)(h.palette.common.white,.1):(0,y.X4)(h.palette.common.black,.1)}`},children:(0,V.jsxs)(L.A,{sx:{p:3},children:[(0,V.jsx)(i.A,{variant:"h6",gutterBottom:!0,sx:{color:h.palette.text.primary,fontWeight:600,mb:3},children:"\ud83d\udd0d Score Breakdown & Analysis"}),(0,V.jsxs)(d.A,{spacing:2,mb:3,children:[o.length>0&&(0,V.jsxs)(l.A,{severity:"info",icon:(0,V.jsx)(N.A,{}),children:[(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,children:"Key Recommendations"}),(0,V.jsx)(K.A,{dense:!0,children:o.slice(0,3).map(((e,t)=>(0,V.jsx)(Z.Ay,{sx:{py:0},children:(0,V.jsx)(Q.A,{primary:e})},t)))})]}),c.length>0&&(0,V.jsxs)(l.A,{severity:"success",icon:(0,V.jsx)(ae.A,{}),children:[(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,children:"Your Strengths"}),(0,V.jsx)(n.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:c.map(((e,t)=>(0,V.jsx)(X.A,{label:e,size:"small",color:"success",variant:"outlined"},t)))})]}),p.length>0&&(0,V.jsxs)(l.A,{severity:"warning",icon:(0,V.jsx)(ne.A,{}),children:[(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,children:"Areas for Improvement"}),(0,V.jsx)(n.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:p.map(((e,t)=>(0,V.jsx)(X.A,{label:e,size:"small",color:"warning",variant:"outlined"},t)))})]})]}),(0,V.jsx)(i.A,{variant:"subtitle1",gutterBottom:!0,sx:{mt:2},children:"Detailed Analysis"}),u.map((e=>{return(0,V.jsx)(n.A,{sx:{backgroundColor:"dark"===h.palette.mode?(0,y.X4)(h.palette.background.paper,.6):(0,y.X4)(h.palette.background.paper,.8),borderRadius:3,border:`1px solid ${"dark"===h.palette.mode?(0,y.X4)(h.palette.common.white,.1):(0,y.X4)(h.palette.common.black,.1)}`,overflow:"hidden",transition:"all 0.2s ease-in-out",mb:2,"&:hover":{transform:"translateY(-1px)",boxShadow:h.shadows[3]}},children:(0,V.jsxs)(ee.A,{expanded:x===e.id,onChange:(r=e.id,(e,t)=>{g(!!t&&r)}),sx:{backgroundColor:"transparent",boxShadow:"none","&:before":{display:"none"},"& .MuiAccordionSummary-root":{borderRadius:3}},children:[(0,V.jsx)(te.A,{expandIcon:(0,V.jsx)(oe.A,{}),children:(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:2,sx:{width:"100%"},children:[(0,V.jsx)(n.A,{sx:{color:h.palette.text.secondary},children:e.icon}),(0,V.jsxs)(n.A,{sx:{flexGrow:1},children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,V.jsx)(i.A,{variant:"subtitle2",fontWeight:"medium",children:e.name}),["Risk Management","Performance","Discipline"].includes(e.name)&&(0,V.jsx)($.A,{title:(0,V.jsx)(n.A,{sx:{p:1,maxWidth:400},children:(0,V.jsx)(i.A,{variant:"body2",sx:{whiteSpace:"pre-line"},children:A(e.name)})}),placement:"top",arrow:!0,children:(0,V.jsx)(q.A,{sx:{fontSize:16,color:h.palette.text.secondary,cursor:"help","&:hover":{color:h.palette.primary.main}}})})]}),(0,V.jsx)(i.A,{variant:"caption",color:"text.secondary",children:e.description})]}),(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:1,children:[(t=e.score,t>=50?(0,V.jsx)(ae.A,{sx:{color:h.palette.success.main}}):t>=30?(0,V.jsx)(ne.A,{sx:{color:h.palette.warning.main}}):(0,V.jsx)(se.A,{sx:{color:h.palette.error.main}})),(0,V.jsxs)(i.A,{variant:"h6",sx:{color:m(e.score),fontWeight:"bold"},children:[isNaN(e.score)?"0":e.score.toFixed(0),"%"]})]})]})}),(0,V.jsx)(re.A,{children:(0,V.jsxs)(d.A,{spacing:2,children:[(0,V.jsx)(F.A,{variant:"determinate",value:isNaN(e.score)?0:e.score,sx:{height:8,borderRadius:4,backgroundColor:"dark"===h.palette.mode?(0,y.X4)(h.palette.common.white,.1):h.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:m(e.score),borderRadius:4}}}),(0,V.jsx)(i.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Factor Breakdown:"}),(0,V.jsx)(d.A,{spacing:1,children:Object.entries(e.factors).map((t=>{let[r,a]=t;return(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(d.A,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:.5,children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,V.jsx)(i.A,{variant:"body2",children:f(r)}),["discipline","risk management","consistency","performance"].includes(e.name.toLowerCase())&&(0,V.jsx)($.A,{title:(0,V.jsx)(n.A,{sx:{p:1,maxWidth:300},children:(0,V.jsx)(i.A,{variant:"body2",children:b(e.name,r)})}),placement:"top",arrow:!0,children:(0,V.jsx)(q.A,{sx:{fontSize:14,color:h.palette.text.secondary,cursor:"help","&:hover":{color:h.palette.primary.main}}})})]}),(0,V.jsxs)(i.A,{variant:"body2",fontWeight:"medium",sx:{color:m(a)},children:[isNaN(a)?"0":a.toFixed(0),"%"]})]}),(0,V.jsx)(F.A,{variant:"determinate",value:isNaN(a)?0:a,sx:{height:4,borderRadius:2,backgroundColor:"dark"===h.palette.mode?(0,y.X4)(h.palette.common.white,.1):h.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:m(a),borderRadius:2}}})]},r)}))})]})})]})},e.id);var t,r})),(0,V.jsxs)(n.A,{sx:{mt:3,p:2,backgroundColor:"dark"===h.palette.mode?(0,y.X4)(h.palette.background.paper,.4):h.palette.grey[50],borderRadius:2,border:`1px solid ${"dark"===h.palette.mode?(0,y.X4)(h.palette.common.white,.1):(0,y.X4)(h.palette.common.black,.1)}`},children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:1,sx:{mb:1},children:[(0,V.jsx)(i.A,{variant:"subtitle2",sx:{color:h.palette.text.primary,fontWeight:600},children:"\ud83d\udcc8 Your Trading Pattern"}),(0,V.jsx)($.A,{title:(0,V.jsxs)(n.A,{sx:{p:1,maxWidth:380},children:[(0,V.jsx)(i.A,{variant:"body2",sx:{mb:1,fontWeight:600},children:"How Your Trading Pattern is Established:"}),(0,V.jsxs)(i.A,{variant:"body2",sx:{mb:1},children:["\u2022 ",(0,V.jsx)("strong",{children:"Preferred Sessions:"})," Your top 2 most frequently traded sessions based on historical data"]}),(0,V.jsxs)(i.A,{variant:"body2",sx:{mb:1},children:["\u2022 ",(0,V.jsx)("strong",{children:"Common Strategies:"})," Your top 5 most-used tags/strategies from past trades"]}),(0,V.jsxs)(i.A,{variant:"body2",sx:{mb:1},children:["\u2022 ",(0,V.jsx)("strong",{children:"Trading Frequency:"})," Average trades per week calculated from your trading history"]}),(0,V.jsxs)(i.A,{variant:"body2",sx:{mb:1},children:["\u2022 ",(0,V.jsx)("strong",{children:"Win Rate & Profit Factor:"})," Historical averages used as benchmarks for consistency scoring"]}),(0,V.jsxs)(i.A,{variant:"body2",sx:{mb:1,color:"warning.main"},children:["\u2022 ",(0,V.jsx)("strong",{children:"Lookback Period:"})," Pattern is based on trades from the last 30 days to reflect your current trading style"]}),(0,V.jsx)(i.A,{variant:"body2",sx:{fontStyle:"italic",mt:1},children:"Patterns are automatically updated as you add more trades. Requires minimum 3 trades for reliable pattern detection."})]}),placement:"top",arrow:!0,children:(0,V.jsx)(q.A,{sx:{fontSize:18,color:h.palette.text.secondary,cursor:"help","&:hover":{color:h.palette.primary.main}}})})]}),(0,V.jsxs)(d.A,{spacing:1,children:[(0,V.jsxs)(i.A,{variant:"body2",sx:{color:h.palette.text.secondary},children:[(0,V.jsx)("strong",{style:{color:h.palette.text.primary},children:"Preferred Sessions:"})," ",r.preferredSessions.join(", ")||"Not established"]}),(0,V.jsxs)(n.A,{children:[(0,V.jsx)(i.A,{variant:"body2",sx:{color:h.palette.text.secondary,mb:1},children:(0,V.jsx)("strong",{style:{color:h.palette.text.primary},children:"Common Strategies:"})}),r.commonTags.length>0?(0,V.jsx)(n.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:r.commonTags.slice(0,5).map(((e,t)=>(0,V.jsx)(X.A,{label:e,size:"small",sx:(0,ie.dO)(e,h)},t)))}):(0,V.jsx)(i.A,{variant:"body2",sx:{color:h.palette.text.secondary,fontStyle:"italic"},children:"Not established"})]}),(0,V.jsxs)(i.A,{variant:"body2",sx:{color:h.palette.text.secondary},children:[(0,V.jsx)("strong",{style:{color:h.palette.text.primary},children:"Trading Frequency:"})," ",isNaN(r.avgTradesPerWeek)?"0.0":r.avgTradesPerWeek.toFixed(1)," trades/week"]}),(0,V.jsxs)(i.A,{variant:"body2",sx:{color:h.palette.text.secondary},children:[(0,V.jsx)("strong",{style:{color:h.palette.text.primary},children:"Win Rate:"})," ",isNaN(r.winRate)?"0.0":r.winRate.toFixed(1),"%"]}),(0,V.jsxs)(i.A,{variant:"body2",sx:{color:h.palette.text.secondary},children:[(0,V.jsx)("strong",{style:{color:h.palette.text.primary},children:"Profit Factor:"})," ",isNaN(r.profitFactor)?"0.00":r.profitFactor.toFixed(2)]})]})]})]})})};var de=r(50108),ce=r(877),pe=r(87734),he=r(52185),xe=r(6026),ge=r(86150),me=r(13839),ue=r(75748),ye=r(21327),fe=r(90168),Ae=r(39993);const be=e=>{let{history:t,period:r,onPeriodChange:o}=e;const l=(0,s.A)(),h=(0,a.useMemo)((()=>t.map((e=>({date:e.date,dateLabel:(0,Ae.A)(e.date,"daily"===r||"weekly"===r?"MMM dd":"monthly"===r?"MMM yyyy":"yyyy"),overall:e.metrics.overall,consistency:e.metrics.consistency,riskManagement:e.metrics.riskManagement,performance:e.metrics.performance,discipline:e.metrics.discipline,tradeCount:e.tradeCount})))),[t,r]),x=e=>{let{active:t,payload:r,label:a}=e;if(t&&r&&r.length){const e=r[0].payload;return(0,V.jsxs)(n.A,{sx:{backgroundColor:"dark"===l.palette.mode?(0,y.X4)(l.palette.background.paper,.95):l.palette.background.paper,border:`1px solid ${l.palette.divider}`,borderRadius:2,p:2,boxShadow:l.shadows[8],backdropFilter:"blur(10px)"},children:[(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,children:a}),(0,V.jsxs)(d.A,{spacing:.5,children:[(0,V.jsxs)(i.A,{variant:"body2",children:[(0,V.jsx)("strong",{children:"Overall Score:"})," ",e.overall.toFixed(0),"%"]}),(0,V.jsxs)(i.A,{variant:"body2",children:[(0,V.jsx)("strong",{children:"Trades:"})," ",e.tradeCount]}),(0,V.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:["Consistency: ",e.consistency.toFixed(0),"%"]}),(0,V.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:["Risk Mgmt: ",e.riskManagement.toFixed(0),"%"]}),(0,V.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:["Performance: ",e.performance.toFixed(0),"%"]}),(0,V.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:["Discipline: ",e.discipline.toFixed(0),"%"]})]})]})}return null},g=(0,a.useMemo)((()=>0===h.length?0:h.reduce(((e,t)=>e+t.overall),0)/h.length),[h]),m=h.length>0?h[h.length-1].overall:0,u=h.length>1?m-h[h.length-2].overall:0;return(0,V.jsx)(E.A,{sx:{backgroundColor:"dark"===l.palette.mode?(0,y.X4)(l.palette.background.paper,.8):l.palette.background.paper,borderRadius:2,boxShadow:l.shadows[2],border:`1px solid ${"dark"===l.palette.mode?(0,y.X4)(l.palette.common.white,.1):(0,y.X4)(l.palette.common.black,.1)}`},children:(0,V.jsxs)(L.A,{sx:{p:3},children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:3,children:[(0,V.jsx)(i.A,{variant:"h6",sx:{color:l.palette.text.primary,fontWeight:600},children:"\ud83d\udcc8 Score History"}),(0,V.jsxs)(c.A,{value:r,onChange:(e,t)=>t&&o(t),sx:{minHeight:32,backgroundColor:"light"===l.palette.mode?"#f0f0f0":(0,y.X4)(l.palette.background.paper,.4),borderRadius:"16px",padding:"2px","& .MuiTabs-flexContainer":{gap:"2px"},"& .MuiTabs-indicator":{display:"none"}},children:[(0,V.jsx)(p.A,{label:"Daily",value:"daily",sx:{minHeight:28,textTransform:"none",fontSize:"0.75rem",fontWeight:500,color:"text.secondary",borderRadius:"12px",padding:"4px 12px",minWidth:"auto","&.Mui-selected":{color:"dark"===l.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:l.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,y.X4)(l.palette.primary.main,.05),color:"primary.main"}}}),(0,V.jsx)(p.A,{label:"Weekly",value:"weekly",sx:{minHeight:28,textTransform:"none",fontSize:"0.75rem",fontWeight:500,color:"text.secondary",borderRadius:"12px",padding:"4px 12px",minWidth:"auto","&.Mui-selected":{color:"dark"===l.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:l.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,y.X4)(l.palette.primary.main,.05),color:"primary.main"}}}),(0,V.jsx)(p.A,{label:"Monthly",value:"monthly",sx:{minHeight:28,textTransform:"none",fontSize:"0.75rem",fontWeight:500,color:"text.secondary",borderRadius:"12px",padding:"4px 12px",minWidth:"auto","&.Mui-selected":{color:"dark"===l.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:l.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,y.X4)(l.palette.primary.main,.05),color:"primary.main"}}}),(0,V.jsx)(p.A,{label:"Yearly",value:"yearly",sx:{minHeight:28,textTransform:"none",fontSize:"0.75rem",fontWeight:500,color:"text.secondary",borderRadius:"12px",padding:"4px 12px",minWidth:"auto","&.Mui-selected":{color:"dark"===l.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:l.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,y.X4)(l.palette.primary.main,.05),color:"primary.main"}}})]})]}),0===h.length?(0,V.jsx)(n.A,{sx:{textAlign:"center",py:4},children:(0,V.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:["Not enough data for ",r," score history.",(0,V.jsx)("br",{}),"Complete more trades to see your score trends."]})}):(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)(d.A,{direction:"row",spacing:3,mb:3,children:[(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(i.A,{variant:"h4",sx:{color:(f=m,f>=50?l.palette.success.main:f>=30?l.palette.warning.main:l.palette.error.main),fontWeight:"bold"},children:[m.toFixed(0),"%"]}),(0,V.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"Latest Score"})]}),(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(i.A,{variant:"h4",sx:{color:u>=0?l.palette.success.main:l.palette.error.main,fontWeight:"bold"},children:[u>=0?"+":"",u.toFixed(0),"%"]}),(0,V.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"Change"})]}),(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(i.A,{variant:"h4",sx:{color:l.palette.text.primary,fontWeight:"bold"},children:[g.toFixed(0),"%"]}),(0,V.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"Average"})]})]}),(0,V.jsx)(n.A,{sx:{height:300,mb:2},children:(0,V.jsx)(de.u,{width:"100%",height:"100%",children:(0,V.jsxs)(ce.Q,{data:h,children:[(0,V.jsx)("defs",{children:(0,V.jsxs)("linearGradient",{id:"overallGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,V.jsx)("stop",{offset:"5%",stopColor:l.palette.primary.main,stopOpacity:"dark"===l.palette.mode?.4:.3}),(0,V.jsx)("stop",{offset:"95%",stopColor:l.palette.primary.main,stopOpacity:0})]})}),(0,V.jsx)(pe.d,{strokeDasharray:"3 3",stroke:"dark"===l.palette.mode?(0,y.X4)(l.palette.common.white,.1):l.palette.divider}),(0,V.jsx)(he.W,{dataKey:"dateLabel",stroke:l.palette.text.secondary,fontSize:12,tick:{fill:l.palette.text.secondary}}),(0,V.jsx)(xe.h,{domain:[0,100],stroke:l.palette.text.secondary,fontSize:12,tick:{fill:l.palette.text.secondary}}),(0,V.jsx)(ge.m,{content:(0,V.jsx)(x,{})}),(0,V.jsx)(me.G,{type:"monotone",dataKey:"overall",stroke:l.palette.primary.main,strokeWidth:3,fill:"url(#overallGradient)",name:"Overall Score"})]})})}),(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Score Components"}),(0,V.jsx)(n.A,{sx:{height:200},children:(0,V.jsx)(de.u,{width:"100%",height:"100%",children:(0,V.jsxs)(ue.b,{data:h,children:[(0,V.jsx)(pe.d,{strokeDasharray:"3 3",stroke:"dark"===l.palette.mode?(0,y.X4)(l.palette.common.white,.1):l.palette.divider}),(0,V.jsx)(he.W,{dataKey:"dateLabel",stroke:l.palette.text.secondary,fontSize:12,tick:{fill:l.palette.text.secondary}}),(0,V.jsx)(xe.h,{domain:[0,100],stroke:l.palette.text.secondary,fontSize:12,tick:{fill:l.palette.text.secondary}}),(0,V.jsx)(ge.m,{content:(0,V.jsx)(x,{})}),(0,V.jsx)(ye.s,{}),(0,V.jsx)(fe.N,{type:"monotone",dataKey:"consistency",stroke:l.palette.info.main,strokeWidth:2,dot:!1,name:"Consistency"}),(0,V.jsx)(fe.N,{type:"monotone",dataKey:"riskManagement",stroke:l.palette.success.main,strokeWidth:2,dot:!1,name:"Risk Mgmt"}),(0,V.jsx)(fe.N,{type:"monotone",dataKey:"performance",stroke:l.palette.warning.main,strokeWidth:2,dot:!1,name:"Performance"}),(0,V.jsx)(fe.N,{type:"monotone",dataKey:"discipline",stroke:l.palette.error.main,strokeWidth:2,dot:!1,name:"Discipline"})]})})})]})]})});var f};var je=r(12097),ve=r(43971),we=r(48640),ke=r(24343),Ce=r(38398),Te=r(54895),Se=r(17347),Me=r(33699),De=r(94527),Ie=r(63745);const We=e=>{let{trades:t,excludedTags:r,onExcludedTagsChange:o,allTags:c}=e;const p=(0,s.A)(),[h,x]=(0,a.useState)(""),g=(0,a.useMemo)((()=>{if(c&&c.length>0)return c.filter((e=>!e.startsWith("Partials:"))).sort();const e=new Set;return t.forEach((t=>{t.tags&&t.tags.forEach((t=>{t.startsWith("Partials:")||e.add(t)}))})),Array.from(e).sort()}),[c,t]),u=(0,a.useMemo)((()=>{if(!h)return g;const e=h.toLowerCase();return g.filter((t=>t.toLowerCase().includes(e)||(0,ie.t)(t).toLowerCase().includes(e)))}),[g,h]),A=(0,a.useMemo)((()=>u.filter((e=>!r.includes(e)))),[u,r]),b=(0,a.useMemo)((()=>{const e={};return A.forEach((t=>{if((0,ie.dn)(t)){const r=(0,ie.Oo)(t);e[r]||(e[r]=[]),e[r].push(t)}else e.Ungrouped||(e.Ungrouped=[]),e.Ungrouped.push(t)})),e}),[A]);return(0,V.jsx)(E.A,{sx:{backgroundColor:"dark"===p.palette.mode?"rgba(255, 255, 255, 0.02)":"rgba(0, 0, 0, 0.02)",border:`1px solid ${p.palette.divider}`,borderRadius:2},children:(0,V.jsxs)(L.A,{sx:{p:3},children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:1,mb:2,children:[(0,V.jsx)(i.A,{variant:"h6",sx:{fontWeight:600},children:"\ud83d\udeab Excluded Tags from Pattern Analysis"}),(0,V.jsx)($.A,{title:"Tags excluded from pattern analysis won't be considered when identifying high-performing or declining tag combinations. This is useful for filtering out temporary or irrelevant tags.",children:(0,V.jsx)(m.A,{size:"small",children:(0,V.jsx)(q.A,{fontSize:"small"})})})]}),(0,V.jsx)(l.A,{severity:"info",sx:{mb:3},children:(0,V.jsx)(i.A,{variant:"body2",children:"Excluded tags will not be included in pattern analysis calculations. This helps focus the analysis on meaningful trading patterns by filtering out temporary, experimental, or irrelevant tags."})}),(0,V.jsxs)(n.A,{mb:3,children:[(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"Add Tag to Exclude"}),(0,V.jsx)(ke.A,{placeholder:"Search for tags to exclude...",variant:"outlined",size:"small",value:h,onChange:e=>x(e.target.value),slotProps:{input:{startAdornment:(0,V.jsx)(Me.A,{position:"start",children:(0,V.jsx)(Ie.A,{})})}},sx:{width:"100%","& .MuiOutlinedInput-root":{backgroundColor:"dark"===p.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.02)"}}})]}),Object.keys(b).length>0&&(0,V.jsx)(n.A,{sx:{maxHeight:"250px",overflow:"auto",border:`1px solid ${p.palette.divider}`,borderRadius:1,mb:3,...(0,z.J)(p)},children:Object.entries(b).map((e=>{let[t,a]=e;return(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(n.A,{sx:{p:1.5,bgcolor:(0,y.X4)(p.palette.primary.main,.05),display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,V.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,V.jsx)(i.A,{variant:"subtitle2",fontWeight:600,children:t}),(0,V.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[a.length," tag",1!==a.length?"s":""]})]}),(0,V.jsx)(je.A,{size:"small",variant:"outlined",onClick:()=>(e=>{const t=b[e]||[],a=[...r,...t];o(a)})(t),sx:{minWidth:"auto",px:1},children:"Add All"})]}),(0,V.jsx)(De.A,{}),(0,V.jsx)(K.A,{disablePadding:!0,children:a.map((e=>(0,V.jsx)(Z.Ay,{secondaryAction:(0,V.jsx)(je.A,{size:"small",variant:"text",onClick:()=>(e=>{e&&!r.includes(e)&&o([...r,e])})(e),sx:{minWidth:"auto",p:.5},children:"Add"}),sx:{"&:hover":{bgcolor:(0,y.X4)(p.palette.primary.main,.05)}},children:(0,V.jsx)(Q.A,{primary:(0,V.jsx)(n.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,V.jsx)(X.A,{label:(0,ie.t)(e,!0),size:"small",sx:(0,ie.dO)(e,p)})})})},e)))})]},t)}))}),0===Object.keys(b).length&&(0,V.jsx)(n.A,{sx:{p:2,textAlign:"center",color:"text.secondary",border:`1px solid ${p.palette.divider}`,borderRadius:1,mb:3},children:(0,V.jsx)(i.A,{variant:"body2",children:h?"No matching tags found":"No tags available to exclude"})}),(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(i.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:["Currently Excluded Tags (",r.length,")"]}),0===r.length?(0,V.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:"No tags are currently excluded from pattern analysis."}):(0,V.jsx)(d.A,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:r.map((e=>(0,V.jsx)(X.A,{label:(0,ie.t)(e),onDelete:()=>{return t=e,void o(r.filter((e=>e!==t)));var t},deleteIcon:(0,V.jsx)(f.A,{sx:{color:"dark"===p.palette.mode?"white":"inherit","&:hover":{color:p.palette.error.main}}}),sx:{...(0,ie.dO)(e,p),"& .MuiChip-deleteIcon":{color:"dark"===p.palette.mode?"white":"inherit","&:hover":{color:p.palette.error.main}}}},e)))})]}),g.length>0&&(0,V.jsx)(n.A,{mt:3,p:2,sx:{backgroundColor:"dark"===p.palette.mode?"rgba(255, 255, 255, 0.02)":"rgba(0, 0, 0, 0.02)",borderRadius:1,border:`1px solid ${p.palette.divider}`},children:(0,V.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[(0,V.jsx)("strong",{children:"Pattern Analysis Coverage:"})," ",A.length," of ",g.length," tags will be included in pattern analysis",r.length>0&&(0,V.jsxs)("span",{children:[" (",r.length," excluded)"]})]})})]})})},Re=e=>{let{trades:t,selectedTags:r,onTagsChange:o,allTags:l}=e;const c=(0,s.A)(),[p,h]=(0,a.useState)(""),x=(0,a.useMemo)((()=>{if(l&&l.length>0)return l.filter((e=>!e.startsWith("Partials:"))).sort();const e=new Set;return t.forEach((t=>{t.tags&&t.tags.forEach((t=>{t.startsWith("Partials:")||e.add(t)}))})),Array.from(e).sort()}),[l,t]),g=(0,a.useMemo)((()=>{const e={};return x.forEach((r=>{const a=t.filter((e=>e.tags&&e.tags.includes(r))).length,n=t.length>0?Math.round(a/t.length*100):0;e[r]={count:a,percentage:n}})),e}),[x,t]),m=(0,a.useMemo)((()=>{if(!p)return x;const e=p.toLowerCase();return x.filter((t=>t.toLowerCase().includes(e)||(0,ie.t)(t).toLowerCase().includes(e)))}),[x,p]),u=(0,a.useMemo)((()=>m.filter((e=>!r.includes(e)))),[m,r]),f=(0,a.useMemo)((()=>{const e={};return u.forEach((t=>{if((0,ie.dn)(t)){const r=(0,ie.Oo)(t);e[r]||(e[r]=[]),e[r].push(t)}else e.Ungrouped||(e.Ungrouped=[]),e.Ungrouped.push(t)})),e}),[u]);return(0,V.jsxs)(n.A,{children:[(0,V.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Select specific tags to track their usage frequency across your trades. This will show how often you use each selected strategy in the Analysis tab."}),(0,V.jsxs)(n.A,{mb:2,children:[(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"Add Tags to Track"}),(0,V.jsx)(ke.A,{placeholder:"Search for tags to track...",variant:"outlined",size:"small",value:p,onChange:e=>h(e.target.value),slotProps:{input:{startAdornment:(0,V.jsx)(Me.A,{position:"start",children:(0,V.jsx)(Ie.A,{})})}},sx:{width:"100%","& .MuiOutlinedInput-root":{backgroundColor:"dark"===c.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.02)"}}})]}),Object.keys(f).length>0&&(0,V.jsx)(n.A,{sx:{maxHeight:"300px",overflow:"auto",border:`1px solid ${c.palette.divider}`,borderRadius:1,mb:2,...(0,z.J)(c)},children:Object.entries(f).map((e=>{let[t,a]=e;return(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(n.A,{sx:{p:1.5,bgcolor:(0,y.X4)(c.palette.primary.main,.05),display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,V.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,V.jsx)(i.A,{variant:"subtitle2",fontWeight:600,children:t}),(0,V.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[a.length," tag",1!==a.length?"s":""]})]}),(0,V.jsx)(je.A,{size:"small",variant:"outlined",onClick:()=>(e=>{const t=f[e]||[],a=[...r,...t];o(a)})(t),sx:{minWidth:"auto",px:1},children:"Add All"})]}),(0,V.jsx)(De.A,{}),(0,V.jsx)(K.A,{disablePadding:!0,children:a.map((e=>{const t=g[e];return(0,V.jsx)(Z.Ay,{secondaryAction:(0,V.jsx)(je.A,{size:"small",variant:"text",onClick:()=>(e=>{e&&!r.includes(e)&&o([...r,e])})(e),sx:{minWidth:"auto",p:.5},children:"Add"}),sx:{"&:hover":{bgcolor:(0,y.X4)(c.palette.primary.main,.05)}},children:(0,V.jsx)(Q.A,{primary:(0,V.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,V.jsx)(X.A,{label:(0,ie.t)(e,!0),size:"small",sx:(0,ie.dO)(e,c)}),(0,V.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[t.count," trades (",t.percentage,"%)"]})]})})},e)}))})]},t)}))}),0===Object.keys(f).length&&(0,V.jsx)(n.A,{sx:{p:2,textAlign:"center",color:"text.secondary",border:`1px solid ${c.palette.divider}`,borderRadius:1,mb:2},children:(0,V.jsx)(i.A,{variant:"body2",children:p?"No matching tags found":"All tags are already selected"})}),r.length>0&&(0,V.jsxs)(n.A,{sx:{mt:2,p:2,bgcolor:"background.default",borderRadius:1},children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:1,children:[(0,V.jsxs)(i.A,{variant:"subtitle2",children:["Selected Tags (",r.length,"):"]}),(0,V.jsx)(X.A,{label:"Clear All",size:"small",onClick:()=>{o([])},sx:{cursor:"pointer"}})]}),(0,V.jsx)(n.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:r.map((e=>{const t=g[e];return(0,V.jsx)(X.A,{label:`${e} (${t.percentage}%)`,size:"small",sx:{...(0,ie.dO)(e,c),"& .MuiChip-deleteIcon":{color:"inherit","&:hover":{color:"inherit",opacity:.7}}},onDelete:()=>(e=>{o(r.filter((t=>t!==e)))})(e)},e)}))})]})]})},Pe=e=>{let{settings:t,onSettingsChange:r,onSave:o,isSaving:c=!1,trades:p,selectedTags:h,onTagsChange:x,allTags:g}=e;const m=(0,s.A)(),[u,f]=(0,a.useState)(t),[A,b]=(0,a.useState)(!1),j=e=>(t,a)=>{const n=Array.isArray(a)?a[0]:a,s={...u.weights,[e]:n};if(100!==Object.values(s).reduce(((e,t)=>e+t),0)){const t=Object.keys(s).filter((t=>t!==e)),r=100-n,a=t.reduce(((e,t)=>e+s[t]),0);a>0&&t.forEach((e=>{s[e]=s[e]/a*r}))}const o={...u,weights:s};f(o),b(!0),r(o)},v=e=>t=>{const a=parseFloat(t.target.value)||0,n={...u,thresholds:{...u.thresholds,[e]:a}};f(n),b(!0),r(n)},k=e=>t=>{const a=parseFloat(t.target.value)||0,n={...u,targets:{...u.targets,[e]:a}};f(n),b(!0),r(n)},C=Object.values(u.weights).reduce(((e,t)=>e+t),0);return(0,V.jsx)(E.A,{sx:{backgroundColor:"dark"===m.palette.mode?(0,y.X4)(m.palette.background.paper,.8):m.palette.background.paper,borderRadius:3,boxShadow:m.shadows[2],border:`1px solid ${"dark"===m.palette.mode?(0,y.X4)(m.palette.common.white,.1):(0,y.X4)(m.palette.common.black,.1)}`,transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-1px)",boxShadow:m.shadows[4]}},children:(0,V.jsxs)(L.A,{sx:{p:3},children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:3,children:[(0,V.jsx)(i.A,{variant:"h6",sx:{color:m.palette.text.primary,fontWeight:600},children:"\u2699\ufe0f Score Settings"}),(0,V.jsxs)(d.A,{direction:"row",spacing:1,children:[(0,V.jsx)(je.A,{startIcon:(0,V.jsx)(Ce.A,{}),onClick:()=>{f(w),b(!0),r(w)},size:"small",variant:"outlined",sx:{borderColor:"dark"===m.palette.mode?(0,y.X4)(m.palette.common.white,.3):m.palette.primary.main,color:"dark"===m.palette.mode?m.palette.common.white:m.palette.primary.main,"&:hover":{borderColor:m.palette.primary.main,backgroundColor:(0,y.X4)(m.palette.primary.main,.05)}},children:"Reset"}),o&&(0,V.jsx)(je.A,{startIcon:(0,V.jsx)(Te.A,{}),onClick:()=>{o&&o(),b(!1)},size:"small",variant:"contained",disabled:!A||c,sx:{backgroundColor:m.palette.primary.main,"&:hover":{backgroundColor:m.palette.primary.dark},"&:disabled":{backgroundColor:"dark"===m.palette.mode?(0,y.X4)(m.palette.common.white,.1):m.palette.grey[300]}},children:c?"Saving...":"Save"})]})]}),A&&(0,V.jsx)(l.A,{severity:"info",sx:{mb:2},children:"You have unsaved changes. Click Save to apply them permanently."}),(0,V.jsxs)(d.A,{children:[(0,V.jsxs)(ee.A,{children:[(0,V.jsx)(te.A,{expandIcon:(0,V.jsx)(oe.A,{}),children:(0,V.jsx)(i.A,{variant:"subtitle1",fontWeight:"medium",children:"Score Component Weights"})}),(0,V.jsxs)(re.A,{children:[(0,V.jsx)(l.A,{severity:"info",icon:(0,V.jsx)(Se.A,{}),sx:{mb:2},children:"Adjust how much each component contributes to your overall score. Total must equal 100%."}),(0,V.jsxs)(d.A,{spacing:3,children:[(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(ve.A,{children:["Consistency (",u.weights.consistency.toFixed(0),"%)"]}),(0,V.jsx)(n.A,{sx:{px:2},children:(0,V.jsx)(we.Ay,{value:u.weights.consistency,onChange:j("consistency"),min:0,max:100,step:5,marks:[{value:0,label:"0%"},{value:50,label:"50%"},{value:100,label:"100%"}],sx:{"& .MuiSlider-markLabel":{fontSize:"0.75rem"},'& .MuiSlider-markLabel[data-index="0"]':{transform:"translateX(0%)"},'& .MuiSlider-markLabel[data-index="2"]':{transform:"translateX(-100%)"}}})}),(0,V.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"How well you stick to your trading patterns"})]}),(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(ve.A,{children:["Risk Management (",u.weights.riskManagement.toFixed(0),"%)"]}),(0,V.jsx)(n.A,{sx:{px:2},children:(0,V.jsx)(we.Ay,{value:u.weights.riskManagement,onChange:j("riskManagement"),min:0,max:100,step:5,marks:[{value:0,label:"0%"},{value:50,label:"50%"},{value:100,label:"100%"}],sx:{"& .MuiSlider-markLabel":{fontSize:"0.75rem"},'& .MuiSlider-markLabel[data-index="0"]':{transform:"translateX(0%)"},'& .MuiSlider-markLabel[data-index="2"]':{transform:"translateX(-100%)"}}})}),(0,V.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"Risk management and position sizing discipline"})]}),(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(ve.A,{children:["Performance (",u.weights.performance.toFixed(0),"%)"]}),(0,V.jsx)(n.A,{sx:{px:2},children:(0,V.jsx)(we.Ay,{value:u.weights.performance,onChange:j("performance"),min:0,max:100,step:5,marks:[{value:0,label:"0%"},{value:50,label:"50%"},{value:100,label:"100%"}],sx:{"& .MuiSlider-markLabel":{fontSize:"0.75rem"},'& .MuiSlider-markLabel[data-index="0"]':{transform:"translateX(0%)"},'& .MuiSlider-markLabel[data-index="2"]':{transform:"translateX(-100%)"}}})}),(0,V.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"Performance consistency vs historical patterns"})]}),(0,V.jsxs)(n.A,{children:[(0,V.jsxs)(ve.A,{children:["Discipline (",u.weights.discipline.toFixed(0),"%)"]}),(0,V.jsx)(n.A,{sx:{px:2},children:(0,V.jsx)(we.Ay,{value:u.weights.discipline,onChange:j("discipline"),min:0,max:100,step:5,marks:[{value:0,label:"0%"},{value:50,label:"50%"},{value:100,label:"100%"}],sx:{"& .MuiSlider-markLabel":{fontSize:"0.75rem"},'& .MuiSlider-markLabel[data-index="0"]':{transform:"translateX(0%)"},'& .MuiSlider-markLabel[data-index="2"]':{transform:"translateX(-100%)"}}})}),(0,V.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"Trading discipline and emotional control"})]}),(0,V.jsxs)(i.A,{variant:"body2",sx:{color:100===C?"success.main":"error.main",fontWeight:"medium"},children:["Total: ",C.toFixed(0),"% ",100!==C&&"(Must equal 100%)"]})]})]})]}),(0,V.jsxs)(ee.A,{children:[(0,V.jsx)(te.A,{expandIcon:(0,V.jsx)(oe.A,{}),children:(0,V.jsx)(i.A,{variant:"subtitle1",fontWeight:"medium",children:"Calculation Thresholds"})}),(0,V.jsx)(re.A,{children:(0,V.jsxs)(n.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(3, 1fr)"},gap:2},children:[(0,V.jsx)(ke.A,{label:"Min Trades for Score",type:"number",value:u.thresholds.minTradesForScore,onChange:v("minTradesForScore"),fullWidth:!0,size:"small",helperText:"Minimum trades needed to calculate score"}),(0,V.jsx)(ke.A,{label:"Lookback Period (days)",type:"number",value:u.thresholds.lookbackPeriod,onChange:v("lookbackPeriod"),fullWidth:!0,size:"small",helperText:"Days to look back for pattern analysis"}),(0,V.jsx)(ke.A,{label:"Consistency Tolerance (%)",type:"number",value:u.thresholds.consistencyTolerance,onChange:v("consistencyTolerance"),fullWidth:!0,size:"small",helperText:"Acceptable deviation from patterns"})]})})]}),(0,V.jsxs)(ee.A,{children:[(0,V.jsx)(te.A,{expandIcon:(0,V.jsx)(oe.A,{}),children:(0,V.jsx)(i.A,{variant:"subtitle1",fontWeight:"medium",children:"Performance Targets"})}),(0,V.jsx)(re.A,{children:(0,V.jsxs)(n.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:2},children:[(0,V.jsx)(ke.A,{label:"Target Win Rate (%)",type:"number",value:u.targets.winRate,onChange:k("winRate"),fullWidth:!0,size:"small",helperText:"Your target win rate percentage"}),(0,V.jsx)(ke.A,{label:"Target Profit Factor",type:"number",inputProps:{step:.1},value:u.targets.profitFactor,onChange:k("profitFactor"),fullWidth:!0,size:"small",helperText:"Your target profit factor"}),(0,V.jsx)(ke.A,{label:"Max Drawdown (%)",type:"number",value:u.targets.maxDrawdown,onChange:k("maxDrawdown"),fullWidth:!0,size:"small",helperText:"Maximum acceptable drawdown"}),(0,V.jsx)(ke.A,{label:"Avg Risk/Reward Ratio",type:"number",inputProps:{step:.1},value:u.targets.avgRiskReward,onChange:k("avgRiskReward"),fullWidth:!0,size:"small",helperText:"Your target risk/reward ratio"})]})})]}),(0,V.jsxs)(ee.A,{children:[(0,V.jsx)(te.A,{expandIcon:(0,V.jsx)(oe.A,{}),children:(0,V.jsx)(i.A,{variant:"subtitle1",fontWeight:"medium",children:"Common Strategies Tracking"})}),(0,V.jsx)(re.A,{children:(0,V.jsx)(Re,{trades:p,selectedTags:h,onTagsChange:e=>{b(!0),x(e)},allTags:g})})]}),(0,V.jsxs)(ee.A,{children:[(0,V.jsx)(te.A,{expandIcon:(0,V.jsx)(oe.A,{}),children:(0,V.jsx)(i.A,{variant:"subtitle1",fontWeight:"medium",children:"Pattern Analysis Settings"})}),(0,V.jsx)(re.A,{children:(0,V.jsx)(We,{trades:p,excludedTags:u.excludedTagsFromPatterns||[],onExcludedTagsChange:e=>{const t={...u,excludedTagsFromPatterns:e};f(t),b(!0),r(t)},allTags:g})})]})]})]})})};var ze=r(21553);const Fe=e=>{let{trades:t,selectedDate:r=new Date,settings:o}=e;const c=(0,s.A)(),p=(0,a.useMemo)((()=>t.length<10?null:C.analyzeTagPatterns(t,r,o)),[t,r,o]),h=e=>{switch(e){case"high_performance":return(0,V.jsx)(N.A,{sx:{color:c.palette.success.main}});case"declining_pattern":return(0,V.jsx)(O.A,{sx:{color:c.palette.error.main}});case"market_condition":return(0,V.jsx)(ne.A,{sx:{color:c.palette.warning.main}});default:return(0,V.jsx)(ze.A,{sx:{color:c.palette.info.main}})}},x=e=>{switch(e){case"high":return c.palette.error.main;case"medium":return c.palette.warning.main;case"low":return c.palette.info.main;default:return c.palette.text.secondary}},g=e=>e>=70?c.palette.success.main:e>=50?c.palette.warning.main:c.palette.error.main,u=e=>`${e.toFixed(1)}%`;return!p||t.length<10?(0,V.jsx)(E.A,{sx:{backgroundColor:"dark"===c.palette.mode?(0,y.X4)(c.palette.background.paper,.8):c.palette.background.paper,borderRadius:2,boxShadow:c.shadows[2],border:`1px solid ${"dark"===c.palette.mode?(0,y.X4)(c.palette.common.white,.1):(0,y.X4)(c.palette.common.black,.1)}`},children:(0,V.jsxs)(L.A,{sx:{p:3},children:[(0,V.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:"\ud83c\udff7\ufe0f Tag Pattern Analysis"}),(0,V.jsx)(l.A,{severity:"info",children:"Add more trades to see tag pattern analysis. We need at least 10 trades to identify meaningful patterns and trends."})]})}):(0,V.jsx)(E.A,{sx:{backgroundColor:"dark"===c.palette.mode?(0,y.X4)(c.palette.background.paper,.8):c.palette.background.paper,borderRadius:2,boxShadow:c.shadows[2],border:`1px solid ${"dark"===c.palette.mode?(0,y.X4)(c.palette.common.white,.1):(0,y.X4)(c.palette.common.black,.1)}`},children:(0,V.jsxs)(L.A,{sx:{p:3},children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:3,children:[(0,V.jsx)(i.A,{variant:"h6",sx:{fontWeight:600},children:"\ud83c\udff7\ufe0f Tag Pattern Analysis"}),(0,V.jsx)($.A,{title:"Analysis of tag combinations to identify high-performing patterns and declining trends",children:(0,V.jsx)(m.A,{size:"small",children:(0,V.jsx)(q.A,{fontSize:"small"})})})]}),p.insights.length>0&&(0,V.jsxs)(n.A,{mb:3,children:[(0,V.jsx)(i.A,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:600},children:"\ud83d\udca1 Key Insights"}),(0,V.jsx)(d.A,{spacing:2,children:p.insights.slice(0,3).map(((e,t)=>(0,V.jsxs)(l.A,{severity:"high_performance"===e.type?"success":"declining_pattern"===e.type?"error":"warning",icon:h(e.type),sx:{backgroundColor:(0,y.X4)(x(e.severity),.1),border:`1px solid ${(0,y.X4)(x(e.severity),.2)}`,"& .MuiAlert-icon":{color:x(e.severity)}},children:[(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:e.title}),(0,V.jsx)(i.A,{variant:"body2",gutterBottom:!0,children:e.description}),(0,V.jsx)(n.A,{sx:{mt:1,mb:1},children:(0,V.jsx)(d.A,{direction:"row",spacing:1,flexWrap:"wrap",children:e.tagCombination.map((e=>(0,V.jsx)(X.A,{label:(0,ie.t)(e),size:"small",sx:(0,ie.dO)(e,c)},e)))})}),(0,V.jsxs)(i.A,{variant:"body2",sx:{fontStyle:"italic"},children:["\ud83d\udca1 ",e.recommendation]})]},t)))})]}),p.topCombinations.length>0&&(0,V.jsxs)(ee.A,{defaultExpanded:!0,children:[(0,V.jsx)(te.A,{expandIcon:(0,V.jsx)(oe.A,{}),children:(0,V.jsx)(i.A,{variant:"subtitle1",sx:{fontWeight:600},children:"\ud83c\udfc6 Top Performing Tag Combinations"})}),(0,V.jsx)(re.A,{children:(0,V.jsx)(d.A,{spacing:2,children:p.topCombinations.slice(0,5).map(((e,t)=>(0,V.jsxs)(n.A,{sx:{p:2,borderRadius:2,backgroundColor:"dark"===c.palette.mode?(0,y.X4)(c.palette.background.paper,.4):(0,y.X4)(c.palette.background.paper,.8),border:`1px solid ${(0,y.X4)(c.palette.divider,.2)}`},children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:1,children:[(0,V.jsx)(d.A,{direction:"row",spacing:1,flexWrap:"wrap",children:e.tags.map((e=>(0,V.jsx)(X.A,{label:(0,ie.t)(e),size:"small",sx:(0,ie.dO)(e,c)},e)))}),(0,V.jsx)(i.A,{variant:"h6",sx:{color:g(e.winRate),fontWeight:"bold"},children:u(e.winRate)})]}),(0,V.jsx)(F.A,{variant:"determinate",value:e.winRate,sx:{height:6,borderRadius:3,backgroundColor:"dark"===c.palette.mode?(0,y.X4)(c.palette.common.white,.1):c.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:g(e.winRate),borderRadius:3}}}),(0,V.jsxs)(d.A,{direction:"row",spacing:3,mt:1,children:[(0,V.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[(0,V.jsx)("strong",{children:"Trades:"})," ",e.totalTrades]}),(0,V.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[(0,V.jsx)("strong",{children:"W/L:"})," ",e.wins,"/",e.losses]}),(0,V.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[(0,V.jsx)("strong",{children:"Avg P&L:"})," ",e.avgPnL>0?"+":"",e.avgPnL.toFixed(2)]}),"stable"!==e.trend&&(0,V.jsx)(i.A,{variant:"caption",sx:{color:"improving"===e.trend?c.palette.success.main:c.palette.error.main,fontWeight:600},children:"improving"===e.trend?"\ud83d\udcc8 Improving":"\ud83d\udcc9 Declining"})]})]},t)))})})]}),p.decliningCombinations.length>0&&(0,V.jsxs)(ee.A,{sx:{mt:2},children:[(0,V.jsx)(te.A,{expandIcon:(0,V.jsx)(oe.A,{}),children:(0,V.jsx)(i.A,{variant:"subtitle1",sx:{fontWeight:600,color:c.palette.error.main},children:"\ud83d\udcc9 Declining Patterns"})}),(0,V.jsx)(re.A,{children:(0,V.jsx)(d.A,{spacing:2,children:p.decliningCombinations.map(((e,t)=>(0,V.jsxs)(n.A,{sx:{p:2,borderRadius:2,backgroundColor:(0,y.X4)(c.palette.error.main,.05),border:`1px solid ${(0,y.X4)(c.palette.error.main,.2)}`},children:[(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:1,children:[(0,V.jsx)(d.A,{direction:"row",spacing:1,flexWrap:"wrap",children:e.tags.map((e=>(0,V.jsx)(X.A,{label:(0,ie.t)(e),size:"small",sx:(0,ie.dO)(e,c)},e)))}),(0,V.jsxs)(d.A,{alignItems:"flex-end",children:[(0,V.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[u(e.historicalWinRate)," \u2192 ",u(e.recentWinRate)]}),(0,V.jsxs)(i.A,{variant:"body2",sx:{color:c.palette.error.main,fontWeight:600},children:["-",(e.historicalWinRate-e.recentWinRate).toFixed(1),"%"]})]})]}),(0,V.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:["This combination has declined from ",u(e.historicalWinRate)," to ",u(e.recentWinRate)," win rate recently. Consider reviewing your approach or market conditions."]})]},t)))})})]}),0===p.insights.length&&0===p.topCombinations.length&&(0,V.jsxs)(l.A,{severity:"info",sx:{mt:2},children:[(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"\ud83d\udcca Building Pattern Database"}),(0,V.jsx)(i.A,{variant:"body2",children:"Continue trading to build a larger dataset. More trades will help identify stronger patterns and trends in your tag combinations."})]})]})})},Ee=e=>{let{children:t,value:r,index:a,...s}=e;return(0,V.jsx)("div",{role:"tabpanel",hidden:r!==a,id:`score-tabpanel-${a}`,"aria-labelledby":`score-tab-${a}`,...s,children:r===a&&(0,V.jsx)(n.A,{children:t})})},Le=e=>{let{trades:t,selectedDate:r,calendarId:A,scoreSettings:b,onUpdateCalendarProperty:j,accountBalance:v,dynamicRiskSettings:w,allTags:k}=e;const C=(0,s.A)(),[T,S]=(0,a.useState)(0),M="monthly",[D,I]=(0,a.useState)("monthly"),[W,R]=(0,a.useState)(b||P.getSettings()),[F,E]=(0,a.useState)((null===b||void 0===b?void 0:b.selectedTags)||[]),[L,$]=(0,a.useState)(!1),[X,N]=(0,a.useState)(!1),O=(e=>{const t=Math.min(85,e.targets.winRate/60*75+Math.min(10,e.targets.avgRiskReward/2*10)),r=Math.min(80,Math.min(60,e.targets.profitFactor/1.5*60)+Math.min(20,e.targets.winRate/60*20)),a=(75*e.weights.consistency+t*e.weights.riskManagement+r*e.weights.performance+70*e.weights.discipline)/100;return Math.max(50,Math.min(90,a))})(W),[B,U]=(0,a.useState)(null),[Y,H]=(0,a.useState)([]),[G,_]=(0,a.useState)(null),[q,K]=(0,a.useState)(!1),[Z,Q]=(0,a.useState)(null);(0,a.useEffect)((()=>{b&&(R(b),E(b.selectedTags||[]))}),[b]),(0,a.useEffect)((()=>{P.updateSettings(W)}),[W]),(0,a.useEffect)((()=>{const e={...W,selectedTags:F};P.updateSettings(e)}),[F,W]),(0,a.useEffect)((()=>{void 0!==v&&P.updateDynamicRiskSettings({accountBalance:v,riskPerTrade:null===w||void 0===w?void 0:w.riskPerTrade,dynamicRiskEnabled:null===w||void 0===w?void 0:w.dynamicRiskEnabled,increasedRiskPercentage:null===w||void 0===w?void 0:w.increasedRiskPercentage,profitThresholdPercentage:null===w||void 0===w?void 0:w.profitThresholdPercentage})}),[v,w]),(0,a.useEffect)((()=>{if(0===t.length)return void U(null);(async()=>{N(!0);try{const e={...W,selectedTags:F};P.updateSettings(e);const a=await P.calculateScore(t,M,r,e);U(a)}catch(e){console.error("Error calculating score:",e),U(null)}finally{N(!1)}})()}),[t,M,r,F,W]),(0,a.useEffect)((()=>{if(0===t.length)return void H([]);(async()=>{try{const e={...W,selectedTags:F};P.updateSettings(e);const r=await P.getScoreHistory(t,D,12,e);H(r)}catch(e){console.error("Error calculating score history:",e),H([])}})()}),[t,D,F,W]),(0,a.useEffect)((()=>{if(0===t.length)return void _(null);(async()=>{try{const e={...W,selectedTags:F};P.updateSettings(e);const a=await P.calculateMultiPeriodScore(t,r,e);_(a)}catch(e){console.error("Error calculating multi-period scores:",e),_(null)}})()}),[t,r,F,W]);const ee=e=>{if(!G)return;const t=G[e];t&&(Q({analysis:t,period:e}),K(!0))},te=()=>{K(!1),Q(null)},re=async e=>{if(j){$(!0);try{const t={...W,selectedTags:null!==e&&void 0!==e?e:F};await j(A,(e=>({...e,scoreSettings:t})))}catch(t){console.error("Error saving score settings:",t)}finally{$(!1)}}};return(0,a.useEffect)((()=>{if(!b&&!j){const t=localStorage.getItem("scoreSettings");if(t)try{const e=JSON.parse(t);R(e),E(e.selectedTags||[])}catch(e){console.error("Error loading saved settings from localStorage:",e)}}}),[b,j]),0===t.length?(0,V.jsxs)(o.A,{sx:{p:3},children:[(0,V.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:"\ud83d\udcca Trading Score"}),(0,V.jsx)(l.A,{severity:"info",children:"Start adding trades to see your trading score and performance analysis. The scoring system will evaluate your consistency, risk management, performance, and discipline."})]}):t.length<W.thresholds.minTradesForScore?(0,V.jsxs)(o.A,{sx:{p:3},children:[(0,V.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:"\ud83d\udcca Trading Score"}),(0,V.jsxs)(l.A,{severity:"warning",children:["You need at least ",W.thresholds.minTradesForScore," trades to calculate your score. Current trades: ",t.length]})]}):(0,V.jsxs)(o.A,{"data-testid":"score-section",sx:{p:0,backgroundColor:"dark"===C.palette.mode?(0,y.X4)(C.palette.background.paper,.8):C.palette.background.paper,borderRadius:2,boxShadow:C.shadows[2],border:`1px solid ${"dark"===C.palette.mode?"rgba(204, 204, 204, 0.1)":(0,y.X4)(C.palette.common.black,.1)}`},children:[(0,V.jsx)(n.A,{sx:{px:3,pt:3},children:(0,V.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:3,children:[(0,V.jsx)(i.A,{variant:"h6",sx:{color:C.palette.text.primary,fontWeight:600},children:"\ud83d\udcca Trading Score Analysis"}),(0,V.jsxs)(c.A,{value:T,onChange:(e,t)=>{S(t)},sx:{minHeight:40,backgroundColor:"light"===C.palette.mode?"#f0f0f0":(0,y.X4)(C.palette.background.paper,.4),borderRadius:"20px",padding:"4px","& .MuiTabs-flexContainer":{gap:"4px"},"& .MuiTabs-indicator":{display:"none"}},children:[(0,V.jsx)(p.A,{label:"Overview",sx:{minHeight:32,my:.2,textTransform:"none",fontSize:"0.875rem",fontWeight:500,color:"text.secondary",borderRadius:"16px",padding:"6px 18px","&.Mui-selected":{color:"dark"===C.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:C.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,y.X4)(C.palette.primary.main,.05),color:"primary.main"}}}),(0,V.jsx)(p.A,{label:"History",sx:{minHeight:32,my:.2,textTransform:"none",fontSize:"0.875rem",fontWeight:500,color:"text.secondary",borderRadius:"16px",padding:"6px 18px","&.Mui-selected":{color:"dark"===C.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:C.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,y.X4)(C.palette.primary.main,.05),color:"primary.main"}}}),(0,V.jsx)(p.A,{label:"Patterns",sx:{minHeight:32,my:.2,textTransform:"none",fontSize:"0.875rem",fontWeight:500,color:"text.secondary",borderRadius:"16px",padding:"6px 18px","&.Mui-selected":{color:"dark"===C.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:C.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,y.X4)(C.palette.primary.main,.05),color:"primary.main"}}}),(0,V.jsx)(p.A,{label:"Settings",sx:{minHeight:32,my:.2,textTransform:"none",fontSize:"0.875rem",fontWeight:500,color:"text.secondary",borderRadius:"16px",padding:"6px 18px","&.Mui-selected":{color:"dark"===C.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:C.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,y.X4)(C.palette.primary.main,.05),color:"primary.main"}}})]})]})}),(0,V.jsxs)(n.A,{sx:{px:3,pb:3},children:[(0,V.jsx)(Ee,{value:T,index:0,children:(0,V.jsxs)(d.A,{spacing:4,children:[X?(0,V.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:4},children:[(0,V.jsx)(h.A,{size:40,sx:{mb:2}}),(0,V.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Calculating trading scores..."})]}):G?(0,V.jsxs)(n.A,{children:[(0,V.jsx)(i.A,{variant:"body2",sx:{color:C.palette.text.secondary,mb:1,fontStyle:"italic"},children:"Click on any score card to see detailed breakdown"}),(0,V.jsxs)(d.A,{direction:{xs:"column",sm:"row"},spacing:2,sx:{flexWrap:"wrap"},children:[(0,V.jsx)(n.A,{onClick:()=>ee("daily"),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-2px)"},flex:{xs:"1",sm:"1 1 calc(50% - 8px)",md:"1 1 calc(25% - 12px)"}},children:(0,V.jsx)(J,{score:G.daily.currentScore,trend:G.daily.trend,period:"daily",compact:!0,recommendedScore:O})}),(0,V.jsx)(n.A,{onClick:()=>ee("weekly"),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-2px)"},flex:{xs:"1",sm:"1 1 calc(50% - 8px)",md:"1 1 calc(25% - 12px)"}},children:(0,V.jsx)(J,{score:G.weekly.currentScore,trend:G.weekly.trend,period:"weekly",compact:!0,recommendedScore:O})}),(0,V.jsx)(n.A,{onClick:()=>ee("monthly"),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-2px)"},flex:{xs:"1",sm:"1 1 calc(50% - 8px)",md:"1 1 calc(25% - 12px)"}},children:(0,V.jsx)(J,{score:G.monthly.currentScore,trend:G.monthly.trend,period:"monthly",compact:!0,recommendedScore:O})}),(0,V.jsx)(n.A,{onClick:()=>ee("yearly"),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-2px)"},flex:{xs:"1",sm:"1 1 calc(50% - 8px)",md:"1 1 calc(25% - 12px)"}},children:(0,V.jsx)(J,{score:G.yearly.currentScore,trend:G.yearly.trend,period:"yearly",compact:!0,recommendedScore:O})})]})]}):(0,V.jsxs)(l.A,{severity:"warning",children:[(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"\ud83d\udcca No Score Data Available"}),(0,V.jsxs)(i.A,{variant:"body2",children:["Unable to calculate multi-period scores. This could be because:",(0,V.jsx)("br",{}),"\u2022 No trades found for the current periods",(0,V.jsx)("br",{}),"\u2022 Insufficient trade data for analysis",(0,V.jsx)("br",{}),"\u2022 All trades are outside the selected date range"]})]}),B&&B.recommendations.length>0&&(0,V.jsxs)(l.A,{severity:"info",sx:{backgroundColor:"dark"===C.palette.mode?(0,y.X4)(C.palette.info.main,.1):(0,y.X4)(C.palette.info.main,.05),border:`1px solid ${(0,y.X4)(C.palette.info.main,.2)}`,borderRadius:2,"& .MuiAlert-icon":{color:C.palette.info.main}},children:[(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"\ud83d\udca1 Quick Tip"}),(0,V.jsx)(i.A,{variant:"body2",children:B.recommendations[0]})]}),!G&&!B&&(0,V.jsxs)(l.A,{severity:"info",children:[(0,V.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"\ud83c\udfaf Get Started with Scoring"}),(0,V.jsxs)(i.A,{variant:"body2",children:["To see your trading score analysis:",(0,V.jsx)("br",{}),"\u2022 Add at least ",W.thresholds.minTradesForScore," trades",(0,V.jsx)("br",{}),"\u2022 Ensure trades have dates within the current periods",(0,V.jsx)("br",{}),"\u2022 Include session, tags, and risk/reward data for better analysis"]})]})]})}),(0,V.jsx)(Ee,{value:T,index:1,children:(0,V.jsx)(be,{history:Y,period:D,onPeriodChange:e=>{I(e)}})}),(0,V.jsx)(Ee,{value:T,index:2,children:(0,V.jsx)(Fe,{trades:t,selectedDate:r,settings:W})}),(0,V.jsx)(Ee,{value:T,index:3,children:(0,V.jsx)(d.A,{spacing:3,children:(0,V.jsx)(Pe,{settings:W,onSettingsChange:e=>{R(e)},onSave:re,isSaving:L,trades:t,selectedTags:F,onTagsChange:async e=>{E(e),j&&await re(e)},allTags:k})})})]}),(0,V.jsxs)(x.A,{open:q,onClose:te,maxWidth:"lg",fullWidth:!0,sx:{"& .MuiDialog-paper":{backgroundColor:"dark"===C.palette.mode?(0,y.X4)(C.palette.background.paper,.95):C.palette.background.paper,borderRadius:2,maxHeight:"90vh"},"& .MuiDialogContent-root":{...(0,z.J)(C)}},children:[(0,V.jsxs)(g.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,V.jsx)(i.A,{variant:"h6",sx:{fontWeight:600},children:Z?`\ud83d\udcca ${Z.period.charAt(0).toUpperCase()+Z.period.slice(1)} Score Analysis`:"Score Analysis"}),(0,V.jsx)(m.A,{onClick:te,sx:{color:C.palette.text.secondary,"&:hover":{backgroundColor:(0,y.X4)(C.palette.text.secondary,.1)}},children:(0,V.jsx)(f.A,{})})]}),(0,V.jsx)(u.A,{sx:{pt:1},children:Z&&(0,V.jsx)(le,{breakdown:Z.analysis.breakdown,pattern:Z.analysis.pattern,recommendations:Z.analysis.recommendations,strengths:Z.analysis.strengths,weaknesses:Z.analysis.weaknesses})})]})]})}},32322:(e,t,r)=>{r.d(t,{AO:()=>o,Fm:()=>i,Kf:()=>l,l6:()=>s});var a=r(5780),n=r(49221);const s=e=>{if(0===e.length)return 0;return e.filter((e=>"win"===e.type)).length/e.length*100},o=e=>{const t=e.filter((e=>e.amount>0)).reduce(((e,t)=>e+t.amount),0),r=Math.abs(e.filter((e=>e.amount<0||"loss"===e.type)).reduce(((e,t)=>e+t.amount),0));return 0===r?t>0?50:0:t/r},i=(e,t,r,a,n)=>{if(!r||r<=0||!t)return 0;const s=(e=>e.reduce(((e,t)=>e+t.amount),0))(e);let o=t;if(a&&n){o=t+n.filter((e=>new Date(e.date)<a)).reduce(((e,t)=>e+t.amount),0)}if(o<=0)return 0;const i=r/100*o;return Math.min(Math.max(s/i*100,0),100)},l=(e,t,r,s,o,i)=>{const l=e.reduce(((e,t)=>e+t.amount),0),d=o&&i?(0,n.eJ)(l,t,o,(0,a.A)(i)).toFixed(1):t>0?(l/t*100).toFixed(1):"0";let c="neutral";e.length>0&&(c=l>0?"win":l<0?"loss":e.find((e=>"breakeven"===e.type))?"breakeven":"neutral");let p=r;s&&o&&(p=(0,n.Pp)(r,o,s));const h=parseFloat(d);return{netAmount:l,status:c,percentage:d,isDrawdownViolation:"loss"===c&&Math.abs(h)>p}}},40269:(e,t,r)=>{r.d(t,{A:()=>C});var a=r(65043),n=r(60267),s=r(53969),o=r(55895),i=r(12097),l=r(42579),d=r(94799),c=r(29651),p=r(63898),h=r(15483),x=r(66370),g=r(85662),m=r(6013),u=r(99130),y=r(17105),f=r(7609),A=r(20234),b=r(16857),j=r(45384),v=r(46577),w=r(32322),k=r(70579);const C=e=>{let{open:t,onClose:r,onDateSelect:C,initialDate:T,trades:S,accountBalance:M,monthlyTarget:D,yearlyTarget:I,onOpenGalleryMode:W}=e;const R=(0,n.A)(),[P,z]=a.useState(T||new Date),F=P.getFullYear(),E=["January","February","March","April","May","June","July","August","September","October","November","December"];a.useEffect((()=>{T&&z(T)}),[T]);const L=P.getMonth(),$=S.filter((e=>new Date(e.date).getFullYear()===F)),X=$.reduce(((e,t)=>e+t.amount),0),N=$.filter((e=>"win"===e.type)).length,O=$.filter((e=>"loss"===e.type)).length,B=$.length>0?(N/$.length*100).toFixed(1):"0",U=new Date(F,0,1),Y=S.filter((e=>new Date(e.date)<U)),H=M+Y.reduce(((e,t)=>e+t.amount),0),G=H>0?(X/H*100).toFixed(2):"0",_=e=>S.filter((t=>new Date(t.date).getFullYear()===F&&new Date(t.date).getMonth()===e)).reduce(((e,t)=>e+t.amount),0),q=(()=>{let e=-1,t=0;for(let r=0;r<12;r++){const a=_(r);a>t&&(t=a,e=r)}return{name:e>=0?E[e]:"None",pnl:t}})(),V=(()=>{if(!I||I<=0)return null;const e=new Date(F,0,1),t=(0,w.Fm)($,M,I,e,S),r=S.filter((t=>new Date(t.date)<e)),a=M+r.reduce(((e,t)=>e+t.amount),0),n=I/100*a;return{progress:t,isMet:X>=n,rawProgress:X/n*100}})(),J=(0,k.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[(0,k.jsx)(p.A,{sx:{fontSize:"1.75rem",color:R.palette.primary.main}}),(0,k.jsx)(o.A,{variant:"h5",sx:{fontWeight:700,flex:1,color:"text.primary",fontSize:"1.5rem",ml:1.5},children:"Select Month"}),(0,k.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[F!==(new Date).getFullYear()&&(0,k.jsx)(i.A,{onClick:()=>z(new Date),size:"medium",variant:"outlined",startIcon:(0,k.jsx)(p.A,{sx:{fontSize:"1.1rem"}}),sx:{ml:1,textTransform:"none",fontWeight:600,borderRadius:1.5,px:2},children:"Today"}),(0,k.jsx)(l.A,{onClick:()=>z((e=>(0,f.A)(e,1))),sx:{color:"text.primary",bgcolor:(0,c.X4)(R.palette.primary.main,.05)},children:(0,k.jsx)(h.A,{})}),(0,k.jsx)(o.A,{variant:"h5",sx:{fontWeight:800,color:"text.primary",minWidth:"80px",textAlign:"center",letterSpacing:"-0.5px"},children:F}),(0,k.jsx)(l.A,{onClick:()=>z((e=>(0,A.A)(e,1))),sx:{color:"text.primary",bgcolor:(0,c.X4)(R.palette.primary.main,.05)},children:(0,k.jsx)(x.A,{})})]})]}),K=(0,k.jsxs)(s.A,{sx:{display:"flex",gap:2},children:[(0,k.jsx)(i.A,{onClick:r,variant:"outlined",size:"large",sx:{textTransform:"none",fontWeight:600,borderRadius:1.5,px:3},children:"Cancel"}),W&&$.length>0&&(0,k.jsx)(i.A,{onClick:()=>{if(W&&$.length>0){const e=`${F} - All Trades (${$.length} trades)`;W($,$[0].id,e),r()}},variant:"contained",size:"large",startIcon:(0,k.jsx)(g.A,{}),sx:{textTransform:"none",fontWeight:600,borderRadius:1.5,px:3},children:"Gallery View"})]});return(0,k.jsx)(j.mY,{open:t,onClose:r,title:J,actions:K,maxWidth:"sm",fullWidth:!0,hideFooterCancelButton:!0,children:(0,k.jsxs)(s.A,{sx:{pt:"24px",pb:"24px",...(0,v.J)(R)},children:[(0,k.jsxs)(d.A,{elevation:0,sx:{px:3,py:2,mb:2,borderRadius:2,bgcolor:e=>(0,c.X4)(e.palette.background.default,.5),border:"1px solid",borderColor:e=>e.palette.divider,position:"relative",overflow:"hidden"},children:[(0,k.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2.5,pl:1},children:[(0,k.jsxs)(s.A,{sx:{display:"flex",flexDirection:"row",gap:.5},children:[(0,k.jsx)(o.A,{variant:"h6",sx:{color:"text.primary",fontSize:"1.1rem",fontWeight:600},children:"Yearly Statistics"}),V&&(0,k.jsx)(b.A,{progress:V.rawProgress,isMet:V.isMet,tooltipText:`${V.isMet?"Yearly target achieved":"Progress towards yearly target"}: ${V.rawProgress.toFixed(0)}%`})]}),(0,k.jsx)(s.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:(0,k.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1,bgcolor:e=>(0,c.X4)(e.palette.success.light,.1),py:.75,px:1.5,borderRadius:1,border:"1px solid",borderColor:"success.light"},children:[(0,k.jsx)(o.A,{variant:"body2",sx:{fontSize:"0.85rem",fontWeight:500,color:"text.secondary"},children:"Best Month:"}),(0,k.jsxs)(o.A,{variant:"body2",sx:{fontSize:"0.85rem",fontWeight:700,color:"success.main"},children:[q.name," ($",q.pnl.toLocaleString(),")"]})]})})]}),(0,k.jsxs)(s.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr 1fr"},gap:4,width:"100%"},children:[(0,k.jsxs)(s.A,{children:[(0,k.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:1},children:[(0,k.jsx)(s.A,{sx:{p:.8,borderRadius:1,bgcolor:e=>(0,c.X4)(e.palette.primary.main,.1),display:"flex",alignItems:"center",justifyContent:"center",mb:1},children:(0,k.jsx)(m.A,{sx:{fontSize:"1.2rem",color:"primary.main"}})}),(0,k.jsx)(o.A,{variant:"body1",sx:{fontSize:"1rem",fontWeight:600,color:"text.primary",textAlign:"center"},children:"Yearly P&L"})]}),(0,k.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[(0,k.jsxs)(o.A,{variant:"h5",sx:{fontWeight:700,fontSize:"1.5rem",color:e=>X>0?e.palette.success.main:X<0?e.palette.error.main:"dark"===e.palette.mode?"grey.300":"text.primary",textAlign:"center"},children:["$",Math.abs(X).toLocaleString()]}),(0,k.jsxs)(s.A,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:.5},children:[(0,k.jsx)(o.A,{variant:"body2",sx:{fontWeight:500,color:"text.secondary",fontSize:"0.9rem",textAlign:"center"},children:"Growth"}),(0,k.jsxs)(o.A,{variant:"body2",sx:{fontWeight:700,color:e=>X>0?e.palette.success.main:X<0?e.palette.error.main:"dark"===e.palette.mode?"grey.300":"text.primary",fontSize:"1rem",textAlign:"center"},children:[G,"%"]})]})]})]}),(0,k.jsxs)(s.A,{children:[(0,k.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:1},children:[(0,k.jsx)(s.A,{sx:{p:.8,borderRadius:1,bgcolor:e=>(0,c.X4)(e.palette.success.main,.1),display:"flex",alignItems:"center",justifyContent:"center",mb:1},children:(0,k.jsx)(u.A,{sx:{fontSize:"1.2rem",color:"success.main"}})}),(0,k.jsx)(o.A,{variant:"body1",sx:{fontSize:"1rem",fontWeight:600,color:"text.primary",textAlign:"center"},children:"Win Rate"})]}),(0,k.jsxs)(o.A,{variant:"h5",sx:{fontWeight:700,fontSize:"1.5rem",color:parseFloat(B)>50?"success.main":"text.primary",textAlign:"center"},children:[B,"%"]}),(0,k.jsxs)(o.A,{variant:"body1",sx:{fontWeight:500,fontSize:"1rem",color:"text.secondary",mt:.5,textAlign:"center"},children:[N," Ws / ",O," Ls"]})]}),(0,k.jsxs)(s.A,{children:[(0,k.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:1},children:[(0,k.jsx)(s.A,{sx:{p:.8,borderRadius:1,bgcolor:e=>(0,c.X4)(e.palette.info.main,.1),display:"flex",alignItems:"center",justifyContent:"center",mb:1},children:(0,k.jsx)(y.A,{sx:{fontSize:"1.2rem",color:"info.main"}})}),(0,k.jsx)(o.A,{variant:"body1",sx:{fontSize:"1rem",fontWeight:600,color:"text.primary",textAlign:"center"},children:"Total Trades"})]}),(0,k.jsx)(o.A,{variant:"h5",sx:{fontWeight:700,fontSize:"1.5rem",color:"text.primary",textAlign:"center"},children:$.length}),(0,k.jsx)(o.A,{variant:"body1",sx:{fontWeight:500,fontSize:"1rem",color:"text.secondary",mt:.5,textAlign:"center"},children:"Trades this year"})]})]})]}),(0,k.jsx)(o.A,{variant:"h6",sx:{color:"text.primary",mb:2,fontSize:"1.1rem",fontWeight:600,pl:1},children:"Select a Month"}),(0,k.jsx)(s.A,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:1.5},children:E.map(((e,t)=>{const a=_(t),n=0!==a,i=(e=>{if(!D||D<=0)return null;const t=S.filter((t=>new Date(t.date).getFullYear()===F&&new Date(t.date).getMonth()===e)),r=new Date(F,e,1),a=(0,w.Fm)(t,M,D,r,S),n=_(e),s=S.filter((e=>new Date(e.date)<r)),o=M+s.reduce(((e,t)=>e+t.amount),0),i=D/100*o;return{progress:a,isMet:n>=i,rawProgress:n/i*100}})(t),l=(e=>{const t=_(e),r=new Date(F,e,1),a=S.filter((e=>new Date(e.date)<r)),n=M+a.reduce(((e,t)=>e+t.amount),0);return n<=0?"0":(t/n*100).toFixed(2)})(t);return(0,k.jsxs)(d.A,{onClick:()=>(e=>{const t=new Date(F,e,1);C(t),r()})(t),elevation:0,sx:{p:2.5,cursor:"pointer",display:"flex",flexDirection:"column",gap:1,height:"100%",bgcolor:e=>n?"dark"===e.palette.mode?(0,c.X4)("#fff",.08):(0,c.X4)(e.palette.primary.main,.04):"dark"===e.palette.mode?"transparent":"#f5f5f5",border:"1px solid",borderColor:e=>L===t&&F===(null===T||void 0===T?void 0:T.getFullYear())?e.palette.primary.main:"dark"===e.palette.mode?(0,c.X4)("#fff",.12):e.palette.grey[200],borderRadius:2,transition:"all 0.2s",position:"relative",overflow:"hidden",...L===t&&F===(null===T||void 0===T?void 0:T.getFullYear())&&{"&::before":{content:'""',position:"absolute",top:0,left:0,width:"100%",height:"4px",backgroundColor:"primary.main"}},"&:hover":{bgcolor:e=>"dark"===e.palette.mode?(0,c.X4)("#fff",.12):(0,c.X4)(e.palette.primary.main,.08),borderColor:"primary.main",transform:"translateY(-2px)",boxShadow:e=>`0 4px 12px ${(0,c.X4)(e.palette.primary.main,.2)}`}},children:[(0,k.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[(0,k.jsx)(o.A,{variant:"h6",sx:{color:e=>L===t&&F===(null===T||void 0===T?void 0:T.getFullYear())?e.palette.primary.main:e.palette.text.primary,fontWeight:700,fontSize:"1.1rem"},children:e}),i&&n&&(0,k.jsx)(s.A,{sx:{ml:1},children:(0,k.jsx)(b.A,{progress:i.rawProgress,isMet:i.isMet,tooltipText:`${i.isMet?"Monthly target achieved":"Progress towards monthly target"}: ${i.rawProgress.toFixed(0)}%`})})]}),n&&(0,k.jsx)(k.Fragment,{children:(0,k.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,k.jsxs)(o.A,{variant:"h6",sx:{color:a>0?"success.main":"error.main",fontSize:"1.2rem",fontWeight:700,display:"flex",alignItems:"center",gap:.5},children:["$",Math.abs(a).toLocaleString(),(0,k.jsx)(s.A,{component:"span",sx:{fontSize:"0.9rem",fontWeight:600},children:a>0?"\u2191":"\u2193"})]}),(0,k.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,k.jsx)(o.A,{variant:"caption",sx:{fontWeight:500,color:"text.secondary",fontSize:"0.75rem"},children:"Growth"}),(0,k.jsxs)(o.A,{variant:"caption",sx:{fontWeight:600,color:a>0?"success.main":"error.main",fontSize:"0.75rem"},children:[l,"%"]})]})]})})]},e)}))})]})})}},52532:(e,t,r)=>{r.d(t,{A:()=>f});var a=r(65043),n=r(39993),s=r(5093),o=r(60267),i=r(53969),l=r(55895),d=r(33309),c=r(12843),p=r(94799),h=r(29651),x=r(32515),g=r(30994),m=r(20872),u=r(61711),y=r(70579);const f=e=>{let{trades:t,selectedDate:r,monthlyTarget:f,accountBalance:A,maxDailyDrawdown:b,calendarId:j,scoreSettings:v,onTimePeriodChange:w,onPrimaryTagsChange:k=()=>{},onSecondaryTagsChange:C=()=>{},onEditTrade:T,onDeleteTrade:S,onUpdateTradeProperty:M,onUpdateCalendarProperty:D,dynamicRiskSettings:I,onOpenGalleryMode:W}=e;const R=(0,o.A)(),[P,z]=(0,a.useState)("month"),[F,E]=(0,a.useState)(0),[L,$]=(0,a.useState)([]),[X,N]=(0,a.useState)([]),[O,B]=(0,a.useState)([]),[U,Y]=(0,a.useState)({open:!1,trades:[],date:"",expandedTradeId:null});(0,a.useEffect)((()=>{if(U.open&&U.trades.length>0){const e=U.trades.filter((e=>t.some((t=>t.id===e.id))&&!e.isDeleted)).map((e=>t.find((t=>t.id===e.id))||e));if(0===e.length)return void Y((e=>({...e,open:!1})));JSON.stringify(e)!==JSON.stringify(U.trades)&&Y((t=>({...t,trades:e})))}}),[t,U.open,U.trades]);const[H,G]=(0,a.useState)(null),[_,q]=(0,a.useState)([]),[V,J]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{J(!0);try{const e=await(0,u.D9)(t,r,P);q(e)}catch(e){console.error("Error calculating chart data:",e),q([])}finally{J(!1)}})()}),[t,r,P]);const K=u.Nb,Z=(0,a.useMemo)((()=>{const e=K(t,r,P).filter((e=>void 0!==e.riskToReward)).sort(((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()));if(0===e.length)return{average:0,max:0,data:[]};const a=e.map((e=>e.riskToReward));return{average:a.reduce(((e,t)=>e+t),0)/a.length,max:Math.max(...a),data:e.map((e=>({date:(0,n.A)(new Date(e.date),"month"===P?"MM/dd":"MM/dd/yyyy"),rr:e.riskToReward||0})))}}),[t,r,P,K]),Q=(0,a.useMemo)((()=>{const e=K(t,r,P),a=e.filter((e=>"win"===e.type)),n=e.filter((e=>"loss"===e.type)),s=e.filter((e=>"breakeven"===e.type)),o=a.length,i=n.length,l=s.length,d=o+i+l,c=o+i,p=c>0?o/c*100:0,h=a.reduce(((e,t)=>e+t.amount),0),x=n.reduce(((e,t)=>e+t.amount),0),g=s.reduce(((e,t)=>e+t.amount),0),m=o>0?h/o:0,u=i>0?x/i:0,y=l>0?g/l:0;let f=0,A=0,b=0,j=0,v=0,w=0,k=0,C=0;[...e].sort(((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())).forEach((e=>{"win"===e.type?(f++,v=0,f>A&&(A=f)):"loss"===e.type?(f>0&&(b+=f,j++),f=0,v++,v>w&&(w=v)):e.type})),f>0?(b+=f,j++):v>0&&(k+=v,C++);return{totalTrades:d,winRate:p,winners:{total:o,avgAmount:m,maxConsecutive:A,avgConsecutive:j>0?b/j:0},losers:{total:i,avgAmount:u,maxConsecutive:w,avgConsecutive:C>0?k/C:0},breakevens:{total:l,avgAmount:y}}}),[t,r,P,K]),ee=(0,a.useMemo)((()=>{const{winners:e,losers:t,breakevens:r}=Q;return[{name:"Wins",value:e.total},{name:"Losses",value:t.total},{name:"Breakeven",value:(null===r||void 0===r?void 0:r.total)||0}].filter((e=>e.value>0))}),[Q]),te=(0,a.useMemo)((()=>{if(0===O.length)return null;const e=K(t,r,P).filter((e=>!!e.tags&&O.some((t=>e.tags.includes(t))))),a=e.filter((e=>"win"===e.type)),n=e.filter((e=>"loss"===e.type)),s=e.filter((e=>"breakeven"===e.type));return[{name:"Wins",value:a.length},{name:"Losses",value:n.length},{name:"Breakeven",value:s.length}].filter((e=>e.value>0))}),[t,r,P,O,K]),re=(0,a.useMemo)((()=>{const e=K(t,r,P).reduce(((e,t)=>{const r=(0,n.A)(new Date(t.date),"yyyy-MM-dd");return e[r]||(e[r]=[]),e[r].push(t),e}),{});return Object.entries(e).map((e=>{let[t,r]=e;const a=r.reduce(((e,t)=>e+t.amount),0),n=r.reduce(((e,t)=>(t.session&&(e[t.session]=(e[t.session]||0)+1),e)),{});let o="",i=0;return Object.entries(n).forEach((e=>{let[t,r]=e;r>i&&(o=t,i=r)})),{date:(0,s.A)(t),trades:r.length,session:o,pnl:a}})).sort(((e,t)=>t.date.getTime()-e.date.getTime()))}),[t,r,P,K]),ae=(0,a.useMemo)((()=>{const e=K(t,r,P),a=new Map;return e.forEach((e=>{e.tags&&e.tags.forEach((t=>{const r=a.get(t)||{wins:0,losses:0,breakevens:0,totalPnL:0};"win"===e.type?r.wins++:"loss"===e.type?r.losses++:"breakeven"===e.type&&r.breakevens++,r.totalPnL+=e.amount,a.set(t,r)}))})),Array.from(a.entries()).map((e=>{let[t,r]=e;const a=r.wins+r.losses,n=a>0?Math.round(r.wins/a*100):0,s=r.wins+r.losses+r.breakevens;return{tag:t,wins:r.wins,losses:r.losses,breakevens:r.breakevens,totalTrades:s,winRate:n,totalPnL:r.totalPnL}})).sort(((e,t)=>t.totalTrades-e.totalTrades))}),[t,r,P,K]),ne=(0,a.useMemo)((()=>{const e=K(t,r,P).filter((e=>void 0!==e.session));return["Asia","London","NY AM","NY PM"].map((t=>{const r=e.filter((e=>e.session===t)),a=r.length,n=r.filter((e=>"win"===e.type)).length,s=r.filter((e=>"loss"===e.type)).length,o=r.filter((e=>"breakeven"===e.type)).length,i=n+s,l=i>0?n/i*100:0,d=r.reduce(((e,t)=>e+t.amount),0);return{session:t,totalTrades:a,winners:n,losers:s,breakevens:o,winRate:l,totalPnL:d,averagePnL:a>0?d/a:0,pnlPercentage:A>0?d/A*100:0}}))}),[t,r,P,A,K]),se=(0,a.useMemo)((()=>{const e=new Set;return t.forEach((t=>{t.tags&&t.tags.forEach((t=>e.add(t)))})),Array.from(e).sort()}),[t]),oe=(0,a.useMemo)((()=>0===L.length&&0===X.length?[]:ae.filter((e=>{if(L.length>0&&!L.includes(e.tag))return!1;if(X.length>0){if(!t.filter((t=>{var r,a;return null!==(r=null===(a=t.tags)||void 0===a?void 0:a.includes(e.tag))&&void 0!==r&&r})).some((e=>X.every((t=>{var r,a;return null!==(r=null===(a=e.tags)||void 0===a?void 0:a.includes(t))&&void 0!==r&&r})))))return!1}return!0}))),[ae,L,X,t]),ie=(0,a.useMemo)((()=>void 0===f||A<=0?null:f/100*A),[f,A]),le=(0,a.useMemo)((()=>-b/100*A),[b,A]),de=e=>{Y((t=>({...t,expandedTradeId:t.expandedTradeId===e?null:e})))};return(0,y.jsxs)(i.A,{sx:{p:2},children:[H&&(0,y.jsx)(x.A,{open:!!H,onClose:()=>G(null),imageProp:H}),(0,y.jsx)(m.Q_,{open:U.open,trades:U.trades,date:U.date,expandedTradeId:U.expandedTradeId,onUpdateTradeProperty:M,onClose:()=>Y((e=>({...e,open:!1}))),onTradeExpand:de,onZoomImage:(e,t,r)=>{G({selectetdImageIndex:r||0,allImages:t||[e]})},accountBalance:A,allTrades:t,onEditClick:T,onDeleteClick:S,onOpenGalleryMode:W,calendarId:j}),(0,y.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,y.jsxs)(l.A,{variant:"h6",children:["Performance Charts for ","month"===P?(0,n.A)(r,"MMMM yyyy"):"year"===P?(0,n.A)(r,"yyyy"):"All Time"]}),(0,y.jsxs)(d.A,{value:P,onChange:(e,t)=>(e=>{z(e),null===w||void 0===w||w(e)})(t),sx:{minHeight:40,backgroundColor:"light"===R.palette.mode?"#f0f0f0":(0,h.X4)(R.palette.background.paper,.4),borderRadius:"20px",padding:"4px","& .MuiTabs-flexContainer":{gap:"4px"},"& .MuiTabs-indicator":{display:"none"}},children:[(0,y.jsx)(c.A,{label:"Month",value:"month",sx:{minHeight:32,my:.2,textTransform:"none",fontSize:"0.875rem",fontWeight:500,color:"text.secondary",borderRadius:"16px",padding:"6px 18px","&.Mui-selected":{color:"dark"===R.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:R.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,h.X4)(R.palette.primary.main,.05),color:"primary.main"}}}),(0,y.jsx)(c.A,{label:"Year",value:"year",sx:{minHeight:32,my:.2,textTransform:"none",fontSize:"0.875rem",fontWeight:500,color:"text.secondary",borderRadius:"16px",padding:"6px 18px","&.Mui-selected":{color:"dark"===R.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:R.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,h.X4)(R.palette.primary.main,.05),color:"primary.main"}}}),(0,y.jsx)(c.A,{label:"All Time",value:"all",sx:{minHeight:32,my:.2,textTransform:"none",fontSize:"0.875rem",fontWeight:500,color:"text.secondary",borderRadius:"16px",padding:"6px 18px","&.Mui-selected":{color:"dark"===R.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:R.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,h.X4)(R.palette.primary.main,.05),color:"primary.main"}}})]})]}),_.some((e=>0!==e.pnl))||ee.some((e=>e.value>0))?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(m.ng,{riskRewardStats:Z}),(0,y.jsx)(m.jH,{winLossStats:Q,trades:K(t,r,P),onTradeClick:de}),(0,y.jsx)(m.fc,{chartData:_,targetValue:ie,monthlyTarget:f,drawdownViolationValue:le,setMultipleTradesDialog:Y,timePeriod:P}),(0,y.jsxs)(i.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:3,mb:3,height:"500px"},children:[(0,y.jsx)(i.A,{sx:{flex:1,width:{xs:"100%",md:"50%"}},children:(0,y.jsx)(m.Y$,{winLossData:ee,comparisonWinLossData:te,allTags:se,comparisonTags:O,setComparisonTags:B,onPieClick:e=>{const a=K(t,r,P);let s=[],o="";if("Wins"===e||"Losses"===e){let t;s=a.filter((t=>"Wins"===e&&"win"===t.type||"Losses"===e&&"loss"===t.type)),t="month"===P?(0,n.A)(r,"MMMM yyyy"):"year"===P?(0,n.A)(r,"yyyy"):"All Time",o=`${e} for ${t}`}else s=a.filter((t=>{var r;return null===(r=t.tags)||void 0===r?void 0:r.includes(e)})),o=`Trades with tag: ${e}`;s.length>0&&Y({open:!0,trades:s,date:o,expandedTradeId:1===s.length?s[0].id:null})},tagStats:ae})}),(0,y.jsx)(i.A,{sx:{flex:1,width:{xs:"100%",md:"50%"}},children:(0,y.jsx)(m.UY,{dailySummaryData:re,trades:t,setMultipleTradesDialog:Y})})]}),(0,y.jsxs)(p.A,{sx:{p:3,mb:3,borderRadius:2},children:[(0,y.jsx)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:(0,y.jsxs)(d.A,{value:F,onChange:(e,t)=>{E(t)},sx:{minHeight:40,backgroundColor:"light"===R.palette.mode?"#f0f0f0":(0,h.X4)(R.palette.background.paper,.4),borderRadius:"20px",padding:"4px","& .MuiTabs-flexContainer":{gap:"4px"},"& .MuiTabs-indicator":{display:"none"}},children:[(0,y.jsx)(c.A,{label:"Tag Performance",sx:{minHeight:32,my:.2,textTransform:"none",fontSize:"0.875rem",fontWeight:500,color:"text.secondary",borderRadius:"16px",padding:"6px 18px","&.Mui-selected":{color:"dark"===R.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:R.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,h.X4)(R.palette.primary.main,.05),color:"primary.main"}}}),(0,y.jsx)(c.A,{label:"Performance by Day of Week",sx:{minHeight:32,my:.2,textTransform:"none",fontSize:"0.875rem",fontWeight:500,color:"text.secondary",borderRadius:"16px",padding:"6px 18px","&.Mui-selected":{color:"dark"===R.palette.mode?"white":"background.paper",backgroundColor:"primary.main",boxShadow:R.shadows[1]},"&:hover:not(.Mui-selected)":{backgroundColor:(0,h.X4)(R.palette.primary.main,.05),color:"primary.main"}}})]})}),(0,y.jsx)(i.A,{sx:{display:0===F?"block":"none"},children:(0,y.jsx)(m.hQ,{trades:t,selectedDate:r,timePeriod:P,allTags:se,primaryTags:L,secondaryTags:X,setPrimaryTags:e=>{$(e),k(e)},setSecondaryTags:e=>{N(e),C(e)},filteredTagStats:oe,setMultipleTradesDialog:Y})}),(0,y.jsx)(i.A,{sx:{display:1===F?"block":"none"},children:(0,y.jsx)(m.KG,{trades:t,selectedDate:r,timePeriod:P,allTags:se,primaryTags:L,secondaryTags:X,setPrimaryTags:e=>{$(e),k(e)},setSecondaryTags:e=>{N(e),C(e)},setMultipleTradesDialog:Y})})]}),(0,y.jsx)(m.Ld,{sessionStats:ne,trades:t,selectedDate:r,timePeriod:P,setMultipleTradesDialog:Y}),(0,y.jsx)(g.A,{trades:t,selectedDate:r,calendarId:j,scoreSettings:v,onUpdateCalendarProperty:D,accountBalance:A,dynamicRiskSettings:I})]}):(0,y.jsx)(i.A,{sx:{height:300,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"dark"===R.palette.mode?"rgba(0, 0, 0, 0.2)":"rgba(0, 0, 0, 0.02)",borderRadius:2,border:`1px solid ${R.palette.divider}`},children:(0,y.jsxs)(l.A,{color:"text.secondary",children:["No trading data available for ","month"===P?(0,n.A)(r,"MMMM yyyy"):"year"===P?(0,n.A)(r,"yyyy"):"All Time"]})})]})}},58309:(e,t,r)=>{r.d(t,{Ay:()=>b,Kv:()=>y,b4:()=>f,fJ:()=>A});var a=r(65043),n=r(53969),s=r(70916),o=r(91449),i=r(46087),l=r(39993),d=r(45384),c=r(87498),p=r(81319),h=r(45852),x=r(72633),g=r(49221),m=r(70579);const u=e=>{const t=document.getElementById("trade-tags-input");let r="";return t&&t.value.trim()&&(r=t.value.trim()),r?[...e,r]:e},y=(e,t)=>(0,g.NX)(e,t),f=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t},A=e=>{var t;return{id:e.id,name:e.name?e.name.replace(/^\ud83d\udcc8 /,""):"",amount:Math.abs(e.amount).toString(),type:e.type,entry:e.entry||"",date:e.date,exit:e.exit||"",tags:e.tags||[],riskToReward:(null===(t=e.riskToReward)||void 0===t?void 0:t.toString())||"",partialsTaken:e.partialsTaken||!1,session:e.session||"",notes:e.notes||"",pendingImages:[],isTemporary:e.isTemporary,uploadedImages:e.images?e.images.map(((e,t)=>({...e,row:void 0!==e.row?e.row:t,column:void 0!==e.column?e.column:0,columnWidth:void 0!==e.columnWidth?e.columnWidth:100}))):[]}},b=e=>{let{open:t,onClose:r,newMainTrade:A,setNewMainTrade:b,date:j,trades:v,accountBalance:w,showForm:k,onCancel:C,onAddTrade:T,onTagUpdated:S,onUpdateTradeProperty:M,allTrades:D=[],dynamicRiskSettings:I,calendarId:W,tags:R=[],requiredTagGroups:P=[],onOpenGalleryMode:z}=e;const[F,E]=(0,a.useState)(null),[L,$]=(0,a.useState)(!1),[X,N]=(0,a.useState)(!1),[O,B]=(0,a.useState)(!1),[U,Y]=(0,a.useState)(""),[H,G]=(0,a.useState)(null),_=(0,a.useRef)(null),q=(0,a.useCallback)((async()=>{E(null),N(!0);try{if(!W||!T)throw new Error("Unable to create trade: Missing calendar ID or add trade function");{const e=(0,x.createNewTradeData)();G((()=>({...e,isTemporary:!0,name:"New Trade"}))),await T({...te(e,j),name:"New Trade",isTemporary:!0})}}catch(e){console.error("Error creating empty trade:",e),J(e instanceof Error?`Failed to create temporary trade: ${e.message}`:"Failed to create temporary trade. Please try again."),G((e=>({...e,isTemporary:!1})))}finally{N(!1)}}),[W,T,j]);(0,a.useEffect)((()=>{var e,t;const r=k.open&&k.createTempTrade,a=(null===(e=_.current)||void 0===e?void 0:e.open)&&(null===(t=_.current)||void 0===t?void 0:t.createTempTrade);!r||_.current&&a?k.editTrade&&E(k.editTrade):q(),_.current=k}),[k,q]),(0,a.useEffect)((()=>{A&&G(A)}),[A]);const V=(0,a.useMemo)((()=>R.filter((e=>!e.startsWith("Partials:")))),[R]),J=e=>{Y(e),B(!0)},K=()=>{B(!1)},Z=()=>{H&&H.pendingImages.forEach((e=>{URL.revokeObjectURL(e.preview)})),E(null),b((()=>null))},Q=async(e,t,r)=>{if(M)try{return M(e,t,r)}catch(a){console.error("Error updating trade property:",a),J(a instanceof Error?a.message:"Failed to update trade property. Please try again.")}},ee=e=>{if(e.riskToReward&&!e.partialsTaken){const t=parseFloat(e.riskToReward);if(!isNaN(t)){const r=re(t,y(e.date||(0,i.A)(j),D));return"loss"===e.type?-Math.abs(r):Math.abs(r)}}const t=parseFloat(e.amount||"0");return"loss"===e.type?-Math.abs(t):Math.abs(t)},te=(e,t)=>{let r=ee(e);console.log(`trade final amount ${r}`);let a=u([...e.tags]);e.partialsTaken&&(a=a.filter((e=>!e.startsWith("Partials:"))),a.push("Partials:Yes"));const n=new Date,s=e.date||t;return{id:e.id||(0,h.A)(),isTemporary:e.isTemporary,date:new Date(s.getFullYear(),s.getMonth(),s.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()),type:e.type,amount:r,isDeleting:!1,...e.name&&{name:e.name},...e.entry&&{entry:e.entry},...e.exit&&{exit:e.exit},...a.length>0&&{tags:a},...e.riskToReward&&{riskToReward:parseFloat(e.riskToReward)},partialsTaken:e.partialsTaken,...e.session&&{session:e.session},...e.notes&&{notes:e.notes},images:e.uploadedImages||[]}},re=(e,t)=>{if(!H||!e||!w||"breakeven"===H.type)return 0;const r=H.date||j,a=(0,g.Xe)(r,D,I),n=(0,g.GU)(a,w,t);return"win"===H.type?Math.round(n*e):Math.round(n)},ae=async(e,t)=>{try{G((t=>({...t,pendingImages:t.pendingImages.map((t=>t.id===e.id?{...t,uploadProgress:1}:t))})));const a=await c.V6(W,e.id,e.file,e.width,e.height,e.caption,(t=>{G((r=>({...r,pendingImages:r.pendingImages.map((r=>r.id===e.id?{...r,uploadProgress:t}:r))})))})),n=H.pendingImages.find((t=>t.id===e.id)),s={...a,caption:e.caption,row:(null===n||void 0===n?void 0:n.row)||H.pendingImages.indexOf(n),column:(null===n||void 0===n?void 0:n.column)||0,columnWidth:(null===n||void 0===n?void 0:n.columnWidth)||100};if(G((t=>{const r=[...t.pendingImages];let a=r.findIndex((t=>t.id===e.id));-1!==a&&r.splice(a,1);const n=[...t.uploadedImages];return a=n.findIndex((t=>t.id===e.id)),-1!==a&&n[a].pending&&n.splice(a,1),{...t,pendingImages:r,uploadedImages:[...n,s]}})),W&&t)try{await Q(t,(e=>{var t;const r=null===(t=e.images)||void 0===t?void 0:t.find((e=>e.id===s.id)),a={...s,row:void 0!==(null===r||void 0===r?void 0:r.row)?r.row:s.row,column:void 0!==(null===r||void 0===r?void 0:r.column)?r.column:s.column,columnWidth:void 0!==(null===r||void 0===r?void 0:r.columnWidth)?r.columnWidth:s.columnWidth};return{...e,images:(e.images||[a]).map((e=>e.id===a.id?a:e))}}))}catch(r){console.error("Error updating trade with new image:",r),J(r instanceof Error?`Failed to save image to trade: ${r.message}`:"Failed to save image to trade. The image is saved locally but may be lost if you refresh the page.")}}catch(a){console.error("Error uploading image:",a),G((t=>({...t,pendingImages:t.pendingImages.map((t=>t.id===e.id?{...t,uploadProgress:-1}:t))})))}},ne=()=>H.pendingImages.some((e=>void 0!==e.uploadProgress&&e.uploadProgress<100&&e.uploadProgress>=0)),se=e=>{if(!P||0===P.length)return{valid:!0,missingGroups:[]};const t=new Set;e.forEach((e=>{if(e.includes(":")){const r=e.split(":")[0];t.add(r)}}));const r=P.filter((e=>!t.has(e)));return{valid:0===r.length,missingGroups:r}},oe=async e=>{if(e&&e.preventDefault(),T)try{if(!H.amount)return void J("Amount is required");if(!H.session)return void J("Session is required");if(!H.riskToReward)return void J("Risk to reward is required");const{valid:e,missingGroups:a}=se(H.tags);if(!e)return void J(`Missing required tag groups: ${a.join(", ")}. Each trade must include at least one tag from these groups.`);if(ne())return void J("Please wait for image uploads to complete...");$(!0);let n=te(H,j);try{H.isTemporary&&H.id?await Q(H.id,(()=>({...n,isTemporary:!1}))):await T(n),Z(),C()}catch(t){if(H.isTemporary&&H.id)try{await Q(H.id,(e=>({...e,isDeleted:!0}))),console.log("Cleaned up temporary trade after failed update")}catch(r){console.error("Failed to cleanup temporary trade:",r)}throw t}}catch(a){console.error("Error in trade submission:",a),J(a instanceof Error?a.message:"Failed to add trade. Please try again.")}finally{$(!1)}},ie=async e=>{if(e&&e.preventDefault(),F){$(!0);try{if(!H.amount)throw new Error("Amount is required");const{valid:e,missingGroups:r}=se(H.tags);if(!e)throw new Error(`Missing required tag groups: ${r.join(", ")}. Each trade must include at least one tag from these groups.`);if(ne())return J("Please wait for image uploads to complete..."),void $(!1);let a=ee(H),n=u([...H.tags]);H.partialsTaken?(n=n.filter((e=>!e.startsWith("Partials:"))),n.push("Partials:Yes")):n=n.filter((e=>!e.startsWith("Partials:")));try{if(!F.id)throw new Error("Cannot update trade: Missing trade ID");{if(!await c.J1(W,F.id))throw new Error(`Trade with ID ${F.id} not found. It may have been deleted.`);const e=[...H.pendingImages.map((e=>({url:e.preview||"",id:e.id,calendarId:W,pending:!0,caption:e.caption||"",width:e.width||0,height:e.height||0,row:void 0!==e.row?e.row:0,column:void 0!==e.column?e.column:0,columnWidth:void 0!==e.columnWidth?e.columnWidth:100}))),...H.uploadedImages.map((e=>({url:e.url||"",id:e.id,calendarId:W,pending:e.pending,caption:e.caption||"",width:e.width||0,height:e.height||0,row:void 0!==e.row?e.row:0,column:void 0!==e.column?e.column:0,columnWidth:void 0!==e.columnWidth?e.columnWidth:100})))];await Q(F.id,(t=>{const r=new Date,s=H.date||t.date,o=new Date(s.getFullYear(),s.getMonth(),s.getDate(),r.getHours(),r.getMinutes(),r.getSeconds());return{...t,type:H.type,amount:a,name:H.name||"",entry:H.entry||"",exit:H.exit||"",date:o,isTemporary:(null===H||void 0===H?void 0:H.isTemporary)&&!H.name,tags:n||[],riskToReward:parseFloat(H.riskToReward)||1,partialsTaken:H.partialsTaken,session:H.session||"London",notes:H.notes||"",images:e}})),console.log("Trade updated successfully")}}catch(t){throw console.error("Error updating trade:",t),new Error(`Failed to update trade: ${t instanceof Error?t.message:"Unknown error"}`)}Z(),C()}catch(r){console.error("Error editing trade:",r),J(r instanceof Error?r.message:"Failed to edit trade. Please try again.")}finally{$(!1)}}};return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(d.mY,{open:t,onClose:()=>{X||(F&&Z(),r())},title:"Daily Trades",maxWidth:"md",fullWidth:!0,hideCloseButton:X,primaryButtonText:F?"Update Trade":"Add Trade",primaryButtonAction:F?e=>ie(e):e=>oe(e),isSubmitting:L||X,cancelButtonAction:()=>{X||(Z(),C())},hideFooterCancelButton:!1,children:(0,m.jsxs)(n.A,{sx:{p:3},children:[(0,m.jsx)(p.A1,{title:(0,l.A)(j,"EEEE, MMMM d, yyyy"),accountBalance:w+y(f(j),D),formInputVisible:!0,totalPnL:v.reduce(((e,t)=>e+t.amount),0),onPrevDay:()=>{},onNextDay:()=>{}}),(0,m.jsx)(n.A,{children:(0,m.jsx)(p.TQ,{accountBalance:w,calculateCumulativePnl:e=>y((null===e||void 0===e?void 0:e.date)||(0,i.A)(j),D),dynamicRiskSettings:I,calendarId:W,requiredTagGroups:P,onTagUpdated:(e,t)=>{H&&H.tags.includes(e)&&G((r=>r?{...r,tags:r.tags.map((r=>r===e?t:r)).filter((e=>""!==e))}:r)),S&&S(e,t)},newTrade:H,editingTrade:F,allTags:V,allTrades:D,isSubmitting:L,calculateAmountFromRiskToReward:re,onNameChange:e=>{G((t=>({...t,name:e.target.value})))},onAmountChange:e=>{G((t=>({...t,amount:e})))},onTypeChange:e=>{G((t=>({...t,type:e.target.value})))},onEntryChange:e=>{G((t=>({...t,entry:e.target.value})))},onExitChange:e=>{G((t=>({...t,exit:e.target.value})))},onRiskToRewardChange:e=>{G((t=>({...t,riskToReward:e})))},onPartialsTakenChange:e=>{const t=e.target.checked;G((e=>({...e,partialsTaken:t})))},onSessionChange:e=>{G((t=>({...t,session:e.target.value})))},onNotesChange:e=>{G((t=>({...t,notes:e})))},onTagsChange:(e,t)=>{G((e=>({...e,tags:t})))},onDateChange:e=>{e&&G((t=>({...t,date:e})))},onImageUpload:async e=>{const t=await Promise.all(Array.from(e).map((async e=>{const t=URL.createObjectURL(e),r=await(a=t,new Promise((e=>{const t=new Image;t.onload=()=>{e({width:t.width,height:t.height})},t.src=a})));var a;return{id:c.Aw(e),file:e,preview:t,caption:"",width:r.width,height:r.height,uploadProgress:0}})));G((e=>{const r=e.pendingImages,a=e.uploadedImages;let n=-1;[...r,...a].forEach((e=>{void 0!==e.row&&e.row>n&&(n=e.row)}));const s=t.map(((e,t)=>({...e,row:n+1+t,column:0,columnWidth:100})));return{...e,pendingImages:[...r,...s]}}));try{const e=await Q(H.id,(e=>{const r=e.images||[];let a=-1;r.forEach((e=>{void 0!==e.row&&e.row>a&&(a=e.row)}));const n=t.map(((e,t)=>{const r=a+1+t;return{url:e.preview,pending:!0,calendarId:W,id:e.id,width:e.width,height:e.height,caption:e.caption,row:r,column:0,columnWidth:100}}));return{...e,images:[...r,...n]}}),(e=>({...te(H,j),id:e,name:H.name||"New Trade",isTemporary:!0})));e&&e.isTemporary&&G((e=>({...e,isTemporary:!0})));for(const r of t)await ae(r,H.id)}catch(r){console.error("Error creating empty trade:",r)}},onImageCaptionChange:async(e,t,r)=>{try{if(r){const r=H.pendingImages[e];if(void 0!==r.uploadProgress&&r.uploadProgress>0&&r.uploadProgress<100)return void console.warn("Attempted to change caption of an image that is currently uploading");G((r=>({...r,pendingImages:r.pendingImages.map(((r,a)=>a===e?{...r,caption:t}:r))})))}else G((r=>({...r,uploadedImages:r.uploadedImages.map(((r,a)=>a===e?{...r,caption:t}:r))})))}catch(a){console.error("Error in handleImageCaptionChange:",a)}},onImageRemove:async(e,t)=>{try{if(t){const t=H.pendingImages[e];if(void 0!==t.uploadProgress&&t.uploadProgress>0&&t.uploadProgress<100)return console.warn("Attempted to delete an image that is currently uploading"),void J("Cannot delete an image while it's uploading. Please wait for the upload to complete.");URL.revokeObjectURL(t.preview),G((t=>({...t,pendingImages:t.pendingImages.filter(((t,r)=>r!==e))})))}else{const t=H.uploadedImages[e];G((t=>({...t,uploadedImages:t.uploadedImages.filter(((t,r)=>r!==e))})));try{await Q(H.id,(e=>({...e,images:(e.images||[]).filter((e=>e.id!==t.id))}))),console.log(`Image ${t.id} deleted and trade updated successfully`)}catch(r){console.error("Error deleting image or updating trade:",r)}}}catch(a){console.error("Error in handleImageRemove:",a),J("Failed to remove image. Please try again.")}},onImagesReordered:async e=>{console.log("handleImagesReordered called with images:",e.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth}))));const t=e.filter((e=>"file"in e)),r=e.filter((e=>!("file"in e)));G((e=>({...e,pendingImages:t,uploadedImages:r})))},onSubmit:F?ie:oe,trades:D,onOpenGalleryMode:z})})]})}),(0,m.jsx)(s.A,{open:O,autoHideDuration:6e3,onClose:K,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,m.jsx)(o.A,{onClose:K,severity:"error",sx:{width:"100%"},children:U})})]})}},61711:(e,t,r)=>{r.d(t,{D9:()=>d,Nb:()=>l,R5:()=>p,f1:()=>h,s5:()=>c});var a=r(2431),n=r(72128),s=r(86255),o=r(51010),i=r(39993);const l=(e,t,r)=>{switch(r){case"month":return e.filter((e=>(0,a.A)(new Date(e.date),t)));case"year":return e.filter((e=>new Date(e.date).getFullYear()===t.getFullYear()));default:return e}},d=async(e,t,r)=>{const a=l(e,t,r);let d,c;if(await new Promise((e=>setTimeout(e,0))),"month"===r)d=(0,n.A)(t),c=(0,s.A)(t);else if("year"===r)d=new Date(t.getFullYear(),0,1),c=new Date(t.getFullYear(),11,31);else if(0===a.length)d=new Date,c=new Date;else{const e=[...a].sort(((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()));d=new Date(e[0].date),c=new Date(e[e.length-1].date)}const p=(0,o.A)({start:d,end:c});let h=0,x=0;const g=[];for(let n=0;n<p.length;n+=100){const e=p.slice(n,n+100),t=[];for(const n of e){const e=a.filter((e=>(0,i.A)(new Date(e.date),"yyyy-MM-dd")===(0,i.A)(n,"yyyy-MM-dd"))),s=e.reduce(((e,t)=>e+t.amount),0);x=h,h+=s,t.push({date:(0,i.A)(n,"month"===r?"MM/dd":"MM/dd/yyyy"),pnl:s,cumulativePnL:h,isIncreasing:h>x,isDecreasing:h<x,dailyChange:h-x,isWin:s>0,isLoss:s<0,isBreakEven:0===s,trades:e,fullDate:new Date(n)})}g.push(...t),n+100<p.length&&await new Promise((e=>setTimeout(e,0)))}return g},c=(e,t,r,a)=>{const n=l(e,t,r).filter((e=>void 0!==e.session));return["Asia","London","NY AM","NY PM"].map((e=>{const t=n.filter((t=>t.session===e)),r=t.length,s=t.filter((e=>"win"===e.type)).length,o=t.filter((e=>"loss"===e.type)).length,i=t.filter((e=>"breakeven"===e.type)).length,l=s+o,d=l>0?s/l*100:0,c=t.reduce(((e,t)=>e+t.amount),0);return{session:e,totalTrades:r,winners:s,losers:o,breakevens:i,winRate:d,totalPnL:c,averagePnL:r>0?c/r:0,pnlPercentage:a>0?c/a*100:0}}))},p=(e,t)=>void 0===e||t<=0?null:e/100*t,h=(e,t)=>-e/100*t},68165:(e,t,r)=>{r.d(t,{A:()=>g});var a=r(65043),n=r(60267),s=r(53969),o=r(29651),i=r(55895),l=r(83759),d=r(24343),c=r(87498),p=r(81084),h=r(45384),x=r(70579);const g=e=>{let{open:t,onClose:r,tag:g,calendarId:m,onSuccess:u}=e;const y=(0,n.A)(),[f,A]=(0,a.useState)(g),[b,j]=(0,a.useState)(!1),[v,w]=(0,a.useState)(null),k=async e=>{if(e.preventDefault(),!f.trim()||C&&!S.trim())return void w("Tag cannot be empty");if((f.match(/:/g)||[]).length>1)w("Tags can only contain one colon (:) for category formatting");else if(f!==g){j(!0),w(null);try{g=g.trim();const e=await c.Gw(m,g,f);e.success?(u&&u(g,f,e.tradesUpdated),r()):w("Failed to update tag")}catch(v){console.error("Error updating tag:",v),w(v instanceof Error?v.message:"An unknown error occurred")}finally{j(!1)}}else r()},C=(0,p.dn)(g),T=e=>(0,p.dn)(e)?e.split(":")[1]:e,[S,M]=(0,a.useState)(T(g)),[D,I]=(0,a.useState)(C?(0,p.Oo)(g):"");(0,a.useEffect)((()=>{A(g),M(T(g)),w(null)}),[g]);const W=()=>{b||r()};return(0,x.jsx)(h.mY,{open:t,onClose:W,maxWidth:"sm",fullWidth:!0,title:"Edit Tag",primaryButtonText:b?"Updating...":"Update Tag",primaryButtonAction:e=>{e&&e.preventDefault(),k(e)},isSubmitting:b,cancelButtonText:"Cancel",cancelButtonAction:W,hideCloseButton:b,children:(0,x.jsxs)(s.A,{component:"form",onSubmit:k,sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,x.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:2,p:1,mt:1,borderRadius:1,bgcolor:(0,o.X4)(y.palette.primary.main,.05),border:`1px solid ${(0,o.X4)(y.palette.primary.main,.1)}`},children:[(0,x.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"This will update all trades that use this tag across all years in the calendar."}),(0,x.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1.5,p:1,borderRadius:1,bgcolor:y.palette.background.paper,border:`1px solid ${y.palette.divider}`},children:[(0,x.jsx)(i.A,{variant:"body2",fontWeight:500,children:"Current tag:"}),(0,x.jsx)(l.A,{label:(0,p.t)(g),size:"small",sx:{...(0,p.dO)(g,y),fontWeight:600,boxShadow:y.shadows[1]}})]})]}),C?(0,x.jsxs)(s.A,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[(0,x.jsx)(d.A,{label:"Group",value:D,onChange:e=>{const t=e.target.value;(t.match(/:/g)||[]).length>0||(I(t),A(`${t}:${S}`))},fullWidth:!0,autoFocus:!0,error:!!v,helperText:v,disabled:b,size:"medium",sx:{"& .MuiFormHelperText-root":{color:y.palette.error.main,fontWeight:500,marginTop:1}}}),(0,x.jsx)(d.A,{label:"Tag Name",value:S,onChange:e=>{const t=e.target.value;(t.match(/:/g)||[]).length>0||(M(t),A(`${D}:${t}`))},fullWidth:!0,autoFocus:!0,error:!!v,helperText:v,disabled:b,size:"medium",sx:{"& .MuiFormHelperText-root":{color:y.palette.error.main,fontWeight:500,marginTop:1}}})]}):(0,x.jsx)(d.A,{label:"Tag Name",value:f,onChange:e=>{const t=e.target.value;(t.match(/:/g)||[]).length>1||(A(t),M(t))},fullWidth:!0,autoFocus:!0,error:!!v,helperText:v,disabled:b,size:"medium",sx:{"& .MuiFormHelperText-root":{color:y.palette.error.main,fontWeight:500,marginTop:1}}})]})})}},72633:(e,t,r)=>{r.r(t),r.d(t,{TradeCalendar:()=>Ft,createNewTradeData:()=>Pt,default:()=>Et});var a=r(65043),n=r(45852),s=r(53969),o=r(70298),i=r(55895),l=r(60267),d=r(26529),c=r(12097),p=r(29651),h=r(42579),x=r(23182),g=r(70916),m=r(91449),u=r(22555),y=r(6013),f=r(83616),A=r(78916),b=r(15483),j=r(66370),v=r(44188),w=r(85662),k=r(3830),C=r(102),T=r(21553),S=r(63745),M=r(90238),D=r(31555),I=r(72275),W=r(407),R=r(33498),P=r(16819),z=r(2431),F=r(39993),E=r(43596),L=r(72128),$=r(86255),X=r(51010),N=r(40494),O=r(23893),B=r(94799),U=r(80172),Y=r(19e3),H=r(17105),G=r(85465),_=r(89935),q=r(64),V=r(25272),J=r(46153),K=r(70579);const Z=e=>{let{calendarNote:t,onUpdateCalendarProperty:r,calendarId:n,isEditable:o=!0,title:c="Description",emptyStateText:x="No description available. Click the edit button to description to calendar.",trades:g,onOpenGalleryMode:m}=e;const[u,y]=(0,a.useState)(!1),[f,A]=(0,a.useState)(t),[b,j]=(0,a.useState)("idle"),v=(0,l.A)();(0,a.useEffect)((()=>{A(t)}),[t]),(0,a.useEffect)((()=>{if(f!==t){j("saving");const e=setTimeout((()=>{w()}),1e3);return()=>clearTimeout(e)}}),[f]);const w=async()=>{try{if(!r)throw new Error("onUpdateCalendarProperty is undefined");j("saving"),await r(n,(e=>({...e,note:f}))),j("saved"),setTimeout((()=>j("idle")),2e3)}catch(e){console.error("Error saving notes:",e),j("error"),setTimeout((()=>j("idle")),3e3)}};return(0,K.jsxs)(B.A,{elevation:3,sx:{mb:2,borderRadius:2,overflow:"hidden",border:"1px solid",borderColor:"divider",backgroundColor:v.palette.background.paper,minHeight:u?"auto":"60px",transition:"all 0.3s ease",boxShadow:`0 2px 8px ${(0,p.X4)(v.palette.grey[500],.1)}`,"&:hover":{boxShadow:`0 4px 12px ${(0,p.X4)(v.palette.grey[500],.15)}`,transform:"translateY(-2px)"}},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1.5,pl:2,backgroundColor:(0,p.X4)(v.palette.primary.main,.08),borderBottom:u?`1px solid ${v.palette.divider}`:"none",transition:"background-color 0.3s ease"},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,K.jsx)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:36,height:36,borderRadius:"50%",backgroundColor:(0,p.X4)(v.palette.warning.main,.15),mr:1.5},children:(0,K.jsx)(H.A,{sx:{color:v.palette.warning.main,fontSize:"1.5rem"}})}),(0,K.jsx)(i.A,{variant:"h6",sx:{fontWeight:700,fontSize:"1.1rem",letterSpacing:"-0.3px",background:"inherit",WebkitBackgroundClip:"unset",WebkitTextFillColor:"inherit"},children:c}),"idle"!==b&&(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:["saving"===b&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(U.A,{size:12,sx:{color:v.palette.warning.main}}),(0,K.jsx)(i.A,{variant:"caption",sx:{color:v.palette.text.secondary,fontSize:"0.7rem"},children:"Saving..."})]}),"saved"===b&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(G.A,{sx:{color:v.palette.success.main,fontSize:"1rem"}}),(0,K.jsx)(i.A,{variant:"caption",sx:{color:v.palette.success.main,fontSize:"0.7rem"},children:"Saved"})]}),"error"===b&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(_.A,{sx:{color:v.palette.error.main,fontSize:"1rem"}}),(0,K.jsx)(i.A,{variant:"caption",sx:{color:v.palette.error.main,fontSize:"0.7rem"},children:"Error saving"})]})]})]}),(0,K.jsx)(s.A,{children:(0,K.jsx)(d.A,{title:u?"Hide description":"Show description",children:(0,K.jsx)(h.A,{size:"small",onClick:()=>{y(!u)},sx:{color:"text.secondary",backgroundColor:(0,p.X4)(v.palette.grey[500],.08),"&:hover":{backgroundColor:(0,p.X4)(v.palette.grey[500],.15)}},children:u?(0,K.jsx)(q.A,{}):(0,K.jsx)(V.A,{})})})})]}),(0,K.jsx)(Y.A,{in:u,children:(0,K.jsx)(s.A,{sx:{p:2},onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),w())},children:(0,K.jsx)(J.A,{value:f,onChange:A,placeholder:"Enter a description about your calendar, trading strategy, plans, or mindset...",minHeight:300,calendarId:n,trades:g,onOpenGalleryMode:m})})})]})};var Q=r(98349),ee=r(5780),te=r(45384),re=r(81319),ae=r(58309);const ne=e=>{let{open:t,onClose:r,date:n,trades:o,accountBalance:i,onDeleteTrade:l,onDeleteMultipleTrades:p,showAddForm:h,onDateChange:x,onUpdateTradeProperty:g,setZoomedImage:m,allTrades:u=[],calendarId:y,deletingTradeIds:f,onOpenGalleryMode:A}=e;const[b,j]=(0,a.useState)(null);return(0,K.jsx)(K.Fragment,{children:(0,K.jsx)(te.mY,{open:t,onClose:()=>{r()},title:"Daily Trades",maxWidth:"md",fullWidth:!0,hideCloseButton:!1,primaryButtonText:"Add Trade",primaryButtonAction:()=>(async()=>{h(null)})(),hideFooterCancelButton:!1,actions:A&&o.length>0?(0,K.jsx)(d.A,{title:"View trades in gallery mode",children:(0,K.jsx)(c.A,{variant:"outlined",startIcon:(0,K.jsx)(w.A,{}),onClick:()=>{if(A&&o.length>0){const e=`${(0,F.A)(n,"EEEE, MMMM d, yyyy")} - ${o.length} Trade${o.length>1?"s":""}`;A(o,b||o[0].id,e),r()}},sx:{mr:1},children:"Gallery View"})}):void 0,children:(0,K.jsxs)(s.A,{sx:{p:3},children:[(0,K.jsx)(re.A1,{title:(0,F.A)(n,"EEEE, MMMM d, yyyy"),accountBalance:i+(0,ae.Kv)((0,ae.b4)(n),u),formInputVisible:!1,totalPnL:o.reduce(((e,t)=>e+t.amount),0),onPrevDay:()=>{const e=new Date(n);e.setDate(e.getDate()-1),x(e)},onNextDay:()=>{const e=(0,ae.b4)(n);(0,Q.A)(e,(0,ee.A)(new Date))||x(e)}}),(0,K.jsx)(re.p,{trades:o,expandedTradeId:b,onTradeClick:e=>{j(b===e?null:e)},onEditClick:e=>{h(e)},onDeleteClick:l,onDeleteMultiple:p,onZoomedImage:m,onUpdateTradeProperty:g,enableBulkSelection:o.length>1,deletingTradeIds:f,calendarId:y})]})})})};var se=r(40269),oe=r(83759),ie=r(24343),le=r(33699),de=r(1725),ce=r(85030),pe=r(94527),he=r(95315),xe=r(82394),ge=r(66185),me=r(46577),ue=r(40847),ye=r(68165),fe=r(81084);const Ae=e=>{let{open:t,onClose:r,allTags:n,calendarId:o,onTagUpdated:h,requiredTagGroups:x=[],onUpdateCalendarProperty:g}=e;const m=(0,l.A)(),[u,y]=(0,a.useState)(""),[f,A]=(0,a.useState)(""),[b,j]=(0,a.useState)(null),[v,w]=(0,a.useState)(x);(0,a.useEffect)((()=>{w(x)}),[x]);const k=(0,a.useMemo)((()=>(0,fe.GI)(n)),[n]);(0,a.useEffect)((()=>{f&&!k.includes(f)&&A("")}),[k,f]);const C=(0,a.useMemo)((()=>{let e=n;if(f&&(e=e.filter((e=>(0,fe.dn)(e)&&(0,fe.Oo)(e)===f))),u){const t=u.toLowerCase();e=e.filter((e=>e.toLowerCase().includes(t)||(0,fe.t)(e).toLowerCase().includes(t)))}return e}),[n,u,f]),M=(0,a.useMemo)((()=>{const e={};return C.forEach((t=>{if((0,fe.dn)(t)){const r=(0,fe.Oo)(t);e[r]||(e[r]=[]),e[r].push(t)}else e.Ungrouped||(e.Ungrouped=[]),e.Ungrouped.push(t)})),e}),[C]);return(0,K.jsxs)(te.mY,{open:t,onClose:r,title:"Tag Management",maxWidth:"md",fullWidth:!0,children:[(0,K.jsxs)(s.A,{sx:{p:2},children:[(0,K.jsxs)(s.A,{sx:{mb:3},children:[(0,K.jsx)(i.A,{variant:"body1",gutterBottom:!0,children:"Manage your tags and set required tag groups for new trades."}),(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"When a tag group is set as required, every new trade must include at least one tag from this group."})]}),(0,K.jsxs)(s.A,{sx:{mb:3},children:[(0,K.jsx)(i.A,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Required Tag Groups"}),(0,K.jsx)(s.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:v.length>0?v.map((e=>(0,K.jsx)(oe.A,{label:e,color:"primary",variant:"outlined",sx:{fontWeight:600}},e))):(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"No required tag groups set. Edit a tag group to make it required."})})]}),(0,K.jsxs)(s.A,{sx:{mb:3},children:[(0,K.jsx)(ie.A,{fullWidth:!0,placeholder:"Search tags...",value:u,onChange:e=>y(e.target.value),InputProps:{startAdornment:(0,K.jsx)(le.A,{position:"start",children:(0,K.jsx)(S.A,{})}),endAdornment:(0,K.jsx)(le.A,{position:"end",children:(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,K.jsx)(ue.A,{fontSize:"small"}),(0,K.jsx)(s.A,{sx:{display:"flex",justifyContent:"flex-end",width:"100%"},children:(0,K.jsxs)("select",{value:f,onChange:e=>A(e.target.value),style:{border:"none",background:"transparent",fontSize:"0.875rem",color:m.palette.text.primary,padding:"4px",cursor:"pointer"},children:[(0,K.jsx)("option",{value:"",children:"All Groups"}),k.map((e=>(0,K.jsx)("option",{value:e,children:e},e)))]})})]})})},size:"small",sx:{mb:2}}),(0,K.jsx)(s.A,{sx:{maxHeight:"400px",overflow:"auto",border:`1px solid ${m.palette.divider}`,borderRadius:1,...m.typography.body2,...(0,me.J)(m)},children:Object.entries(M).length>0?Object.entries(M).map((e=>{let[t,r]=e;return(0,K.jsxs)(s.A,{children:[(0,K.jsxs)(s.A,{sx:{p:1.5,bgcolor:(0,p.X4)(m.palette.primary.main,.05),display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,K.jsx)(i.A,{variant:"subtitle2",fontWeight:600,children:t}),"Ungrouped"!==t&&(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",ml:1},children:[(0,K.jsx)(de.A,{control:(0,K.jsx)(ce.A,{checked:v.includes(t),onChange:e=>{const r=e.target.checked?[...v,t]:v.filter((e=>e!==t));var a;w(a=r),g&&g(o,(e=>({...e,requiredTagGroups:a})))},color:"primary",size:"small"}),label:(0,K.jsx)(i.A,{variant:"caption",sx:{fontWeight:500},children:"Required"})}),(0,K.jsx)(d.A,{title:"When a tag group is set as required, every new trade must include at least one tag from this group",children:(0,K.jsx)(T.A,{sx:{ml:.5,color:"text.secondary",fontSize:"0.875rem"}})})]})]}),(0,K.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[r.length," tag",1!==r.length?"s":""]})]}),(0,K.jsx)(pe.A,{}),(0,K.jsx)(he.A,{disablePadding:!0,children:r.map((e=>(0,K.jsx)(xe.Ay,{secondaryAction:(0,K.jsx)(c.A,{color:"primary",sx:{minWidth:"auto",p:.5},onClick:()=>j(e),children:"Edit"}),sx:{"&:hover":{bgcolor:(0,p.X4)(m.palette.primary.main,.05)}},children:(0,K.jsx)(ge.A,{primary:(0,K.jsx)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,K.jsx)(oe.A,{label:(0,fe.t)(e,!0),size:"small",sx:(0,fe.dO)(e,m)})})})},e)))})]},t)})):(0,K.jsx)(s.A,{sx:{p:3,textAlign:"center"},children:(0,K.jsx)(i.A,{color:"text.secondary",children:"No tags found matching your search criteria."})})})]})]}),b&&(0,K.jsx)(ye.A,{open:!!b,onClose:()=>j(null),tag:b,calendarId:o,onSuccess:(e,t,r)=>{console.log(`Tag update completed: ${e} -> ${t}, ${r} trades updated`);const a=(0,fe.dn)(e)?(0,fe.Oo)(e):null,n=(0,fe.dn)(t)?(0,fe.Oo)(t):null;if(a&&n&&a!==n&&f===a&&A(n),a&&n&&a!==n){const e=v.map((e=>e===a?n:e));w(e)}t.trim(),h&&h(e,t)}})]})};var be=r(47548),je=r(36081),ve=r(27421);const we=e=>{let{open:t,onClose:r,allTags:n,calendarId:o,onTagUpdated:x,requiredTagGroups:g=[],onUpdateCalendarProperty:m}=e;const u=(0,l.A)(),[y,f]=(0,a.useState)(""),[A,b]=(0,a.useState)(""),[j,v]=(0,a.useState)(null),[w,k]=(0,a.useState)(g);(0,a.useEffect)((()=>{k(g)}),[g]);const C=(0,a.useMemo)((()=>(0,fe.GI)(n)),[n]);(0,a.useEffect)((()=>{A&&!C.includes(A)&&b("")}),[C,A]);const M=(0,a.useMemo)((()=>{let e=n;if(A&&(e=e.filter((e=>(0,fe.dn)(e)&&(0,fe.Oo)(e)===A))),y){const t=y.toLowerCase();e=e.filter((e=>e.toLowerCase().includes(t)||(0,fe.t)(e).toLowerCase().includes(t)))}return e}),[n,y,A]),D=(0,a.useMemo)((()=>{const e={};return M.forEach((t=>{if((0,fe.dn)(t)){const r=(0,fe.Oo)(t);e[r]||(e[r]=[]),e[r].push(t)}else e.Ungrouped||(e.Ungrouped=[]),e.Ungrouped.push(t)})),e}),[M]);return(0,K.jsxs)(be.Ay,{anchor:"right",open:t,onClose:r,sx:{zIndex:1300,"& .MuiDrawer-paper":{width:{xs:"100%",sm:500},maxWidth:"100vw",zIndex:1300}},children:[(0,K.jsxs)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,K.jsxs)(s.A,{sx:{p:2,borderBottom:`1px solid ${u.palette.divider}`,display:"flex",alignItems:"center",gap:2},children:[(0,K.jsx)(s.A,{sx:{p:1,borderRadius:1,backgroundColor:(0,p.X4)(u.palette.primary.main,.1),display:"flex",alignItems:"center",justifyContent:"center"},children:(0,K.jsx)(je.A,{sx:{color:"primary.main",fontSize:20}})}),(0,K.jsx)(i.A,{variant:"h6",sx:{flex:1,fontWeight:600},children:"Tag Management"}),(0,K.jsx)(h.A,{onClick:r,size:"small",children:(0,K.jsx)(ve.A,{})})]}),(0,K.jsxs)(s.A,{sx:{flex:1,p:2,overflow:"auto"},children:[(0,K.jsxs)(s.A,{sx:{mb:3},children:[(0,K.jsx)(i.A,{variant:"body1",gutterBottom:!0,children:"Manage your tags and set required tag groups for new trades."}),(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"When a tag group is set as required, every new trade must include at least one tag from this group."})]}),(0,K.jsxs)(s.A,{sx:{mb:3},children:[(0,K.jsx)(i.A,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Required Tag Groups"}),(0,K.jsx)(s.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:w.length>0?w.map((e=>(0,K.jsx)(oe.A,{label:e,color:"primary",variant:"outlined",sx:{fontWeight:600}},e))):(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"No required tag groups set. Edit a tag group to make it required."})})]}),(0,K.jsxs)(s.A,{sx:{mb:3},children:[(0,K.jsx)(ie.A,{fullWidth:!0,placeholder:"Search tags...",value:y,onChange:e=>f(e.target.value),InputProps:{startAdornment:(0,K.jsx)(le.A,{position:"start",children:(0,K.jsx)(S.A,{})}),endAdornment:(0,K.jsx)(le.A,{position:"end",children:(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,K.jsx)(ue.A,{fontSize:"small"}),(0,K.jsx)(s.A,{sx:{display:"flex",justifyContent:"flex-end",width:"100%"},children:(0,K.jsxs)("select",{value:A,onChange:e=>b(e.target.value),style:{border:"none",background:"transparent",fontSize:"0.875rem",color:u.palette.text.primary,padding:"4px",cursor:"pointer"},children:[(0,K.jsx)("option",{value:"",children:"All Groups"}),C.map((e=>(0,K.jsx)("option",{value:e,children:e},e)))]})})]})})},size:"small",sx:{mb:2}}),(0,K.jsx)(s.A,{sx:{maxHeight:"400px",overflow:"auto",border:`1px solid ${u.palette.divider}`,borderRadius:1,...u.typography.body2,...(0,me.J)(u)},children:Object.entries(D).length>0?Object.entries(D).map((e=>{let[t,r]=e;return(0,K.jsxs)(s.A,{children:[(0,K.jsxs)(s.A,{sx:{p:1.5,bgcolor:(0,p.X4)(u.palette.primary.main,.05),display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,K.jsx)(i.A,{variant:"subtitle2",fontWeight:600,children:t}),"Ungrouped"!==t&&(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",ml:1},children:[(0,K.jsx)(de.A,{control:(0,K.jsx)(ce.A,{checked:w.includes(t),onChange:e=>{const r=e.target.checked?[...w,t]:w.filter((e=>e!==t));var a;k(a=r),m&&m(o,(e=>({...e,requiredTagGroups:a})))},color:"primary",size:"small"}),label:(0,K.jsx)(i.A,{variant:"caption",sx:{fontWeight:500},children:"Required"})}),(0,K.jsx)(d.A,{title:"When a tag group is set as required, every new trade must include at least one tag from this group",children:(0,K.jsx)(T.A,{sx:{ml:.5,color:"text.secondary",fontSize:"0.875rem"}})})]})]}),(0,K.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[r.length," tag",1!==r.length?"s":""]})]}),(0,K.jsx)(pe.A,{}),(0,K.jsx)(he.A,{disablePadding:!0,children:r.map((e=>(0,K.jsx)(xe.Ay,{secondaryAction:(0,K.jsx)(c.A,{color:"primary",sx:{minWidth:"auto",p:.5},onClick:()=>v(e),children:"Edit"}),sx:{"&:hover":{bgcolor:(0,p.X4)(u.palette.primary.main,.05)}},children:(0,K.jsx)(ge.A,{primary:(0,K.jsx)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,K.jsx)(oe.A,{label:(0,fe.t)(e,!0),size:"small",sx:(0,fe.dO)(e,u)})})})},e)))})]},t)})):(0,K.jsx)(s.A,{sx:{p:3,textAlign:"center"},children:(0,K.jsx)(i.A,{color:"text.secondary",children:"No tags found matching your search criteria."})})})]})]})]}),j&&(0,K.jsx)(ye.A,{open:!!j,onClose:()=>v(null),tag:j,calendarId:o,onSuccess:(e,t,r)=>{console.log(`Tag update completed: ${e} -> ${t}, ${r} trades updated`);const a=(0,fe.dn)(e)?(0,fe.Oo)(e):null,n=(0,fe.dn)(t)?(0,fe.Oo)(t):null;if(a&&n&&a!==n&&A===a&&b(n),a&&n&&a!==n){const e=w.map((e=>e===a?n:e));k(e)}x&&x(e,t)}})]})};var ke=r(99565),Ce=r(10256),Te=r(46261),Se=r(68826),Me=r(78403),De=r(92248),Ie=r(18837),We=r(97388),Re=r(63898),Pe=r(68545),ze=r(46087),Fe=r(67278);const Ee=e=>{let{open:t,onClose:r,trades:n,allTags:o,onTradeClick:d,selectedTags:x=[],onTagsChange:g}=e;const m=(0,l.A)(),[u,A]=(0,a.useState)(""),[b,j]=(0,a.useState)(!1),[v,w]=(0,a.useState)([]),[k,C]=(0,a.useState)([]),[T,M]=(0,a.useState)(!1),[D,I]=(0,a.useState)(""),[W,R]=(0,a.useState)(!1),[P,z]=(0,a.useState)({type:"all",startDate:null,endDate:null}),E=(0,a.useMemo)((()=>(0,fe.GI)(o)),[o]),L=(0,a.useMemo)((()=>D?(0,fe.o)(o,D):o),[o,D]),$=((e,t)=>{const[r,n]=(0,a.useState)(e);return(0,a.useEffect)((()=>{const r=setTimeout((()=>{n(e)}),t);return()=>{clearTimeout(r)}}),[e,t]),r})(u,300);(0,a.useEffect)((()=>{if(!t)return;(async()=>{j(!0),setTimeout((()=>{try{const e=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0,n=e;if(r.length>0&&(n=e.filter((e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.some((e=>r.includes(e)))}))),"all"!==a.type&&(n=n.filter((e=>{const t=new Date(e.date);if("single"===a.type&&a.startDate){const e=(0,ee.A)(a.startDate),r=(0,ze.A)(a.startDate);return!(0,Fe.A)(t,e)&&!(0,Q.A)(t,r)}if("range"===a.type&&a.startDate&&a.endDate){const e=(0,ee.A)(a.startDate),r=(0,ze.A)(a.endDate);return!(0,Fe.A)(t,e)&&!(0,Q.A)(t,r)}return!0}))),!t.trim())return n.sort(((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()));const s=t.toLowerCase().split(/[,;\s]+/).map((e=>e.trim())).filter((e=>e.length>0));return n.filter((e=>{if(s.length>1)return s.every((t=>!(!e.tags||0===e.tags.length)&&e.tags.some((e=>e.toLowerCase().includes(t)||(0,fe.t)(e).toLowerCase().includes(t)))));{const t=s[0];return!(!e.name||!e.name.toLowerCase().includes(t))||!(!e.tags||!e.tags.some((e=>e.toLowerCase().includes(t)||(0,fe.t)(e).toLowerCase().includes(t))))||!(!e.notes||!e.notes.toLowerCase().includes(t))||!(!e.session||!e.session.toLowerCase().includes(t))}})).sort(((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()))}(n,$,x,P),t=((e,t)=>{var r;if(!t.trim())return[];const a=t.split(/[,;\s]+/).map((e=>e.trim())).filter((e=>e.length>0)),n=(null===(r=a[a.length-1])||void 0===r?void 0:r.toLowerCase())||"";if(!n)return[];const s=a.slice(0,-1).map((e=>e.toLowerCase()));return e.filter((e=>{const t=e.toLowerCase(),r=(0,fe.t)(e).toLowerCase();return!s.some((e=>t.includes(e)||r.includes(e)))&&(t.includes(n)||r.includes(n))})).slice(0,5)})(o,$);w(e),C(t)}catch(e){console.error("Search error:",e),w([]),C([])}finally{j(!1)}}),0)})()}),[$,x,P,n,o,t]),(0,a.useEffect)((()=>{t||(A(""),w([]),C([]),j(!1),I(""),R(!1),z({type:"all",startDate:null,endDate:null}))}),[t]);const X=(0,a.useCallback)((e=>{null===g||void 0===g||g(e)}),[g]),N=(0,a.useCallback)((()=>{null===g||void 0===g||g([])}),[g]),O=(0,a.useCallback)((e=>{z((t=>({...t,type:e,startDate:"all"===e?null:t.startDate,endDate:"all"===e?null:t.endDate})))}),[]),B=(0,a.useCallback)((e=>{z((t=>({...t,startDate:e})))}),[]),H=(0,a.useCallback)((e=>{z((t=>({...t,endDate:e})))}),[]),G=(0,a.useCallback)((()=>{z({type:"all",startDate:null,endDate:null})}),[]),_=e=>{switch(e){case"win":return(0,K.jsx)(y.A,{sx:{fontSize:20,color:"success.main"}});case"loss":return(0,K.jsx)(De.A,{sx:{fontSize:20,color:"error.main"}});case"breakeven":return(0,K.jsx)(Ie.A,{sx:{fontSize:20,color:"text.secondary"}})}},J=e=>{switch(e){case"win":return m.palette.success.main;case"loss":return m.palette.error.main;case"breakeven":return m.palette.text.secondary}},Z=(0,a.useCallback)((e=>{const t=u.split(/[,;\s]+/).map((e=>e.trim())).filter((e=>e.length>0));if(0===t.length)A(e);else{const r=[...t.slice(0,-1),e];A(r.join(", ")+", ")}}),[u]),re=(0,a.useCallback)((e=>{null===d||void 0===d||d(e),r()}),[d,r]);return(0,K.jsx)(be.Ay,{anchor:"right",open:t,onClose:r,sx:{zIndex:1300,"& .MuiDrawer-paper":{width:{xs:"100%",sm:450},maxWidth:"100vw",zIndex:1300}},children:(0,K.jsxs)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,K.jsxs)(s.A,{sx:{p:2,borderBottom:`1px solid ${m.palette.divider}`,display:"flex",alignItems:"center",gap:2},children:[(0,K.jsx)(s.A,{sx:{p:1,borderRadius:1,backgroundColor:(0,p.X4)(m.palette.primary.main,.1),display:"flex",alignItems:"center",justifyContent:"center"},children:(0,K.jsx)(S.A,{sx:{color:"primary.main",fontSize:20}})}),(0,K.jsx)(i.A,{variant:"h6",sx:{flex:1,fontWeight:600},children:"Search & Filter Trades"}),(0,K.jsx)(h.A,{onClick:r,size:"small",children:(0,K.jsx)(ve.A,{})})]}),(0,K.jsxs)(s.A,{sx:{p:2,borderBottom:`1px solid ${m.palette.divider}`},children:[(0,K.jsx)(ie.A,{fullWidth:!0,placeholder:"Search by name, tags, notes, or session...",value:u,onChange:e=>A(e.target.value),slotProps:{input:{startAdornment:(0,K.jsx)(le.A,{position:"start",children:b?(0,K.jsx)(U.A,{size:20,sx:{color:"text.secondary"}}):(0,K.jsx)(S.A,{sx:{color:"text.secondary"}})})}},variant:"outlined",size:"small"}),(0,K.jsx)(i.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"\ud83d\udca1 Use multiple tags separated by spaces, commas, or semicolons to find trades with ALL specified tags"})]}),g&&(0,K.jsxs)(s.A,{sx:{borderBottom:`1px solid ${m.palette.divider}`},children:[(0,K.jsx)(s.A,{sx:{p:2,pb:1},children:(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",color:x.length>0?"primary.main":"text.secondary",fontWeight:x.length>0?600:400},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[(0,K.jsx)(f.A,{sx:{fontSize:20}}),(0,K.jsx)(i.A,{variant:"body2",children:"Filter by Tags"}),x.length>0&&(0,K.jsx)(oe.A,{label:`${x.length} selected`,size:"small",color:"primary",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}})]}),(0,K.jsx)(h.A,{onClick:()=>M(!T),size:"small",sx:{color:"inherit","&:hover":{backgroundColor:(0,p.X4)(m.palette.primary.main,.1)}},children:T?(0,K.jsx)(q.A,{}):(0,K.jsx)(V.A,{})})]})}),(0,K.jsx)(Y.A,{in:T,children:(0,K.jsx)(s.A,{sx:{px:2,pb:2},children:(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[E.length>0&&(0,K.jsx)(te.pp,{label:"Filter by Tag Group",value:D,onChange:e=>I(e.target.value),options:[{value:"",label:"All Tags"},...E.map((e=>({value:e,label:e})))],size:"small"}),(0,K.jsx)(ke.A,{multiple:!0,options:L,value:x,onChange:(e,t)=>X(t),slotProps:{listbox:{sx:{...(0,me.J)(m)}}},renderInput:e=>(0,K.jsx)(ie.A,{...e,variant:"outlined",label:"Select Tags",placeholder:"Choose tags to filter",fullWidth:!0,size:"small"}),renderTags:(e,t)=>e.map(((e,r)=>(0,K.jsx)(oe.A,{label:(0,fe.t)(e,!0),...t({index:r}),sx:(0,fe.dO)(e,m),title:(0,fe.dn)(e)?`Group: ${(0,fe.Oo)(e)}`:void 0}))),renderOption:(e,t)=>(0,K.jsx)("li",{...e,children:(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,fe.dn)(t)&&(0,K.jsx)(oe.A,{label:(0,fe.Oo)(t),size:"small",sx:{...(0,fe.dO)(t,m),height:"18px",fontSize:"0.7rem"}}),(0,fe.t)(t,!0)]})})}),x.length>0&&(0,K.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,K.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:[x.length," tag",x.length>1?"s":""," selected"]}),(0,K.jsx)(c.A,{onClick:N,size:"small",color:"inherit",children:"Clear All"})]})]})})})]}),(0,K.jsxs)(s.A,{sx:{borderBottom:`1px solid ${m.palette.divider}`},children:[(0,K.jsx)(s.A,{sx:{p:2,pb:1},children:(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"all"!==P.type?"primary.main":"text.secondary",fontWeight:"all"!==P.type?600:400},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[(0,K.jsx)(We.A,{sx:{fontSize:20}}),(0,K.jsx)(i.A,{variant:"body2",children:"Filter by Date"}),"all"!==P.type&&(0,K.jsx)(oe.A,{label:"single"===P.type?"Single Date":"range"===P.type?"Date Range":"",size:"small",color:"primary",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}})]}),(0,K.jsx)(h.A,{onClick:()=>R(!W),size:"small",sx:{color:"inherit","&:hover":{backgroundColor:(0,p.X4)(m.palette.primary.main,.1)}},children:W?(0,K.jsx)(q.A,{}):(0,K.jsx)(V.A,{})})]})}),(0,K.jsx)(Y.A,{in:W,children:(0,K.jsx)(s.A,{sx:{px:2,pb:2},children:(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,K.jsx)(Ce.A,{component:"fieldset",sx:{width:"100%"},children:(0,K.jsxs)(Te.A,{value:P.type,onChange:e=>O(e.target.value),sx:{gap:1},children:[(0,K.jsx)(de.A,{value:"all",control:(0,K.jsx)(Se.A,{size:"small"}),label:"All dates",sx:{margin:0}}),(0,K.jsx)(de.A,{value:"single",control:(0,K.jsx)(Se.A,{size:"small"}),label:"Specific date",sx:{margin:0}}),(0,K.jsx)(de.A,{value:"range",control:(0,K.jsx)(Se.A,{size:"small"}),label:"Date range",sx:{margin:0}})]})}),"single"===P.type&&(0,K.jsx)(Pe.l,{label:"Select Date",value:P.startDate,onChange:B,slotProps:{textField:{fullWidth:!0,size:"small"}}}),"range"===P.type&&(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,K.jsx)(Pe.l,{label:"Start Date",value:P.startDate,onChange:B,slotProps:{textField:{fullWidth:!0,size:"small"}}}),(0,K.jsx)(Pe.l,{label:"End Date",value:P.endDate,onChange:H,minDate:P.startDate||void 0,slotProps:{textField:{fullWidth:!0,size:"small"}}})]}),"all"!==P.type&&(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,K.jsx)(s.A,{sx:{p:1.5,bgcolor:(0,p.X4)(m.palette.primary.main,.05),borderRadius:1},children:(0,K.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:["single"===P.type&&P.startDate&&(0,K.jsxs)(K.Fragment,{children:["Showing trades from: ",(0,K.jsx)("strong",{children:(0,F.A)(P.startDate,"MMM dd, yyyy")})]}),"range"===P.type&&P.startDate&&P.endDate&&(0,K.jsxs)(K.Fragment,{children:["Showing trades from: ",(0,K.jsx)("strong",{children:(0,F.A)(P.startDate,"MMM dd, yyyy")})," to ",(0,K.jsx)("strong",{children:(0,F.A)(P.endDate,"MMM dd, yyyy")})]}),"range"===P.type&&P.startDate&&!P.endDate&&(0,K.jsxs)(K.Fragment,{children:["Showing trades from: ",(0,K.jsx)("strong",{children:(0,F.A)(P.startDate,"MMM dd, yyyy")})," onwards"]})]})}),(0,K.jsx)(s.A,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,K.jsx)(c.A,{onClick:G,size:"small",color:"inherit",children:"Clear Date Filter"})})]})]})})})]}),(0,K.jsxs)(s.A,{sx:{flex:1,overflow:"auto",...(0,me.J)(m)},children:[k.length>0&&(0,K.jsxs)(s.A,{sx:{p:2,borderBottom:`1px solid ${m.palette.divider}`},children:[(0,K.jsx)(i.A,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Tag Suggestions"}),(0,K.jsx)(s.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:k.map((e=>(0,K.jsx)(oe.A,{label:(0,fe.t)(e,!0),size:"small",clickable:!0,onClick:()=>Z(e),sx:{...(0,fe.dO)(e,m),"&:hover":{backgroundColor:(0,p.X4)(m.palette.primary.main,.1)}}},e)))})]}),(u.trim()||x.length>0||"all"!==P.type)&&(0,K.jsxs)(s.A,{sx:{p:2},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1,flexWrap:"wrap"},children:[(0,K.jsxs)(i.A,{variant:"subtitle2",sx:{fontWeight:600},children:[u.trim()?"Search Results":"Filtered Results"," ",!b&&`(${v.length})`]}),(()=>{const e=u.split(/[,;\s]+/).map((e=>e.trim())).filter((e=>e.length>0));return e.length>1?(0,K.jsx)(oe.A,{label:`${e.length} search terms (AND)`,size:"small",color:"primary",variant:"outlined",sx:{fontSize:"0.7rem",height:20}}):null})(),x.length>0&&(0,K.jsx)(oe.A,{label:`${x.length} tag filter${x.length>1?"s":""}`,size:"small",color:"secondary",variant:"outlined",sx:{fontSize:"0.7rem",height:20}}),"all"!==P.type&&(0,K.jsx)(oe.A,{label:("single"===P.type?"Single date":"Date range")+" filter",size:"small",color:"info",variant:"outlined",sx:{fontSize:"0.7rem",height:20}})]}),b?(0,K.jsxs)(s.A,{sx:{textAlign:"center",py:4},children:[(0,K.jsx)(U.A,{size:40,sx:{mb:2}}),(0,K.jsx)(i.A,{variant:"body1",color:"text.secondary",children:"Searching trades..."})]}):0===v.length?(0,K.jsxs)(s.A,{sx:{textAlign:"center",py:4},children:[(0,K.jsx)(S.A,{sx:{fontSize:48,color:"text.disabled",mb:2}}),(0,K.jsx)(i.A,{variant:"body1",color:"text.secondary",children:"No trades found"}),(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Try searching with different keywords"})]}):(0,K.jsx)(he.A,{sx:{p:0,...(0,me.J)(m)},children:v.map(((e,t)=>(0,K.jsxs)(a.Fragment,{children:[(0,K.jsx)(xe.Ay,{disablePadding:!0,children:(0,K.jsx)(Me.A,{onClick:()=>re(e),sx:{p:2,"&:hover":{backgroundColor:(0,p.X4)(m.palette.primary.main,.05)}},children:(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,width:"100%"},children:[(0,K.jsx)(s.A,{sx:{mt:.5},children:_(e.type)}),(0,K.jsx)(s.A,{sx:{flex:1,minWidth:0},children:(0,K.jsx)(ge.A,{primary:(0,K.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:.5},children:[(0,K.jsx)(i.A,{variant:"subtitle1",sx:{fontWeight:600,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,mr:1},children:e.name||`Trade ${e.id.slice(-6)}`}),(0,K.jsxs)(i.A,{variant:"subtitle1",sx:{fontWeight:700,color:J(e.type),whiteSpace:"nowrap"},children:[e.amount>0?"+":"","$",Math.abs(e.amount).toFixed(2)]})]}),secondary:(0,K.jsxs)(s.A,{children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,K.jsx)(Re.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",children:(0,F.A)(new Date(e.date),"MMM dd, yyyy")}),e.session&&(0,K.jsx)(oe.A,{label:e.session,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem",borderColor:(0,p.X4)(m.palette.text.secondary,.3),color:"text.secondary"}})]}),e.tags&&e.tags.length>0&&(0,K.jsxs)(s.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[e.tags.slice(0,3).map((e=>(0,K.jsx)(oe.A,{label:(0,fe.t)(e,!0),size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem",...(0,fe.dO)(e,m)}},e))),e.tags.length>3&&(0,K.jsx)(oe.A,{label:"+"+(e.tags.length-3),size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem",borderColor:(0,p.X4)(m.palette.text.secondary,.3),color:"text.secondary"}})]})]})})})]})})}),t<v.length-1&&(0,K.jsx)(pe.A,{})]},e.id)))})]}),!u.trim()&&0===x.length&&"all"===P.type&&(0,K.jsxs)(s.A,{sx:{textAlign:"center",py:6,px:3},children:[(0,K.jsx)(S.A,{sx:{fontSize:64,color:"text.disabled",mb:2}}),(0,K.jsx)(i.A,{variant:"h6",sx:{mb:1,fontWeight:600,color:"text.secondary"},children:"Search Your Trades"}),(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",maxWidth:400,mx:"auto",mb:2},children:"Search by trade name, tags, notes, or session. Use tag and date filters to narrow down results."}),(0,K.jsxs)(s.A,{sx:{textAlign:"left",maxWidth:400,mx:"auto"},children:[(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:1,fontWeight:600},children:"Examples:"}),(0,K.jsxs)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["\u2022 ",(0,K.jsx)("code",{children:"scalping"}),' - Find trades with "scalping" tag']}),(0,K.jsxs)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["\u2022 ",(0,K.jsx)("code",{children:"scalping, morning"})," - Find trades with BOTH tags"]}),(0,K.jsxs)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["\u2022 ",(0,K.jsx)("code",{children:"EURUSD breakout"})," - Find trades with both terms"]}),(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"\u2022 Use tag filters to show trades with specific tags"}),(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"\u2022 Use date filters to show trades from specific dates or ranges"})]})]})]})]})})};var Le=r(16857),$e=r(58128);(0,$e.Ay)(s.A)((e=>{let{theme:t}=e;return{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:t.spacing(1),padding:t.spacing(2),backgroundColor:t.palette.background.paper,borderRadius:t.shape.borderRadius,boxShadow:t.shadows[1],width:"100%",minHeight:"600px",alignContent:"start"}}));const Xe=(0,$e.Ay)(s.A)((e=>{let{theme:t}=e;return{aspectRatio:"1",minHeight:"30px",borderRadius:t.shape.borderRadius,overflow:"hidden",backgroundColor:t.palette.background.default,border:`1px solid ${t.palette.divider}`}})),Ne=(0,$e.Ay)(s.A)((e=>{let{theme:t}=e;return{padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary,fontSize:"0.875rem",fontWeight:500,border:`1px solid ${t.palette.divider}`,backgroundColor:t.palette.background.default,borderRadius:t.shape.borderRadius}}));var Oe=r(64924),Be=r(99900),Ue=r(32515),Ye=r(3877),He=r(64321);const Ge=e=>{let{open:t,onClose:r,day:n,notes:o,calendarId:d,onUpdateCalendarProperty:c,trades:h,onOpenGalleryMode:x}=e;const[g,m]=(0,a.useState)(o),[u,y]=(0,a.useState)(!1),[f,A]=(0,a.useState)(!1);(0,a.useEffect)((()=>{m(o),A(!1)}),[o,n]);const b=(0,l.A)(),j="Sun"===n?"Sunday":"Mon"===n?"Monday":"Tue"===n?"Tuesday":"Wed"===n?"Wednesday":"Thu"===n?"Thursday":"Fri"===n?"Friday":"Sat"===n?"Saturday":n,v=(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,K.jsx)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,borderRadius:"50%",backgroundColor:(0,p.X4)(b.palette.primary.main,.1),color:b.palette.primary.main},children:(0,K.jsx)(He.A,{})}),(0,K.jsxs)(i.A,{variant:"h6",component:"div",sx:{fontWeight:600},children:["Notes for ",j]})]});return(0,K.jsx)(te.mY,{open:t,onClose:()=>{u||r()},maxWidth:"md",fullWidth:!0,title:v,hideCloseButton:u,hideFooterCancelButton:!1,cancelButtonText:"Cancel",cancelButtonAction:r,primaryButtonText:u?"Saving...":"Save Notes",primaryButtonAction:f?async()=>{if(f){y(!0);try{if(!c)throw new Error("onUpdateCalendarProperty is undefined");await c(d,(e=>{const t=e.daysNotes?new Map(e.daysNotes):new Map,r=n.toString();return t.set(r,g),{...e,daysNotes:t}})),A(!1),r()}catch(e){console.error("Error saving notes:",e)}finally{y(!1)}}else r()}:void 0,isSubmitting:u,contentSx:{minHeight:350,p:3},children:(0,K.jsx)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,K.jsx)(J.A,{value:g,onChange:e=>{m(e),A(!0)},placeholder:"Add notes for this day...",minHeight:300,calendarId:d,trades:h,onOpenGalleryMode:x})})})};var _e=r(38517),qe=r(81911),Ve=r(78776),Je=r(85877),Ke=r(91658),Ze=r(50103),Qe=r(99130),et=r(81839),tt=r(11238);const rt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"xlsx";if(0===e.length)return;const a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=[...e].sort(((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()));let a=0,n=t;return r.map((e=>(a+=e.amount,n+=e.amount,{...e,cumulativePnL:a,accountBalance:n}))).map((e=>{var t,r;return{Date:(0,F.A)(new Date(e.date),"MM/dd/yyyy"),Name:e.name?e.name:"",Type:e.type.charAt(0).toUpperCase()+e.type.slice(1),Amount:e.amount,"P&L":e.amount>0?`+${e.amount.toFixed(2)}`:e.amount.toFixed(2),"Cumulative P&L":e.cumulativePnL>0?`+${e.cumulativePnL.toFixed(2)}`:e.cumulativePnL.toFixed(2),"Account Balance":e.accountBalance.toFixed(2),"Entry Price":e.entry||"","Exit Price":e.exit||"",Tags:(null===(t=e.tags)||void 0===t?void 0:t.join(", "))||"","Risk to Reward":(null===(r=e.riskToReward)||void 0===r?void 0:r.toFixed(2))||"",Session:e.session||"",Notes:e.notes||""}}))}(e,t),n=`trades_${(0,F.A)(new Date,"yyyy-MM-dd")}.${r}`;"xlsx"===r?((e,t)=>{const r=tt.Wp.book_new(),a=tt.Wp.json_to_sheet(e);a["!cols"]=[{wch:12},{wch:25},{wch:8},{wch:10},{wch:10},{wch:15},{wch:15},{wch:15},{wch:15},{wch:30},{wch:12},{wch:12},{wch:50}],tt.Wp.book_append_sheet(r,a,"Trades"),tt._h(r,t)})(a,n):((e,t)=>{const r=Object.keys(e[0]),a=[];a.push(r.join(","));for(const l of e){const e=r.map((e=>{const t=l[e],r=String(t).replace(/"/g,'""');return r.includes(",")||r.includes('"')||r.includes("\n")?`"${r}"`:t}));a.push(e.join(","))}const n=a.join("\n"),s=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(s),i=document.createElement("a");i.setAttribute("href",o),i.setAttribute("download",t),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)})(a,n)},at=["id","date","Date","amount","Amount","P&L","type","Type","name","Name","entry","Entry Price","exit","Exit Price","tags","Tags","riskToReward","Risk to Reward","partialsTaken","Partials Taken","session","Session","notes","Notes","images","Images","Cumulative P&L","Account Balance"],nt=["MM/dd/yyyy","M/d/yyyy","yyyy-MM-dd","yyyy/MM/dd","dd/MM/yyyy","dd-MM-yyyy","MM-dd-yyyy","M-d-yyyy","MMMM d, yyyy","MMM d, yyyy","MMMM dd, yyyy","MMM dd, yyyy"],st=e=>e.map((e=>{const t=e.Date?(e=>{const t=e.trim();for(const s of nt)try{const e=(0,et.A)(t,s,new Date);if(!isNaN(e.getTime()))return e}catch(n){}const r=t.match(/(January|February|March|April|May|June|July|August|September|October|November|December)\s+(\d{1,2})(?:st|nd|rd|th)?(?:,)?\s+(\d{4})/i);if(r){const[,e,t,a]=r,n=["january","february","march","april","may","june","july","august","september","october","november","december"].indexOf(e.toLowerCase());if(-1!==n){const e=new Date(parseInt(a),n,parseInt(t));if(!isNaN(e.getTime()))return e}}const a=new Date(t);return isNaN(a.getTime())?(console.warn(`Could not parse date: ${t}. Using current date instead.`),new Date):a})(e.Date):new Date;let r=0;try{r=void 0!==e.Amount?"string"===typeof e.Amount?parseFloat(e.Amount):e.Amount:parseFloat(e["P&L"]||"0")}catch(s){console.warn(`Could not parse amount: ${e.Amount||e["P&L"]}. Using 0 instead.`)}let a,n=e.Tags?e.Tags.split(",").map((e=>e.trim())).filter(Boolean):[];for(const o in e){if(at.includes(o)||!e[o]||""===e[o])continue;const t=o.trim(),r=String(e[o]).split(",");for(const e of r){const r=e.trim();r&&n.push(`${t}:${r}`)}}if(e.Type&&"string"===typeof e.Type){const t=e.Type.toLowerCase();a="win"===t||"loss"===t||"breakeven"===t?t:r>0?"win":r<0?"loss":"breakeven"}else a=r>0?"win":r<0?"loss":"breakeven";return{id:crypto.randomUUID(),date:t,type:a,amount:r,...e.Name&&{name:e.Name},...e["Entry Price"]&&{entry:e["Entry Price"]},...e["Exit Price"]&&{exit:e["Exit Price"]},...n.length>0&&{tags:n},...e["Risk to Reward"]&&{riskToReward:parseFloat(e["Risk to Reward"])},...e.Session&&{session:e.Session},...e.Notes&&{notes:e.Notes}}})),ot=async e=>new Promise(((t,r)=>{var a;const n=new FileReader,s=null===(a=e.name.split(".").pop())||void 0===a?void 0:a.toLowerCase();n.onload=async e=>{try{let r=[];if("csv"===s){var a;const t=null===(a=e.target)||void 0===a?void 0:a.result;r=await(async e=>{try{const a=e.split("\n");if(0===a.length)throw new Error("CSV file is empty");const n=a[0].split(",").map((e=>e.replace(/^"|"$/g,"").trim()));if(!n.includes("Date"))throw new Error('CSV file must contain a "Date" column');const s=[];for(let e=1;e<a.length;e++){if(!a[e].trim())continue;const r=[];let o=!1,i="";try{for(let n=0;n<a[e].length;n++){const t=a[e][n];'"'===t?o=!o:","!==t||o?i+=t:(r.push(i),i="")}r.push(i);const t={};for(let e=0;e<n.length;e++)e<r.length&&(t[n[e]]=r[e].replace(/^"|"$/g,"").trim());t.Date&&s.push(t)}catch(t){console.warn(`Skipping row ${e} due to parsing error:`,t)}}if(0===s.length)throw new Error("No valid data rows found in the CSV file");try{return st(s)}catch(r){if(console.error("Trade data parsing error:",r),r instanceof Error){if(r.message.includes("Invalid time value"))throw new Error('Could not parse one or more dates in the CSV file. Please ensure dates are in a standard format like "MM/DD/YYYY" or "Month Day, Year".');throw r}throw new Error("Failed to parse trade data from CSV file.")}}catch(t){throw console.error("CSV parsing error:",t),t}})(t)}else{var n;const t=null===(n=e.target)||void 0===n?void 0:n.result;r=await(async e=>{try{const r=tt.LF(new Uint8Array(e),{type:"array"});if(!r.SheetNames||0===r.SheetNames.length)throw new Error("Excel file does not contain any sheets");const a=r.Sheets[r.SheetNames[0]];if(!a)throw new Error("Excel sheet is empty or invalid");const n=tt.Wp.sheet_to_json(a);if(!n||0===n.length)throw new Error("No data found in the Excel file");if(!n[0].Date)throw new Error('Excel file must contain a "Date" column');try{return st(n)}catch(t){if(console.error("Trade data parsing error:",t),t instanceof Error){if(t.message.includes("Invalid time value"))throw new Error('Could not parse one or more dates in the Excel file. Please ensure dates are in a standard format like "MM/DD/YYYY" or "Month Day, Year".');throw t}throw new Error("Failed to parse trade data from Excel file.")}}catch(r){throw console.error("Excel parsing error:",r),r}})(t)}t(r)}catch(o){console.error("Import error:",o);let e="Failed to parse import file. ";o instanceof Error?o.message.includes("Invalid time value")?e+="There was an issue with a date format in your file. Please ensure all dates are in a standard format like MM/DD/YYYY.":o.message.includes("is not a function")?e+="There was an issue with the file structure. Please ensure the file has proper headers and data.":e+=o.message:e+="Please ensure the file format is correct.",r(new Error(e))}},n.onerror=()=>{r(new Error("Failed to read import file."))},"csv"===s?n.readAsText(e):n.readAsArrayBuffer(e)}));var it=r(49221),lt=r(32322);const dt=e=>{let{trades:t,accountBalance:r,onImportTrades:n,onDeleteTrade:o,currentDate:l=new Date,monthlyTarget:x,onClearMonthTrades:u}=e;const[f,A]=(0,a.useState)(!1),b=t.filter((e=>new Date(e.date).getMonth()===l.getMonth()&&new Date(e.date).getFullYear()===l.getFullYear())),j=b.reduce(((e,t)=>e+t.amount),0),v=b.filter((e=>"win"===e.type)).length,w=b.filter((e=>"loss"===e.type)).length,k=b.length>0?(v/b.length*100).toFixed(1):"0",C=new Date(l.getFullYear(),l.getMonth(),1),T=t?(0,it.eJ)(j,r,t,C).toFixed(1):r>0?(j/r*100).toFixed(2):"0",S=t.filter((e=>new Date(e.date)<C)),M=r+S.reduce(((e,t)=>e+t.amount),0),D=(x&&x>0?(0,lt.Fm)(b,r,x,C,t):0).toFixed(0),I=!!x&&parseFloat(T)>=x,[W,R]=(0,a.useState)("xlsx"),[P,z]=(0,a.useState)(!1),[E,L]=(0,a.useState)(!1),[$,X]=(0,a.useState)(""),[N,U]=(0,a.useState)("success"),Y=()=>{L(!1)};return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(B.A,{elevation:2,sx:{p:2,borderRadius:2,position:"relative",width:"100%",pb:{xs:5,sm:2.5},overflow:"hidden"},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,K.jsxs)(i.A,{variant:"h6",sx:{mb:2,fontWeight:600,pl:.5},children:["Monthly Performance",(0,K.jsxs)(i.A,{variant:"body2",sx:{fontWeight:500,mt:1,color:"text.secondary",fontSize:"0.875rem"},children:["Started with ",(0,O.vv)(M)]})]}),(0,K.jsxs)(s.A,{sx:{position:{xs:"absolute",sm:"static"},bottom:0,left:0,right:0,display:"flex",gap:1,justifyContent:{xs:"center",sm:"flex-end"},mt:{xs:2,sm:0},flex:1,alignItems:"flex-start"},children:[(0,K.jsx)("input",{type:"file",accept:".xlsx,.csv",style:{display:"none"},id:"import-file",onChange:async e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r&&n){z(!0);try{const e=await ot(r);n(e),X(`Successfully imported ${e.length} trades`),U("success"),L(!0)}catch(a){console.error("Import failed:",a);const e=a instanceof Error?a.message:"Unknown error during import";X(`Error importing trades: ${e}`),U("error"),L(!0)}finally{z(!1)}e.target.value=""}}}),(0,K.jsx)(d.A,{title:"Import trades from Excel or CSV. Custom columns will be converted to tags (e.g., 'Strategy: Breakout' becomes 'Strategy:Breakout' tag)",children:(0,K.jsx)("label",{htmlFor:"import-file",children:(0,K.jsx)(c.A,{component:"span",size:"small",variant:"outlined",startIcon:(0,K.jsx)(Ke.A,{}),sx:{color:"text.secondary",fontSize:"0.75rem",fontWeight:500,textTransform:"none",minWidth:"auto",p:.5,px:1,bgcolor:"background.paper",border:"1px solid",borderColor:"divider","&:hover":{bgcolor:"action.hover",color:"text.primary",borderColor:"text.primary"}},children:"Import"})})}),(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center"},children:[(0,K.jsxs)(c.A,{size:"small",variant:"outlined",startIcon:(0,K.jsx)(Ze.A,{}),onClick:()=>{0!==t.length&&rt(t,r,W)},disabled:0===b.length,sx:{color:"text.secondary",fontSize:"0.75rem",fontWeight:500,textTransform:"none",minWidth:"auto",p:.5,px:1,bgcolor:"background.paper",border:"1px solid",borderColor:"divider","&:hover":{bgcolor:"action.hover",color:"text.primary",borderColor:"text.primary"},"&.Mui-disabled":{color:"text.disabled",bgcolor:"action.disabledBackground",borderColor:"divider"}},children:["Export ",W.toUpperCase()]}),(0,K.jsx)(d.A,{title:`Switch to ${"xlsx"===W?"CSV":"Excel"} format`,children:(0,K.jsx)(h.A,{size:"small",onClick:()=>{R((e=>"xlsx"===e?"csv":"xlsx"))},disabled:0===b.length,sx:{ml:.5},children:(0,K.jsx)(i.A,{variant:"caption",sx:{fontWeight:600},children:"xlsx"===W?"CSV":"XLS"})})})]}),(0,K.jsx)(c.A,{size:"small",variant:"outlined",onClick:()=>{A(!0)},disabled:0===b.length,sx:{color:"error.main",fontSize:"0.75rem",fontWeight:500,textTransform:"none",minWidth:"auto",p:.5,px:1,bgcolor:"background.paper",border:"1px solid",borderColor:"divider","&:hover":{bgcolor:e=>(0,p.X4)(e.palette.error.main,.08),borderColor:"error.main"},"&.Mui-disabled":{color:"text.disabled",bgcolor:"action.disabledBackground",borderColor:"divider"}},children:"Clear Month"})]})]}),(0,K.jsxs)(s.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(3, 1fr)"},gap:2.5,mb:2},children:[(0,K.jsxs)(s.A,{sx:{p:2,borderRadius:2,bgcolor:e=>(0,p.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:.5},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,K.jsx)(y.A,{sx:{fontSize:"1.2rem",color:j>0?"success.main":j<0?"error.main":"text.secondary"}}),(0,K.jsx)(i.A,{variant:"body1",sx:{fontWeight:600,color:"text.secondary"},children:"Monthly P&L"})]}),(0,K.jsxs)(i.A,{variant:"h5",sx:{fontWeight:700,color:j>0?"success.main":j<0?"error.main":"text.primary",display:"flex",alignItems:"baseline",gap:.5},children:[(0,O.vv)(j),(0,K.jsx)(d.A,{title:`Percentage calculated based on account value at start of ${(0,F.A)(l,"MMMM")}: ${(0,O.vv)(M)} (excluding this month's trades for consistent comparison)`,placement:"top",children:(0,K.jsxs)(i.A,{component:"span",sx:{fontSize:"1rem",color:j>0?"success.main":j<0?"error.main":"text.primary",fontWeight:600,cursor:"help"},children:["(",T,"%)"]})})]}),x&&(0,K.jsxs)(s.A,{sx:{width:"100%",mt:1.5},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[(0,K.jsx)(i.A,{variant:"body2",sx:{fontWeight:500,color:"text.secondary"},children:"Target Progress"}),(0,K.jsxs)(i.A,{variant:"body2",sx:{fontWeight:600,color:I?"success.main":"primary.main"},children:[D,"%"]})]}),(0,K.jsx)(s.A,{sx:{width:"100%",height:"8px",bgcolor:e=>(0,p.X4)(e.palette.divider,.5),borderRadius:"4px",overflow:"hidden"},children:(0,K.jsx)(s.A,{sx:{width:`${Math.max(Math.min(parseFloat(D),100),0)}%`,height:"100%",bgcolor:I?"success.main":"primary.main",transition:"width 0.3s ease"}})})]})]}),(0,K.jsxs)(s.A,{sx:{p:2,borderRadius:2,bgcolor:e=>(0,p.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:.5},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,K.jsx)(Qe.A,{sx:{fontSize:"1.2rem",color:parseFloat(k)>50?"success.main":"text.secondary"}}),(0,K.jsx)(i.A,{variant:"body1",sx:{fontWeight:600,color:"text.secondary"},children:"Win Rate"})]}),(0,K.jsxs)(i.A,{variant:"h5",sx:{fontWeight:700,color:parseFloat(k)>50?"success.main":"text.primary"},children:[k,"%"]}),(0,K.jsxs)(i.A,{variant:"body1",sx:{fontWeight:500,color:"text.secondary",mt:.5},children:[v," Wins / ",w," Losses"]}),(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[(0,K.jsx)(s.A,{sx:{height:"10px",bgcolor:"success.main",borderRadius:"5px",flex:v||1}}),(0,K.jsx)(s.A,{sx:{height:"10px",bgcolor:"error.main",borderRadius:"5px",flex:w||1}})]})]}),(0,K.jsxs)(s.A,{sx:{p:2,borderRadius:2,bgcolor:e=>(0,p.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:.5},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,K.jsx)(H.A,{sx:{fontSize:"1.2rem",color:"text.secondary"}}),(0,K.jsx)(i.A,{variant:"body1",sx:{fontWeight:600,color:"text.secondary"},children:"Trading Activity"})]}),(0,K.jsxs)(i.A,{variant:"h5",sx:{fontWeight:700,color:"text.primary"},children:[b.length," Trade",1===b.length?"":"s"]}),(0,K.jsxs)(i.A,{variant:"body1",sx:{fontWeight:500,color:"text.secondary",mt:.5},children:[b.length>0?(b.length/30*100).toFixed(0):0,"% of Month Active"]})]})]})]}),(0,K.jsxs)(_e.A,{open:f,onClose:()=>A(!1),maxWidth:"xs",fullWidth:!0,children:[(0,K.jsx)(qe.A,{children:"Clear Trades"}),(0,K.jsx)(Ve.A,{children:(0,K.jsx)(i.A,{children:"Are you sure you want to clear all trades? This action cannot be undone."})}),(0,K.jsxs)(Je.A,{children:[(0,K.jsx)(c.A,{onClick:()=>A(!1),children:"Cancel"}),(0,K.jsx)(c.A,{onClick:()=>{u&&u(l.getMonth(),l.getFullYear()),A(!1)},color:"error",children:"Clear"})]})]}),(0,K.jsx)(g.A,{open:E,autoHideDuration:"success"===N?3e3:6e3,onClose:Y,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,K.jsx)(m.A,{onClose:Y,severity:N,variant:"filled",sx:{width:"100%"},children:$})})]})};var ct=r(31191);const pt=e=>{let{balance:t,onChange:r,trades:n,totalProfit:o,onPerformanceClick:l,riskPerTrade:d,dynamicRiskSettings:c,onToggleDynamicRisk:h,isDynamicRiskToggled:x=!0}=e;const[g,m]=(0,a.useState)(!1),[u,y]=(0,a.useState)(t.toString()),f=n.length>0&&t>0?(o/t*100).toFixed(2):"0",A=(0,a.useMemo)((()=>{if(d)return null!==c&&void 0!==c&&c.dynamicRiskEnabled&&c.increasedRiskPercentage&&c.profitThresholdPercentage&&parseFloat(f)>=c.profitThresholdPercentage?c.increasedRiskPercentage:d}),[d,c,f]),b=t+o,j=()=>{const e=parseFloat(u);!isNaN(e)&&e>0&&(r(e),m(!1))};return(0,K.jsxs)(B.A,{elevation:2,sx:{display:"flex",flexDirection:"column",gap:1.5,p:2,borderRadius:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",position:"relative",overflow:"hidden"},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,K.jsx)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,K.jsx)(i.A,{variant:"h6",sx:{color:"text.primary",fontWeight:600,pl:1},children:"Account Balance"})}),g?(0,K.jsx)(ie.A,{value:u,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&y(t)},onBlur:j,onKeyDown:e=>{"Enter"===e.key?j():"Escape"===e.key&&(m(!1),y(t.toString()))},size:"small",autoFocus:!0,sx:{width:"150px","& .MuiInputBase-input":{py:.8,px:1.5,fontSize:"1.1rem",fontWeight:600,color:"text.primary"}},InputProps:{startAdornment:(0,K.jsx)(i.A,{sx:{color:"text.secondary",fontSize:"1.1rem",mr:.5,fontWeight:600},children:"$"})}}):(0,K.jsxs)(i.A,{onClick:()=>m(!0),sx:{cursor:"pointer",fontSize:"1.5rem",fontWeight:700,color:"text.primary","&:hover":{color:"primary.main"},display:"flex",alignItems:"center",gap:.5},children:[(0,K.jsx)(s.A,{component:"span",sx:{fontSize:"1.1rem",color:"text.secondary",fontWeight:500},children:"$"}),t.toLocaleString()]})]}),(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:e=>(0,p.X4)(e.palette.background.default,.5),p:1.5,borderRadius:1.5,mt:.5},children:[(0,K.jsxs)(s.A,{children:[(0,K.jsx)(i.A,{variant:"body2",sx:{color:"text.secondary",mb:.5,fontWeight:500},children:"Current P&L"}),(0,K.jsxs)(i.A,{variant:"h6",sx:{fontSize:"1.2rem",color:o>0?"success.main":o<0?"error.main":"text.secondary",fontWeight:700,display:"flex",alignItems:"center",gap:.5},children:["$",n.length>0?Math.abs(o).toLocaleString():"0",(0,K.jsxs)(i.A,{component:"span",sx:{fontSize:"0.9rem",color:o>0?"success.main":o<0?"error.main":"text.secondary",fontWeight:600},children:["(",f,"%)"]})]})]}),(0,K.jsxs)(s.A,{children:[(0,K.jsx)(i.A,{variant:"body2",sx:{color:"text.secondary",mb:.5,fontWeight:500,textAlign:"right"},children:"Total Value"}),(0,K.jsxs)(i.A,{variant:"h6",sx:{fontSize:"1.2rem",color:b>t?"success.main":b<t?"error.main":"text.secondary",fontWeight:700},children:["$",b.toLocaleString()]})]})]}),d&&(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:1,mt:1},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:e=>(0,p.X4)(e.palette.primary.main,.08),p:1.5,borderRadius:1.5},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,K.jsx)(ct.A,{sx:{fontSize:"1rem",color:"primary.main"}}),(0,K.jsxs)(i.A,{variant:"body2",sx:{color:"text.secondary",fontWeight:500},children:["Risk Per Trade (",A,"%)",(null===c||void 0===c?void 0:c.dynamicRiskEnabled)&&A!==d&&(0,K.jsx)(s.A,{component:"span",sx:{ml:1,color:"success.main",fontSize:"0.75rem",fontWeight:700},children:"INCREASED"})]})]}),(0,K.jsxs)(i.A,{variant:"body1",sx:{fontWeight:600,color:"primary.main"},children:["$",A?(b*A/100).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"]})]}),(null===c||void 0===c?void 0:c.dynamicRiskEnabled)&&c.profitThresholdPercentage&&c.increasedRiskPercentage&&(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:1,backgroundColor:e=>(0,p.X4)(e.palette.background.default,.5),p:1,borderRadius:1.5,fontSize:"0.75rem"},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,K.jsxs)(i.A,{variant:"caption",sx:{color:"text.secondary"},children:["Dynamic Risk: ",parseFloat(f)>=c.profitThresholdPercentage?(0,K.jsx)(s.A,{component:"span",sx:{color:"success.main",fontWeight:600},children:"Active"}):(0,K.jsx)(s.A,{component:"span",sx:{color:"text.secondary",fontWeight:600},children:"Inactive"})]}),(0,K.jsxs)(i.A,{variant:"caption",sx:{color:"text.secondary"},children:["Threshold: ",c.profitThresholdPercentage,"% profit"]})]}),(0,K.jsx)(s.A,{sx:{display:"flex",alignItems:"center"},children:(0,K.jsx)(de.A,{control:(0,K.jsx)(ce.A,{checked:x,onChange:e=>{h&&h(e.target.checked)},size:"small",color:"primary"}),label:(0,K.jsx)(i.A,{variant:"caption",sx:{color:"text.secondary"},children:x?"Using actual trade amounts":"Using calculated amounts"}),sx:{m:0}})})]})]})]})};var ht=r(54410),xt=r(41393);const gt=e=>{if(!e)return"";try{const t=(0,ht.convertFromRaw)(JSON.parse(e)),r={inlineStyles:{...Object.fromEntries(Array.from({length:100},((e,t)=>{const r=t.toString(16).padStart(2,"0");return[`TEXT_COLOR_${r}${r}${r}`,{style:{color:`#${r}${r}${r}`}}]}))),TEXT_COLOR_FF0000:{style:{color:"#FF0000"}},TEXT_COLOR_00FF00:{style:{color:"#00FF00"}},TEXT_COLOR_0000FF:{style:{color:"#0000FF"}},TEXT_COLOR_FFFF00:{style:{color:"#FFFF00"}},TEXT_COLOR_FF00FF:{style:{color:"#FF00FF"}},TEXT_COLOR_00FFFF:{style:{color:"#00FFFF"}},TEXT_COLOR_000000:{style:{color:"#000000"}},TEXT_COLOR_FFFFFF:{style:{color:"#FFFFFF"}},TEXT_COLOR_808080:{style:{color:"#808080"}},TEXT_COLOR_FFA500:{style:{color:"#FFA500"}},TEXT_COLOR_800080:{style:{color:"#800080"}},TEXT_COLOR_008000:{style:{color:"#008000"}},TEXT_COLOR_800000:{style:{color:"#800000"}},TEXT_COLOR_000080:{style:{color:"#000080"}},TEXT_COLOR_808000:{style:{color:"#808000"}},TEXT_COLOR_008080:{style:{color:"#008080"}}},blockStyleFn:e=>{switch(e.getType()){case"header-one":return{element:"h1",style:{margin:"0.4em 0",fontSize:"1.2rem"}};case"header-two":return{element:"h2",style:{margin:"0.3em 0",fontSize:"1.1rem"}};case"header-three":return{element:"h3",style:{margin:"0.2em 0",fontSize:"1rem"}};default:return{}}}};let a=(0,xt.W)(t,r);return a=`<div style="width: 100%; box-sizing: border-box; font-size: 0.8rem; line-height: 1.3;">${a}</div>`,a=a.replace(/<p/g,'<p style="margin: 0.3em 0"'),a}catch(t){console.error("Error converting rich text to HTML:",t);try{const t=JSON.parse(e);if(t.blocks&&Array.isArray(t.blocks))return t.blocks.map((e=>e.text)).join("\n")}catch(r){return e}return""}};var mt=r(61773),ut=r(22950),yt=r(30210);const ft=e=>{var t;let{calendarNotes:r,setIsDayNotesDialogOpen:n}=e;const o=(0,l.A)(),[c,x]=(0,a.useState)(!1),g=(0,F.A)(new Date,"EEE"),m=r&&r.has(g)&&""!==(null===(t=r.get(g))||void 0===t?void 0:t.trim()),u=(0,a.useCallback)(((e,t)=>{const a=document.createElement("div");a.style.position="absolute",a.style.visibility="hidden",a.style.height="auto",a.style.width=t.clientWidth+"px",a.style.fontSize="0.8rem",a.style.lineHeight="1.3",a.innerHTML=gt((null===r||void 0===r?void 0:r.get(g))||""),document.body.appendChild(a);const n=a.offsetHeight;document.body.removeChild(a);const s=n>t.clientHeight;return x(s),s}),[r,g]),y={display:"flex",flexDirection:"column",gap:1.5,p:2,borderRadius:2,bgcolor:"background.paper",border:"1px solid",borderColor:m?o.palette.info.main:(0,p.X4)(o.palette.primary.main,.3),boxShadow:m?`0 0 8px ${(0,p.X4)(o.palette.info.main,.2)}`:`0 0 8px ${(0,p.X4)(o.palette.primary.main,.1)}`,position:"relative",overflow:"hidden",cursor:"pointer",transition:"all 0.2s ease-in-out",height:"100%","&:hover":{transform:"translateY(-2px)",boxShadow:o.shadows[4],borderColor:o.palette.primary.main}};return(0,K.jsxs)(B.A,{elevation:2,sx:y,onClick:()=>n(g),children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,K.jsx)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:"50%",backgroundColor:(0,p.X4)(m?o.palette.info.main:o.palette.primary.main,.1),color:m?o.palette.info.main:o.palette.primary.main},children:(0,K.jsx)(He.A,{fontSize:"small"})}),(0,K.jsx)(i.A,{variant:"subtitle1",sx:{color:"text.primary",fontWeight:600},children:"Today's Notes"})]}),(0,K.jsx)(d.A,{title:m?"Edit Notes":"Add Notes",children:(0,K.jsx)(h.A,{size:"small",sx:{color:m?"info.main":"primary.main",bgcolor:(0,p.X4)(m?o.palette.info.main:o.palette.primary.main,.08),"&:hover":{bgcolor:(0,p.X4)(m?o.palette.info.main:o.palette.primary.main,.15)}},onClick:e=>{e.stopPropagation(),n(g)},children:m?(0,K.jsx)(mt.A,{fontSize:"small"}):(0,K.jsx)(ut.A,{fontSize:"small"})})})]}),m?(0,K.jsxs)(s.A,{sx:{backgroundColor:(0,p.X4)(o.palette.background.default,.5),p:1.2,borderRadius:1.5,mt:.5,flex:1,overflow:"hidden",position:"relative",width:"100%",display:"flex",flexDirection:"column"},children:[(0,K.jsx)(s.A,{className:"auto-scroll-container",sx:{overflow:"hidden",height:"100%",maxHeight:"170px",position:"relative",width:"100%","& .MuiTypography-root":{margin:0},"& .auto-scroll-content":{position:"relative",whiteSpace:"normal",width:"100%",textAlign:"left",boxSizing:"border-box",fontSize:"0.8rem"},"&:hover":{"& .infinite-scroll-wrapper":{animationPlayState:"paused"}},"@keyframes scrollText":{"0%, 100%":{transform:"translateY(0)"}}},children:(0,K.jsx)(s.A,{className:"scroll-container",sx:{position:"relative",width:"100%",height:"100%",overflow:"hidden","&:hover .scroll-content":{animationPlayState:"paused"}},children:(0,K.jsx)(s.A,{className:"scroll-content",sx:{animation:"marquee var(--scroll-duration, 15s) linear infinite",paddingBottom:"20px","@keyframes marquee":{"0%":{transform:"translateY(0)"},"100%":{transform:"translateY(-50%)"}}},ref:e=>{if(e){const t=e.parentElement;t&&setTimeout((()=>{if(u(e,t)){var r;const t=(null===(r=e.textContent)||void 0===r?void 0:r.length)||0,a=Math.max(10,Math.min(30,t/20));e.style.setProperty("--scroll-duration",`${a}s`),e.style.animationPlayState="running"}else e.style.animationPlayState="paused",e.style.transform="translateY(0)"}),100)}},dangerouslySetInnerHTML:{__html:`\n                    <div style="font-size: 0.8rem; line-height: 1.3; text-align: left;">\n                      ${gt((null===r||void 0===r?void 0:r.get(g))||"")}\n                    </div>\n                    ${c?`\n                      <div style="height: 30px;"></div>\n                      <div style="font-size: 0.8rem; line-height: 1.3; text-align: left;">\n                        ${gt((null===r||void 0===r?void 0:r.get(g))||"")}\n                      </div>\n                    `:""}\n                  `}})})}),(0,K.jsx)(s.A,{className:"scroll-indicator",sx:{position:"absolute",bottom:0,left:0,right:0,height:"30px",background:`linear-gradient(to bottom, transparent, ${"dark"===o.palette.mode?"rgba(30,30,30,0.8)":"rgba(255,255,255,0.8)"})`,pointerEvents:"none",display:"flex",justifyContent:"center",alignItems:"flex-end",paddingBottom:"4px",opacity:0,transition:"opacity 0.3s ease","&::after":{content:'""',width:"40px",height:"4px",borderRadius:"2px",backgroundColor:(0,p.X4)(o.palette.info.main,.3),animation:"pulseIndicator 2s ease-in-out infinite"},"@keyframes pulseIndicator":{"0%, 100%":{opacity:.3},"50%":{opacity:.7}}},ref:e=>{e&&setTimeout((()=>{e.style.opacity=c?"1":"0"}),150)}})]}):(0,K.jsxs)(s.A,{sx:{backgroundColor:(0,p.X4)(o.palette.background.default,.5),p:1,borderRadius:1.5,flex:1,pb:3,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",gap:2},children:[(0,K.jsx)(s.A,{sx:{width:60,height:60,borderRadius:"50%",mt:1,backgroundColor:(0,p.X4)(o.palette.primary.main,.1),display:"flex",alignItems:"center",justifyContent:"center",color:o.palette.primary.main},children:(0,K.jsx)(yt.A,{sx:{fontSize:"2rem"}})}),(0,K.jsxs)(i.A,{variant:"body1",sx:{fontWeight:500,color:"text.primary"},children:["No notes for ",(0,F.A)(new Date,"EEEE")]}),(0,K.jsx)(i.A,{variant:"body2",sx:{color:"text.secondary",maxWidth:"80%"},children:"Add notes about market conditions, your trading mindset, or lessons learned for today."})]})]})};var At=r(32396);const bt=e=>{let{open:t,onClose:r,trades:n,onTradeClick:o}=e;const d=(0,l.A)(),c=(0,a.useMemo)((()=>n.filter((e=>e.isPinned))),[n]),x=(0,a.useMemo)((()=>[...c].sort(((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()))),[c]),g=e=>{switch(e){case"win":return(0,K.jsx)(y.A,{sx:{fontSize:20,color:"success.main"}});case"loss":return(0,K.jsx)(De.A,{sx:{fontSize:20,color:"error.main"}});case"breakeven":return(0,K.jsx)(Ie.A,{sx:{fontSize:20,color:"text.secondary"}})}},m=e=>{switch(e){case"win":return d.palette.success.main;case"loss":return d.palette.error.main;case"breakeven":return d.palette.text.secondary}};return(0,K.jsx)(be.Ay,{anchor:"right",open:t,onClose:r,sx:{zIndex:1300,"& .MuiDrawer-paper":{width:{xs:"100%",sm:400},maxWidth:"100vw",zIndex:1300}},children:(0,K.jsxs)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,K.jsxs)(s.A,{sx:{p:2,borderBottom:`1px solid ${d.palette.divider}`,display:"flex",alignItems:"center",gap:2},children:[(0,K.jsx)(s.A,{sx:{p:1,borderRadius:1,backgroundColor:(0,p.X4)(d.palette.primary.main,.1),display:"flex",alignItems:"center",justifyContent:"center"},children:(0,K.jsx)(k.A,{sx:{color:"primary.main",fontSize:20}})}),(0,K.jsx)(i.A,{variant:"h6",sx:{flex:1,fontWeight:600},children:"Pinned Trades"}),x.length>0&&(0,K.jsx)(oe.A,{label:x.length,size:"small",sx:{backgroundColor:(0,p.X4)(d.palette.primary.main,.1),color:"primary.main",fontWeight:600}}),(0,K.jsx)(h.A,{onClick:r,size:"small",children:(0,K.jsx)(ve.A,{})})]}),(0,K.jsx)(s.A,{sx:{flex:1,overflow:"auto"},children:0===x.length?(0,K.jsxs)(s.A,{sx:{p:4,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,K.jsx)(k.A,{sx:{fontSize:64,color:"text.disabled",mb:2}}),(0,K.jsx)(i.A,{variant:"h6",sx:{mb:1,fontWeight:600,color:"text.secondary"},children:"No Pinned Trades"}),(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",maxWidth:300},children:"Pin important trades to keep them easily accessible. Open any trade and click the pin button to add trades here."})]}):(0,K.jsx)(he.A,{sx:{p:0,overflow:"auto",height:"100%"},children:x.map(((e,t)=>(0,K.jsxs)(a.Fragment,{children:[(0,K.jsx)(xe.Ay,{disablePadding:!0,children:(0,K.jsx)(Me.A,{onClick:()=>null===o||void 0===o?void 0:o(e),sx:{p:2,"&:hover":{backgroundColor:(0,p.X4)(d.palette.primary.main,.05)}},children:(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,width:"100%"},children:[(0,K.jsx)(s.A,{sx:{mt:.5},children:g(e.type)}),(0,K.jsx)(s.A,{sx:{flex:1,minWidth:0},children:(0,K.jsx)(ge.A,{primary:(0,K.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:.5},children:[(0,K.jsx)(i.A,{variant:"subtitle1",sx:{fontWeight:600,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,mr:1},children:e.name||`Trade ${e.id.slice(-6)}`}),(0,K.jsxs)(i.A,{variant:"subtitle1",sx:{fontWeight:700,color:m(e.type),whiteSpace:"nowrap"},children:[e.amount>0?"+":"","$",Math.abs(e.amount).toFixed(2)]})]}),secondary:(0,K.jsxs)(s.A,{children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,K.jsx)(Re.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,K.jsx)(i.A,{variant:"body2",color:"text.secondary",children:(0,F.A)(new Date(e.date),"MMM dd, yyyy")}),e.session&&(0,K.jsx)(oe.A,{label:e.session,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem",borderColor:(0,p.X4)(d.palette.text.secondary,.3),color:"text.secondary"}})]}),e.tags&&e.tags.length>0&&(0,K.jsxs)(s.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[e.tags.slice(0,4).map((e=>(0,K.jsx)(oe.A,{label:e,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem",borderColor:(0,p.X4)(d.palette.primary.main,.3),color:"primary.main"}},e))),e.tags.length>4&&(0,K.jsx)(oe.A,{label:"+"+(e.tags.length-4),size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem",borderColor:(0,p.X4)(d.palette.text.secondary,.3),color:"text.secondary"}})]})]})})})]})})}),t<x.length-1&&(0,K.jsx)(pe.A,{})]},e.id)))})})]})})};var jt=r(92490),vt=r(22038),wt=r(14204);const kt=e=>{let{open:t,onClose:r,trades:n,initialTradeId:o,onUpdateTradeProperty:c,setZoomedImage:x,title:g="Trade Gallery",calendarId:m,onOpenGalleryMode:u}=e;const y=(0,l.A)(),f=(0,a.useMemo)((()=>{if(!o)return 0;const e=n.findIndex((e=>e.id===o));return e>=0?e:0}),[n,o]),[A,b]=(0,a.useState)(f);(0,a.useEffect)((()=>{b(f)}),[f]);const j=(0,a.useMemo)((()=>n[A]||null),[n,A]),v=(0,a.useCallback)((()=>{n.length<=1||b((e=>(e+1)%n.length))}),[n.length]),w=(0,a.useCallback)((()=>{n.length<=1||b((e=>(e-1+n.length)%n.length))}),[n.length]);return(0,a.useEffect)((()=>{const e=e=>{t&&("ArrowLeft"===e.key?(e.preventDefault(),w()):"ArrowRight"===e.key?(e.preventDefault(),v()):"Escape"===e.key&&(e.preventDefault(),r()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[t,w,v,r]),j?(0,K.jsxs)(_e.A,{open:t,onClose:r,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{height:"90vh",maxHeight:"90vh",backgroundColor:y.palette.background.default}},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,borderBottom:`1px solid ${y.palette.divider}`,backgroundColor:y.palette.background.paper},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[(0,K.jsx)(d.A,{title:"Previous trade (\u2190)",children:(0,K.jsx)("span",{children:(0,K.jsx)(h.A,{onClick:w,disabled:n.length<=1,sx:{color:n.length<=1?"text.disabled":"text.primary","&:hover":{backgroundColor:(0,p.X4)(y.palette.primary.main,.1)}},children:(0,K.jsx)(jt.A,{})})})}),(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,K.jsx)(i.A,{variant:"h6",sx:{fontWeight:600},children:g}),(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,K.jsx)(oe.A,{size:"small",label:`${A+1} of ${n.length}`,sx:{backgroundColor:(0,p.X4)(y.palette.primary.main,.1),color:"primary.main",fontWeight:600}}),(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,K.jsx)(Re.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,K.jsx)(i.A,{variant:"caption",color:"text.secondary",children:(0,F.A)(new Date(j.date),"MMM d, yyyy")})]})]})]}),(0,K.jsx)(d.A,{title:"Next trade (\u2192)",children:(0,K.jsx)("span",{children:(0,K.jsx)(h.A,{onClick:v,disabled:n.length<=1,sx:{color:n.length<=1?"text.disabled":"text.primary","&:hover":{backgroundColor:(0,p.X4)(y.palette.primary.main,.1)}},children:(0,K.jsx)(vt.A,{})})})})]}),(0,K.jsx)(h.A,{onClick:r,sx:{color:"text.secondary","&:hover":{backgroundColor:(0,p.X4)(y.palette.error.main,.1),color:"error.main"}},children:(0,K.jsx)(ve.A,{})})]}),(0,K.jsx)(s.A,{sx:{flex:1,overflow:"auto",...(0,me.J)(y)},children:(0,K.jsx)(wt.A,{tradeData:j,isExpanded:!0,setZoomedImage:x,onUpdateTradeProperty:c,calendarId:m,trades:n,onOpenGalleryMode:u})})]}):null};var Ct=r(87777),Tt=r(20872),St=r(30994),Mt=r(52532),Dt=r(61711);const It=e=>{let{trades:t,selectedDate:r,accountBalance:n,maxDailyDrawdown:o,monthlyTarget:d,calendarId:p,scoreSettings:x,onUpdateTradeProperty:g,onUpdateCalendarProperty:m,dynamicRiskSettings:u,allTags:y,onEditTrade:f,onDeleteTrade:A,onDeleteMultipleTrades:b,onZoomImage:j,onOpenGalleryMode:v}=e;const w=(0,l.A)(),[k,C]=(0,a.useState)({open:!1,trades:[],date:"",expandedTradeId:null}),[T,S]=(0,a.useState)(!1),[M,D]=(0,a.useState)([]),[I,W]=(0,a.useState)([]),[R,P]=(0,a.useState)(!1),z="month";(0,a.useEffect)((()=>{(async()=>{P(!0);try{const e=await(0,Dt.D9)(t,r,z);W(e)}catch(e){console.error("Error calculating chart data:",e),W([])}finally{P(!1)}})()}),[t,r,z]);const F=(0,a.useMemo)((()=>(0,Dt.s5)(t,r,z,n)),[t,r,z,n]),E=(0,a.useMemo)((()=>(0,Dt.R5)(d,n)),[d,n]),L=(0,a.useMemo)((()=>(0,Dt.f1)(o,n)),[o,n]),$=(0,a.useMemo)((()=>{const e=(0,Dt.Nb)(t,r,z);return[{name:"Wins",value:e.filter((e=>"win"===e.type)).length},{name:"Losses",value:e.filter((e=>"loss"===e.type)).length},{name:"Breakeven",value:e.filter((e=>"breakeven"===e.type)).length}].filter((e=>e.value>0))}),[t,r,z]),X=(0,a.useMemo)((()=>{if(y&&y.length>0)return y;const e=(0,Dt.Nb)(t,r,z),a=new Set;return e.forEach((e=>{e.tags&&e.tags.forEach((e=>a.add(e)))})),Array.from(a).sort()}),[y,t,r,z]),N=(0,a.useMemo)((()=>{const e=(0,Dt.Nb)(t,r,z),a=new Map;return e.forEach((e=>{e.tags&&e.tags.forEach((e=>{a.set(e,(a.get(e)||0)+1)}))})),Array.from(a.entries()).map((e=>{let[t,r]=e;return{tag:t,totalTrades:r}}))}),[t,r,z]);return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(s.A,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:(0,K.jsx)(c.A,{variant:"outlined",startIcon:(0,K.jsx)(Ct.A,{}),onClick:()=>S(!0),sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:"View Details Stats"})}),(0,K.jsx)(St.A,{trades:t,selectedDate:r,calendarId:p,scoreSettings:x,onUpdateCalendarProperty:m,accountBalance:n,dynamicRiskSettings:u,allTags:X}),(0,K.jsx)(Tt.fc,{chartData:I,targetValue:E,monthlyTarget:d,drawdownViolationValue:L,setMultipleTradesDialog:C,timePeriod:z}),(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:3,mb:3},children:[(0,K.jsx)(s.A,{sx:{flex:1,width:{xs:"100%",md:"50%"}},children:(0,K.jsx)(Tt.Ld,{sessionStats:F,trades:t,selectedDate:r,timePeriod:z,setMultipleTradesDialog:C})}),(0,K.jsx)(s.A,{sx:{flex:1,width:{xs:"100%",md:"50%"}},children:(0,K.jsx)(Tt.Y$,{winLossData:$,comparisonWinLossData:null,allTags:X,comparisonTags:M,setComparisonTags:D,onPieClick:e=>{const a=(0,Dt.Nb)(t,r,z);let n=[];n="Wins"===e?a.filter((e=>"win"===e.type)):"Losses"===e?a.filter((e=>"loss"===e.type)):"Breakeven"===e?a.filter((e=>"breakeven"===e.type)):a.filter((t=>t.tags&&t.tags.includes(e))),n.length>0&&C({open:!0,trades:n,date:`${e} Trades`,expandedTradeId:null})},tagStats:N})})]}),(0,K.jsx)(Tt.Q_,{open:k.open,onClose:()=>C((e=>({...e,open:!1}))),trades:k.trades,date:k.date,expandedTradeId:k.expandedTradeId,onTradeExpand:e=>C((t=>({...t,expandedTradeId:t.expandedTradeId===e?null:e}))),onUpdateTradeProperty:g,onZoomImage:j||(()=>{}),accountBalance:n,allTrades:t,onEditClick:f,onDeleteClick:A,onDeleteMultiple:b,onOpenGalleryMode:v}),(0,K.jsxs)(_e.A,{open:T,onClose:()=>S(!1),maxWidth:"lg",fullWidth:!0,sx:{"& .MuiDialog-paper":{borderRadius:2,boxShadow:"none",border:`1px solid ${w.palette.divider}`,maxHeight:"90vh",overflow:"hidden"},"& .MuiDialogContent-root":{...(0,me.J)(w)}},children:[(0,K.jsx)(qe.A,{children:(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,K.jsx)(i.A,{variant:"h6",children:"Performance Analytics"}),(0,K.jsx)(h.A,{onClick:()=>S(!1),size:"small",children:(0,K.jsx)(ve.A,{})})]})}),(0,K.jsx)(Ve.A,{sx:{p:0},children:(0,K.jsx)(Mt.A,{trades:t,selectedDate:r,accountBalance:n,maxDailyDrawdown:o,monthlyTarget:d,calendarId:p,scoreSettings:x,onUpdateTradeProperty:g,onUpdateCalendarProperty:m,dynamicRiskSettings:u,onEditTrade:f,onDeleteTrade:A,onOpenGalleryMode:v})})]})]})},Wt=e=>{let{currentDate:t,isVisible:r,onPrevMonth:a,onNextMonth:n,onMonthClick:o}=e;const d=(0,l.A)();return(0,K.jsx)(K.Fragment,{children:r&&(0,K.jsxs)(s.A,{sx:{position:"fixed",top:80,right:20,zIndex:1200,backgroundColor:(0,p.X4)(d.palette.background.paper,.95),backdropFilter:"blur(8px)",borderRadius:3,boxShadow:d.shadows[4],border:`1px solid ${(0,p.X4)(d.palette.divider,.2)}`,p:1,display:"flex",alignItems:"center",gap:1,transition:"opacity 0.3s ease-in-out",opacity:r?1:0,visibility:r?"visible":"hidden",pointerEvents:r?"auto":"none"},children:[(0,K.jsx)(h.A,{onClick:a,size:"small",sx:{color:"text.secondary","&:hover":{color:"primary.main",bgcolor:(0,p.X4)(d.palette.primary.main,.08)}},children:(0,K.jsx)(b.A,{})}),(0,K.jsx)(i.A,{variant:"body1",sx:{fontWeight:600,cursor:"pointer",minWidth:"140px",textAlign:"center",fontSize:"0.95rem",color:"text.primary",borderRadius:1,px:1,py:.5,"&:hover":{color:"primary.main",bgcolor:(0,p.X4)(d.palette.primary.main,.05)}},onClick:o,children:(0,F.A)(t,"MMM yyyy")}),(0,K.jsx)(h.A,{onClick:n,size:"small",sx:{color:"text.secondary","&:hover":{color:"primary.main",bgcolor:(0,p.X4)(d.palette.primary.main,.08)}},children:(0,K.jsx)(j.A,{})})]})})},Rt=e=>{let{date:t,trades:r,monthStart:a,weekIndex:n,currentMonth:l,accountBalance:d,weeklyTarget:c,sx:p}=e;const h=(0,M.A)(t,{weekStartsOn:0}),x=((0,D.A)(t,{weekStartsOn:0}),r.filter((e=>(0,I.A)(new Date(e.date),h,{weekStartsOn:0})&&new Date(e.date).getMonth()===l))),g=x.reduce(((e,t)=>e+t.amount),0),m=r?(0,it.eJ)(g,d,r,h).toFixed(1):d>0?(g/d*100).toFixed(1):"0",u=(c&&c>0?(0,lt.Fm)(x,d,c,h,r):0).toFixed(0),f=!!c&&parseFloat(m)>=c;return(0,K.jsx)(s.A,{sx:{bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",...p},children:(0,K.jsxs)(o.A,{spacing:.3,sx:{alignItems:"center"},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,K.jsx)(y.A,{sx:{fontSize:"0.875rem",color:"text.secondary"}}),(0,K.jsxs)(i.A,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Week ",n+1]})]}),(0,K.jsx)(i.A,{variant:"subtitle1",sx:{fontWeight:600,color:g>0?"success.main":g<0?"error.main":"text.primary",fontSize:"0.875rem",textAlign:"center"},children:(0,O.vv)(g)}),(0,K.jsxs)(i.A,{variant:"caption",sx:{color:g>0?"success.main":g<0?"error.main":"text.secondary",fontSize:"0.75rem",fontWeight:500,textAlign:"center"},children:[m,"%"]}),c&&(0,K.jsx)(Le.A,{progress:parseFloat(u),isMet:f,tooltipText:`${f?"Weekly target achieved":"Progress towards weekly target"}: ${u}%`}),(0,K.jsxs)(i.A,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem",textAlign:"center"},children:[x.length," trades"]})]})})},Pt=()=>({id:(0,n.A)(),name:"",amount:"",type:"win",entry:"",date:null,exit:"",tags:[],riskToReward:"",partialsTaken:!1,session:"",notes:"",pendingImages:[],uploadedImages:[]}),zt=e=>{let{allTags:t,selectedTags:r,onTagsChange:a,onOpenDrawer:n}=e;const o=(0,l.A)();return(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,K.jsx)(d.A,{title:"Filter by tags",children:(0,K.jsx)(c.A,{variant:"outlined",size:"small",startIcon:(0,K.jsx)(f.A,{}),onClick:n,sx:{borderColor:r.length>0?"primary.main":"divider",color:r.length>0?"primary.main":"text.secondary",display:"flex",alignItems:"center","&:hover":{borderColor:"primary.main",bgcolor:(0,p.X4)(o.palette.primary.main,.08)}},children:r.length>0?`${r.length} tag${r.length>1?"s":""}`:"Filter Tags"})}),r.length>0&&(0,K.jsx)(d.A,{title:"Clear all filters",children:(0,K.jsx)(h.A,{size:"small",onClick:()=>{a([])},sx:{color:"text.secondary","&:hover":{color:"error.main",bgcolor:(0,p.X4)(o.palette.error.main,.08)}},children:(0,K.jsx)(A.A,{fontSize:"small"})})})]})},Ft=e=>{const{trades:t,accountBalance:r,maxDailyDrawdown:n,weeklyTarget:y,monthlyTarget:f,yearlyTarget:A,dynamicRiskSettings:M,requiredTagGroups:I,allTags:B,onAddTrade:U,onTagUpdated:Y,onUpdateTradeProperty:H,onUpdateCalendarProperty:G,onAccountBalanceChange:_,onImportTrades:q,calendarName:V,calendarNote:J,calendarDayNotes:Q,scoreSettings:ee,onClearMonthTrades:te,onToggleTheme:re,mode:oe,totalPnL:ie,onToggleDynamicRisk:le,isLoadingTrades:de=!1}=e,[ce,pe]=(0,a.useState)(new Date),[he,xe]=(0,a.useState)(null),[ge,me]=(0,a.useState)(null),[ue,ye]=(0,a.useState)(!1),[fe,be]=(0,a.useState)([]),[je,ve]=(0,a.useState)(null),[ke,Ce]=(0,a.useState)(null),[Te,Se]=(0,a.useState)(null),[Me,De]=(0,a.useState)([]),[Ie,We]=(0,a.useState)(!1),[Re,Pe]=(0,a.useState)([]),[ze,Fe]=(0,a.useState)(null),Le=(0,a.useCallback)(((e,t,r)=>{Se({selectetdImageIndex:r||0,allImages:t||[e]})}),[]),[$e,He]=(0,a.useState)(!1),[_e,qe]=(0,a.useState)(!1),[Ve,Je]=(0,a.useState)(!1),[Ke,Ze]=(0,a.useState)(!0),[Qe,et]=(0,a.useState)(!1),[tt,rt]=(0,a.useState)(""),[at,nt]=(0,a.useState)("warning"),[st,ot]=(0,a.useState)(!1),[it,ct]=(0,a.useState)(!1),[ht,xt]=(0,a.useState)({open:!1,trades:[],initialTradeId:void 0,title:void 0}),gt=(0,l.A)(),{calendarId:mt}=(0,Be.g)();(0,a.useEffect)((()=>{const e=()=>{const e=document.querySelector('[data-testid="month-nav-section"]');if(e){const t=e.getBoundingClientRect();ot(0==(t.top<=window.innerHeight&&t.bottom>=0))}};return window.addEventListener("scroll",e),e(),()=>window.removeEventListener("scroll",e)}),[]);const ut=(0,a.useMemo)((()=>{if(B&&B.length>0)return B;const e=new Set;return t.forEach((t=>{t.tags&&t.tags.forEach((t=>e.add(t)))})),Array.from(e).sort()}),[B,t]),yt=(0,a.useMemo)((()=>0===fe.length?t:t.filter((e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.some((e=>fe.includes(e)))}))),[t,fe]),jt=(0,a.useMemo)((()=>he?yt.filter((e=>(0,W.A)(new Date(e.date),he))):[]),[he,yt]),vt=(0,a.useMemo)((()=>0===fe.length&&void 0!==ie?ie:yt.length>0?yt.reduce(((e,t)=>e+t.amount),0):0),[yt,fe,ie]),wt=((0,a.useMemo)((()=>{const e=[],t=new Date(ce.getFullYear(),ce.getMonth(),1),r=new Date(ce.getFullYear(),ce.getMonth()+1,0);for(let a=t;a<=r;a.setDate(a.getDate()+1))e.push(new Date(a));return e}),[ce]),()=>{pe((e=>(0,R.A)(e,1)))}),Ct=()=>{pe((e=>(0,P.A)(e,1)))},Tt=(0,a.useMemo)((()=>t.filter((e=>e.isPinned)).length),[t]),St=e=>{De([e]),We(!0),Fe(null)},Mt=e=>{De(e),We(!0),Fe(null)},Dt=async()=>{if(0!==Me.length){We(!1),Fe(null),Pe((e=>[...e,...Me]));try{const e=Me.map((async e=>H?await H(e,(e=>({...e,isDeleted:!0}))):Promise.resolve()));await Promise.all(e);const t=1===Me.length?"Trade deleted successfully.":`Successfully deleted ${Me.length} trades.`;Xt(t,"success")}catch(e){console.error("Error deleting trades:",e);const t=1===Me.length?"Failed to delete trade. Please try again.":"Failed to delete some trades. Please try again.";Fe(t),Xt(t,"error")}finally{Pe((e=>e.filter((e=>!Me.includes(e))))),De([])}}},Ft=U?async e=>{await U(e)}:void 0,Et=()=>{ye(!0)},Lt=e=>{be(e)},$t=()=>{et(!1)},Xt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning";rt(e),nt(t),et(!0)},Nt=(e,t,r)=>{xt({open:!0,trades:e,initialTradeId:t,title:r})};return(0,K.jsxs)(s.A,{children:[(0,K.jsx)(Wt,{currentDate:ce,isVisible:st,onPrevMonth:wt,onNextMonth:Ct,onMonthClick:Et}),(0,K.jsx)(Ye.A,{onToggleTheme:re,mode:oe,title:V||"Calendar",showBackButton:!0,backButtonPath:"/"}),(0,K.jsx)(x.A,{}),(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:2,p:2,mt:1},children:[(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:2,maxWidth:"1200px",margin:"0 auto",width:"100%"},children:[(0,K.jsx)(Z,{calendarNote:J||"",calendarId:mt,onUpdateCalendarProperty:G,trades:t,onOpenGalleryMode:Nt}),(0,K.jsxs)(s.A,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",md:"row"},justifyContent:"center",alignItems:"stretch",width:"100%"},children:[(0,K.jsx)(s.A,{sx:{flex:1,maxWidth:"600px"},children:(0,K.jsx)(pt,{balance:r,totalProfit:vt,onChange:_,trades:yt,riskPerTrade:null===M||void 0===M?void 0:M.riskPerTrade,dynamicRiskSettings:M,onToggleDynamicRisk:e=>{Ze(e),le&&le(e)},isDynamicRiskToggled:Ke})}),(0,K.jsx)(s.A,{sx:{flex:1,maxWidth:"600px"},children:(0,K.jsx)(ft,{calendarNotes:Q||new Map,setIsDayNotesDialogOpen:me})})]}),(0,K.jsx)(dt,{trades:yt,accountBalance:r,onImportTrades:q,currentDate:ce,monthlyTarget:f,onClearMonthTrades:te}),(0,K.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5,flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:0}},children:[(0,K.jsxs)(s.A,{"data-testid":"month-nav-section",sx:{display:"flex",alignItems:"center",gap:1},children:[(0,K.jsx)(h.A,{onClick:wt,children:(0,K.jsx)(b.A,{})}),(0,K.jsx)(i.A,{variant:"h5",sx:{fontWeight:800,cursor:"pointer",width:"200px",textAlign:"center",fontSize:{xs:"1.3rem",sm:"1.6rem"},letterSpacing:"-0.5px",color:"text.primary","&:hover":{color:"primary.main"}},onClick:Et,children:(0,F.A)(ce,"MMMM yyyy")}),(0,K.jsx)(h.A,{onClick:Ct,children:(0,K.jsx)(j.A,{})})]}),(0,K.jsxs)(o.A,{direction:"row",spacing:1,children:[(0,K.jsx)(c.A,{startIcon:(0,K.jsx)(v.A,{}),onClick:()=>{pe(new Date)},variant:"outlined",size:"small",sx:{minWidth:{xs:"100%",sm:"auto"},display:"flex",alignItems:"center"},children:"Today"}),yt.filter((e=>(0,z.A)(new Date(e.date),ce))).length>0&&(0,K.jsx)(d.A,{title:"View all trades for this month in gallery mode",children:(0,K.jsx)(c.A,{startIcon:(0,K.jsx)(w.A,{}),onClick:()=>{const e=yt.filter((e=>(0,z.A)(new Date(e.date),ce)));if(e.length>0){const t=`${(0,F.A)(ce,"MMMM yyyy")} - Monthly Trades (${e.length} trades)`;Nt(e,e[0].id,t)}},variant:"outlined",size:"small",sx:{minWidth:{xs:"100%",sm:"auto"},display:"flex",alignItems:"center",borderColor:"divider",color:"text.secondary","&:hover":{borderColor:"primary.main",bgcolor:(0,p.X4)(gt.palette.primary.main,.08)}},children:"Gallery View"})}),(0,K.jsx)(c.A,{startIcon:(0,K.jsx)(k.A,{}),onClick:()=>ct(!0),variant:"outlined",size:"small",sx:{minWidth:{xs:"100%",sm:"auto"},display:"flex",alignItems:"center",...Tt>0?{borderColor:"primary.main",color:"primary.main","&:hover":{borderColor:"primary.main",bgcolor:(0,p.X4)(gt.palette.primary.main,.08)}}:{borderColor:"divider",color:"text.secondary","&:hover":{borderColor:"primary.main",bgcolor:(0,p.X4)(gt.palette.primary.main,.08)}}},children:"Pinned Trades"}),(0,K.jsxs)(s.A,{sx:{display:"flex",gap:1},children:[(0,K.jsx)(zt,{allTags:ut,selectedTags:fe,onTagsChange:Lt,onOpenDrawer:()=>Je(!0)}),(0,K.jsx)(d.A,{title:"Manage tags and required tag groups",children:(0,K.jsx)(c.A,{variant:"outlined",size:"small",startIcon:(0,K.jsx)(C.A,{}),onClick:()=>qe(!0),sx:{borderColor:"divider",color:"text.secondary",display:"flex",alignItems:"center","&:hover":{borderColor:"primary.main",bgcolor:(0,p.X4)(gt.palette.primary.main,.08)}},children:"Manage Tags"})})]})]})]}),(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,K.jsx)(s.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(7, 1fr)",sm:"repeat(8, 1fr)"},gap:.5,mb:.5},children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Week"].map(((e,t)=>{var r;const a=t<7&&Q&&Q.has(e)&&""!==(null===(r=Q.get(e))||void 0===r?void 0:r.trim());return(0,K.jsxs)(Ne,{onClick:()=>{t<7&&me(e)},sx:{display:7===t?{xs:"none",sm:"flex"}:"flex",cursor:t<7?"pointer":"default",position:"relative",justifyContent:"center",alignItems:"center","&:hover":t<7?{color:"primary.main",bgcolor:e=>(0,p.X4)(e.palette.primary.main,.08)}:{}},children:[e,a&&(0,K.jsx)(d.A,{title:"This day has notes. Click to view or edit.",placement:"top",arrow:!0,children:(0,K.jsx)(s.A,{sx:{position:"absolute",right:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1rem"},children:(0,K.jsx)(T.A,{fontSize:"inherit"})})})]},e)}))}),(0,K.jsx)(s.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(7, 1fr)",sm:"repeat(8, 1fr)"},gap:1},children:(0,E.A)({start:(0,L.A)(ce),end:(0,$.A)(ce)},{weekStartsOn:0}).map(((e,t)=>{const o=(0,X.A)({start:e,end:(0,D.A)(e,{weekStartsOn:0})});return(0,K.jsxs)(a.Fragment,{children:[o.map((e=>{const t=yt.filter((t=>(0,W.A)(new Date(t.date),e))),a=(0,lt.Kf)(t,r,n,M,yt,e),o=(0,z.A)(e,ce),l=(0,N.A)(e);return(0,K.jsx)(Xe,{children:(0,K.jsxs)(Oe.eR,{onClick:()=>(e=>{if(de)return console.log("Cannot add trade while trades are loading"),void Xt("Cannot add trade while trades are loading. Please wait...","warning");if(!Ke)return Ze(!0),void(le&&le(!0));0==yt.filter((t=>(0,W.A)(new Date(t.date),e))).length?(ve(Pt),Ce({open:!0,date:e,showDayDialogWhenDone:!0})):xe(e)})(e),$isCurrentMonth:o,$dayStatus:a.status,sx:[{backgroundColor:"win"===a.status?(0,p.X4)(gt.palette.success.light,.3):"loss"===a.status?(0,p.X4)(gt.palette.error.light,.3):"breakeven"===a.status?(0,p.X4)(gt.palette.primary.main,.1):gt.palette.background.paper,transition:"all 0.2s ease-in-out",border:`1px solid ${gt.palette.divider}`,boxShadow:`0 1px 2px ${(0,p.X4)(gt.palette.common.black,.05)}`,"&:hover":{borderColor:gt.palette.primary.main,backgroundColor:"win"===a.status?(0,p.X4)(gt.palette.success.light,.25):"loss"===a.status?(0,p.X4)(gt.palette.error.light,.25):(0,p.X4)(gt.palette.primary.light,.1)}},!o&&{opacity:.5,backgroundColor:gt.palette.background.default},l&&{color:gt.palette.primary.main,borderColor:gt.palette.primary.main,borderWidth:2},he&&(0,W.A)(e,he)&&{borderColor:gt.palette.primary.main,borderWidth:2,backgroundColor:(0,p.X4)(gt.palette.primary.light,.1)}],children:[(0,K.jsx)(Oe.kL,{$isCurrentMonth:o,children:(0,F.A)(e,"d")}),t.length>0&&(0,K.jsx)(Oe.Zg,{children:(0,K.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[(0,K.jsx)(Oe.B2,{$dayStatus:a.status,children:(0,O.vv)(Math.abs(a.netAmount))}),(0,K.jsxs)(Oe.uk,{children:[t.length," trade",1!==t.length?"s":""]}),(0,K.jsxs)(i.A,{variant:"caption",sx:{color:"win"===a.status?"success.main":"loss"===a.status?"error.main":"text.secondary",fontSize:"0.75rem",fontWeight:500},children:[a.percentage,"%"]}),a.isDrawdownViolation&&(0,K.jsx)(i.A,{variant:"caption",sx:{color:"error.main",fontSize:"0.75rem",fontWeight:700,textTransform:"uppercase"},children:"VIOLATED"})]})})]})},e.toISOString())})),(0,K.jsx)(Rt,{date:e,trades:yt,monthStart:(0,L.A)(ce),weekIndex:t,currentMonth:ce.getMonth(),accountBalance:r,weeklyTarget:y,sx:{display:{xs:"none",sm:"flex"}}})]},e.toISOString())}))}),(0,K.jsx)(s.A,{sx:{display:{xs:"flex",sm:"none"},flexDirection:"column",gap:1,mt:2},children:(0,E.A)({start:(0,L.A)(ce),end:(0,$.A)(ce)},{weekStartsOn:0}).map(((e,t)=>(0,K.jsx)(Rt,{date:e,trades:yt,monthStart:(0,L.A)(ce),weekIndex:t,currentMonth:ce.getMonth(),accountBalance:r,weeklyTarget:y},e.toISOString())))})]}),(0,K.jsx)(It,{trades:yt,selectedDate:ce,accountBalance:r,maxDailyDrawdown:n,monthlyTarget:f,calendarId:mt,scoreSettings:ee,onUpdateTradeProperty:H,onUpdateCalendarProperty:G,dynamicRiskSettings:M,allTags:ut,onEditTrade:t=>{e.onUpdateTradeProperty&&(ve((()=>(0,ae.fJ)(t))),Ce({open:!0,date:new Date(t.date),editTrade:t,createTempTrade:!1,showDayDialogWhenDone:!1}))},onDeleteTrade:e=>{St(e)},onDeleteMultipleTrades:Mt,onZoomImage:(e,t,r)=>{Le(e,t,r)},onOpenGalleryMode:Nt})]}),(0,K.jsx)(ne,{open:!!he&&!(null!==ke&&void 0!==ke&&ke.open),onClose:()=>{xe(null)},showAddForm:e=>{null!==e&&ve((()=>(0,ae.fJ)(e))),Ce({open:!0,date:he,editTrade:e,createTempTrade:null===e,showDayDialogWhenDone:!0})},date:he||new Date,trades:he?jt:[],onUpdateTradeProperty:H,onDeleteTrade:St,onDeleteMultipleTrades:Mt,calendarId:mt,onDateChange:e=>{xe(e)},setZoomedImage:Le,accountBalance:r,allTrades:t,deletingTradeIds:Re,onOpenGalleryMode:Nt}),(0,K.jsx)(ae.Ay,{open:!(null===ke||void 0===ke||!ke.date)&&(null===ke||void 0===ke?void 0:ke.open)||!1,onClose:()=>{xe(null),Ce(null),null!=je&&je.pendingImages&&(je.pendingImages.forEach((e=>{URL.revokeObjectURL(e.preview)})),ve(null))},onCancel:()=>{null!==ke&&void 0!==ke&&ke.showDayDialogWhenDone&&(xe(null),xe(null===ke||void 0===ke?void 0:ke.date)),Ce(null)},showForm:{open:(null===ke||void 0===ke?void 0:ke.open)||!1,editTrade:(null===ke||void 0===ke?void 0:ke.editTrade)||null,createTempTrade:(null===ke||void 0===ke?void 0:ke.createTempTrade)||!1},date:(null===ke||void 0===ke?void 0:ke.date)||new Date,trades:null!==ke&&void 0!==ke&&ke.date?jt:[],onAddTrade:Ft,onTagUpdated:Y,newMainTrade:je,setNewMainTrade:e=>ve(e(je)),onUpdateTradeProperty:H,calendarId:mt,setZoomedImage:Le,accountBalance:r,onAccountBalanceChange:_,allTrades:t,tags:ut,dynamicRiskSettings:M,requiredTagGroups:I,onOpenGalleryMode:Nt}),ge&&(0,K.jsx)(Ge,{open:!!ge,onClose:()=>{me(null)},notes:Q&&ge&&Q.get(ge)||"",day:ge,calendarId:mt,onUpdateCalendarProperty:G,trades:t,onOpenGalleryMode:Nt}),Te&&(0,K.jsx)(Ue.A,{open:!!Te,onClose:()=>Se(null),imageProp:Te}),(0,K.jsx)(se.A,{open:ue,onClose:()=>ye(!1),onDateSelect:e=>{pe(e),ye(!1)},initialDate:he||void 0,trades:yt,accountBalance:r,monthlyTarget:f,yearlyTarget:A,onOpenGalleryMode:Nt}),(0,K.jsx)(we,{open:_e,onClose:()=>qe(!1),allTags:ut,calendarId:mt,onTagUpdated:Y,requiredTagGroups:I,onUpdateCalendarProperty:G}),(0,K.jsx)(Ae,{open:$e,onClose:()=>He(!1),allTags:ut,calendarId:mt,onTagUpdated:Y,requiredTagGroups:I,onUpdateCalendarProperty:G}),(0,K.jsx)(At.A,{open:Ie,title:1===Me.length?"Delete Trade":`Delete ${Me.length} Trades`,message:1===Me.length?"Are you sure you want to delete this trade? This action cannot be undone.":`Are you sure you want to delete ${Me.length} trades? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",onConfirm:Dt,onCancel:()=>{We(!1),De([]),Fe(null)},confirmColor:"error",isSubmitting:Re.some((e=>Me.includes(e)))}),(0,K.jsx)(g.A,{open:Qe,autoHideDuration:"success"===at?3e3:ze?6e3:4e3,onClose:$t,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,K.jsx)(m.A,{onClose:$t,severity:at,variant:"filled",sx:{width:"100%"},action:ze&&Me.length>0?(0,K.jsx)(c.A,{color:"inherit",size:"small",onClick:()=>{$t(),(async()=>{ze&&Me.length>0&&(Fe(null),await Dt())})()},sx:{color:"inherit"},children:"Retry"}):void 0,children:tt})}),(0,K.jsx)(u.A,{color:"primary","aria-label":"search and filter trades",onClick:()=>Je(!0),sx:{position:"fixed",bottom:24,right:24,zIndex:1200},children:(0,K.jsx)(S.A,{})}),(0,K.jsx)(Ee,{open:Ve,onClose:()=>Je(!1),trades:t,allTags:ut,selectedTags:fe,onTagsChange:Lt,onTradeClick:e=>{Je(!1),Nt(t,e.id,"Search Results")}}),(0,K.jsx)(bt,{open:it,onClose:()=>ct(!1),trades:t,onTradeClick:e=>{ct(!1);const r=t.filter((e=>e.isPinned));Nt(r,e.id,"Pinned Trades")}}),(0,K.jsx)(kt,{open:ht.open,onClose:()=>{xt({open:!1,trades:[],initialTradeId:void 0,title:void 0})},trades:ht.trades,initialTradeId:ht.initialTradeId,onUpdateTradeProperty:H,setZoomedImage:Le,title:ht.title,calendarId:mt,onOpenGalleryMode:Nt})]})]})},Et=Ft},81319:(e,t,r)=>{r.d(t,{A1:()=>_.A,TQ:()=>H,p:()=>G.A});var a=r(65043),n=r(60267),s=r(99565),o=r(24343),i=r(53969),l=r(55895),d=r(10256),c=r(43971),p=r(46261),h=r(1725),x=r(68826),g=r(38865),m=r(3353),u=r(67203),y=r(47471),f=r(29651),A=r(83759),b=r(68545),j=r(64924),v=r(12097),w=r(26529),k=r(42579),C=r(93468),T=r(43900),S=r(14540),M=r(80172),D=r(83290),I=r(5362),W=r(70579);const R=e=>{let{image:t,theme:r}=e;const a=D.i7`
    0% {
      background-position: -200% 0;
    }
    100% {
      background-position: 200% 0;
    }
  `;return(0,W.jsx)(i.A,{sx:{width:"100%",height:"auto",maxHeight:300,overflow:"hidden",position:"relative",...t.width&&t.height?{paddingTop:t.height/t.width*100+"%"}:{}},children:(0,W.jsx)(i.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:()=>{const e="dark"===r.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.04)";return`linear-gradient(90deg, ${e} 25%, ${"dark"===r.palette.mode?"rgba(255, 255, 255, 0.15)":"rgba(0, 0, 0, 0.1)"} 50%, ${e} 75%)`},backgroundSize:"200% 100%",animation:`${a} 1.5s infinite linear`,willChange:"background-position",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[(0,W.jsx)(M.A,{size:24,color:"primary"}),(0,W.jsx)(l.A,{variant:"caption",sx:{color:"text.secondary",fontWeight:500},children:"Uploading..."})]})})})},P=e=>{let{pendingImages:t,uploadedImages:r,editingTrade:s,onImageCaptionChange:d,onImageRemove:c,onImagesReordered:p}=e;const h=(0,n.A)(),[x,g]=(0,a.useState)([]),[m,u]=(0,a.useState)(null),[y,A]=(0,a.useState)(null),[b,j]=(0,a.useState)(null),[v,w]=(0,a.useState)(null),C=(0,a.useRef)(null),T=(0,a.useRef)(null);(0,a.useEffect)((()=>{const e=((e,t)=>{console.log("Input to organizeImagesIntoRows:","Pending:",e.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth}))),"Uploaded:",t.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth}))));const r=[...e.map(((e,t)=>{var r;const a={...e,id:null!==(r=e.id)&&void 0!==r?r:`pending-${t}`,isPending:!0,row:void 0!==e.row?e.row:void 0,column:void 0!==e.column?e.column:void 0,columnWidth:void 0!==e.columnWidth?e.columnWidth:void 0};return console.log(`Processed pending image ${t}:`,a.id,a.row,a.column,a.columnWidth),a})),...t.map(((e,t)=>{var r;const a={...e,id:null!==(r=e.id)&&void 0!==r?r:`uploaded-${t}`,isPending:!1,row:void 0!==e.row?e.row:void 0,column:void 0!==e.column?e.column:void 0,columnWidth:void 0!==e.columnWidth?e.columnWidth:void 0};return console.log(`Processed uploaded image ${t}:`,a.id,a.row,a.column,a.columnWidth),a}))],a={};let n=-1;r.forEach((e=>{void 0!==e.row&&(a[e.row]||(a[e.row]=[]),a[e.row].push(e),n=Math.max(n,e.row))}));let s=n+1;r.filter((e=>void 0===e.row)).forEach(((e,t)=>{const r=s+t;e.row=r,e.column=0,e.columnWidth=100,a[e.row]||(a[e.row]=[]),a[e.row].push(e)}));const o=Object.entries(a).sort(((e,t)=>{let[r]=e,[a]=t;return Number(r)-Number(a)})).map((e=>{let[t,r]=e;return console.log(`Processing row ${t} with ${r.length} images`),r}));o.forEach(((e,t)=>{e.forEach((e=>e.row=t)),e.sort(((e,t)=>{var r,a;return(null!==(r=e.column)&&void 0!==r?r:1/0)-(null!==(a=t.column)&&void 0!==a?a:1/0)}));let r=0,a=0;if(e.forEach(((e,t)=>{e.column=t,void 0===e.columnWidth?a++:r+=e.columnWidth})),a>0){const t=Math.max(0,100-r)/a;e.forEach((e=>{void 0===e.columnWidth&&(e.columnWidth=t)}))}else if(e.length>0&&Math.abs(r-100)>.1){const t=100/r;e.forEach((e=>{var r;e.columnWidth=(null!==(r=e.columnWidth)&&void 0!==r?r:0)*t}))}else if(e.length>0&&0===r){const t=100/e.length;e.forEach((e=>{e.columnWidth=t}))}}));const i=o.filter((e=>e&&e.length>0));return console.log("Final organized rows:",i.map(((e,t)=>`Row ${t}: `+e.map((e=>`(id: ${e.id}, col: ${e.column}, width: ${e.columnWidth}%)`)).join(", ")))),i})(t,r);console.log("Organizing images with layout info:",t.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth}))),r.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth})))),g(e)}),[t,r]);const S=e=>"isPending"in e?!!e.isPending:"file"in e,D=()=>t.some((e=>void 0!==e.uploadProgress&&e.uploadProgress>=0&&e.uploadProgress<100)),P=(e,t,r)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",m&&(A(t),j(null!==r&&void 0!==r?r:0))},z=(e,a,n)=>{var s;if(e.preventDefault(),e.stopPropagation(),!m)return;const o=JSON.parse(e.dataTransfer.getData("text/plain")),i=o.sourceRowIndex,l=o.sourceColumnIndex,d=o.id,c=o.isPending;let h,u;if(u=(c?t:r).findIndex((e=>e.id===d)),-1===u)return console.error("Could not find dragged image in original collection!"),void E();if(h=null===(s=x[i])||void 0===s?void 0:s[l],!h){console.error("Inconsistency: Dragged image not found in current rows state at source index");const e=x.flat();if(h=e.find((e=>e.id===d&&S(e)===c)),!h)return console.error("Could not find dragged image anywhere!"),void E();console.warn("Found image via fallback, drag/drop might be slightly off.")}let y=x.map((e=>[...e])),f=-1,A=-1;for(let t=0;t<y.length;t++){const e=y[t].findIndex((e=>e.id===h.id&&S(e)===S(h)));if(-1!==e){f=t,A=e;break}}if(-1===f)return console.error("Cannot find image to remove during drop!"),void E();y[f].splice(A,1);let b=a,j=null!==n&&void 0!==n?n:0;for(a===y.filter((e=>e.length>0)).length&&null===n?(b=y.length,j=0):null===n&&(j=0);y.length<=b;)y.push([]);if(y[b].splice(j,0,h),y=y.filter((e=>e.length>0)),y.forEach(((e,t)=>{const r=100/e.length;e.forEach(((a,n)=>{var s;if(a.row=t,a.column=n,a.id===h.id||1===e.length||f!==t)a.columnWidth=r;else if(t===b&&e.length>1)a.columnWidth=r;else if(t===f&&(null===(s=y[t])||void 0===s?void 0:s.length)>0){const e=100/y[t].length;a.columnWidth=e}(void 0===a.columnWidth||null===a.columnWidth||isNaN(a.columnWidth)||a.columnWidth<=0)&&(a.columnWidth=100/e.length)}));const a=e.reduce(((e,t)=>e+(t.columnWidth||0)),0);if(a>0&&Math.abs(a-100)>.1){const t=100/a;e.forEach((e=>e.columnWidth=(e.columnWidth||0)*t))}else if(0===a&&e.length>0){const t=100/e.length;e.forEach((e=>e.columnWidth=t))}})),g(y),p){const e=y.flat();p(e)}E()},F=()=>{T.current&&document.body.contains(T.current)&&document.body.removeChild(T.current),T.current=null},E=()=>{u(null),A(null),j(null),F()},L=(0,a.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e||0===e.length)return e;const r=e.reduce(((e,t)=>e+(t.columnWidth||0)),0);if(Math.abs(r-100)<.1)return e;if(0===r){const t=100/e.length;return e.forEach((e=>e.columnWidth=t)),e}const a=100/r;e.forEach((e=>{e.columnWidth=(e.columnWidth||0)*a,e.columnWidth=Math.max(t,e.columnWidth)}));const n=e.reduce(((e,t)=>e+(t.columnWidth||0)),0);if(Math.abs(n-100)>.1){const t=e.reduce(((e,t,r,a)=>(t.columnWidth||0)>(a[e].columnWidth||0)?r:e),0);e[t].columnWidth=(e[t].columnWidth||0)-(n-100)}return e}),[]),$=(0,a.useCallback)((e=>{if(!v)return;const{rowIndex:t,dividerIndex:r,startX:a,rowElementWidth:n,initialWidths:s}=v,o=(e.clientX-a)/n*100,i=[...x.map((e=>[...e.map((e=>({...e})))]))],l=i[t];let d=0;for(let x=0;x<=r;x++)d+=s[x];let c=0;for(let x=r+1;x<s.length;x++)c+=s[x];let p=d+o,h=c-o;const m=r+1,u=s.length-m,y=10*m,f=10*u;p=Math.max(y,p),h=Math.max(f,h);const A=p+h;if(Math.abs(A-100)>.1){const e=100/A;p*=e,h*=e,p=Math.max(y,p),h=Math.max(f,h),p===y?h=100-p:h===f&&(p=100-h)}for(let x=0;x<=r;x++){let e=0;if(d>0){e=p*(s[x]/d)}else e=p/m;l[x].columnWidth=Math.max(10,e)}for(let x=r+1;x<l.length;x++){let e=0;if(c>0){e=h*(s[x]/c)}else e=h/u;l[x].columnWidth=Math.max(10,e)}L(l),g(i)}),[v,x,L]),X=(0,a.useCallback)((()=>{if(v){if(p){const e=v.rowIndex;if(x[e]){const e=x.flat();p(e)}}w(null)}}),[v,x,p]);return(0,a.useEffect)((()=>(v?(window.addEventListener("mousemove",$),window.addEventListener("mouseup",X),document.body.style.cursor="col-resize"):(window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",X),document.body.style.cursor=""),()=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",X),document.body.style.cursor=""})),[v,$,X]),(0,W.jsxs)(i.A,{sx:{width:"100%"},ref:C,children:[x.map(((e,n)=>(0,W.jsx)(i.A,{className:"image-row-container",sx:{display:"flex",width:"100%",marginBottom:3,position:"relative",gap:1},onDragOver:e=>P(e,n,0),children:e.map(((p,g)=>{const A=S(p),j=A?p:null,C=A?null:p,L=A?j.id:C.id,$=g===e.length-1;return(0,W.jsxs)(a.Fragment,{children:[(0,W.jsxs)(i.A,{sx:{position:"relative",width:`${p.columnWidth||100}%`,height:"auto",borderRadius:1,overflow:"visible",display:"flex",flexDirection:"column",opacity:m===p?.5:1,backgroundColor:"transparent",transition:"border-color 0.2s, background-color 0.2s, opacity 0.2s, box-shadow 0.2s",...m&&y===n&&b===g&&{backgroundColor:(0,f.X4)(h.palette.primary.main,.1)},"&:hover .resize-handle":{opacity:D()?.2:1},cursor:D()?"not-allowed":"grab",filter:D()?"grayscale(0.2)":"none"},draggable:!D(),onDragStart:e=>((e,t,r,a)=>{if(v||D())return void e.preventDefault();u(t),e.dataTransfer.setData("text/plain",JSON.stringify({id:t.id,isPending:S(t),sourceRowIndex:r,sourceColumnIndex:a})),e.dataTransfer.effectAllowed="move";const n=e.currentTarget,s=n.getBoundingClientRect(),o=e.clientX-s.left,i=e.clientY-s.top,l=n.cloneNode(!0);l.style.width=`${s.width}px`,l.style.height=`${s.height}px`,l.style.opacity="0.7",l.style.position="absolute",l.style.top="-1000px",l.style.left="-1000px",l.style.pointerEvents="none",l.style.zIndex="1000",T.current=l,document.body.appendChild(l),e.dataTransfer.setDragImage(l,o,i),setTimeout((()=>{F()}),100)})(e,p,n,g),onDragOver:e=>P(e,n,g),onDrop:e=>z(e,n,g),onDragEnd:E,children:[(0,W.jsxs)(i.A,{sx:{overflow:"hidden",borderRadius:"4px 4px 0 0"},children:[" ",A?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(i.A,{sx:{width:"100%",height:"auto",maxHeight:e.length>1?300:"none",overflow:"hidden",position:"relative",backgroundColor:(0,f.X4)(h.palette.divider,.1),aspectRatio:null!==j&&void 0!==j&&j.width&&null!==j&&void 0!==j&&j.height?`${j.width}/${j.height}`:"16/9"},children:[void 0!==(null===j||void 0===j?void 0:j.uploadProgress)&&j.uploadProgress>=0&&j.uploadProgress<100&&(0,W.jsx)(i.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:2},children:(0,W.jsxs)(i.A,{sx:{position:"relative",display:"inline-flex"},children:[(0,W.jsx)(M.A,{variant:0===j.uploadProgress?"indeterminate":"determinate",value:j.uploadProgress,size:80,sx:{color:"white"}}),(0,W.jsx)(i.A,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,W.jsx)(l.A,{variant:"caption",component:"div",sx:{color:"white",fontSize:`${0===j.uploadProgress?"0.55rem":void 0}`,fontWeight:"bold"},children:0===j.uploadProgress?"Preparing...":`${Math.round(j.uploadProgress)}%`})})]})}),(0,W.jsx)("img",{src:null===j||void 0===j?void 0:j.preview,alt:"Pending Upload",style:{display:"block",width:"100%",height:"100%",objectFit:"contain"}}),(!(null!==j&&void 0!==j&&j.uploadProgress)||100===j.uploadProgress||-1===j.uploadProgress)&&(0,W.jsx)(k.A,{size:"small",onClick:()=>c(t.findIndex((e=>e.id===p.id)),!0),sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",zIndex:10,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:(0,W.jsx)(I.A,{fontSize:"small"})})]}),(0,W.jsx)(o.A,{placeholder:"Add a caption...",value:(null===j||void 0===j?void 0:j.caption)||"",onChange:e=>d(t.findIndex((e=>e.id===p.id)),e.target.value,!0),variant:"standard",multiline:!0,minRows:1,maxRows:20,fullWidth:!0,disabled:void 0!==(null===j||void 0===j?void 0:j.uploadProgress)&&j.uploadProgress>=0&&j.uploadProgress<100,sx:{px:1,py:.5,backgroundColor:h.palette.background.paper,fontSize:"0.75rem","& .MuiInput-underline:before":{borderBottomColor:"transparent"},"& .MuiInput-underline:after":{borderBottomColor:"transparent"},"& .MuiInput-underline:hover:not(.Mui-disabled):before":{borderBottomColor:"transparent"},"& .MuiInputBase-input":{fontSize:"0.75rem"},"& .MuiInputBase-root":{overflow:"visible"},"&.Mui-disabled":{opacity:.7,"& .MuiInputBase-input":{color:"text.disabled"}}}})]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(i.A,{sx:{width:"100%",height:"auto",maxHeight:e.length>1?300:"none",overflow:"hidden",position:"relative",backgroundColor:(0,f.X4)(h.palette.divider,.1),aspectRatio:null!==C&&void 0!==C&&C.width&&null!==C&&void 0!==C&&C.height?`${C.width}/${C.height}`:"16/9"},children:[s&&null!==C&&void 0!==C&&C.pending?(0,W.jsx)(R,{image:C,theme:h}):(0,W.jsx)("img",{src:null===C||void 0===C?void 0:C.url,alt:(null===C||void 0===C?void 0:C.caption)||"Uploaded image",style:{display:"block",width:"100%",height:"100%",objectFit:"contain",position:"relative",zIndex:1}}),(0,W.jsx)(k.A,{size:"small",onClick:()=>c(r.findIndex((e=>e.id===p.id)),!1),sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",zIndex:10,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:(0,W.jsx)(I.A,{fontSize:"small"})})]}),(0,W.jsx)(o.A,{placeholder:"Add a caption...",value:(null===C||void 0===C?void 0:C.caption)||"",onChange:e=>d(r.findIndex((e=>e.id===p.id)),e.target.value,!1),variant:"standard",multiline:!0,minRows:1,maxRows:20,fullWidth:!0,disabled:D()||!0===(null===C||void 0===C?void 0:C.pending),sx:{px:1,py:.5,backgroundColor:h.palette.background.paper,fontSize:"0.75rem","& .MuiInput-underline:before":{borderBottomColor:"transparent"},"& .MuiInput-underline:after":{borderBottomColor:"transparent"},"& .MuiInput-underline:hover:not(.Mui-disabled):before":{borderBottomColor:"transparent"},"& .MuiInputBase-input":{fontSize:"0.75rem"},"& .MuiInputBase-root":{overflow:"visible"},"&.Mui-disabled":{opacity:.7,"& .MuiInputBase-input":{color:"text.disabled"}}}})]})]})," "]},`image-${L}-${n}-${g}`),!$&&e.length>1&&(0,W.jsx)(i.A,{className:"resize-handle",sx:{width:"8px",position:"relative",cursor:D()?"not-allowed":"col-resize",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,zIndex:10,"&::before":{content:'""',position:"absolute",top:"5%",bottom:"5%",left:"3px",width:"2px",backgroundColor:v&&v.rowIndex===n&&v.dividerIndex===g?h.palette.primary.main:D()?(0,f.X4)(h.palette.divider,.4):(0,f.X4)(h.palette.divider,.8),opacity:v&&v.rowIndex===n&&v.dividerIndex===g?1:0,transition:"opacity 0.2s, background-color 0.2s, width 0.2s"},"&:hover::before":{opacity:D()?.3:1,width:D()?"2px":"3px",backgroundColor:D()?(0,f.X4)(h.palette.divider,.4):h.palette.primary.light},...v&&v.rowIndex===n&&v.dividerIndex===g&&{"&::before":{opacity:1,width:"3px",backgroundColor:h.palette.primary.main}}},onMouseDown:e=>((e,t,r)=>{if(e.preventDefault(),e.stopPropagation(),D())return;const a=e.target.closest(".image-row-container");if(!a)return;const n=a.getBoundingClientRect().width;n<=0||w({rowIndex:t,dividerIndex:r,startX:e.clientX,rowElementWidth:n,initialWidths:x[t].map((e=>e.columnWidth||0))})})(e,n,g)})]},`image-frag-${L}-${n}-${g}`)}))},`row-${n}`))),m&&!D()&&(0,W.jsx)(i.A,{sx:{width:"100%",height:80,border:`2px dashed ${y===x.length&&0===b?h.palette.primary.main:(0,f.X4)(h.palette.divider,.5)}`,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:y===x.length&&0===b?(0,f.X4)(h.palette.primary.main,.1):"transparent",color:h.palette.text.secondary,transition:"all 0.2s ease-in-out",marginBottom:2,position:"relative",...y===x.length&&0===b&&{backgroundColor:(0,f.X4)(h.palette.primary.main,.1),border:`2px solid ${h.palette.primary.main}`,"&::after":{content:'"New Row"',position:"absolute",top:"-10px",right:"10px",backgroundColor:h.palette.primary.main,color:h.palette.primary.contrastText,padding:"2px 8px",borderRadius:"4px",fontSize:"0.7rem",fontWeight:"bold",zIndex:10,boxShadow:`0 2px 4px ${(0,f.X4)(h.palette.common.black,.2)}`}}},onDragOver:e=>P(e,x.length,0),onDragLeave:()=>{},onDrop:e=>z(e,x.length,null),children:"Drop here to create a new row"})]})},z=e=>{let{pendingImages:t,uploadedImages:r,editingTrade:n,onImageUpload:s,onImageCaptionChange:o,onImageRemove:d,onImagesReordered:c}=e;const p=(0,a.useRef)(null),h=()=>t.some((e=>void 0!==e.uploadProgress&&e.uploadProgress>=0&&e.uploadProgress<100)),x=e=>{var t;const r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;const a=[];for(let n=0;n<r.length;n++){const e=r[n];if(-1!==e.type.indexOf("image")){const t=e.getAsFile();t&&a.push(t)}}if(a.length>0){const e=new DataTransfer;a.forEach((t=>e.items.add(t))),s(e.files)}};return(0,a.useEffect)((()=>(document.addEventListener("paste",x),()=>{document.removeEventListener("paste",x)})),[s]),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(l.A,{variant:"subtitle1",sx:{mb:1},children:"Images"}),(0,W.jsx)("input",{type:"file",accept:"image/*",multiple:!0,ref:p,style:{display:"none"},onChange:e=>{e.target.files&&e.target.files.length>0&&(s(e.target.files),e.target.value="")}}),(0,W.jsxs)(i.A,{sx:{mb:2},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,W.jsx)(v.A,{variant:"outlined",startIcon:(0,W.jsx)(C.A,{}),onClick:()=>{var e;null===(e=p.current)||void 0===e||e.click()},children:"Add Images"}),(0,W.jsx)(i.A,{sx:{flex:1}}),"  ",(0,W.jsx)(w.A,{title:"Arrange images vertically (one per row)",children:(0,W.jsxs)("span",{children:[" ",(0,W.jsx)(k.A,{onClick:()=>{if(!c||h())return;const e=[...[...t,...r]].sort(((e,t)=>{var r,a,n,s;const o=null!==(r=e.row)&&void 0!==r?r:0,i=null!==(a=t.row)&&void 0!==a?a:0,l=null!==(n=e.column)&&void 0!==n?n:0,d=null!==(s=t.column)&&void 0!==s?s:0;return o===i?l-d:o-i})).map(((e,t)=>({...e,row:t,column:0,columnWidth:100}))),a=e.filter((e=>"file"in e)),n=e.filter((e=>!("file"in e)));c([...a,...n])},color:"default",disabled:t.length+r.length<2||h(),children:(0,W.jsx)(T.A,{})})]})}),(0,W.jsx)(w.A,{title:"Arrange images in a grid (max 3 columns)",children:(0,W.jsxs)("span",{children:[" ",(0,W.jsx)(k.A,{onClick:()=>{if(!c||h())return;const e=[...[...t,...r]].sort(((e,t)=>{var r,a,n,s;const o=null!==(r=e.row)&&void 0!==r?r:0,i=null!==(a=t.row)&&void 0!==a?a:0,l=null!==(n=e.column)&&void 0!==n?n:0,d=null!==(s=t.column)&&void 0!==s?s:0;return o===i?l-d:o-i})),a=100/3,n=e.map(((e,t)=>({...e,row:Math.floor(t/3),column:t%3,columnWidth:a}))),s=n.filter((e=>"file"in e)),o=n.filter((e=>!("file"in e)));c([...s,...o])},color:"default",disabled:t.length+r.length<2||h(),children:(0,W.jsx)(S.A,{})})]})})]}),(0,W.jsx)(l.A,{variant:"caption",color:"text.secondary",display:"block",children:"You can also paste images directly (Ctrl+V)"})]}),(t.length>0||r.length>0)&&(0,W.jsx)(P,{pendingImages:t,uploadedImages:r,editingTrade:n,onImageCaptionChange:o,onImageRemove:d,onImagesReordered:c})]})};var F=r(23893),E=r(70916),L=r(91449),$=r(81084),X=r(68165),N=r(46577);const O=e=>{let{tags:t,allTags:r,onTagsChange:l,calendarId:d,onTagUpdated:c}=e;const p=(0,n.A)(),[h,x]=(0,a.useState)(null),[g,m]=(0,a.useState)(!1);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(s.A,{multiple:!0,freeSolo:!0,options:r,value:t,onChange:(e,t)=>{const r=[];let a=!1;t.forEach((e=>{(e.match(/:/g)||[]).length<=1?r.push(e):a=!0})),a&&m(!0),l(e,r)},slotProps:{listbox:{sx:{...(0,N.J)(p)}}},renderTags:(e,t)=>e.map(((e,r)=>(0,W.jsx)(A.A,{label:(0,$.t)(e,!1),...t({index:r}),sx:(0,$.dO)(e,p),title:(0,$.dn)(e)?`Group: ${(0,$.Oo)(e)}`:void 0}))),renderOption:(e,t)=>(0,W.jsx)("li",{...e,children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,$.dn)(t)&&(0,W.jsx)(A.A,{label:(0,$.Oo)(t),size:"small",sx:{...(0,$.dO)(t,p),height:"18px",fontSize:"0.7rem"}}),(0,$.t)(t,!0)]}),(0,W.jsx)(w.A,{title:"Edit this tag across all trades",children:(0,W.jsx)(v.A,{size:"small",onClick:e=>{e.stopPropagation(),x(t)},sx:{color:p.palette.text.secondary,"&:hover":{color:p.palette.primary.main}},children:"Edit"})})]})}),renderInput:e=>(0,W.jsx)(o.A,{...e,label:"Tags",placeholder:"Add tags",slotProps:{htmlInput:{...e.inputProps,id:"trade-tags-input"}}})}),h&&(0,W.jsx)(X.A,{open:!!h,onClose:()=>x(null),tag:h,calendarId:d,onSuccess:(e,t,r)=>{c&&c(e,t)}}),(0,W.jsx)(E.A,{open:g,autoHideDuration:4e3,onClose:()=>m(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,W.jsx)(L.A,{onClose:()=>m(!1),severity:"warning",sx:{width:"100%"},children:"Tags can only contain one colon (:) for category formatting. Invalid tags were removed."})})]})};var B=r(46153);const U=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;if(!e||0===e.length)return[];const a=e.map((e=>e.name)).filter((e=>Boolean(e&&e.trim()))).map((e=>e.trim())).filter((e=>"New Trade"!==e)).filter(((e,t,r)=>r.indexOf(e)===t));if(!t.trim()){const e=new Map;return a.forEach((t=>{e.set(t,(e.get(t)||0)+1)})),Array.from(e.entries()).sort(((e,t)=>t[1]-e[1])).map((e=>{let[t]=e;return t})).slice(0,r)}const n=t.toLowerCase(),s=a.filter((e=>e.toLowerCase().includes(n)));return[...s.filter((e=>e.toLowerCase()===n)),...s.filter((e=>e.toLowerCase().startsWith(n)&&e.toLowerCase()!==n)),...s.filter((e=>e.toLowerCase().includes(n)&&!e.toLowerCase().startsWith(n)))].slice(0,r)},Y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=["EURUSD Long","EURUSD Short","GBPUSD Long","GBPUSD Short","USDJPY Long","USDJPY Short","AUDUSD Long","AUDUSD Short","USDCAD Long","USDCAD Short","NZDUSD Long","NZDUSD Short","EURJPY Long","EURJPY Short","GBPJPY Long","GBPJPY Short","Breakout Trade","Reversal Trade","Trend Following","Support Bounce","Resistance Rejection","News Trade","Scalp Trade","Swing Trade","Range Trade","Momentum Trade"];if(!e.trim())return t.slice(0,5);const r=e.toLowerCase();return t.filter((e=>e.toLowerCase().includes(r))).slice(0,5)},H=e=>{let{newTrade:t,editingTrade:r,allTags:v,allTrades:w=[],isSubmitting:k,accountBalance:C,dynamicRiskSettings:T,calculateAmountFromRiskToReward:S,calculateCumulativePnl:M,calendarId:D,requiredTagGroups:I=[],onTagUpdated:R,onNameChange:P,onAmountChange:E,onTypeChange:L,onEntryChange:X,onExitChange:N,onRiskToRewardChange:H,onPartialsTakenChange:G,onSessionChange:_,onNotesChange:q,onTagsChange:V,onDateChange:J,onImageUpload:K,onImageCaptionChange:Z,onImageRemove:Q,onImagesReordered:ee,onSubmit:te,trades:re,onOpenGalleryMode:ae}=e;const ne=(0,n.A)(),se=(0,a.useMemo)((()=>{if(!I||0===I.length)return[];const e=new Set;return t.tags.forEach((t=>{if((0,$.dn)(t)){const r=(0,$.Oo)(t);e.add(r)}})),I.filter((t=>!e.has(t)))}),[I,t.tags]),oe=M(t),ie=(0,a.useMemo)((()=>{if(!w||0===w.length)return Y(t.name);const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;if(!e||0===e.length)return U(e,a,n);const s=e.filter((e=>{if(!e.name||""===e.name.trim()||"New Trade"===e.name)return!1;const a=t.length>0&&e.tags&&e.tags.some((e=>t.includes(e))),n=r&&e.session===r;return a||n}));if(s.length>0){const t=U(s,a,Math.ceil(.7*n)),r=n-t.length;if(r>0){const n=U(e,a,r).filter((e=>!t.includes(e)));return[...t,...n]}return t}return U(e,a,n)}(w,t.tags,t.session||void 0,t.name,8);if(e.length<5){const r=Y(t.name).filter((t=>!e.includes(t)));return[...e,...r].slice(0,8)}return e}),[w,t.name,t.tags,t.session]);return(0,W.jsxs)("form",{onSubmit:te,children:[(0,W.jsx)(j.zB,{children:(0,W.jsx)(s.A,{freeSolo:!0,options:ie,value:t.name,onInputChange:(e,t)=>{P({target:{value:t||""}})},renderInput:e=>(0,W.jsx)(o.A,{...e,label:"Trade Name",placeholder:"Enter a name for this trade",fullWidth:!0}),renderOption:(e,t)=>(0,W.jsx)(i.A,{component:"li",...e,children:(0,W.jsx)(l.A,{variant:"body2",children:t})}),sx:{"& .MuiAutocomplete-option":{fontSize:"0.875rem"}}})}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:2,width:"100%"},children:[(0,W.jsx)(j.zB,{sx:{flex:1},children:(0,W.jsx)(o.A,{label:"Entry Price",value:t.entry,onChange:X,fullWidth:!0,placeholder:"Optional entry price"})}),(0,W.jsx)(j.zB,{sx:{flex:1},children:(0,W.jsx)(o.A,{label:"Exit Price",value:t.exit,onChange:N,fullWidth:!0,placeholder:"Optional exit price"})})]}),r&&J&&(0,W.jsx)(j.zB,{children:(0,W.jsx)(b.l,{label:"Trade Date",value:t.date,onChange:J,slotProps:{textField:{fullWidth:!0,helperText:"Change the date of this trade"}}})}),(0,W.jsxs)(d.A,{component:"fieldset",sx:{mb:2},children:[(0,W.jsx)(c.A,{component:"legend",children:"Trade Type"}),(0,W.jsxs)(p.A,{row:!0,name:"type",value:t.type,onChange:L,children:[(0,W.jsx)(h.A,{value:"win",control:(0,W.jsx)(x.A,{}),label:"Win"}),(0,W.jsx)(h.A,{value:"loss",control:(0,W.jsx)(x.A,{}),label:"Loss"}),(0,W.jsx)(h.A,{value:"breakeven",control:(0,W.jsx)(x.A,{}),label:"Breakeven"})]})]}),!T.riskPerTrade||T.riskPerTrade&&t.partialsTaken?(0,W.jsx)(j.zB,{children:(0,W.jsx)(o.A,{label:"Amount",type:"number",value:t.amount,onChange:e=>E(e.target.value),fullWidth:!0,required:!0,helperText:T.riskPerTrade&&t.partialsTaken?"Manual entry for partial profits":void 0})}):(0,W.jsx)(j.zB,{children:(0,W.jsx)(o.A,{label:"Amount (Calculated from Risk)",type:"number",value:(()=>{if(!T.riskPerTrade||!t.riskToReward)return"";const e=parseFloat(t.riskToReward);if(isNaN(e))return"";const r=S(e,oe);return!t.partialsTaken&&r>0&&setTimeout((()=>E(r.toString())),0),r.toString()})(),sx:{"& .MuiInputBase-input":{pointerEvents:"none"}},fullWidth:!0,disabled:!0,helperText:null!==T&&void 0!==T&&T.dynamicRiskEnabled&&T.increasedRiskPercentage&&T.profitThresholdPercentage&&oe/C*100>=T.profitThresholdPercentage?`Based on ${T.increasedRiskPercentage}% of account balance (INCREASED from ${T.riskPerTrade}%)`:`Based on ${T.riskPerTrade}% of account balance (${(0,F.vv)(C*(T.riskPerTrade||0)/100)})`})}),void 0!==T.riskPerTrade&&(0,W.jsx)(j.zB,{children:(0,W.jsx)(h.A,{control:(0,W.jsx)(g.A,{checked:t.partialsTaken,onChange:G}),label:(0,W.jsx)(l.A,{variant:"body2",children:"Partials taken (allows manual amount entry)"})})}),(0,W.jsx)(j.zB,{children:(0,W.jsx)(o.A,{label:"Risk to Reward",value:t.riskToReward,onChange:e=>{const r=e.target.value;if((""===r||/^\d*\.?\d*$/.test(r))&&(H(r),T.riskPerTrade&&r&&!t.partialsTaken)){const e=parseFloat(r);if(!isNaN(e)){const t=S(e,oe);E(t.toString())}}},fullWidth:!0,type:"number",sx:{"& input":{min:0,step:.1}}})}),(0,W.jsx)(j.zB,{children:(0,W.jsxs)(d.A,{fullWidth:!0,children:[(0,W.jsx)(m.A,{id:"session-label",children:"Session"}),(0,W.jsxs)(u.A,{labelId:"session-label",value:t.session,onChange:_,label:"Session",children:[(0,W.jsx)(y.A,{value:"",children:"None"}),(0,W.jsx)(y.A,{value:"Asia",children:"Asia"}),(0,W.jsx)(y.A,{value:"London",children:"London"}),(0,W.jsx)(y.A,{value:"NY AM",children:"NY AM"}),(0,W.jsx)(y.A,{value:"NY PM",children:"NY PM"})]})]})}),(0,W.jsxs)(j.zB,{children:[se.length>0&&(0,W.jsxs)(i.A,{sx:{mb:2,p:2,borderRadius:1,bgcolor:(0,f.X4)(ne.palette.warning.main,.1),border:`1px solid ${(0,f.X4)(ne.palette.warning.main,.3)}`},children:[(0,W.jsx)(l.A,{variant:"body2",color:"warning.main",sx:{fontWeight:600,mb:1},children:"Required Tag Groups"}),(0,W.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"Please add at least one tag from each required group:"}),(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:se.map((e=>(0,W.jsx)(A.A,{label:e,size:"small",color:"warning",variant:"outlined",sx:{fontWeight:500,"& .MuiChip-label":{fontSize:"0.75rem"}}},e)))})]}),(0,W.jsx)(O,{tags:t.tags,allTags:v,onTagsChange:V,calendarId:D,onTagUpdated:R}),(0,W.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:'Pro tip: Categorize tags using the format "Category:Tag" (e.g., "Strategy:Breakout", "Setup:Double Top"). Categorized tags are grouped together in charts, making it easier to filter and analyze your trading patterns and identify which strategies and setups are most profitable. Note: Only one colon (:) is allowed per tag.'})]}),(0,W.jsx)(z,{pendingImages:t.pendingImages,uploadedImages:t.uploadedImages,editingTrade:null!==r,onImageUpload:K,onImageCaptionChange:Z,onImageRemove:Q,onImagesReordered:ee}),(0,W.jsx)(j.zB,{children:(0,W.jsx)(B.A,{label:"Notes",value:t.notes,onChange:q,placeholder:"Add notes for this trade...",minHeight:150,maxHeight:400,maxLength:1024,calendarId:D,trades:re,onOpenGalleryMode:ae})}),(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2,gap:1},children:(0,W.jsx)("button",{type:"submit",style:{display:"none"},disabled:k})})]})};var G=r(24915),_=r(90668)},90668:(e,t,r)=>{r.d(t,{A:()=>p});r(65043);var a=r(60267),n=r(53969),s=r(42579),o=r(55895),i=r(15483),l=r(66370),d=r(29651),c=r(70579);const p=e=>{let{accountBalance:t,formInputVisible:r,totalPnL:p,title:h,onPrevDay:x,onNextDay:g}=e;const m=(0,a.A)();return(0,c.jsxs)(n.A,{sx:{mb:3},children:[(0,c.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[!r&&(0,c.jsx)(s.A,{onClick:x,size:"small",children:(0,c.jsx)(i.A,{})}),h&&(0,c.jsx)(o.A,{variant:"h6",sx:{fontWeight:600},children:h}),!r&&(0,c.jsx)(s.A,{onClick:g,size:"small",children:(0,c.jsx)(l.A,{})})]}),(0,c.jsxs)(n.A,{sx:{display:"flex",gap:2},children:[(0,c.jsxs)(n.A,{sx:{flex:1,p:2,borderRadius:1,bgcolor:p>=0?(0,d.X4)(m.palette.success.main,.1):(0,d.X4)(m.palette.error.main,.1),border:"1px solid",borderColor:p>=0?(0,d.X4)(m.palette.success.main,.2):(0,d.X4)(m.palette.error.main,.2)},children:[(0,c.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"Day P&L"}),(0,c.jsxs)(o.A,{variant:"h6",sx:{fontWeight:600,color:p>=0?m.palette.success.main:m.palette.error.main},children:[p>=0?"+":"",p.toLocaleString()]})]}),(0,c.jsxs)(n.A,{sx:{flex:1,p:2,borderRadius:1,bgcolor:(0,d.X4)(m.palette.primary.main,.1),border:"1px solid",borderColor:(0,d.X4)(m.palette.primary.main,.2)},children:[(0,c.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"Balance Of The Day"}),(0,c.jsxs)(o.A,{variant:"h6",sx:{fontWeight:600},children:["$",t.toLocaleString()]})]})]})]})}}}]);
//# sourceMappingURL=104.8e9197fd.chunk.js.map