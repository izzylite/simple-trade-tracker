"use strict";(self.webpackChunksimple_trade_tracker=self.webpackChunksimple_trade_tracker||[]).push([[116],{26116:(e,t,n)=>{n.r(t),n.d(t,{TradeCalendar:()=>at,createNewTradeData:()=>rt,default:()=>it});var r=n(65043),o=n(45852),a=n(60267),i=n(94799),s=n(53969),l=n(94842),d=n(26529),c=n(42579),u=n(89826),m=n(66154),h=n(12097),p=n(33023),g=n(81911),x=n(78776),f=n(85877),y=n(70916),w=n(91449),v=n(70298),b=n(26887),j=n(23182),A=n(17873),C=n(6013),k=n(31191),I=n(91658),T=n(50103),S=n(99130),W=n(17105),P=n(83616),M=n(78916),D=n(58315),E=n(83041),R=n(64296),z=n(65767),F=n(86262),$=n(15483),B=n(66370),N=n(44188),L=n(27421),X=n(1620),U=n(38605),O=n(72887),Y=n(65757),V=n(66465),_=n(91208),G=n(92885),H=n(69023),J=n(16703),Z=n(74912),q=n(33695),K=n(28340),Q=n(47142),ee=n(23893),te=n(57735),ne=n(91176),re=n(4279),oe=n(87498),ae=n(10256),ie=n(43971),se=n(46261),le=n(1725),de=n(68826),ce=n(38865),ue=n(3353),me=n(4282),he=n(58560),pe=n(99565),ge=n(83759),xe=n(64924),fe=n(81084),ye=n(93468),we=n(80172),ve=n(83290),be=n(5362),je=n(70579);const Ae=e=>{let{image:t,theme:n}=e;const r=ve.i7`
    0% {
      background-position: -200% 0;
    }
    100% {
      background-position: 200% 0;
    }
  `;return(0,je.jsx)(s.A,{sx:{width:"100%",height:"auto",maxHeight:300,overflow:"hidden",position:"relative",...t.width&&t.height?{paddingTop:t.height/t.width*100+"%"}:{}},children:(0,je.jsx)(s.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:()=>{const e="dark"===n.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.04)";return`linear-gradient(90deg, ${e} 25%, ${"dark"===n.palette.mode?"rgba(255, 255, 255, 0.15)":"rgba(0, 0, 0, 0.1)"} 50%, ${e} 75%)`},backgroundSize:"200% 100%",animation:`${r} 1.5s infinite linear`,willChange:"background-position",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:(0,je.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[(0,je.jsx)(we.A,{size:24,color:"primary"}),(0,je.jsx)(l.A,{variant:"caption",sx:{color:"text.secondary",fontWeight:500},children:"Uploading..."})]})})})},Ce=e=>{let{pendingImages:t,uploadedImages:n,editingTrade:o,onImageCaptionChange:i,onImageRemove:d,onImagesReordered:h}=e;const p=(0,a.A)(),[g,x]=(0,r.useState)([]),[f,y]=(0,r.useState)(null),[w,v]=(0,r.useState)(null),[b,j]=(0,r.useState)(null),[A,C]=(0,r.useState)(null),k=(0,r.useRef)(null),I=(0,r.useRef)(null);(0,r.useEffect)((()=>{const e=((e,t)=>{console.log("Input to organizeImagesIntoRows:","Pending:",e.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth}))),"Uploaded:",t.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth}))));const n=[...e.map(((e,t)=>{var n;const r={...e,id:null!==(n=e.id)&&void 0!==n?n:`pending-${t}`,isPending:!0,row:void 0!==e.row?e.row:void 0,column:void 0!==e.column?e.column:void 0,columnWidth:void 0!==e.columnWidth?e.columnWidth:void 0};return console.log(`Processed pending image ${t}:`,r.id,r.row,r.column,r.columnWidth),r})),...t.map(((e,t)=>{var n;const r={...e,id:null!==(n=e.id)&&void 0!==n?n:`uploaded-${t}`,isPending:!1,row:void 0!==e.row?e.row:void 0,column:void 0!==e.column?e.column:void 0,columnWidth:void 0!==e.columnWidth?e.columnWidth:void 0};return console.log(`Processed uploaded image ${t}:`,r.id,r.row,r.column,r.columnWidth),r}))],r={};let o=-1;n.forEach((e=>{void 0!==e.row&&(r[e.row]||(r[e.row]=[]),r[e.row].push(e),o=Math.max(o,e.row))}));let a=o+1,i=a,s=0;n.filter((e=>void 0===e.row)).forEach(((e,t)=>{i=a+Math.floor(t/2),s=t%2,e.row=i,e.column=s,e.columnWidth=50,r[e.row]||(r[e.row]=[]),r[e.row].push(e)}));const l=Object.entries(r).sort(((e,t)=>{let[n]=e,[r]=t;return Number(n)-Number(r)})).map((e=>{let[t,n]=e;return console.log(`Processing row ${t} with ${n.length} images`),n}));l.forEach(((e,t)=>{e.forEach((e=>e.row=t)),e.sort(((e,t)=>{var n,r;return(null!==(n=e.column)&&void 0!==n?n:1/0)-(null!==(r=t.column)&&void 0!==r?r:1/0)}));let n=0,r=0;if(e.forEach(((e,t)=>{e.column=t,void 0===e.columnWidth?r++:n+=e.columnWidth})),r>0){const t=Math.max(0,100-n)/r;e.forEach((e=>{void 0===e.columnWidth&&(e.columnWidth=t)}))}else if(e.length>0&&Math.abs(n-100)>.1){const t=100/n;e.forEach((e=>{var n;e.columnWidth=(null!==(n=e.columnWidth)&&void 0!==n?n:0)*t}))}else if(e.length>0&&0===n){const t=100/e.length;e.forEach((e=>{e.columnWidth=t}))}}));const d=l.filter((e=>e&&e.length>0));return console.log("Final organized rows:",d.map(((e,t)=>`Row ${t}: `+e.map((e=>`(id: ${e.id}, col: ${e.column}, width: ${e.columnWidth}%)`)).join(", ")))),d})(t,n);console.log("Organizing images with layout info:",t.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth}))),n.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth})))),x(e)}),[t,n]);const T=e=>"isPending"in e?!!e.isPending:"file"in e,S=()=>t.some((e=>void 0!==e.uploadProgress&&e.uploadProgress>0&&e.uploadProgress<100)),W=(e,t,n)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",f&&(v(t),j(null!==n&&void 0!==n?n:0))},P=(e,r,o)=>{var a;if(e.preventDefault(),e.stopPropagation(),!f)return;const i=JSON.parse(e.dataTransfer.getData("text/plain")),s=i.sourceRowIndex,l=i.sourceColumnIndex,d=i.id,c=i.isPending;let u,m;if(m=(c?t:n).findIndex((e=>e.id===d)),-1===m)return console.error("Could not find dragged image in original collection!"),void D();if(u=null===(a=g[s])||void 0===a?void 0:a[l],!u){console.error("Inconsistency: Dragged image not found in current rows state at source index");const e=g.flat();if(u=e.find((e=>e.id===d&&T(e)===c)),!u)return console.error("Could not find dragged image anywhere!"),void D();console.warn("Found image via fallback, drag/drop might be slightly off.")}let p=g.map((e=>[...e])),y=-1,w=-1;for(let t=0;t<p.length;t++){const e=p[t].findIndex((e=>e.id===u.id&&T(e)===T(u)));if(-1!==e){y=t,w=e;break}}if(-1===y)return console.error("Cannot find image to remove during drop!"),void D();p[y].splice(w,1);let v=r,b=null!==o&&void 0!==o?o:0;for(r===p.filter((e=>e.length>0)).length&&null===o?(v=p.length,b=0):null===o&&(b=0);p.length<=v;)p.push([]);if(p[v].splice(b,0,u),p=p.filter((e=>e.length>0)),p.forEach(((e,t)=>{const n=100/e.length;e.forEach(((r,o)=>{var a;if(r.row=t,r.column=o,r.id===u.id||1===e.length||y!==t)r.columnWidth=n;else if(t===v&&e.length>1)r.columnWidth=n;else if(t===y&&(null===(a=p[t])||void 0===a?void 0:a.length)>0){const e=100/p[t].length;r.columnWidth=e}(void 0===r.columnWidth||null===r.columnWidth||isNaN(r.columnWidth)||r.columnWidth<=0)&&(r.columnWidth=100/e.length)}));const r=e.reduce(((e,t)=>e+(t.columnWidth||0)),0);if(r>0&&Math.abs(r-100)>.1){const t=100/r;e.forEach((e=>e.columnWidth=(e.columnWidth||0)*t))}else if(0===r&&e.length>0){const t=100/e.length;e.forEach((e=>e.columnWidth=t))}})),x(p),h){const e=p.flat();h(e)}D()},M=()=>{I.current&&document.body.contains(I.current)&&document.body.removeChild(I.current),I.current=null},D=()=>{y(null),v(null),j(null),M()},E=(0,r.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e||0===e.length)return e;const n=e.reduce(((e,t)=>e+(t.columnWidth||0)),0);if(Math.abs(n-100)<.1)return e;if(0===n){const t=100/e.length;return e.forEach((e=>e.columnWidth=t)),e}const r=100/n;e.forEach((e=>{e.columnWidth=(e.columnWidth||0)*r,e.columnWidth=Math.max(t,e.columnWidth)}));const o=e.reduce(((e,t)=>e+(t.columnWidth||0)),0);if(Math.abs(o-100)>.1){const t=e.reduce(((e,t,n,r)=>(t.columnWidth||0)>(r[e].columnWidth||0)?n:e),0);e[t].columnWidth=(e[t].columnWidth||0)-(o-100)}return e}),[]),R=(0,r.useCallback)((e=>{if(!A)return;const{rowIndex:t,dividerIndex:n,startX:r,rowElementWidth:o,initialWidths:a}=A,i=(e.clientX-r)/o*100,s=[...g.map((e=>[...e.map((e=>({...e})))]))],l=s[t];let d=0;for(let g=0;g<=n;g++)d+=a[g];let c=0;for(let g=n+1;g<a.length;g++)c+=a[g];let u=d+i,m=c-i;const h=n+1,p=a.length-h,f=10*h,y=10*p;u=Math.max(f,u),m=Math.max(y,m);const w=u+m;if(Math.abs(w-100)>.1){const e=100/w;u*=e,m*=e,u=Math.max(f,u),m=Math.max(y,m),u===f?m=100-u:m===y&&(u=100-m)}for(let g=0;g<=n;g++){let e=0;if(d>0){e=u*(a[g]/d)}else e=u/h;l[g].columnWidth=Math.max(10,e)}for(let g=n+1;g<l.length;g++){let e=0;if(c>0){e=m*(a[g]/c)}else e=m/p;l[g].columnWidth=Math.max(10,e)}E(l),x(s)}),[A,g,E]),z=(0,r.useCallback)((()=>{if(A){if(h){const e=A.rowIndex;if(g[e]){const e=g.flat();h(e)}}C(null)}}),[A,g,h]);return(0,r.useEffect)((()=>(A?(window.addEventListener("mousemove",R),window.addEventListener("mouseup",z),document.body.style.cursor="col-resize"):(window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",z),document.body.style.cursor=""),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",z),document.body.style.cursor=""})),[A,R,z]),(0,je.jsxs)(s.A,{sx:{width:"100%"},ref:k,children:[g.map(((e,a)=>(0,je.jsx)(s.A,{className:"image-row-container",sx:{display:"flex",width:"100%",marginBottom:3,position:"relative",gap:1},onDragOver:e=>W(e,a,0),children:e.map(((h,x)=>{const v=T(h),j=v?h:null,k=v?null:h,E=v?j.id:k.id,R=x===e.length-1;return(0,je.jsxs)(r.Fragment,{children:[(0,je.jsxs)(s.A,{sx:{position:"relative",width:`${h.columnWidth||100}%`,height:"auto",borderRadius:1,overflow:"visible",display:"flex",flexDirection:"column",opacity:f===h?.5:1,backgroundColor:"transparent",transition:"border-color 0.2s, background-color 0.2s, opacity 0.2s, box-shadow 0.2s",...f&&w===a&&b===x&&{backgroundColor:(0,u.X4)(p.palette.primary.main,.1)},"&:hover .resize-handle":{opacity:S()?.2:1},cursor:S()?"not-allowed":"grab",filter:S()?"grayscale(0.2)":"none"},draggable:!S(),onDragStart:e=>((e,t,n,r)=>{if(A||S())return void e.preventDefault();y(t),e.dataTransfer.setData("text/plain",JSON.stringify({id:t.id,isPending:T(t),sourceRowIndex:n,sourceColumnIndex:r})),e.dataTransfer.effectAllowed="move";const o=e.currentTarget,a=o.getBoundingClientRect(),i=e.clientX-a.left,s=e.clientY-a.top,l=o.cloneNode(!0);l.style.width=`${a.width}px`,l.style.height=`${a.height}px`,l.style.opacity="0.7",l.style.position="absolute",l.style.top="-1000px",l.style.left="-1000px",l.style.pointerEvents="none",l.style.zIndex="1000",I.current=l,document.body.appendChild(l),e.dataTransfer.setDragImage(l,i,s),setTimeout((()=>{M()}),100)})(e,h,a,x),onDragOver:e=>W(e,a,x),onDrop:e=>P(e,a,x),onDragEnd:D,children:[(0,je.jsxs)(s.A,{sx:{overflow:"hidden",borderRadius:"4px 4px 0 0"},children:[" ",v?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsxs)(s.A,{sx:{width:"100%",height:"auto",maxHeight:e.length>1?300:"none",overflow:"hidden",position:"relative",backgroundColor:(0,u.X4)(p.palette.divider,.1),aspectRatio:null!==j&&void 0!==j&&j.width&&null!==j&&void 0!==j&&j.height?`${j.width}/${j.height}`:"16/9"},children:[void 0!==(null===j||void 0===j?void 0:j.uploadProgress)&&j.uploadProgress>0&&j.uploadProgress<100&&(0,je.jsx)(s.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:2},children:(0,je.jsxs)(s.A,{sx:{position:"relative",display:"inline-flex"},children:[(0,je.jsx)(we.A,{variant:"determinate",value:j.uploadProgress,size:60,sx:{color:"white"}}),(0,je.jsx)(s.A,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,je.jsx)(l.A,{variant:"caption",component:"div",sx:{color:"white",fontWeight:"bold"},children:`${Math.round(j.uploadProgress)}%`})})]})}),(0,je.jsx)("img",{src:null===j||void 0===j?void 0:j.preview,alt:"Pending Upload",style:{display:"block",width:"100%",height:"100%",objectFit:"contain"}}),(!(null!==j&&void 0!==j&&j.uploadProgress)||100===j.uploadProgress||-1===j.uploadProgress)&&(0,je.jsx)(c.A,{size:"small",onClick:()=>d(t.findIndex((e=>e.id===h.id)),!0),sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",zIndex:10,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:(0,je.jsx)(be.A,{fontSize:"small"})})]}),(0,je.jsx)(m.A,{placeholder:"Add a caption...",value:(null===j||void 0===j?void 0:j.caption)||"",onChange:e=>i(t.findIndex((e=>e.id===h.id)),e.target.value,!0),variant:"standard",multiline:!0,minRows:1,maxRows:20,fullWidth:!0,disabled:void 0!==(null===j||void 0===j?void 0:j.uploadProgress)&&j.uploadProgress>0&&j.uploadProgress<100,sx:{px:1,py:.5,backgroundColor:p.palette.background.paper,fontSize:"0.75rem","& .MuiInput-underline:before":{borderBottomColor:"transparent"},"& .MuiInput-underline:after":{borderBottomColor:"transparent"},"& .MuiInput-underline:hover:not(.Mui-disabled):before":{borderBottomColor:"transparent"},"& .MuiInputBase-input":{fontSize:"0.75rem"},"& .MuiInputBase-root":{overflow:"visible"},"&.Mui-disabled":{opacity:.7,"& .MuiInputBase-input":{color:"text.disabled"}}}})]}):(0,je.jsxs)(je.Fragment,{children:[(0,je.jsxs)(s.A,{sx:{width:"100%",height:"auto",maxHeight:e.length>1?300:"none",overflow:"hidden",position:"relative",backgroundColor:(0,u.X4)(p.palette.divider,.1),aspectRatio:null!==k&&void 0!==k&&k.width&&null!==k&&void 0!==k&&k.height?`${k.width}/${k.height}`:"16/9"},children:[o&&null!==k&&void 0!==k&&k.pending?(0,je.jsx)(Ae,{image:k,theme:p}):(0,je.jsx)("img",{src:null===k||void 0===k?void 0:k.url,alt:(null===k||void 0===k?void 0:k.caption)||"Uploaded image",style:{display:"block",width:"100%",height:"100%",objectFit:"contain",position:"relative",zIndex:1}}),(0,je.jsx)(c.A,{size:"small",onClick:()=>d(n.findIndex((e=>e.id===h.id)),!1),sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",zIndex:10,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:(0,je.jsx)(be.A,{fontSize:"small"})})]}),(0,je.jsx)(m.A,{placeholder:"Add a caption...",value:(null===k||void 0===k?void 0:k.caption)||"",onChange:e=>i(n.findIndex((e=>e.id===h.id)),e.target.value,!1),variant:"standard",multiline:!0,minRows:1,maxRows:20,fullWidth:!0,disabled:S()||!0===(null===k||void 0===k?void 0:k.pending),sx:{px:1,py:.5,backgroundColor:p.palette.background.paper,fontSize:"0.75rem","& .MuiInput-underline:before":{borderBottomColor:"transparent"},"& .MuiInput-underline:after":{borderBottomColor:"transparent"},"& .MuiInput-underline:hover:not(.Mui-disabled):before":{borderBottomColor:"transparent"},"& .MuiInputBase-input":{fontSize:"0.75rem"},"& .MuiInputBase-root":{overflow:"visible"},"&.Mui-disabled":{opacity:.7,"& .MuiInputBase-input":{color:"text.disabled"}}}})]})]})," "]},`image-${E}-${a}-${x}`),!R&&e.length>1&&(0,je.jsx)(s.A,{className:"resize-handle",sx:{width:"8px",position:"relative",cursor:S()?"not-allowed":"col-resize",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,zIndex:10,"&::before":{content:'""',position:"absolute",top:"5%",bottom:"5%",left:"3px",width:"2px",backgroundColor:A&&A.rowIndex===a&&A.dividerIndex===x?p.palette.primary.main:S()?(0,u.X4)(p.palette.divider,.4):(0,u.X4)(p.palette.divider,.8),opacity:A&&A.rowIndex===a&&A.dividerIndex===x?1:0,transition:"opacity 0.2s, background-color 0.2s, width 0.2s"},"&:hover::before":{opacity:S()?.3:1,width:S()?"2px":"3px",backgroundColor:S()?(0,u.X4)(p.palette.divider,.4):p.palette.primary.light},...A&&A.rowIndex===a&&A.dividerIndex===x&&{"&::before":{opacity:1,width:"3px",backgroundColor:p.palette.primary.main}}},onMouseDown:e=>((e,t,n)=>{if(e.preventDefault(),e.stopPropagation(),S())return;const r=e.target.closest(".image-row-container");if(!r)return;const o=r.getBoundingClientRect().width;o<=0||C({rowIndex:t,dividerIndex:n,startX:e.clientX,rowElementWidth:o,initialWidths:g[t].map((e=>e.columnWidth||0))})})(e,a,x)})]},`image-frag-${E}-${a}-${x}`)}))},`row-${a}`))),f&&!S()&&(0,je.jsx)(s.A,{sx:{width:"100%",height:80,border:`2px dashed ${w===g.length&&0===b?p.palette.primary.main:(0,u.X4)(p.palette.divider,.5)}`,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:w===g.length&&0===b?(0,u.X4)(p.palette.primary.main,.1):"transparent",color:p.palette.text.secondary,transition:"all 0.2s ease-in-out",marginBottom:2,position:"relative",...w===g.length&&0===b&&{backgroundColor:(0,u.X4)(p.palette.primary.main,.1),border:`2px solid ${p.palette.primary.main}`,"&::after":{content:'"New Row"',position:"absolute",top:"-10px",right:"10px",backgroundColor:p.palette.primary.main,color:p.palette.primary.contrastText,padding:"2px 8px",borderRadius:"4px",fontSize:"0.7rem",fontWeight:"bold",zIndex:10,boxShadow:`0 2px 4px ${(0,u.X4)(p.palette.common.black,.2)}`}}},onDragOver:e=>W(e,g.length,0),onDragLeave:()=>{},onDrop:e=>P(e,g.length,null),children:"Drop here to create a new row"})]})},ke=e=>{let{pendingImages:t,uploadedImages:n,editingTrade:o,onImageUpload:a,onImageCaptionChange:i,onImageRemove:d,onImagesReordered:c}=e;const u=(0,r.useRef)(null),m=e=>{var t;const n=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!n)return;const r=[];for(let o=0;o<n.length;o++){const e=n[o];if(-1!==e.type.indexOf("image")){const t=e.getAsFile();t&&r.push(t)}}if(r.length>0){const e=new DataTransfer;r.forEach((t=>e.items.add(t))),a(e.files)}};return(0,r.useEffect)((()=>(document.addEventListener("paste",m),()=>{document.removeEventListener("paste",m)})),[a]),(0,je.jsxs)(s.A,{sx:{mt:2},children:[(0,je.jsx)(l.A,{variant:"subtitle1",sx:{mb:1},children:"Images"}),(0,je.jsx)("input",{type:"file",accept:"image/*",multiple:!0,ref:u,style:{display:"none"},onChange:e=>{e.target.files&&e.target.files.length>0&&(a(e.target.files),e.target.value="")}}),(0,je.jsxs)(s.A,{sx:{mb:2},children:[(0,je.jsx)(h.A,{variant:"outlined",startIcon:(0,je.jsx)(ye.A,{}),onClick:()=>{var e;null===(e=u.current)||void 0===e||e.click()},sx:{mb:1},children:"Add Images"}),(0,je.jsx)(l.A,{variant:"caption",color:"text.secondary",display:"block",children:"You can also paste images directly (Ctrl+V)"})]}),(t.length>0||n.length>0)&&(0,je.jsx)(Ce,{pendingImages:t,uploadedImages:n,editingTrade:o,onImageCaptionChange:i,onImageRemove:d,onImagesReordered:c})]})},Ie=e=>{let{newTrade:t,editingTrade:n,allTags:r,isSubmitting:o,riskPerTrade:i,accountBalance:d,dynamicRiskEnabled:c,increasedRiskPercentage:u,profitThresholdPercentage:h,calculateAmountFromRiskToReward:p,calculateCumulativePnl:g,onNameChange:x,onAmountChange:f,onTypeChange:y,onEntryChange:w,onExitChange:v,onRiskToRewardChange:b,onPartialsTakenChange:j,onSessionChange:A,onNotesChange:C,onTagsChange:k,onImageUpload:I,onImageCaptionChange:T,onImageRemove:S,onImagesReordered:W,onSubmit:P}=e;const M=(0,a.A)(),D=g(t);return(0,je.jsxs)("form",{onSubmit:P,children:[(0,je.jsx)(xe.zB,{children:(0,je.jsx)(m.A,{label:"Trade Name",value:t.name,onChange:x,fullWidth:!0,placeholder:"Enter a name for this trade"})}),(0,je.jsxs)(s.A,{sx:{display:"flex",gap:2,width:"100%"},children:[(0,je.jsx)(xe.zB,{sx:{flex:1},children:(0,je.jsx)(m.A,{label:"Entry Price",value:t.entry,onChange:w,fullWidth:!0,placeholder:"Optional entry price"})}),(0,je.jsx)(xe.zB,{sx:{flex:1},children:(0,je.jsx)(m.A,{label:"Exit Price",value:t.exit,onChange:v,fullWidth:!0,placeholder:"Optional exit price"})})]}),(0,je.jsxs)(ae.A,{component:"fieldset",sx:{mb:2},children:[(0,je.jsx)(ie.A,{component:"legend",children:"Trade Type"}),(0,je.jsxs)(se.A,{row:!0,name:"type",value:t.type,onChange:y,children:[(0,je.jsx)(le.A,{value:"win",control:(0,je.jsx)(de.A,{}),label:"Win"}),(0,je.jsx)(le.A,{value:"loss",control:(0,je.jsx)(de.A,{}),label:"Loss"}),(0,je.jsx)(le.A,{value:"breakeven",control:(0,je.jsx)(de.A,{}),label:"Breakeven"})]})]}),!i||i&&t.partialsTaken?(0,je.jsx)(xe.zB,{children:(0,je.jsx)(m.A,{label:"Amount",type:"number",value:t.amount,onChange:e=>f(e.target.value),fullWidth:!0,required:!0,helperText:i&&t.partialsTaken?"Manual entry for partial profits":void 0})}):(0,je.jsx)(xe.zB,{children:(0,je.jsx)(m.A,{label:"Amount (Calculated from Risk)",type:"number",value:(()=>{if(!i||!t.riskToReward)return"";const e=parseFloat(t.riskToReward);if(isNaN(e))return"";const n=p(e,D);return!t.partialsTaken&&n>0&&setTimeout((()=>f(n.toString())),0),n.toString()})(),sx:{"& .MuiInputBase-input":{pointerEvents:"none"}},fullWidth:!0,disabled:!0,helperText:c&&u&&h&&D/d*100>=h?`Based on ${u}% of account balance (INCREASED from ${i}%)`:`Based on ${i}% of account balance (${(0,ee.vv)(d*i/100)})`})}),void 0!==i&&(0,je.jsx)(xe.zB,{children:(0,je.jsx)(le.A,{control:(0,je.jsx)(ce.A,{checked:t.partialsTaken,onChange:j}),label:(0,je.jsx)(l.A,{variant:"body2",children:"Partials taken (allows manual amount entry)"})})}),(0,je.jsx)(xe.zB,{children:(0,je.jsx)(m.A,{label:"Risk to Reward",value:t.riskToReward,onChange:e=>{const n=e.target.value;if((""===n||/^\d*\.?\d*$/.test(n))&&(b(n),i&&n&&!t.partialsTaken)){const e=parseFloat(n);if(!isNaN(e)){const t=p(e,D);f(t.toString())}}},fullWidth:!0,type:"number",sx:{"& input":{min:0,step:.1}}})}),(0,je.jsx)(xe.zB,{children:(0,je.jsxs)(ae.A,{fullWidth:!0,children:[(0,je.jsx)(ue.A,{id:"session-label",children:"Session"}),(0,je.jsxs)(me.A,{labelId:"session-label",value:t.session,onChange:A,label:"Session",children:[(0,je.jsx)(he.A,{value:"",children:"None"}),(0,je.jsx)(he.A,{value:"Asia",children:"Asia"}),(0,je.jsx)(he.A,{value:"London",children:"London"}),(0,je.jsx)(he.A,{value:"NY AM",children:"NY AM"}),(0,je.jsx)(he.A,{value:"NY PM",children:"NY PM"})]})]})}),(0,je.jsx)(xe.zB,{children:(0,je.jsx)(pe.A,{multiple:!0,freeSolo:!0,options:r,value:t.tags,onChange:k,renderTags:(e,t)=>e.map(((e,n)=>(0,je.jsx)(ge.A,{label:(0,fe.t)(e,!1),...t({index:n}),sx:(0,fe.dO)(e,M),title:(0,fe.dn)(e)?`Group: ${(0,fe.Oo)(e)}`:void 0}))),renderOption:(e,t)=>(0,je.jsx)("li",{...e,children:(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,fe.dn)(t)&&(0,je.jsx)(ge.A,{label:(0,fe.Oo)(t),size:"small",sx:{...(0,fe.dO)(t,M),height:"18px",fontSize:"0.7rem"}}),(0,fe.t)(t,!0)]})}),renderInput:e=>(0,je.jsx)(m.A,{...e,label:"Tags",placeholder:"Add tags"})})}),(console.log("TradeForm rendering with images:","Pending:",t.pendingImages.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth}))),"Uploaded:",t.uploadedImages.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth})))),null),(0,je.jsx)(ke,{pendingImages:t.pendingImages,uploadedImages:t.uploadedImages,editingTrade:null!==n,onImageUpload:I,onImageCaptionChange:T,onImageRemove:S,onImagesReordered:W}),(0,je.jsx)(xe.zB,{children:(0,je.jsx)(m.A,{label:"Notes",value:t.notes,onChange:C,fullWidth:!0,multiline:!0,minRows:4,maxRows:20,sx:{"& .MuiInputBase-root":{overflow:"visible"},"& .MuiOutlinedInput-root":{overflow:"visible"}}})}),(0,je.jsx)(s.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2,gap:1},children:(0,je.jsx)("button",{type:"submit",style:{display:"none"},disabled:o})})]})};var Te=n(64),Se=n(25272),We=n(61773),Pe=n(8961);const Me=e=>{let{trades:t,expandedTradeId:n,onTradeClick:o,onEditClick:i,onDeleteClick:d,onZoomedImage:u,onUpdateTradeProperty:m}=e;const h=(0,a.A)();return(0,je.jsxs)(s.A,{sx:{mt:2},children:[(0,je.jsx)(l.A,{variant:"subtitle1",sx:{mb:1},children:"Trades"}),0===t.length?(0,je.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:"No trades for this day"}):(0,je.jsx)(v.A,{spacing:1,children:t.map((e=>(0,je.jsxs)(r.Fragment,{children:[(0,je.jsxs)(xe.uf,{$type:e.type,onClick:()=>o(e.id),sx:{cursor:"pointer",...e.isTemporary&&{opacity:.7,border:"1px dashed",borderColor:"divider",backgroundColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.02)"}},children:[(0,je.jsxs)(xe.j3,{children:[(0,je.jsx)(s.A,{sx:{display:"flex",alignItems:"flex-start",gap:.5,justifyContent:"space-between"},children:(0,je.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column"},children:[e.name&&(0,je.jsx)(l.A,{variant:"body2",sx:{fontWeight:600},children:e.isTemporary?e.name:`\ud83d\udcc8 ${e.name.replace(/^\ud83d\udcc8 /,"")}`}),(0,je.jsxs)(l.A,{variant:"body1",sx:{fontWeight:500,color:"win"===e.type?"success.main":"loss"===e.type?"error.main":"info.main"},children:["$",Math.abs(e.amount).toLocaleString()]})]})}),e.tags&&e.tags.length>0&&(0,je.jsx)(s.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:e.tags.filter((e=>!e.startsWith("Partials:"))).map(((e,t)=>(0,je.jsx)(ge.A,{label:(0,fe.t)(e),size:"small",sx:{...(0,fe.dO)(e,h),height:"20px","& .MuiChip-label":{px:1,fontSize:"0.7rem"}}},t)))}),(0,je.jsx)(s.A,{sx:{mt:.5,mr:1},children:n===e.id?(0,je.jsx)(Te.A,{fontSize:"small",sx:{color:"text.secondary"}}):(0,je.jsx)(Se.A,{fontSize:"small",sx:{color:"text.secondary"}})})]}),(0,je.jsxs)(xe.wt,{children:[(0,je.jsx)(c.A,{size:"small",onClick:t=>{t.stopPropagation(),i(e)},children:(0,je.jsx)(We.A,{fontSize:"small"})}),(0,je.jsx)(c.A,{size:"small",onClick:t=>{t.stopPropagation(),d(e.id)},children:(0,je.jsx)(be.A,{fontSize:"small"})})]})]}),n===e.id&&(0,je.jsx)(Pe.A,{trade:e,isExpanded:!0,setZoomedImage:u,onUpdateTradeProperty:m})]},e.id)))})]})},De=e=>{let{date:t,accountBalance:n,formInputVisible:r,totalPnL:o,onPrevDay:i,onNextDay:d}=e;const m=(0,a.A)();return(0,je.jsxs)(s.A,{sx:{mb:3},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[!r&&(0,je.jsx)(c.A,{onClick:i,size:"small",children:(0,je.jsx)($.A,{})}),(0,je.jsx)(l.A,{variant:"h6",sx:{fontWeight:600},children:(0,H.GP)(t,"EEEE, MMMM d, yyyy")}),!r&&(0,je.jsx)(c.A,{onClick:d,size:"small",children:(0,je.jsx)(B.A,{})})]}),(0,je.jsxs)(s.A,{sx:{display:"flex",gap:2},children:[(0,je.jsxs)(s.A,{sx:{flex:1,p:2,borderRadius:1,bgcolor:o>=0?(0,u.X4)(m.palette.success.main,.1):(0,u.X4)(m.palette.error.main,.1),border:"1px solid",borderColor:o>=0?(0,u.X4)(m.palette.success.main,.2):(0,u.X4)(m.palette.error.main,.2)},children:[(0,je.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Day P&L"}),(0,je.jsxs)(l.A,{variant:"h6",sx:{fontWeight:600,color:o>=0?m.palette.success.main:m.palette.error.main},children:[o>=0?"+":"",o.toLocaleString()]})]}),(0,je.jsxs)(s.A,{sx:{flex:1,p:2,borderRadius:1,bgcolor:(0,u.X4)(m.palette.primary.main,.1),border:"1px solid",borderColor:(0,u.X4)(m.palette.primary.main,.2)},children:[(0,je.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Balance Of The Day"}),(0,je.jsxs)(l.A,{variant:"h6",sx:{fontWeight:600},children:["$",n.toLocaleString()]})]})]})]})},Ee=e=>{const t=document.querySelector(".MuiAutocomplete-input");let n="";return t&&t.value.trim()&&(n=t.value.trim()),n?[...e,n]:e},Re=e=>{let{open:t,onClose:n,showForm:a,newMainTrade:i,setNewMainTrade:l,date:d,trades:c,accountBalance:u,onDateChange:m,onAddTrade:h,onUpdateTradeProperty:p,setZoomedImage:g,allTrades:x=[],riskPerTrade:f,dynamicRiskEnabled:v,increasedRiskPercentage:b,profitThresholdPercentage:j,calendarId:A}=e;const[C,k]=(0,r.useState)(!1),[I,T]=(0,r.useState)(null),[S,W]=(0,r.useState)(null),[P,M]=(0,r.useState)(!1),[D,E]=(0,r.useState)(null),[R,z]=(0,r.useState)(!1),[F,$]=(0,r.useState)(!1),[B,N]=(0,r.useState)(!1),[L,X]=(0,r.useState)(!1),[U,O]=(0,r.useState)(""),[Y,V]=(0,r.useState)(null),_=e=>x.reduce(((t,n)=>(new Date(n.date)<e&&(t+=n.amount),t)),0);(0,r.useEffect)((()=>{k(a)}),[a]),(0,r.useEffect)((()=>{i&&V(i)}),[i]);const G=(0,r.useMemo)((()=>{const e=new Set;return x.forEach((t=>{t.tags&&t.tags.forEach((t=>{t.startsWith("Partials:")||e.add(t)}))})),Array.from(e)}),[x]),H=()=>{const e=new Date(d);return e.setDate(e.getDate()+1),e},J=e=>{O(e),X(!0)},Z=()=>{X(!1)},q=()=>{Y&&Y.pendingImages.forEach((e=>{URL.revokeObjectURL(e.preview)})),k(!1),T(null),l((()=>null))},K=async(e,t,n)=>{if(p)try{return p(e,t,n)}catch(r){console.error("Error updating trade property:",r),J(r instanceof Error?r.message:"Failed to update trade property. Please try again.")}},Q=e=>{if(f&&e.riskToReward&&!e.partialsTaken){const t=parseFloat(e.riskToReward);if(!isNaN(t)){const n=ae(t,_(e.date||d));return"loss"===e.type?-Math.abs(n):Math.abs(n)}}const t=parseFloat(e.amount||"0");return"loss"===e.type?-Math.abs(t):Math.abs(t)},ee=(e,t)=>{let n=Q(e);console.log(`trade final amount ${n}`);let r=Ee([...e.tags]);e.partialsTaken&&(r=r.filter((e=>!e.startsWith("Partials:"))),r.push("Partials:Yes"));const a=new Date;return{id:e.id||(0,o.A)(),isTemporary:e.isTemporary,date:new Date(t.getFullYear(),t.getMonth(),t.getDate(),a.getHours(),a.getMinutes(),a.getSeconds()),type:e.type,amount:n,isDeleting:!1,...e.name&&{name:e.name},...e.entry&&{entry:e.entry},...e.exit&&{exit:e.exit},...r.length>0&&{tags:r},...e.riskToReward&&{riskToReward:parseFloat(e.riskToReward)},partialsTaken:e.partialsTaken,...e.session&&{session:e.session},...e.notes&&{notes:e.notes},images:e.uploadedImages||[]}},ae=(e,t)=>{if(!Y||!f||!e||!u)return 0;const n=ie(t),r=(u+t)*n/100;return"win"===Y.type?Math.round(r*e):Math.round(r)},ie=e=>{if(!f)return 0;if(v&&b&&j&&u>0){if(e/u*100>=j)return b}return f},se=async(e,t)=>{try{V((t=>({...t,pendingImages:t.pendingImages.map((t=>t.id===e.id?{...t,uploadProgress:1}:t))})));const r=await oe.V6(e.id,e.file,e.width,e.height,e.caption,(t=>{V((n=>({...n,pendingImages:n.pendingImages.map((n=>n.id===e.id?{...n,uploadProgress:t}:n))})))})),o=Y.pendingImages.find((t=>t.id===e.id)),a={...r,caption:e.caption,row:null===o||void 0===o?void 0:o.row,column:null===o||void 0===o?void 0:o.column,columnWidth:null===o||void 0===o?void 0:o.columnWidth};if(V((t=>{const n=[...t.pendingImages];let r=n.findIndex((t=>t.id===e.id));-1!==r&&n.splice(r,1);const o=[...t.uploadedImages];return r=o.findIndex((t=>t.id===e.id)),-1!==r&&o[r].pending&&o.splice(r,1),{...t,pendingImages:n,uploadedImages:[...o,a]}})),A&&t)try{await K(t,(e=>{var t;const n=null===(t=e.images)||void 0===t?void 0:t.find((e=>e.id===a.id)),r={...a,row:void 0!==(null===n||void 0===n?void 0:n.row)?n.row:a.row,column:void 0!==(null===n||void 0===n?void 0:n.column)?n.column:a.column,columnWidth:void 0!==(null===n||void 0===n?void 0:n.columnWidth)?n.columnWidth:a.columnWidth};return{...e,images:(e.images||[r]).map((e=>e.id===r.id?r:e))}}))}catch(n){console.error("Error updating trade with new image:",n),J(n instanceof Error?`Failed to save image to trade: ${n.message}`:"Failed to save image to trade. The image is saved locally but may be lost if you refresh the page.")}}catch(r){console.error("Error uploading image:",r),V((t=>({...t,pendingImages:t.pendingImages.map((t=>t.id===e.id?{...t,uploadProgress:-1}:t))})))}},le=()=>Y.pendingImages.some((e=>void 0!==e.uploadProgress&&e.uploadProgress<100&&e.uploadProgress>=0)),de=async e=>{if(e&&e.preventDefault(),h){M(!0);try{if(!Y.amount)throw new Error("Amount is required");if(le())return J("Please wait for image uploads to complete..."),void M(!1);let e=ee(Y,d);Y.isTemporary&&Y.id?await K(Y.id,(()=>({...e,isTemporary:!1}))):await h(e),q()}catch(t){throw J(t instanceof Error?t.message:"Failed to add trade. Please try again."),Y.isTemporary?(console.error("Error updating temporary trade:",t),new Error(`Failed to update temporary trade: ${t instanceof Error?t.message:"Unknown error"}`)):(console.error("Error adding new trade:",t),new Error(`Failed to add new trade: ${t instanceof Error?t.message:"Unknown error"}`))}finally{M(!1)}}},ce=async e=>{if(e&&e.preventDefault(),I){M(!0);try{if(!Y.amount)throw new Error("Amount is required");if(le())return J("Please wait for image uploads to complete..."),void M(!1);let e=Q(Y),n=Ee([...Y.tags]);Y.partialsTaken?(n=n.filter((e=>!e.startsWith("Partials:"))),n.push("Partials:Yes")):n=n.filter((e=>!e.startsWith("Partials:")));try{if(!I.id)throw new Error("Cannot update trade: Missing trade ID");{if(!await oe.J1(A,I.id))throw new Error(`Trade with ID ${I.id} not found. It may have been deleted.`);const t=[...Y.pendingImages.map((e=>({url:e.preview||"",id:e.id,pending:!0,caption:e.caption||"",width:e.width||0,height:e.height||0,row:void 0!==e.row?e.row:0,column:void 0!==e.column?e.column:0,columnWidth:void 0!==e.columnWidth?e.columnWidth:50}))),...Y.uploadedImages.map((e=>({url:e.url||"",id:e.id,pending:e.pending,caption:e.caption||"",width:e.width||0,height:e.height||0,row:void 0!==e.row?e.row:0,column:void 0!==e.column?e.column:0,columnWidth:void 0!==e.columnWidth?e.columnWidth:50})))];await K(I.id,(r=>({...r,type:Y.type,amount:e,name:Y.name||"",entry:Y.entry||"",exit:Y.exit||"",tags:n||[],riskToReward:parseFloat(Y.riskToReward)||1,partialsTaken:Y.partialsTaken,session:Y.session||"London",notes:Y.notes||"",images:t}))),console.log("Trade updated successfully")}}catch(t){throw console.error("Error updating trade:",t),new Error(`Failed to update trade: ${t instanceof Error?t.message:"Unknown error"}`)}q()}catch(n){console.error("Error editing trade:",n),J(n instanceof Error?n.message:"Failed to edit trade. Please try again.")}finally{M(!1)}}};return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(re.mY,{open:t,onClose:()=>{B||(I&&q(),n())},title:"Daily Trades",maxWidth:"md",fullWidth:!0,hideCloseButton:B,primaryButtonText:C&&I?"Update Trade":"Add Trade",primaryButtonAction:C?I?e=>ce(e):e=>de(e):()=>(async()=>{k(!0),T(null),N(!0);try{if(!A||!h)throw new Error("Unable to create trade: Missing calendar ID or add trade function");{const e=rt();V((()=>({...e,isTemporary:!0,name:"New Trade"}))),await h({...ee(e,d),name:"New Trade",isTemporary:!0})}}catch(e){console.error("Error creating empty trade:",e),J(e instanceof Error?`Failed to create temporary trade: ${e.message}`:"Failed to create temporary trade. Please try again."),V((e=>({...e,isTemporary:!1})))}finally{N(!1)}})(),isSubmitting:P||B,cancelButtonAction:C?()=>{B||(k(!1),q())}:void 0,hideFooterCancelButton:!C,children:(0,je.jsxs)(s.A,{sx:{p:3},children:[(0,je.jsx)(De,{date:d,accountBalance:u+_(H()),formInputVisible:C,totalPnL:c.reduce(((e,t)=>e+t.amount),0),onPrevDay:()=>{const e=new Date(d);e.setDate(e.getDate()-1),m(e)},onNextDay:()=>{const e=H();(0,te.d)(e,(0,ne.o)(new Date))||m(e)}}),C?(0,je.jsx)(s.A,{children:(0,je.jsx)(Ie,{accountBalance:u,calculateCumulativePnl:e=>_((null===e||void 0===e?void 0:e.date)||new Date),dynamicRiskEnabled:v,increasedRiskPercentage:b,profitThresholdPercentage:j,newTrade:Y,editingTrade:I,allTags:G,isSubmitting:P,riskPerTrade:f,calculateAmountFromRiskToReward:ae,onNameChange:e=>{V((t=>({...t,name:e.target.value})))},onAmountChange:e=>{V((t=>({...t,amount:e})))},onTypeChange:e=>{V((t=>({...t,type:e.target.value})))},onEntryChange:e=>{V((t=>({...t,entry:e.target.value})))},onExitChange:e=>{V((t=>({...t,exit:e.target.value})))},onRiskToRewardChange:e=>{V((t=>({...t,riskToReward:e})))},onPartialsTakenChange:e=>{const t=e.target.checked;V((e=>({...e,partialsTaken:t})))},onSessionChange:e=>{V((t=>({...t,session:e.target.value})))},onNotesChange:e=>{V((t=>({...t,notes:e.target.value})))},onTagsChange:(e,t)=>{V((e=>({...e,tags:t})))},onImageUpload:async e=>{const t=await Promise.all(Array.from(e).map((async e=>{const t=URL.createObjectURL(e),n=await(r=t,new Promise((e=>{const t=new Image;t.onload=()=>{e({width:t.width,height:t.height})},t.src=r})));var r;return{id:oe.Aw(e),file:e,preview:t,caption:"",width:n.width,height:n.height,uploadProgress:0}})));V((e=>{const n=e.pendingImages,r=e.uploadedImages;let o=-1;[...n,...r].forEach((e=>{void 0!==e.row&&e.row>o&&(o=e.row)}));const a=t.map(((e,t)=>({...e,row:o+1+t,column:0,columnWidth:100})));return{...e,pendingImages:[...n,...a]}}));try{const e=await K(Y.id,(e=>{const n=e.images||[];let r=-1;n.forEach((e=>{void 0!==e.row&&e.row>r&&(r=e.row)}));const o=t.map(((e,t)=>{const n=r+1+t;return{url:e.preview,pending:!0,id:e.id,width:e.width,height:e.height,caption:e.caption,row:n,column:0,columnWidth:100}}));return{...e,images:[...n,...o]}}),(e=>(N(!0),{...ee(Y,d),id:e,name:Y.name||"New Trade",isTemporary:!0})));e&&e.isTemporary&&(V((e=>({...e,isTemporary:!0}))),N(!1));for(const n of t)await se(n,Y.id)}catch(n){console.error("Error creating empty trade:",n)}},onImageCaptionChange:async(e,t,n)=>{try{if(n){const n=Y.pendingImages[e];if(void 0!==n.uploadProgress&&n.uploadProgress>0&&n.uploadProgress<100)return void console.warn("Attempted to change caption of an image that is currently uploading");V((n=>({...n,pendingImages:n.pendingImages.map(((n,r)=>r===e?{...n,caption:t}:n))})))}else V((n=>({...n,uploadedImages:n.uploadedImages.map(((n,r)=>r===e?{...n,caption:t}:n))})))}catch(r){console.error("Error in handleImageCaptionChange:",r)}},onImageRemove:async(e,t)=>{try{if(t){const t=Y.pendingImages[e];if(void 0!==t.uploadProgress&&t.uploadProgress>0&&t.uploadProgress<100)return console.warn("Attempted to delete an image that is currently uploading"),void J("Cannot delete an image while it's uploading. Please wait for the upload to complete.");URL.revokeObjectURL(t.preview),V((t=>({...t,pendingImages:t.pendingImages.filter(((t,n)=>n!==e))})))}else{const t=Y.uploadedImages[e];V((t=>({...t,uploadedImages:t.uploadedImages.filter(((t,n)=>n!==e))})));try{await K(Y.id,(e=>({...e,images:(e.images||[]).filter((e=>e.id!==t.id))}))),console.log(`Image ${t.id} deleted and trade updated successfully`)}catch(n){console.error("Error deleting image or updating trade:",n)}}}catch(r){console.error("Error in handleImageRemove:",r),J("Failed to remove image. Please try again.")}},onImagesReordered:async e=>{console.log("handleImagesReordered called with images:",e.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.columnWidth}))));const t=e.filter((e=>"file"in e)),n=e.filter((e=>!("file"in e)));V((e=>({...e,pendingImages:t,uploadedImages:n})))},onSubmit:I?ce:de})}):(0,je.jsx)(je.Fragment,{children:(0,je.jsx)(Me,{trades:c,expandedTradeId:S,onTradeClick:e=>{W(S===e?null:e)},onEditClick:e=>{T(e),l((()=>{var t;return{id:e.id,name:e.name?e.name.replace(/^\ud83d\udcc8 /,""):"",amount:Math.abs(e.amount).toString(),type:e.type,entry:e.entry||"",date:e.date,exit:e.exit||"",tags:e.tags||[],riskToReward:(null===(t=e.riskToReward)||void 0===t?void 0:t.toString())||"",partialsTaken:e.partialsTaken||!1,session:e.session||"",notes:e.notes||"",pendingImages:[],isTemporary:e.isTemporary,uploadedImages:e.images?e.images.map((e=>({...e,row:void 0!==e.row?e.row:0,column:void 0!==e.column?e.column:0,columnWidth:void 0!==e.columnWidth?e.columnWidth:50}))):[]}})),console.log(`Editing trade image: ${JSON.stringify(e.images)}`)},onDeleteClick:e=>{E(e),z(!0)},onZoomedImage:g,onUpdateTradeProperty:K})})]})}),(0,je.jsx)(re.KK,{open:R,title:"Delete Trade",message:"Are you sure you want to delete this trade? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",onConfirm:async()=>{if(D){$(!0);try{await K(D,(e=>({...e,isDeleted:!0})))}catch(e){console.error("Error deleting trade:",e),J("Failed to delete trade. Please try again.")}finally{$(!1),z(!1),E(null)}}},onCancel:()=>{z(!1),E(null)},isSubmitting:F,confirmColor:"error"}),(0,je.jsx)(y.A,{open:L,autoHideDuration:6e3,onClose:Z,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,je.jsx)(w.A,{onClose:Z,severity:"error",sx:{width:"100%"},children:U})})]})};var ze=n(40269),Fe=n(38490),$e=n(15655),Be=n(16857),Ne=n(92410),Le=n(11238);const Xe=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"xlsx";if(0===e.length)return;const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=[...e].sort(((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()));let r=0,o=t;return n.map((e=>(r+=e.amount,o+=e.amount,{...e,cumulativePnL:r,accountBalance:o}))).map((e=>{var t,n;return{Date:(0,H.GP)(new Date(e.date),"MM/dd/yyyy"),Name:e.name?e.name:"",Type:e.type.charAt(0).toUpperCase()+e.type.slice(1),Amount:e.amount,"P&L":e.amount>0?`+${e.amount.toFixed(2)}`:e.amount.toFixed(2),"Cumulative P&L":e.cumulativePnL>0?`+${e.cumulativePnL.toFixed(2)}`:e.cumulativePnL.toFixed(2),"Account Balance":e.accountBalance.toFixed(2),"Entry Price":e.entry||"","Exit Price":e.exit||"",Tags:(null===(t=e.tags)||void 0===t?void 0:t.join(", "))||"","Risk to Reward":(null===(n=e.riskToReward)||void 0===n?void 0:n.toFixed(2))||"",Session:e.session||"",Notes:e.notes||""}}))}(e,t),o=`trades_${(0,H.GP)(new Date,"yyyy-MM-dd")}.${n}`;"xlsx"===n?((e,t)=>{const n=Le.Wp.book_new(),r=Le.Wp.json_to_sheet(e);r["!cols"]=[{wch:12},{wch:25},{wch:8},{wch:10},{wch:10},{wch:15},{wch:15},{wch:15},{wch:15},{wch:30},{wch:12},{wch:12},{wch:50}],Le.Wp.book_append_sheet(n,r,"Trades"),Le._h(n,t)})(r,o):((e,t)=>{const n=Object.keys(e[0]),r=[];r.push(n.join(","));for(const l of e){const e=n.map((e=>{const t=l[e],n=String(t).replace(/"/g,'""');return n.includes(",")||n.includes('"')||n.includes("\n")?`"${n}"`:t}));r.push(e.join(","))}const o=r.join("\n"),a=new Blob([o],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(a),s=document.createElement("a");s.setAttribute("href",i),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)})(r,o)},Ue=["id","date","Date","amount","Amount","P&L","type","Type","name","Name","entry","Entry Price","exit","Exit Price","tags","Tags","riskToReward","Risk to Reward","partialsTaken","Partials Taken","session","Session","notes","Notes","images","Images","Cumulative P&L","Account Balance"],Oe=["MM/dd/yyyy","M/d/yyyy","yyyy-MM-dd","yyyy/MM/dd","dd/MM/yyyy","dd-MM-yyyy","MM-dd-yyyy","M-d-yyyy","MMMM d, yyyy","MMM d, yyyy","MMMM dd, yyyy","MMM dd, yyyy"],Ye=e=>e.map((e=>{const t=e.Date?(e=>{const t=e.trim();for(const a of Oe)try{const e=(0,Ne.qg)(t,a,new Date);if(!isNaN(e.getTime()))return e}catch(o){}const n=t.match(/(January|February|March|April|May|June|July|August|September|October|November|December)\s+(\d{1,2})(?:st|nd|rd|th)?(?:,)?\s+(\d{4})/i);if(n){const[,e,t,r]=n,o=["january","february","march","april","may","june","july","august","september","october","november","december"].indexOf(e.toLowerCase());if(-1!==o){const e=new Date(parseInt(r),o,parseInt(t));if(!isNaN(e.getTime()))return e}}const r=new Date(t);return isNaN(r.getTime())?(console.warn(`Could not parse date: ${t}. Using current date instead.`),new Date):r})(e.Date):new Date;let n=0;try{n=void 0!==e.Amount?"string"===typeof e.Amount?parseFloat(e.Amount):e.Amount:parseFloat(e["P&L"]||"0")}catch(a){console.warn(`Could not parse amount: ${e.Amount||e["P&L"]}. Using 0 instead.`)}let r,o=e.Tags?e.Tags.split(",").map((e=>e.trim())).filter(Boolean):[];for(const i in e){if(Ue.includes(i)||!e[i]||""===e[i])continue;const t=i.trim(),n=String(e[i]).split(",");for(const e of n){const n=e.trim();n&&o.push(`${t}:${n}`)}}if(e.Type&&"string"===typeof e.Type){const t=e.Type.toLowerCase();r="win"===t||"loss"===t||"breakeven"===t?t:n>0?"win":n<0?"loss":"breakeven"}else r=n>0?"win":n<0?"loss":"breakeven";return{id:crypto.randomUUID(),date:t,type:r,amount:n,...e.Name&&{name:e.Name},...e["Entry Price"]&&{entry:e["Entry Price"]},...e["Exit Price"]&&{exit:e["Exit Price"]},...o.length>0&&{tags:o},...e["Risk to Reward"]&&{riskToReward:parseFloat(e["Risk to Reward"])},...e.Session&&{session:e.Session},...e.Notes&&{notes:e.Notes}}})),Ve=async e=>new Promise(((t,n)=>{var r;const o=new FileReader,a=null===(r=e.name.split(".").pop())||void 0===r?void 0:r.toLowerCase();o.onload=async e=>{try{let n=[];if("csv"===a){var r;const t=null===(r=e.target)||void 0===r?void 0:r.result;n=await(async e=>{try{const r=e.split("\n");if(0===r.length)throw new Error("CSV file is empty");const o=r[0].split(",").map((e=>e.replace(/^"|"$/g,"").trim()));if(!o.includes("Date"))throw new Error('CSV file must contain a "Date" column');const a=[];for(let e=1;e<r.length;e++){if(!r[e].trim())continue;const n=[];let i=!1,s="";try{for(let o=0;o<r[e].length;o++){const t=r[e][o];'"'===t?i=!i:","!==t||i?s+=t:(n.push(s),s="")}n.push(s);const t={};for(let e=0;e<o.length;e++)e<n.length&&(t[o[e]]=n[e].replace(/^"|"$/g,"").trim());t.Date&&a.push(t)}catch(t){console.warn(`Skipping row ${e} due to parsing error:`,t)}}if(0===a.length)throw new Error("No valid data rows found in the CSV file");try{return Ye(a)}catch(n){if(console.error("Trade data parsing error:",n),n instanceof Error){if(n.message.includes("Invalid time value"))throw new Error('Could not parse one or more dates in the CSV file. Please ensure dates are in a standard format like "MM/DD/YYYY" or "Month Day, Year".');throw n}throw new Error("Failed to parse trade data from CSV file.")}}catch(t){throw console.error("CSV parsing error:",t),t}})(t)}else{var o;const t=null===(o=e.target)||void 0===o?void 0:o.result;n=await(async e=>{try{const n=Le.LF(new Uint8Array(e),{type:"array"});if(!n.SheetNames||0===n.SheetNames.length)throw new Error("Excel file does not contain any sheets");const r=n.Sheets[n.SheetNames[0]];if(!r)throw new Error("Excel sheet is empty or invalid");const o=Le.Wp.sheet_to_json(r);if(!o||0===o.length)throw new Error("No data found in the Excel file");if(!o[0].Date)throw new Error('Excel file must contain a "Date" column');try{return Ye(o)}catch(t){if(console.error("Trade data parsing error:",t),t instanceof Error){if(t.message.includes("Invalid time value"))throw new Error('Could not parse one or more dates in the Excel file. Please ensure dates are in a standard format like "MM/DD/YYYY" or "Month Day, Year".');throw t}throw new Error("Failed to parse trade data from Excel file.")}}catch(n){throw console.error("Excel parsing error:",n),n}})(t)}t(n)}catch(i){console.error("Import error:",i);let e="Failed to parse import file. ";i instanceof Error?i.message.includes("Invalid time value")?e+="There was an issue with a date format in your file. Please ensure all dates are in a standard format like MM/DD/YYYY.":i.message.includes("is not a function")?e+="There was an issue with the file structure. Please ensure the file has proper headers and data.":e+=i.message:e+="Please ensure the file format is correct.",n(new Error(e))}},o.onerror=()=>{n(new Error("Failed to read import file."))},"csv"===a?o.readAsText(e):o.readAsArrayBuffer(e)}));var _e=n(58128);(0,_e.Ay)(s.A)((e=>{let{theme:t}=e;return{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:t.spacing(1),padding:t.spacing(2),backgroundColor:t.palette.background.paper,borderRadius:t.shape.borderRadius,boxShadow:t.shadows[1],width:"100%",minHeight:"600px",alignContent:"start"}}));const Ge=(0,_e.Ay)(s.A)((e=>{let{theme:t}=e;return{aspectRatio:"1",minHeight:"30px",borderRadius:t.shape.borderRadius,overflow:"hidden",backgroundColor:t.palette.background.default,border:`1px solid ${t.palette.divider}`}})),He=(0,_e.Ay)(s.A)((e=>{let{theme:t}=e;return{padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary,fontSize:"0.875rem",fontWeight:500,border:`1px solid ${t.palette.divider}`,backgroundColor:t.palette.background.default,borderRadius:t.shape.borderRadius}}));var Je=n(99900),Ze=n(75499),qe=n(46577),Ke=n(29066),Qe=n(32515);const et=e=>{let{balance:t,onChange:n,trades:o,totalProfit:h,onPerformanceClick:p,riskPerTrade:g,dynamicRiskEnabled:x,increasedRiskPercentage:f,profitThresholdPercentage:y}=e;const[w,v]=(0,r.useState)(!1),[b,j]=(0,r.useState)(t.toString()),A=(0,a.A)(),I=o.length>0&&t>0?(h/t*100).toFixed(2):"0",T=t+h,S=(0,r.useMemo)((()=>{if(g)return x&&f&&y&&parseFloat(I)>=y?f:g}),[g,x,f,y,I]),W=()=>{const e=parseFloat(b);!isNaN(e)&&e>0&&(n(e),v(!1))};return(0,je.jsxs)(i.A,{elevation:2,sx:{display:"flex",flexDirection:"column",gap:1.5,p:2,borderRadius:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",position:"relative",overflow:"hidden"},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,je.jsx)(l.A,{variant:"h6",sx:{color:"text.primary",fontWeight:600,pl:1},children:"Account Balance"}),(0,je.jsx)(d.A,{title:"View Performance Analytics",children:(0,je.jsx)(c.A,{size:"small",onClick:p,sx:{color:"primary.main",bgcolor:(0,u.X4)(A.palette.primary.main,.08),"&:hover":{bgcolor:(0,u.X4)(A.palette.primary.main,.15)}},children:(0,je.jsx)(C.A,{fontSize:"small"})})})]}),w?(0,je.jsx)(m.A,{value:b,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&j(t)},onBlur:W,onKeyDown:e=>{"Enter"===e.key?W():"Escape"===e.key&&(v(!1),j(t.toString()))},size:"small",autoFocus:!0,sx:{width:"150px","& .MuiInputBase-input":{py:.8,px:1.5,fontSize:"1.1rem",fontWeight:600,color:"text.primary"}},InputProps:{startAdornment:(0,je.jsx)(l.A,{sx:{color:"text.secondary",fontSize:"1.1rem",mr:.5,fontWeight:600},children:"$"})}}):(0,je.jsxs)(l.A,{onClick:()=>v(!0),sx:{cursor:"pointer",fontSize:"1.5rem",fontWeight:700,color:"text.primary","&:hover":{color:"primary.main"},display:"flex",alignItems:"center",gap:.5},children:[(0,je.jsx)(s.A,{component:"span",sx:{fontSize:"1.1rem",color:"text.secondary",fontWeight:500},children:"$"}),t.toLocaleString()]})]}),(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:e=>(0,u.X4)(e.palette.background.default,.5),p:1.5,borderRadius:1.5,mt:.5},children:[(0,je.jsxs)(s.A,{children:[(0,je.jsx)(l.A,{variant:"body2",sx:{color:"text.secondary",mb:.5,fontWeight:500},children:"Current P&L"}),(0,je.jsxs)(l.A,{variant:"h6",sx:{fontSize:"1.2rem",color:h>0?"success.main":h<0?"error.main":"text.secondary",fontWeight:700,display:"flex",alignItems:"center",gap:.5},children:["$",o.length>0?Math.abs(h).toLocaleString():"0",(0,je.jsxs)(l.A,{component:"span",sx:{fontSize:"0.9rem",color:h>0?"success.main":h<0?"error.main":"text.secondary",fontWeight:600},children:["(",I,"%)"]})]})]}),(0,je.jsxs)(s.A,{children:[(0,je.jsx)(l.A,{variant:"body2",sx:{color:"text.secondary",mb:.5,fontWeight:500,textAlign:"right"},children:"Total Value"}),(0,je.jsxs)(l.A,{variant:"h6",sx:{fontSize:"1.2rem",color:T>t?"success.main":T<t?"error.main":"text.secondary",fontWeight:700},children:["$",T.toLocaleString()]})]})]}),g&&(0,je.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:1,mt:1},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:e=>(0,u.X4)(e.palette.primary.main,.08),p:1.5,borderRadius:1.5},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,je.jsx)(k.A,{sx:{fontSize:"1rem",color:"primary.main"}}),(0,je.jsxs)(l.A,{variant:"body2",sx:{color:"text.secondary",fontWeight:500},children:["Risk Per Trade (",S,"%)",x&&S!==g&&(0,je.jsx)(s.A,{component:"span",sx:{ml:1,color:"success.main",fontSize:"0.75rem",fontWeight:700},children:"INCREASED"})]})]}),(0,je.jsxs)(l.A,{variant:"body1",sx:{fontWeight:600,color:"primary.main"},children:["$",S?(T*S/100).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"]})]}),x&&y&&f&&(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:e=>(0,u.X4)(e.palette.background.default,.5),p:1,borderRadius:1.5,fontSize:"0.75rem"},children:[(0,je.jsxs)(l.A,{variant:"caption",sx:{color:"text.secondary"},children:["Dynamic Risk: ",parseFloat(I)>=y?(0,je.jsx)(s.A,{component:"span",sx:{color:"success.main",fontWeight:600},children:"Active"}):(0,je.jsx)(s.A,{component:"span",sx:{color:"text.secondary",fontWeight:600},children:"Inactive"})]}),(0,je.jsxs)(l.A,{variant:"caption",sx:{color:"text.secondary"},children:["Threshold: ",y,"% profit"]})]})]})]})},tt=e=>{let{trades:t,accountBalance:n,onImportTrades:o,onDeleteTrade:a,currentDate:m=new Date,monthlyTarget:v,onClearMonthTrades:b}=e;const[j,A]=(0,r.useState)(!1),k=t.filter((e=>new Date(e.date).getMonth()===m.getMonth()&&new Date(e.date).getFullYear()===m.getFullYear())),P=k.reduce(((e,t)=>e+t.amount),0),M=k.filter((e=>"win"===e.type)).length,D=k.filter((e=>"loss"===e.type)).length,E=k.length>0?(M/k.length*100).toFixed(1):"0",R=n>0?(P/n*100).toFixed(2):"0",z=v&&v>0?(parseFloat(R)/v*100).toFixed(0):"0",F=!!v&&parseFloat(R)>=v,[$,B]=(0,r.useState)("xlsx"),[N,L]=(0,r.useState)(!1),[X,U]=(0,r.useState)(!1),[O,Y]=(0,r.useState)(""),[V,_]=(0,r.useState)("success"),G=()=>{U(!1)};return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsxs)(i.A,{elevation:2,sx:{p:2,borderRadius:2,position:"relative",width:"100%",pb:{xs:5,sm:2.5},overflow:"hidden"},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,je.jsx)(l.A,{variant:"h6",sx:{mb:2,fontWeight:600,pl:.5},children:"Monthly Performance"}),(0,je.jsxs)(s.A,{sx:{position:{xs:"absolute",sm:"static"},bottom:0,left:0,right:0,display:"flex",gap:1,justifyContent:{xs:"center",sm:"flex-end"},mt:{xs:2,sm:0},flex:1,alignItems:"flex-start"},children:[(0,je.jsx)("input",{type:"file",accept:".xlsx,.csv",style:{display:"none"},id:"import-file",onChange:async e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n&&o){L(!0);try{const e=await Ve(n);o(e),Y(`Successfully imported ${e.length} trades`),_("success"),U(!0)}catch(r){console.error("Import failed:",r);const e=r instanceof Error?r.message:"Unknown error during import";Y(`Error importing trades: ${e}`),_("error"),U(!0)}finally{L(!1)}e.target.value=""}}}),(0,je.jsx)(d.A,{title:"Import trades from Excel or CSV. Custom columns will be converted to tags (e.g., 'Strategy: Breakout' becomes 'Strategy:Breakout' tag)",children:(0,je.jsx)("label",{htmlFor:"import-file",children:(0,je.jsx)(h.A,{component:"span",size:"small",variant:"outlined",startIcon:(0,je.jsx)(I.A,{}),sx:{color:"text.secondary",fontSize:"0.75rem",fontWeight:500,textTransform:"none",minWidth:"auto",p:.5,px:1,bgcolor:"background.paper",border:"1px solid",borderColor:"divider","&:hover":{bgcolor:"action.hover",color:"text.primary",borderColor:"text.primary"}},children:"Import"})})}),(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center"},children:[(0,je.jsxs)(h.A,{size:"small",variant:"outlined",startIcon:(0,je.jsx)(T.A,{}),onClick:()=>{0!==t.length&&Xe(t,n,$)},disabled:0===k.length,sx:{color:"text.secondary",fontSize:"0.75rem",fontWeight:500,textTransform:"none",minWidth:"auto",p:.5,px:1,bgcolor:"background.paper",border:"1px solid",borderColor:"divider","&:hover":{bgcolor:"action.hover",color:"text.primary",borderColor:"text.primary"},"&.Mui-disabled":{color:"text.disabled",bgcolor:"action.disabledBackground",borderColor:"divider"}},children:["Export ",$.toUpperCase()]}),(0,je.jsx)(d.A,{title:`Switch to ${"xlsx"===$?"CSV":"Excel"} format`,children:(0,je.jsx)(c.A,{size:"small",onClick:()=>{B((e=>"xlsx"===e?"csv":"xlsx"))},disabled:0===k.length,sx:{ml:.5},children:(0,je.jsx)(l.A,{variant:"caption",sx:{fontWeight:600},children:"xlsx"===$?"CSV":"XLS"})})})]}),(0,je.jsx)(h.A,{size:"small",variant:"outlined",onClick:()=>{A(!0)},disabled:0===k.length,sx:{color:"error.main",fontSize:"0.75rem",fontWeight:500,textTransform:"none",minWidth:"auto",p:.5,px:1,bgcolor:"background.paper",border:"1px solid",borderColor:"divider","&:hover":{bgcolor:e=>(0,u.X4)(e.palette.error.main,.08),borderColor:"error.main"},"&.Mui-disabled":{color:"text.disabled",bgcolor:"action.disabledBackground",borderColor:"divider"}},children:"Clear Month"})]})]}),(0,je.jsxs)(s.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(3, 1fr)"},gap:2.5,mb:2},children:[(0,je.jsxs)(s.A,{sx:{p:2,borderRadius:2,bgcolor:e=>(0,u.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:.5},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,je.jsx)(C.A,{sx:{fontSize:"1.2rem",color:P>0?"success.main":P<0?"error.main":"text.secondary"}}),(0,je.jsx)(l.A,{variant:"body1",sx:{fontWeight:600,color:"text.secondary"},children:"Monthly P&L"})]}),(0,je.jsxs)(l.A,{variant:"h5",sx:{fontWeight:700,color:P>0?"success.main":P<0?"error.main":"text.primary",display:"flex",alignItems:"baseline",gap:.5},children:[(0,ee.vv)(P),(0,je.jsxs)(l.A,{component:"span",sx:{fontSize:"1rem",color:P>0?"success.main":P<0?"error.main":"text.primary",fontWeight:600},children:["(",R,"%)"]})]}),v&&(0,je.jsxs)(s.A,{sx:{width:"100%",mt:1.5},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[(0,je.jsx)(l.A,{variant:"body2",sx:{fontWeight:500,color:"text.secondary"},children:"Target Progress"}),(0,je.jsxs)(l.A,{variant:"body2",sx:{fontWeight:600,color:F?"success.main":"primary.main"},children:[z,"%"]})]}),(0,je.jsx)(s.A,{sx:{width:"100%",height:"8px",bgcolor:e=>(0,u.X4)(e.palette.divider,.5),borderRadius:"4px",overflow:"hidden"},children:(0,je.jsx)(s.A,{sx:{width:`${Math.max(Math.min(parseFloat(z),100),0)}%`,height:"100%",bgcolor:F?"success.main":"primary.main",transition:"width 0.3s ease"}})})]})]}),(0,je.jsxs)(s.A,{sx:{p:2,borderRadius:2,bgcolor:e=>(0,u.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:.5},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,je.jsx)(S.A,{sx:{fontSize:"1.2rem",color:parseFloat(E)>50?"success.main":"text.secondary"}}),(0,je.jsx)(l.A,{variant:"body1",sx:{fontWeight:600,color:"text.secondary"},children:"Win Rate"})]}),(0,je.jsxs)(l.A,{variant:"h5",sx:{fontWeight:700,color:parseFloat(E)>50?"success.main":"text.primary"},children:[E,"%"]}),(0,je.jsxs)(l.A,{variant:"body1",sx:{fontWeight:500,color:"text.secondary",mt:.5},children:[M," Wins / ",D," Losses"]}),(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[(0,je.jsx)(s.A,{sx:{height:"10px",bgcolor:"success.main",borderRadius:"5px",flex:M||1}}),(0,je.jsx)(s.A,{sx:{height:"10px",bgcolor:"error.main",borderRadius:"5px",flex:D||1}})]})]}),(0,je.jsxs)(s.A,{sx:{p:2,borderRadius:2,bgcolor:e=>(0,u.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:.5},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,je.jsx)(W.A,{sx:{fontSize:"1.2rem",color:"text.secondary"}}),(0,je.jsx)(l.A,{variant:"body1",sx:{fontWeight:600,color:"text.secondary"},children:"Trading Activity"})]}),(0,je.jsxs)(l.A,{variant:"h5",sx:{fontWeight:700,color:"text.primary"},children:[k.length," Days"]}),(0,je.jsxs)(l.A,{variant:"body1",sx:{fontWeight:500,color:"text.secondary",mt:.5},children:[k.length>0?(k.length/30*100).toFixed(0):0,"% of Month Active"]})]})]})]}),(0,je.jsxs)(p.A,{open:j,onClose:()=>A(!1),maxWidth:"xs",fullWidth:!0,children:[(0,je.jsx)(g.A,{children:"Clear Trades"}),(0,je.jsx)(x.A,{children:(0,je.jsx)(l.A,{children:"Are you sure you want to clear all trades? This action cannot be undone."})}),(0,je.jsxs)(f.A,{children:[(0,je.jsx)(h.A,{onClick:()=>A(!1),children:"Cancel"}),(0,je.jsx)(h.A,{onClick:()=>{b&&b(m.getMonth(),m.getFullYear()),A(!1)},color:"error",children:"Clear"})]})]}),(0,je.jsx)(y.A,{open:X,autoHideDuration:"success"===V?3e3:6e3,onClose:G,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,je.jsx)(w.A,{onClose:G,severity:V,variant:"filled",sx:{width:"100%"},children:O})})]})},nt=e=>{let{date:t,trades:n,monthStart:r,weekIndex:o,currentMonth:a,accountBalance:i,weeklyTarget:d,sx:c}=e;const u=(0,X.k)(t,{weekStartsOn:0}),m=((0,U.$)(t,{weekStartsOn:0}),n.filter((e=>(0,O.R)(new Date(e.date),u,{weekStartsOn:0})&&new Date(e.date).getMonth()===a))),h=m.reduce(((e,t)=>e+t.amount),0),p=i>0?(h/i*100).toFixed(1):"0",g=d&&d>0?(parseFloat(p)/d*100).toFixed(0):"0",x=!!d&&parseFloat(p)>=d;return(0,je.jsx)(s.A,{sx:{bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",...c},children:(0,je.jsxs)(v.A,{spacing:.3,sx:{alignItems:"center"},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,je.jsx)(C.A,{sx:{fontSize:"0.875rem",color:"text.secondary"}}),(0,je.jsxs)(l.A,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Week ",o+1]})]}),(0,je.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:600,color:h>0?"success.main":h<0?"error.main":"text.primary",fontSize:"0.875rem",textAlign:"center"},children:(0,ee.vv)(h)}),(0,je.jsxs)(l.A,{variant:"caption",sx:{color:h>0?"success.main":h<0?"error.main":"text.secondary",fontSize:"0.75rem",fontWeight:500,textAlign:"center"},children:[p,"%"]}),d&&(0,je.jsx)(Be.A,{progress:parseFloat(g),isMet:x,tooltipText:`${x?"Weekly target achieved":"Progress towards weekly target"}: ${g}%`}),(0,je.jsxs)(l.A,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem",textAlign:"center"},children:[m.length," trades"]})]})})},rt=()=>({id:(0,o.A)(),name:"",amount:"",type:"win",entry:"",date:null,exit:"",tags:[],riskToReward:"",partialsTaken:!1,session:"",notes:"",pendingImages:[],uploadedImages:[]}),ot=e=>{let{allTags:t,selectedTags:n,onTagsChange:o}=e;const i=(0,a.A)(),[l,m]=(0,r.useState)(!1);return(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,je.jsx)(d.A,{title:"Filter by tags",children:(0,je.jsx)(h.A,{variant:"outlined",size:"small",startIcon:(0,je.jsx)(P.A,{}),onClick:()=>m(!0),sx:{borderColor:n.length>0?"primary.main":"divider",color:n.length>0?"primary.main":"text.secondary","&:hover":{borderColor:"primary.main",bgcolor:(0,u.X4)(i.palette.primary.main,.08)}},children:n.length>0?`${n.length} tag${n.length>1?"s":""}`:"Filter Tags"})}),n.length>0&&(0,je.jsx)(d.A,{title:"Clear all filters",children:(0,je.jsx)(c.A,{size:"small",onClick:()=>{o([])},sx:{color:"text.secondary","&:hover":{color:"error.main",bgcolor:(0,u.X4)(i.palette.error.main,.08)}},children:(0,je.jsx)(M.A,{fontSize:"small"})})}),(0,je.jsx)($e.A,{open:l,onClose:()=>m(!1),title:"Filter Trades by Tags",allTags:t,selectedTags:n,onTagsChange:o})]})},at=e=>{const{trades:t,accountBalance:n,maxDailyDrawdown:o,weeklyTarget:i,monthlyTarget:d,yearlyTarget:m,riskPerTrade:g,dynamicRiskEnabled:x,increasedRiskPercentage:f,profitThresholdPercentage:y,onAddTrade:w,onUpdateTradeProperty:C,onAccountBalanceChange:k,onImportTrades:I,calendarName:T,onClearMonthTrades:S,onToggleTheme:W,mode:P,totalPnL:M}=e,[X,O]=(0,r.useState)(new Date),[te,ne]=(0,r.useState)(null),[re,oe]=(0,r.useState)(!1),[ae,ie]=(0,r.useState)([]),[se,le]=(0,r.useState)(null),[de,ce]=(0,r.useState)(""),[ue,me]=(0,r.useState)(null),[he,pe]=(0,r.useState)(!1),ge=(0,a.A)(),fe=(0,Je.Zp)(),{calendarId:ye}=(0,Je.g)(),{user:we,signInWithGoogle:ve,signOut:be}=(0,Ke.A)(),Ae=(0,r.useMemo)((()=>{const e=new Set;return t.forEach((t=>{t.tags&&t.tags.forEach((t=>e.add(t)))})),Array.from(e).sort()}),[t]),Ce=(0,r.useMemo)((()=>0===ae.length?t:t.filter((e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.some((e=>ae.includes(e)))}))),[t,ae]),ke=(0,r.useMemo)((()=>te?Ce.filter((e=>(0,V.r)(new Date(e.date),te))):[]),[te,Ce]),Ie=(0,r.useMemo)((()=>0===ae.length&&void 0!==M?M:Ce.length>0?Ce.reduce(((e,t)=>e+t.amount),0):0),[Ce,ae,M]),Te=((0,r.useMemo)((()=>{const e=[],t=new Date(X.getFullYear(),X.getMonth(),1),n=new Date(X.getFullYear(),X.getMonth()+1,0);for(let r=t;r<=n;r.setDate(r.getDate()+1))e.push(new Date(r));return e}),[X]),(0,r.useMemo)((()=>((e,t,n)=>{const r=e.filter((e=>(0,Y.t)(new Date(e.date),t))),o=r.reduce(((e,t)=>e+t.amount),0),a=r.filter((e=>"win"===e.type)).length,i=r.filter((e=>"loss"===e.type)).length,s=r.length>0?a/r.length*100:0,l=r.filter((e=>"win"===e.type)),d=r.filter((e=>"loss"===e.type)),c=l.reduce(((e,t)=>e+t.amount),0),u=Math.abs(d.reduce(((e,t)=>e+t.amount),0));return{totalPnL:o,winRate:s,profitFactor:u>0?c/u:a>0?1/0:0,avgWin:a>0?l.reduce(((e,t)=>e+t.amount),0)/a:0,avgLoss:i>0?d.reduce(((e,t)=>e+t.amount),0)/i:0,netChange:n>0?o/n*100:0}})(Ce,X,n)),[Ce,X,n]),w?async e=>{await w(e)}:void 0);return(0,je.jsxs)(s.A,{children:[(0,je.jsx)(b.A,{position:"fixed",color:"transparent",elevation:.7,sx:{backdropFilter:"blur(8px)",backgroundColor:(0,u.X4)("light"===P?"#ffffff":ge.palette.background.default,.9),borderBottom:`1px solid ${ge.palette.divider}`},children:(0,je.jsxs)(j.A,{children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:2,flexGrow:1},children:[(0,je.jsx)(c.A,{onClick:()=>fe("/"),size:"small",sx:{color:"text.secondary","&:hover":{color:"primary.main",bgcolor:(0,u.X4)(ge.palette.primary.main,.08)}},children:(0,je.jsx)(D.A,{})}),(0,je.jsx)(l.A,{variant:"h5",component:"h1",children:T||"Calendar"})]}),we?(0,je.jsxs)(v.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,je.jsx)(c.A,{onClick:W,color:"inherit",size:"small",sx:{"&:hover":{bgcolor:(0,u.X4)(ge.palette.primary.main,.1)}},children:"dark"===P?(0,je.jsx)(E.A,{}):(0,je.jsx)(R.A,{})}),(0,je.jsxs)(v.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,je.jsx)(l.A,{variant:"body2",color:"text.secondary",children:we.email}),(0,je.jsx)(A.A,{src:we.photoURL||void 0,sx:{width:32,height:32,bgcolor:ge.palette.primary.main,fontSize:"0.875rem"},children:we.email?we.email[0].toUpperCase():"U"})]}),(0,je.jsx)(h.A,{variant:"outlined",color:"inherit",startIcon:(0,je.jsx)(z.A,{}),onClick:be,size:"small",children:"Sign Out"})]}):(0,je.jsxs)(v.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,je.jsx)(c.A,{onClick:W,color:"inherit",size:"small",sx:{"&:hover":{bgcolor:(0,u.X4)(ge.palette.primary.main,.1)}},children:"dark"===P?(0,je.jsx)(E.A,{}):(0,je.jsx)(R.A,{})}),(0,je.jsx)(h.A,{variant:"contained",startIcon:(0,je.jsx)(F.A,{}),onClick:ve,sx:{bgcolor:"#4285F4","&:hover":{bgcolor:"#3367D6"}},children:"Sign in with Google"})]})]})}),(0,je.jsx)(j.A,{})," ",(0,je.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:2,p:2,mt:1},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:2,maxWidth:"1200px",margin:"0 auto",width:"100%"},children:[(0,je.jsx)(et,{balance:n,totalProfit:Ie,onChange:k,trades:Ce,onPerformanceClick:()=>pe(!0),riskPerTrade:g,dynamicRiskEnabled:x,increasedRiskPercentage:f,profitThresholdPercentage:y}),(0,je.jsx)(tt,{trades:Ce,accountBalance:n,onImportTrades:I,currentDate:X,monthlyTarget:d,onClearMonthTrades:S}),(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5,flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:0}},children:[(0,je.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,je.jsx)(c.A,{onClick:()=>{O((e=>(0,_.a)(e,1)))},children:(0,je.jsx)($.A,{})}),(0,je.jsx)(l.A,{variant:"h5",sx:{fontWeight:800,cursor:"pointer",width:"200px",textAlign:"center",fontSize:{xs:"1.3rem",sm:"1.6rem"},letterSpacing:"-0.5px",color:"text.primary","&:hover":{color:"primary.main"}},onClick:()=>{oe(!0)},children:(0,H.GP)(X,"MMMM yyyy")}),(0,je.jsx)(c.A,{onClick:()=>{O((e=>(0,G.P)(e,1)))},children:(0,je.jsx)(B.A,{})})]}),(0,je.jsxs)(v.A,{direction:"row",spacing:1,children:[(0,je.jsx)(h.A,{startIcon:(0,je.jsx)(N.A,{}),onClick:()=>{O(new Date)},variant:"outlined",size:"small",sx:{minWidth:{xs:"100%",sm:"auto"}},children:"Today"}),(0,je.jsx)(ot,{allTags:Ae,selectedTags:ae,onTagsChange:e=>{ie(e)}})]})]}),(0,je.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,je.jsx)(s.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(7, 1fr)",sm:"repeat(8, 1fr)"},gap:.5,mb:.5},children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Week"].map(((e,t)=>(0,je.jsx)(He,{sx:{display:7===t?{xs:"none",sm:"flex"}:"flex"},children:e},e)))}),(0,je.jsx)(s.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(7, 1fr)",sm:"repeat(8, 1fr)"},gap:1},children:(0,J.Y)({start:(0,Z.w)(X),end:(0,q.p)(X)},{weekStartsOn:0}).map(((e,t)=>{const a=(0,K.k)({start:e,end:(0,U.$)(e,{weekStartsOn:0})});return(0,je.jsxs)(r.Fragment,{children:[a.map((e=>{const t=Ce.filter((t=>(0,V.r)(new Date(t.date),e))),r=((e,t,n)=>{const r=e.reduce(((e,t)=>e+t.amount),0),o=t>0?(r/t*100).toFixed(1):"0";let a="neutral";e.length>0&&(a=r>0?"win":r<0?"loss":"neutral");const i=parseFloat(o);return{netAmount:r,status:a,percentage:o,isDrawdownViolation:"loss"===a&&Math.abs(i)>n}})(t,n,o),a=(0,Y.t)(e,X),i=(0,Q.c)(e);return(0,je.jsx)(Ge,{children:(0,je.jsxs)(xe.eR,{onClick:()=>{return t=e,0==Ce.filter((e=>(0,V.r)(new Date(e.date),t))).length&&le(rt),void ne(t);var t},$isCurrentMonth:a,$dayStatus:r.status,sx:[{backgroundColor:"win"===r.status?(0,u.X4)(ge.palette.success.light,.3):"loss"===r.status?(0,u.X4)(ge.palette.error.light,.3):ge.palette.background.paper,transition:"all 0.2s ease-in-out",border:`1px solid ${ge.palette.divider}`,boxShadow:`0 1px 2px ${(0,u.X4)(ge.palette.common.black,.05)}`,"&:hover":{borderColor:ge.palette.primary.main,backgroundColor:"win"===r.status?(0,u.X4)(ge.palette.success.light,.25):"loss"===r.status?(0,u.X4)(ge.palette.error.light,.25):(0,u.X4)(ge.palette.primary.light,.1)}},!a&&{opacity:.5,backgroundColor:ge.palette.background.default},i&&{color:ge.palette.primary.main,borderColor:ge.palette.primary.main,borderWidth:2},te&&(0,V.r)(e,te)&&{borderColor:ge.palette.primary.main,borderWidth:2,backgroundColor:(0,u.X4)(ge.palette.primary.light,.1)}],children:[(0,je.jsx)(xe.kL,{$isCurrentMonth:a,children:(0,H.GP)(e,"d")}),t.length>0&&(0,je.jsx)(xe.Zg,{children:(0,je.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[(0,je.jsx)(xe.B2,{$dayStatus:r.status,children:(0,ee.vv)(Math.abs(r.netAmount))}),(0,je.jsxs)(xe.uk,{children:[t.length," trade",1!==t.length?"s":""]}),(0,je.jsxs)(l.A,{variant:"caption",sx:{color:"win"===r.status?"success.main":"loss"===r.status?"error.main":"text.secondary",fontSize:"0.75rem",fontWeight:500},children:[r.percentage,"%"]}),r.isDrawdownViolation&&(0,je.jsx)(l.A,{variant:"caption",sx:{color:"error.main",fontSize:"0.75rem",fontWeight:700,textTransform:"uppercase"},children:"VIOLATED"})]})})]})},e.toISOString())})),(0,je.jsx)(nt,{date:e,trades:Ce,monthStart:(0,Z.w)(X),weekIndex:t,currentMonth:X.getMonth(),accountBalance:n,weeklyTarget:i,sx:{display:{xs:"none",sm:"flex"}}})]},e.toISOString())}))}),(0,je.jsx)(s.A,{sx:{display:{xs:"flex",sm:"none"},flexDirection:"column",gap:1,mt:2},children:(0,J.Y)({start:(0,Z.w)(X),end:(0,q.p)(X)},{weekStartsOn:0}).map(((e,t)=>(0,je.jsx)(nt,{date:e,trades:Ce,monthStart:(0,Z.w)(X),weekIndex:t,currentMonth:X.getMonth(),accountBalance:n,weeklyTarget:i},e.toISOString())))})]})]}),(0,je.jsx)(Re,{open:!!te,onClose:()=>{ne(null),null!=se&&se.pendingImages&&(se.pendingImages.forEach((e=>{URL.revokeObjectURL(e.preview)})),le(null))},showForm:null!=se,date:te||new Date,trades:te?ke:[],onAddTrade:Te,newMainTrade:se,setNewMainTrade:e=>le(e(se)),onUpdateTradeProperty:C,calendarId:ye,onDateChange:e=>{ne(e)},setZoomedImage:me,accountBalance:n,onAccountBalanceChange:k,allTrades:t,riskPerTrade:g,dynamicRiskEnabled:x,increasedRiskPercentage:f,profitThresholdPercentage:y}),(0,je.jsx)(Qe.A,{open:!!ue,onClose:()=>me(null),imageUrl:ue}),(0,je.jsx)(ze.A,{open:re,onClose:()=>oe(!1),onDateSelect:e=>{O(e),oe(!1)},initialDate:te||void 0,trades:Ce,accountBalance:n,monthlyTarget:d,yearlyTarget:m}),(0,je.jsxs)(p.A,{open:he,onClose:()=>pe(!1),maxWidth:"lg",fullWidth:!0,...Ze.z,PaperProps:{sx:{borderRadius:2,boxShadow:"none",border:`1px solid ${ge.palette.divider}`,maxHeight:"90vh",overflow:"hidden","& .MuiDialogContent-root":{...(0,qe.J)(ge)}}},children:[(0,je.jsxs)(xe.A8,{children:[(0,je.jsx)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:(0,je.jsx)(l.A,{variant:"h6",children:"Performance Analytics"})}),(0,je.jsx)(c.A,{onClick:()=>pe(!1),size:"small",children:(0,je.jsx)(L.A,{})})]}),(0,je.jsx)(xe.DZ,{children:(0,je.jsx)(Fe.A,{trades:Ce,selectedDate:X,accountBalance:n,maxDailyDrawdown:o,monthlyTarget:d})})]})]})]})},it=at}}]);
//# sourceMappingURL=116.04bacf13.chunk.js.map