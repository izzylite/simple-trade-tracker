"use strict";(self.webpackChunkjournotrades=self.webpackChunkjournotrades||[]).push([[946],{53946:(e,r,t)=>{t.r(r),t.d(r,{default:()=>k});var s=t(65043),n=t(91283),o=t(60267),a=t(53969),i=t(29651),d=t(80172),l=t(55895),c=t(94799),g=t(91449),u=t(41859),h=t(24343),x=t(33699),p=t(42579),m=t(89935),f=t(93201),b=t(22632),y=t(3665),A=t(66524),w=t(78018),j=t(35054),v=t(70579);const k=()=>{const e=(0,n.Zp)(),r=(0,o.A)(),[t]=(0,n.ok)(),{updatePassword:k}=(0,A.W6)(),[P,S]=(0,s.useState)(""),[C,W]=(0,s.useState)(""),[R,T]=(0,s.useState)(!1),[z,E]=(0,s.useState)(!1),[N,X]=(0,s.useState)(!1),[D,I]=(0,s.useState)(null),[H,q]=(0,s.useState)(!1),[B,L]=(0,s.useState)(!1),[M,O]=(0,s.useState)(!0);(0,s.useEffect)((()=>{(async()=>{const e=t.get("error"),r=t.get("error_code"),s=t.get("error_description");if(e||"otp_expired"===r)return w.logger.error("Password reset link error:",{errorParam:e,errorCode:r,errorDescription:s}),L(!0),void O(!1);const n=t.get("code");if(!n)return w.logger.warn("No recovery code found in URL"),I("Please use the password reset link from your email to access this page."),void O(!1);try{w.logger.info("Recovery code detected, verifying session...");const{data:{session:e},error:r}=await j.N.auth.getSession();if(r||!e){w.logger.error("No session found after recovery code",r),w.logger.info("Attempting manual OTP verification");const{data:e,error:t}=await j.N.auth.verifyOtp({token_hash:n,type:"recovery"});if(t||!e.session)return w.logger.error("OTP verification failed:",t),I("Unable to verify password reset link. The link may have expired. Please request a new password reset."),void O(!1);w.logger.info("Manual OTP verification successful")}else w.logger.info("Recovery session active");O(!1)}catch(o){w.logger.error("Error handling recovery code:",o),I("An error occurred while verifying your password reset link. Please try again."),O(!1)}})()}),[t]);const _=async()=>{if(P.trim())if(P.length<8)I("Password must be at least 8 characters");else if(P===C){X(!0),I(null);try{const{data:{session:r},error:t}=await j.N.auth.getSession();if(t)throw w.logger.error("Session error:",t),new Error("Auth session missing!");if(!r)throw w.logger.error("No active session found"),new Error("Auth session missing! Please use the password reset link from your email.");w.logger.info("Active session found, updating password"),await k(P),q(!0),setTimeout((()=>{e("/dashboard",{replace:!0})}),2e3)}catch(r){w.logger.error("Failed to reset password:",r),I(r.message||"Failed to reset password. Please try again or request a new reset link."),X(!1)}}else I("Passwords do not match");else I("Please enter a new password")};return M?(0,v.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",px:2,background:"dark"===r.palette.mode?"linear-gradient(145deg, ".concat((0,i.X4)(r.palette.background.default,.95)," 0%, ").concat((0,i.X4)(r.palette.background.paper,.98)," 100%)"):"linear-gradient(145deg, rgba(248,250,252,0.98) 0%, rgba(255,255,255,0.95) 100%)"},children:[(0,v.jsx)(d.A,{size:48,sx:{mb:2}}),(0,v.jsx)(l.A,{variant:"h6",color:"text.secondary",children:"Verifying password reset link..."})]}):B?(0,v.jsx)(a.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",px:2,background:"dark"===r.palette.mode?"linear-gradient(145deg, ".concat((0,i.X4)(r.palette.background.default,.95)," 0%, ").concat((0,i.X4)(r.palette.background.paper,.98)," 100%)"):"linear-gradient(145deg, rgba(248,250,252,0.98) 0%, rgba(255,255,255,0.95) 100%)"},children:(0,v.jsxs)(c.A,{sx:{p:4,maxWidth:500,width:"100%",textAlign:"center",borderRadius:3},children:[(0,v.jsx)(m.A,{color:"error",sx:{fontSize:64,mb:2}}),(0,v.jsx)(l.A,{variant:"h5",gutterBottom:!0,fontWeight:600,children:"Reset Link Expired"}),(0,v.jsx)(l.A,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"This password reset link has expired or is no longer valid. Password reset links expire after 60 minutes for security."}),(0,v.jsxs)(g.A,{severity:"info",sx:{mb:3,textAlign:"left"},children:[(0,v.jsx)(l.A,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Common reasons for this error:"}),(0,v.jsxs)(l.A,{variant:"body2",component:"ul",sx:{m:0,pl:2},children:[(0,v.jsx)("li",{children:"The link is older than 60 minutes"}),(0,v.jsx)("li",{children:"A newer reset link was requested"}),(0,v.jsx)("li",{children:"The link was already used"}),(0,v.jsx)("li",{children:"Multiple reset attempts triggered rate limits"})]})]}),(0,v.jsx)(u.A,{variant:"contained",size:"large",fullWidth:!0,onClick:()=>e("/",{replace:!0}),sx:{py:1.5,fontSize:"1rem",fontWeight:600,textTransform:"none"},children:"Go to Home & Request New Link"})]})}):H?(0,v.jsx)(a.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",px:2,background:"dark"===r.palette.mode?"linear-gradient(145deg, ".concat((0,i.X4)(r.palette.background.default,.95)," 0%, ").concat((0,i.X4)(r.palette.background.paper,.98)," 100%)"):"linear-gradient(145deg, rgba(248,250,252,0.98) 0%, rgba(255,255,255,0.95) 100%)"},children:(0,v.jsxs)(c.A,{sx:{p:4,maxWidth:400,width:"100%",textAlign:"center",borderRadius:3},children:[(0,v.jsx)(f.A,{color:"success",sx:{fontSize:64,mb:2}}),(0,v.jsx)(l.A,{variant:"h5",gutterBottom:!0,fontWeight:600,children:"Password Reset Successful!"}),(0,v.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Your password has been updated successfully."}),(0,v.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Redirecting to dashboard..."})]})}):(0,v.jsx)(a.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",px:2,background:"dark"===r.palette.mode?"linear-gradient(145deg, ".concat((0,i.X4)(r.palette.background.default,.95)," 0%, ").concat((0,i.X4)(r.palette.background.paper,.98)," 100%)"):"linear-gradient(145deg, rgba(248,250,252,0.98) 0%, rgba(255,255,255,0.95) 100%)"},children:(0,v.jsxs)(c.A,{sx:{p:4,maxWidth:400,width:"100%",borderRadius:3},children:[(0,v.jsxs)(a.A,{sx:{textAlign:"center",mb:3},children:[(0,v.jsx)(a.A,{component:"img",src:"/android-chrome-192x192.png",alt:"JournoTrades Logo",sx:{width:60,height:60,borderRadius:"15px",mb:2,mx:"auto"}}),(0,v.jsx)(l.A,{variant:"h5",gutterBottom:!0,fontWeight:600,children:"Reset Your Password"}),(0,v.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Enter your new password below"})]}),D&&(0,v.jsx)(g.A,{severity:"error",sx:{mb:2},onClose:()=>I(null),children:D}),(0,v.jsx)(h.A,{fullWidth:!0,type:R?"text":"password",label:"New Password",value:P,onChange:e=>{S(e.target.value),I(null)},disabled:N,sx:{mb:2},InputProps:{endAdornment:(0,v.jsx)(x.A,{position:"end",children:(0,v.jsx)(p.A,{onClick:()=>T(!R),edge:"end",children:R?(0,v.jsx)(b.A,{}):(0,v.jsx)(y.A,{})})})},helperText:"Minimum 8 characters"}),(0,v.jsx)(h.A,{fullWidth:!0,type:z?"text":"password",label:"Confirm Password",value:C,onChange:e=>{W(e.target.value),I(null)},disabled:N,onKeyPress:e=>{"Enter"===e.key&&_()},sx:{mb:3},InputProps:{endAdornment:(0,v.jsx)(x.A,{position:"end",children:(0,v.jsx)(p.A,{onClick:()=>E(!z),edge:"end",children:z?(0,v.jsx)(b.A,{}):(0,v.jsx)(y.A,{})})})}}),(0,v.jsx)(u.A,{variant:"contained",size:"large",fullWidth:!0,onClick:_,disabled:N||!P.trim()||!C.trim(),sx:{py:1.5,fontSize:"1rem",fontWeight:600,textTransform:"none",mb:2},children:N?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(d.A,{size:20,sx:{mr:1},color:"inherit"}),"Resetting Password..."]}):"Reset Password"}),(0,v.jsx)(a.A,{sx:{textAlign:"center"},children:(0,v.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Remember your password?"," ",(0,v.jsx)(u.A,{onClick:()=>e("/",{replace:!0}),sx:{textTransform:"none",p:0,minWidth:"auto",fontWeight:600,"&:hover":{bgcolor:"transparent",textDecoration:"underline"}},children:"Sign in"})]})})]})})}},89935:(e,r,t)=>{t.d(r,{A:()=>o});var s=t(14057),n=t(70579);const o=(0,s.A)((0,n.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error")}}]);
//# sourceMappingURL=946.ee975a24.chunk.js.map