{"version":3,"file":"static/js/673.b1d6f19c.chunk.js","mappings":"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","sources":["pages/AuthCallbackPage.tsx"],"sourcesContent":["/**\r\n * Auth Callback Component\r\n * Handles OAuth callback from Supabase Auth\r\n *\r\n * Following Supabase best practices:\r\n * - Uses onAuthStateChange for event-driven authentication\r\n * - No manual delays or polling\r\n * - Proper cleanup of auth listeners\r\n */\r\n\r\nimport React, { useEffect, useState, useRef } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { Box, CircularProgress, Typography, Alert } from '@mui/material';\r\nimport { supabase } from '../config/supabase';\r\nimport { logger } from '../utils/logger';\r\n\r\nconst AuthCallback: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const [searchParams] = useSearchParams();\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isProcessing, setIsProcessing] = useState(true);\r\n  const hasRedirected = useRef(false);\r\n\r\n  useEffect(() => {\r\n    logger.info('AuthCallback: Starting callback handling');\r\n    logger.info('AuthCallback: Current URL:', window.location.href);\r\n    logger.info('AuthCallback: Search params:', Object.fromEntries(searchParams.entries()));\r\n\r\n    // Check for OAuth errors first\r\n    const oauthError = searchParams.get('error');\r\n    const errorDescription = searchParams.get('error_description');\r\n\r\n    if (oauthError) {\r\n      logger.error('OAuth error:', oauthError, errorDescription);\r\n      setError(errorDescription || oauthError);\r\n      setIsProcessing(false);\r\n      return;\r\n    }\r\n\r\n    // Check if we have a code parameter (PKCE flow)\r\n    // The code exchange happens async, so we need to wait for it\r\n    const hasCode = searchParams.has('code');\r\n    logger.info('AuthCallback: Has code param:', hasCode);\r\n\r\n    // Set up auth state listener for event-driven authentication\r\n    // This is the recommended Supabase pattern instead of polling\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {\r\n      logger.info('AuthCallback: Auth event received:', event);\r\n\r\n      // Prevent multiple redirects\r\n      if (hasRedirected.current) {\r\n        return;\r\n      }\r\n\r\n      if (event === 'SIGNED_IN' && session) {\r\n        logger.info('Authentication successful via SIGNED_IN event');\r\n        logger.info('Session user:', session.user.email);\r\n        hasRedirected.current = true;\r\n        navigate('/dashboard', { replace: true });\r\n      } else if (event === 'INITIAL_SESSION' && session) {\r\n        // Handle case where session already exists on page load\r\n        logger.info('Authentication successful via INITIAL_SESSION event');\r\n        logger.info('Session user:', session.user.email);\r\n        hasRedirected.current = true;\r\n        navigate('/dashboard', { replace: true });\r\n      } else if (event === 'INITIAL_SESSION' && !session) {\r\n        // No session on initial check - but if we have a code, wait for SIGNED_IN\r\n        // PKCE code exchange happens async after INITIAL_SESSION fires\r\n        if (hasCode) {\r\n          logger.info('AuthCallback: No session yet, but code present - waiting for PKCE exchange');\r\n          // Don't set error yet, wait for code exchange to complete\r\n        } else {\r\n          // No code and no session - this is a direct navigation, redirect home\r\n          logger.info('AuthCallback: No code and no session - redirecting to home');\r\n          hasRedirected.current = true;\r\n          navigate('/', { replace: true });\r\n        }\r\n      }\r\n    });\r\n\r\n    // Set a timeout for PKCE code exchange - if it takes too long, show error\r\n    let timeoutId: NodeJS.Timeout | undefined;\r\n    if (hasCode) {\r\n      timeoutId = setTimeout(() => {\r\n        if (!hasRedirected.current) {\r\n          logger.error('AuthCallback: PKCE code exchange timeout');\r\n          setError('Authentication timed out. Please try signing in again.');\r\n          setIsProcessing(false);\r\n        }\r\n      }, 15000); // 15 second timeout for code exchange\r\n    }\r\n\r\n    // Cleanup function to unsubscribe from auth changes\r\n    return () => {\r\n      logger.info('AuthCallback: Cleaning up auth listener');\r\n      subscription.unsubscribe();\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n      }\r\n    };\r\n  }, [navigate, searchParams]);\r\n\r\n  // Auto-redirect to home after error\r\n  useEffect(() => {\r\n    if (error) {\r\n      const timer = setTimeout(() => {\r\n        navigate('/', { replace: true });\r\n      }, 5000);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [error, navigate]);\r\n\r\n  if (isProcessing) {\r\n    return (\r\n      <Box\r\n        sx={{\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          alignItems: 'center',\r\n          justifyContent: 'center',\r\n          minHeight: '100vh',\r\n          gap: 2,\r\n          px: 2\r\n        }}\r\n      >\r\n        <CircularProgress size={48} />\r\n        <Typography variant=\"h6\" color=\"text.secondary\">\r\n          Completing sign in...\r\n        </Typography>\r\n        <Typography variant=\"body2\" color=\"text.secondary\" textAlign=\"center\">\r\n          Please wait while we finish setting up your account.\r\n        </Typography>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Box\r\n        sx={{\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          alignItems: 'center',\r\n          justifyContent: 'center',\r\n          minHeight: '100vh',\r\n          gap: 2,\r\n          px: 2,\r\n          maxWidth: 500,\r\n          mx: 'auto'\r\n        }}\r\n      >\r\n        <Alert severity=\"error\" sx={{ width: '100%' }}>\r\n          <Typography variant=\"h6\" gutterBottom>\r\n            Authentication Failed\r\n          </Typography>\r\n          <Typography variant=\"body2\">\r\n            {error}\r\n          </Typography>\r\n        </Alert>\r\n        <Typography variant=\"body2\" color=\"text.secondary\" textAlign=\"center\">\r\n          You will be redirected to the home page in a few seconds.\r\n        </Typography>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport default AuthCallback;\r\n"],"names":["AuthCallback","navigate","useNavigate","searchParams","useSearchParams","error","setError","useState","isProcessing","setIsProcessing","hasRedirected","useRef","useEffect","logger","info","window","location","href","Object","fromEntries","entries","oauthError","get","errorDescription","hasCode","has","data","subscription","supabase","auth","onAuthStateChange","event","session","current","user","email","replace","timeoutId","setTimeout","unsubscribe","clearTimeout","timer","_jsxs","Box","sx","display","flexDirection","alignItems","justifyContent","minHeight","gap","px","children","_jsx","CircularProgress","size","Typography","variant","color","textAlign","maxWidth","mx","Alert","severity","width","gutterBottom"],"sourceRoot":""}