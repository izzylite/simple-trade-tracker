{"version":3,"file":"static/js/431.b54b124c.chunk.js","mappings":"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","sources":["pages/SharedCalendarPage.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from 'react';\r\nimport { useParams, useLocation, useNavigate } from 'react-router-dom';\r\nimport {\r\n  Box,\r\n  Container,\r\n  Toolbar,\r\n  Alert,\r\n  ThemeProvider,\r\n  CssBaseline,\r\n  CircularProgress,\r\n  Typography\r\n} from '@mui/material';\r\nimport { createTheme } from '@mui/material/styles';\r\nimport { createAppTheme } from '../theme';\r\nimport { TradeCalendar } from './TradeCalendarPage';\r\nimport AppHeader from '../components/common/AppHeader';\r\nimport { getSharedTradesWithCalendar } from '../services/sharingService';\r\nimport { Trade, Calendar } from '../types/dualWrite';\r\nimport { logger } from '../utils/logger';\r\n\r\ninterface SharedCalendarData {\r\n  calendar: Calendar;\r\n  trades: Trade[];\r\n  shareInfo: {\r\n    id: string;\r\n    createdAt: Date;\r\n    viewCount: number;\r\n    userId: string;\r\n  };\r\n}\r\n\r\nconst SharedCalendarPage: React.FC = () => {\r\n  const { shareId } = useParams<{ shareId: string }>();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n\r\n  // Check if we came from a referrer (link click)\r\n  const referrerState = location.state as { referrer?: string; referrerCalendarId?: string } | null;\r\n\r\n  // Local theme mode state for shared calendar page\r\n  const [mode, setMode] = useState<'light' | 'dark'>(() => {\r\n    // Get saved theme preference or default to light\r\n    const savedMode = localStorage.getItem('themeMode');\r\n    return (savedMode as 'light' | 'dark') || 'light';\r\n  });\r\n\r\n  const [calendarData, setCalendarData] = useState<SharedCalendarData | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isLoadingTrades, setIsLoadingTrades] = useState<boolean>(false);\r\n  const [loadingAction, setLoadingAction] = useState<'loading' | 'importing' | 'exporting'>('loading');\r\n\r\n  // Update theme mode in localStorage when it changes\r\n  useEffect(() => {\r\n    localStorage.setItem('themeMode', mode);\r\n  }, [mode]);\r\n\r\n  const handleToggleTheme = () => {\r\n    setMode(prevMode => prevMode === 'light' ? 'dark' : 'light');\r\n  };\r\n\r\n  const handleSetLoading = (\r\n    loading: boolean,\r\n    action: 'loading' | 'importing' | 'exporting' = 'loading'\r\n  ) => {\r\n    setIsLoadingTrades(loading);\r\n    setLoadingAction(action);\r\n  };\r\n\r\n  // Handle back navigation\r\n  const handleBackClick = () => {\r\n    if (referrerState?.referrer) {\r\n      navigate(referrerState.referrer);\r\n    } else {\r\n      navigate('/');\r\n    }\r\n  };\r\n\r\n  // Create theme based on current mode\r\n  const theme = useMemo(() => createTheme(createAppTheme(mode)), [mode]);\r\n\r\n  useEffect(() => {\r\n    const fetchSharedCalendar = async () => {\r\n      if (!shareId) {\r\n        setError('Invalid share link');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        const data = await getSharedTradesWithCalendar(shareId);\r\n\r\n        // Data is already in the correct format from the service\r\n        const calendar: Calendar = data.calendar;\r\n        const trades: Trade[] = data.trades;\r\n\r\n        const shareInfo = {\r\n          ...data.shareInfo,\r\n          createdAt: new Date(data.shareInfo.createdAt)\r\n        };\r\n\r\n        setCalendarData({\r\n          calendar,\r\n          trades,\r\n          shareInfo\r\n        });\r\n\r\n        // Update document title\r\n        document.title = `${calendar.name} - Shared Calendar | Trade Tracker`;\r\n\r\n      } catch (error: any) {\r\n        logger.error('Error fetching shared calendar:', error);\r\n\r\n        if (error.code === 'functions/not-found') {\r\n          setError('This shared calendar could not be found. It may have been removed or the link is invalid.');\r\n        } else if (error.code === 'functions/permission-denied') {\r\n          setError('This shared calendar is no longer available.');\r\n        } else {\r\n          setError('Failed to load shared calendar. Please try again later.');\r\n        }\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchSharedCalendar();\r\n  }, [shareId]);\r\n\r\n  if (!shareId) {\r\n    return (\r\n      <ThemeProvider theme={theme}>\r\n        <CssBaseline />\r\n        <Box sx={{ minHeight: '100vh', backgroundColor: 'custom.pageBackground' }}>\r\n          <AppHeader\r\n            onToggleTheme={handleToggleTheme}\r\n            mode={mode}\r\n          />\r\n          <Toolbar sx={{ pl: 0, pr: 0 }} />\r\n\r\n          <Container\r\n            maxWidth=\"md\"\r\n            sx={{\r\n              pt: { xs: 2, sm: 4 },\r\n              pb: { xs: 2, sm: 4 },\r\n              px: { xs: 1, sm: 3 }\r\n            }}\r\n          >\r\n            <Alert severity=\"error\">\r\n              Invalid share link\r\n            </Alert>\r\n          </Container>\r\n        </Box>\r\n      </ThemeProvider>\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <ThemeProvider theme={theme}>\r\n        <CssBaseline />\r\n        <Box sx={{ minHeight: '100vh', backgroundColor: 'custom.pageBackground' }}>\r\n          <AppHeader\r\n            onToggleTheme={handleToggleTheme}\r\n            mode={mode}\r\n          />\r\n          <Toolbar sx={{ pl: 0, pr: 0 }} />\r\n\r\n          <Container\r\n            maxWidth=\"md\"\r\n            sx={{\r\n              pt: { xs: 2, sm: 4 },\r\n              pb: { xs: 2, sm: 4 },\r\n              px: { xs: 1, sm: 3 },\r\n              display: 'flex',\r\n              flexDirection: 'column',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              minHeight: '50vh'\r\n            }}\r\n          >\r\n            <CircularProgress size={60} sx={{ mb: 2 }} />\r\n            <Typography variant=\"h6\" color=\"text.secondary\">\r\n              Loading shared calendar...\r\n            </Typography>\r\n          </Container>\r\n        </Box>\r\n      </ThemeProvider>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <ThemeProvider theme={theme}>\r\n        <CssBaseline />\r\n        <Box sx={{ minHeight: '100vh', backgroundColor: 'custom.pageBackground' }}>\r\n          <AppHeader\r\n            onToggleTheme={handleToggleTheme}\r\n            mode={mode}\r\n          />\r\n          <Toolbar sx={{ pl: 0, pr: 0 }} />\r\n\r\n          <Container\r\n            maxWidth=\"md\"\r\n            sx={{\r\n              pt: { xs: 2, sm: 4 },\r\n              pb: { xs: 2, sm: 4 },\r\n              px: { xs: 1, sm: 3 }\r\n            }}\r\n          >\r\n            <Alert severity=\"error\" sx={{ mb: 2 }}>\r\n              <Typography variant=\"h6\" gutterBottom>\r\n                Calendar Not Found\r\n              </Typography>\r\n              <Typography variant=\"body2\">\r\n                {error}\r\n              </Typography>\r\n            </Alert>\r\n            <Typography variant=\"body2\" color=\"text.secondary\" sx={{ textAlign: 'center', mt: 3 }}>\r\n              If you believe this is an error, please contact the person who shared this calendar with you.\r\n            </Typography>\r\n          </Container>\r\n        </Box>\r\n      </ThemeProvider>\r\n    );\r\n  }\r\n\r\n  if (!calendarData) {\r\n    return (\r\n      <ThemeProvider theme={theme}>\r\n        <CssBaseline />\r\n        <Box sx={{ minHeight: '100vh', backgroundColor: 'custom.pageBackground' }}>\r\n          <AppHeader\r\n            onToggleTheme={handleToggleTheme}\r\n            mode={mode}\r\n          />\r\n          <Toolbar sx={{ pl: 0, pr: 0 }} />\r\n\r\n          <Container\r\n            maxWidth=\"md\"\r\n            sx={{\r\n              pt: { xs: 2, sm: 4 },\r\n              pb: { xs: 2, sm: 4 },\r\n              px: { xs: 1, sm: 3 }\r\n            }}\r\n          >\r\n            <Alert severity=\"warning\">\r\n              <Typography variant=\"h6\" gutterBottom>\r\n                No Calendar Data\r\n              </Typography>\r\n              <Typography variant=\"body2\">\r\n                The shared calendar data could not be loaded.\r\n              </Typography>\r\n            </Alert>\r\n          </Container>\r\n        </Box>\r\n      </ThemeProvider>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CssBaseline />\r\n      <Box sx={{ minHeight: '100vh', backgroundColor: 'custom.pageBackground' }}>\r\n        <AppHeader\r\n          onToggleTheme={handleToggleTheme}\r\n          mode={mode}\r\n        />\r\n          <Toolbar sx={{ pl: 0, pr: 0 }} />\r\n\r\n\r\n\r\n\r\n\r\n        {/* Calendar Content - Using TradeCalendar in read-only mode */}\r\n        {/* Trades are fetched directly by useCalendarTrades via RLS policies */}\r\n        <TradeCalendar\r\n          calendar={calendarData.calendar}\r\n          setLoading={handleSetLoading}\r\n          onToggleTheme={handleToggleTheme}\r\n          mode={mode}\r\n          isReadOnly={true}\r\n        />\r\n\r\n        {/* Share Statistics */}\r\n        <Container maxWidth=\"lg\" sx={{ py: 2 }}>\r\n          <Box sx={{ textAlign: 'center' }}>\r\n            <Typography variant=\"caption\" color=\"text.secondary\">\r\n              This calendar has been viewed {calendarData.shareInfo.viewCount} time{calendarData.shareInfo.viewCount !== 1 ? 's' : ''}\r\n            </Typography>\r\n          </Box>\r\n        </Container>\r\n      </Box>\r\n    </ThemeProvider>\r\n  );\r\n};\r\n\r\nexport default SharedCalendarPage;\r\n"],"names":["SharedCalendarPage","shareId","useParams","location","useLocation","mode","setMode","useNavigate","state","useState","localStorage","getItem","calendarData","setCalendarData","loading","setLoading","error","setError","isLoadingTrades","setIsLoadingTrades","loadingAction","setLoadingAction","useEffect","setItem","handleToggleTheme","prevMode","theme","useMemo","createTheme","createAppTheme","async","data","getSharedTradesWithCalendar","calendar","trades","shareInfo","_objectSpread","createdAt","Date","document","title","concat","name","logger","code","fetchSharedCalendar","_jsxs","ThemeProvider","children","_jsx","CssBaseline","Box","sx","minHeight","backgroundColor","AppHeader","onToggleTheme","Toolbar","pl","pr","Container","maxWidth","pt","xs","sm","pb","px","display","flexDirection","alignItems","justifyContent","CircularProgress","size","mb","Typography","variant","color","Alert","severity","gutterBottom","textAlign","mt","TradeCalendar","action","arguments","length","undefined","isReadOnly","py","viewCount"],"sourceRoot":""}