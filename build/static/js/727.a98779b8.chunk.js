"use strict";(self.webpackChunkjournotrades=self.webpackChunkjournotrades||[]).push([[727],{4890:(e,t,r)=>{r.d(t,{A:()=>h});var n=r(89379),a=r(65043),o=r(60267),s=r(29651),i=r(57268),l=r(53969),c=r(55895),d=r(42579),u=r(27421),g=r(70579);const h=e=>{let{open:t,onClose:r,anchor:h="right",keepMounted:p=!1,title:m,subtitle:x,icon:f,headerActions:y,children:v,width:A={xs:"100%",sm:450},maxWidth:b="100vw",zIndex:j=1300,headerVariant:w="enhanced",sx:k,headerSx:C,contentSx:S}=e;const _=(0,o.A)(),T={background:"dark"===_.palette.mode?"linear-gradient(135deg, rgba(18, 18, 18, 0.95) 0%, rgba(30, 30, 30, 0.95) 100%)":"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%)",backdropFilter:"blur(20px)",borderLeft:"right"===h?"1px solid ".concat((0,s.X4)(_.palette.divider,.1)):void 0,borderRight:"left"===h?"1px solid ".concat((0,s.X4)(_.palette.divider,.1)):void 0,boxShadow:"dark"===_.palette.mode?"0 8px 32px rgba(0, 0, 0, 0.4)":"0 8px 32px rgba(0, 0, 0, 0.12)"},I={p:3,borderBottom:"1px solid ".concat((0,s.X4)(_.palette.divider,.1)),display:"flex",alignItems:"center",gap:2,background:(0,s.X4)(_.palette.background.paper,.8),backdropFilter:"blur(10px)"},M={p:2,borderBottom:"1px solid ".concat(_.palette.divider),display:"flex",alignItems:"center",gap:2},E="enhanced"===w?I:M;return(0,g.jsx)(i.Ay,{anchor:h,open:t,onClose:r,ModalProps:{keepMounted:p},sx:(0,n.A)({zIndex:j,"& .MuiDrawer-paper":(0,n.A)({width:A,maxWidth:b,zIndex:j},"enhanced"===w?T:{})},k),children:(0,g.jsxs)(l.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,g.jsxs)(l.A,{sx:(0,n.A)((0,n.A)({},E),C),children:[f&&(0,g.jsx)(l.A,{sx:{p:"enhanced"===w?1.5:1,borderRadius:"enhanced"===w?2:1,background:"enhanced"===w?"linear-gradient(135deg, ".concat((0,s.X4)(_.palette.primary.main,.1)," 0%, ").concat((0,s.X4)(_.palette.primary.main,.05)," 100%)"):(0,s.X4)(_.palette.primary.main,.1),border:"enhanced"===w?"1px solid ".concat((0,s.X4)(_.palette.primary.main,.2)):void 0,display:"flex",alignItems:"center",justifyContent:"center"},children:a.isValidElement(f)&&"string"!==typeof f.type?a.cloneElement(f,{sx:{color:"primary.main",fontSize:"enhanced"===w?22:20}}):a.isValidElement(f)?a.cloneElement(f,{style:{color:"var(--mui-palette-primary-main)",fontSize:"enhanced"===w?22:20}}):f}),(0,g.jsxs)(l.A,{sx:{flex:1},children:[(0,g.jsx)(c.A,{variant:"h6",sx:{fontWeight:"enhanced"===w?700:600,mb:x?.5:0},children:m}),x&&(0,g.jsx)(c.A,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.75rem"},children:x})]}),y,(0,g.jsx)(d.A,{onClick:r,size:"small",children:(0,g.jsx)(u.A,{})})]}),(0,g.jsx)(l.A,{sx:(0,n.A)({flex:1,overflow:"auto"},S),children:v})]})})}},9475:(e,t,r)=>{r.d(t,{A:()=>w});var n=r(65043),a=r(60267),o=r(41859),s=r(80172),i=r(70298),l=r(24343),c=r(53969),d=r(55895),u=r(91244),g=r(88578),h=r(29651),p=r(26529),m=r(42579),x=r(1725),f=r(85030),y=r(5362),v=r(20312),A=r(94808),b=r(38508);r(78018);var j=r(70579);const w=e=>{let{open:t,onClose:r,onSubmit:w,initialData:k,isSubmitting:C,mode:S,title:_,submitButtonText:T}=e;const I=(0,a.A)(),[M,E]=(0,n.useState)(""),[z,D]=(0,n.useState)(""),[R,W]=(0,n.useState)(""),[P,N]=(0,n.useState)(""),[F,L]=(0,n.useState)(""),[X,O]=(0,n.useState)(""),[B,U]=(0,n.useState)(""),[q,G]=(0,n.useState)(!1),[H,Y]=(0,n.useState)(""),[V,K]=(0,n.useState)(""),[J,$]=(0,n.useState)(""),[Q,Z]=(0,n.useState)(void 0),[ee,te]=(0,n.useState)(!1);(0,n.useEffect)((()=>{var e,r,n,a,o,s,i,l;t&&(k?(E(k.name||""),D((null===(e=k.account_balance)||void 0===e?void 0:e.toString())||""),W((null===(r=k.max_daily_drawdown)||void 0===r?void 0:r.toString())||""),N((null===(n=k.weekly_target)||void 0===n?void 0:n.toString())||""),L((null===(a=k.monthly_target)||void 0===a?void 0:a.toString())||""),O((null===(o=k.yearly_target)||void 0===o?void 0:o.toString())||""),U((null===(s=k.risk_per_trade)||void 0===s?void 0:s.toString())||""),G(k.dynamic_risk_enabled||!1),Y((null===(i=k.increased_risk_percentage)||void 0===i?void 0:i.toString())||""),K((null===(l=k.profit_threshold_percentage)||void 0===l?void 0:l.toString())||""),$(k.hero_image_url||""),Z(k.hero_image_attribution)):re())}),[t,k,S]);const re=()=>{E(""),D(""),W(""),N(""),L(""),O(""),U(""),G(!1),Y(""),K(""),$(""),Z(void 0)},ne=M.trim()&&z.trim()&&R.trim(),ae=_,oe=(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(o.A,{onClick:r,disabled:C,children:"Cancel"}),(0,j.jsxs)(o.A,{onClick:async()=>{if(M.trim()&&z.trim()&&R.trim()){const e=parseFloat(z),t=parseFloat(R),r=P.trim()?parseFloat(P):void 0,n=F.trim()?parseFloat(F):void 0,a=X.trim()?parseFloat(X):void 0,o=B.trim()?parseFloat(B):void 0,s=H.trim()?parseFloat(H):void 0,i=V.trim()?parseFloat(V):void 0;!isNaN(e)&&e>=0&&!isNaN(t)&&t>0&&(void 0===r||!isNaN(r)&&r>0)&&(void 0===n||!isNaN(n)&&n>0)&&(void 0===a||!isNaN(a)&&a>0)&&(void 0===o||!isNaN(o)&&o>0)&&(void 0===s||!isNaN(s)&&s>0)&&(void 0===i||!isNaN(i)&&i>0)&&await w({name:M.trim(),account_balance:e,max_daily_drawdown:t,weekly_target:r,monthly_target:n,yearly_target:a,risk_per_trade:o,dynamic_risk_enabled:q,increased_risk_percentage:s,profit_threshold_percentage:i,hero_image_url:J||void 0,hero_image_attribution:Q})}},variant:"contained",disabled:!ne||C,sx:{minWidth:100,display:"flex",alignItems:"center",gap:1},children:[T,C&&(0,j.jsx)(s.A,{size:20,color:"inherit"})]})]});return(0,j.jsxs)(A.mY,{open:t,onClose:()=>!C&&r(),maxWidth:"xs",fullWidth:!0,title:ae,actions:oe,hideFooterCancelButton:!0,children:[(0,j.jsxs)(i.A,{spacing:2,sx:{mt:1},children:[(0,j.jsx)(l.A,{label:"Calendar Name",fullWidth:!0,value:M,onChange:e=>E(e.target.value),autoFocus:!0}),(0,j.jsxs)(c.A,{children:[(0,j.jsx)(d.A,{variant:"subtitle2",sx:{mb:1.5,fontWeight:600},children:"Cover Image (Optional)"}),J?(0,j.jsxs)(u.A,{sx:{position:"relative",borderRadius:2,overflow:"hidden",border:"1px solid",borderColor:"divider"},children:[(0,j.jsx)(g.A,{component:"div",sx:{height:120,backgroundImage:"url(".concat(J,")"),backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, ".concat((0,h.X4)(I.palette.common.black,.1),", ").concat((0,h.X4)(I.palette.common.black,.3),")"),zIndex:1}}}),(0,j.jsx)(c.A,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1,zIndex:2},children:(0,j.jsx)(p.A,{title:"Remove image",children:(0,j.jsx)(m.A,{size:"small",onClick:()=>{$(""),Z(void 0)},sx:{backgroundColor:(0,h.X4)(I.palette.error.main,.9),color:"white","&:hover":{backgroundColor:I.palette.error.main}},children:(0,j.jsx)(y.A,{fontSize:"small"})})})}),Q&&(0,j.jsx)(c.A,{sx:{position:"absolute",bottom:4,right:4,backgroundColor:(0,h.X4)(I.palette.common.black,.7),color:"white",px:1,py:.5,borderRadius:.5,zIndex:2},children:(0,j.jsxs)(d.A,{variant:"caption",sx:{fontSize:"0.6rem"},children:["\ud83d\udcf8 ",Q.photographer]})})]}):(0,j.jsx)(o.A,{variant:"outlined",startIcon:(0,j.jsx)(v.A,{}),onClick:()=>te(!0),sx:{height:120,borderStyle:"dashed",borderColor:"divider",color:"text.secondary","&:hover":{borderColor:"primary.main",color:"primary.main",backgroundColor:(0,h.X4)(I.palette.primary.main,.04)}},fullWidth:!0,children:"Add Cover Image"})]}),(0,j.jsx)(l.A,{label:"create"===S?"Initial Account Balance":"Account Balance",fullWidth:!0,value:z,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&D(t)},type:"number",InputProps:{startAdornment:(0,j.jsx)(c.A,{component:"span",sx:{mr:1},children:"$"})}}),(0,j.jsx)(l.A,{label:"Max Daily Drawdown (%)",fullWidth:!0,value:R,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&W(t)},type:"number",InputProps:{endAdornment:(0,j.jsx)(c.A,{component:"span",sx:{ml:1},children:"%"})},helperText:"Maximum allowed loss percentage per day"}),(0,j.jsx)(l.A,{label:"Weekly Target (%)",fullWidth:!0,value:P,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&N(t)},type:"number",InputProps:{endAdornment:(0,j.jsx)(c.A,{component:"span",sx:{ml:1},children:"%"})},helperText:"Target profit percentage per week"}),(0,j.jsx)(l.A,{label:"Monthly Target (%)",fullWidth:!0,value:F,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&L(t)},type:"number",InputProps:{endAdornment:(0,j.jsx)(c.A,{component:"span",sx:{ml:1},children:"%"})},helperText:"Target profit percentage per month"}),(0,j.jsx)(l.A,{label:"Yearly Target (%)",fullWidth:!0,value:X,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&O(t)},type:"number",InputProps:{endAdornment:(0,j.jsx)(c.A,{component:"span",sx:{ml:1},children:"%"})},helperText:"Target profit percentage per year"}),(0,j.jsx)(l.A,{label:"Risk Per Trade (%)",fullWidth:!0,value:B,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&U(t)},type:"number",InputProps:{endAdornment:(0,j.jsx)(c.A,{component:"span",sx:{ml:1},children:"%"})},helperText:"Percentage of account balance to risk per trade (optional)"}),B&&(0,j.jsxs)(c.A,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,p:2,mt:1},children:[(0,j.jsx)(d.A,{variant:"subtitle2",sx:{mb:1.5,fontWeight:600},children:"Dynamic Risk Settings"}),(0,j.jsx)(x.A,{control:(0,j.jsx)(f.A,{checked:q,onChange:e=>G(e.target.checked),color:"primary"}),label:"Enable Dynamic Risk",sx:{mb:1.5}}),q&&(0,j.jsxs)(i.A,{spacing:2,children:[(0,j.jsx)(l.A,{label:"Profit Threshold (%)",fullWidth:!0,value:V,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&K(t)},type:"number",InputProps:{endAdornment:(0,j.jsx)(c.A,{component:"span",sx:{ml:1},children:"%"})},helperText:"Increase risk when profit exceeds this percentage",size:"small"}),(0,j.jsx)(l.A,{label:"Increased Risk (%)",fullWidth:!0,value:H,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&Y(t)},type:"number",InputProps:{endAdornment:(0,j.jsx)(c.A,{component:"span",sx:{ml:1},children:"%"})},helperText:"New risk percentage when profit threshold is exceeded",size:"small"})]})]})]}),(0,j.jsx)(b.A,{open:ee,onClose:()=>te(!1),onImageSelect:(e,t)=>{$(e),Z(t),te(!1)},title:"Choose a cover image for your calendar"})]})}},16476:(e,t,r)=>{r.d(t,{G:()=>o});var n=r(35054),a=r(78018);const o={async fetchTagDefinitions(e){if(!e)return{};try{const{data:t,error:r}=await n.N.from("tag_definitions").select("tag_name, definition").eq("user_id",e);if(r)return a.logger.error("Error fetching tag definitions:",r),{};const o={};return null===t||void 0===t||t.forEach((e=>{o[e.tag_name]=e.definition})),o}catch(t){return a.logger.error("Error fetching tag definitions:",t),{}}},async fetchTagDefinition(e,t){if(!e||!t)return"";try{const{data:r,error:o}=await n.N.from("tag_definitions").select("definition").eq("user_id",e).eq("tag_name",t).single();return o&&"PGRST116"!==o.code&&a.logger.error("Error fetching tag definition:",o),(null===r||void 0===r?void 0:r.definition)||""}catch(r){return a.logger.error("Error fetching tag definition:",r),""}},async saveTagDefinition(e,t,r,o){if(!e||!t)return;const s=r.trim();if(void 0===o||s!==o.trim())try{if(s){const{error:r}=await n.N.from("tag_definitions").upsert({user_id:e,tag_name:t,definition:s,updated_at:(new Date).toISOString()},{onConflict:"user_id,tag_name"});if(r)throw a.logger.error("Error saving tag definition:",r),r}else o&&await this.deleteTagDefinition(e,t)}catch(i){throw a.logger.error("Error saving tag definition:",i),i}},async deleteTagDefinition(e,t){if(e&&t)try{const{error:r}=await n.N.from("tag_definitions").delete().eq("user_id",e).eq("tag_name",t);if(r)throw a.logger.error("Error deleting tag definition:",r),r}catch(r){throw a.logger.error("Error deleting tag definition:",r),r}}}},21161:(e,t,r)=>{r.d(t,{A:()=>$});var n=r(80045),a=r(59526),o=r(89379),s=r(65043),i=r(60267),l=r(53969),c=r(29651),d=r(33539),u=r(55895),g=r(26529),h=r(42579),p=r(24343),m=r(33699),x=r(95315),f=r(57401),y=r(94527),v=r(91449),A=r(78403),b=r(83759),j=r(41859),w=r(80172),k=r(38517),C=r(81911),S=r(78776),_=r(9200),T=r(85877),I=r(1422),M=r(3377),E=r(58315),z=r(99161),D=r(16936),R=r(27421),W=r(63745),P=r(27496),N=r(5362),F=r(39993),L=r(73200),X=r(75576),O=r(46577),B=r(78018),U=r(74675),q=r(28262),G=r(83491),H=r(85744),Y=r(62720),V=r(55467),K=r(70579);const J=780,$=e=>{let{open:t,onClose:r,trades:$,calendar:Q,isReadOnly:Z=!1,tradeOperations:ee}=e;const{onOpenGalleryMode:te,onUpdateTradeProperty:re,onEditTrade:ne,onDeleteTrade:ae,onDeleteMultipleTrades:oe,onZoomImage:se,onUpdateCalendarProperty:ie,isTradeUpdating:le}=ee,ce=(0,i.A)(),{user:de}=(0,U.h)(),ue=(0,s.useRef)(null),{messages:ge,isLoading:he,isTyping:pe,toolExecutionStatus:me,conversations:xe,loadingConversations:fe,loadingMoreConversations:ye,hasMoreConversations:ve,totalConversationsCount:Ae,isAtMessageLimit:be,sendMessage:je,cancelRequest:we,setInputForEdit:ke,loadConversations:Ce,loadMoreConversations:Se,selectConversation:_e,deleteConversation:Te,startNewChat:Ie,setMessages:Me,getWelcomeMessage:Ee}=(0,q.o)({userId:null===de||void 0===de?void 0:de.uid,calendar:Q,messageLimit:50,autoSaveConversation:!0}),[ze,De]=(0,s.useState)(!1),[Re,We]=(0,s.useState)(!1),[Pe,Ne]=(0,s.useState)(null),[Fe,Le]=(0,s.useState)(""),[Xe,Oe]=(0,s.useState)(null),[Be,Ue]=(0,s.useState)(!1),[qe,Ge]=(0,s.useState)(null),[He,Ye]=(0,s.useState)(!1),[Ve,Ke]=(0,s.useState)(!1);(0,s.useEffect)((()=>{if(t){const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}}),[t]);const Je=s.useMemo((()=>{if(!Fe.trim())return xe;const e=Fe.toLowerCase();return xe.filter((t=>{var r,n;if(null!==(r=t.title)&&void 0!==r&&r.toLowerCase().includes(e))return!0;if(null!==(n=t.preview)&&void 0!==n&&n.toLowerCase().includes(e))return!0;if(t.messages&&Array.isArray(t.messages)){if(t.messages.some((t=>{var r;return null===(r=t.content)||void 0===r?void 0:r.toLowerCase().includes(e)})))return!0}return!1}))}),[xe,Fe]);(0,s.useEffect)((()=>{t&&!he&&setTimeout((()=>{var e;return null===(e=ue.current)||void 0===e?void 0:e.focus()}),100)}),[t,he]),(0,s.useEffect)((()=>{t&&null!==Q&&void 0!==Q&&Q.id&&de&&Ce()}),[t,null===Q||void 0===Q?void 0:Q.id,de,Ce]);const $e=()=>{We(!1),Ne(null)},Qe=e=>{const t=e.messages.find((e=>"user"===e.role));return t&&t.content?t.content.substring(0,80)+(t.content.length>80?"...":""):"No messages"};return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(l.A,{onClick:r,sx:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(4px)",zIndex:V.M.AI_DRAWER_BACKDROP,opacity:t?1:0,visibility:t?"visible":"hidden",transition:"opacity 0.3s ease-in-out, visibility 0.3s ease-in-out",cursor:"pointer"}}),(0,K.jsx)(l.A,{sx:{position:"fixed",bottom:0,right:{xs:0,sm:20},left:{xs:0,sm:"auto"},zIndex:V.M.AI_DRAWER,height:t?J:0,maxHeight:"85vh",width:"100%",maxWidth:{xs:"100%",sm:"420px",md:"460px",lg:"500px"},borderTopLeftRadius:20,borderTopRightRadius:20,borderBottomLeftRadius:0,borderBottomRightRadius:0,background:"dark"===ce.palette.mode?"linear-gradient(135deg, rgba(18, 18, 18, 0.98) 0%, rgba(30, 30, 30, 0.98) 100%)":"linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%)",backdropFilter:"blur(20px)",boxShadow:"dark"===ce.palette.mode?"0 -8px 32px rgba(0, 0, 0, 0.6)":"0 -8px 32px rgba(0, 0, 0, 0.15)",border:"1px solid ".concat((0,c.X4)(ce.palette.divider,.1)),borderBottom:"none",transition:"height 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:t?"translateY(0)":"translateY(100%)",overflow:"hidden",pointerEvents:t?"auto":"none"},children:(0,K.jsxs)(l.A,{sx:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,K.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,pb:1,borderBottom:"1px solid ".concat((0,c.X4)(ce.palette.divider,.1)),background:(0,c.X4)(ce.palette.background.paper,.8),backdropFilter:"blur(10px)"},children:[(0,K.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,K.jsx)(d.A,{sx:{width:36,height:36,background:"linear-gradient(135deg, ".concat(ce.palette.primary.main," 0%, ").concat(ce.palette.primary.dark," 100%)"),border:"2px solid ".concat((0,c.X4)(ce.palette.primary.main,.2))},children:(0,K.jsx)(I.A,{sx:{fontSize:20,color:"white"}})}),(0,K.jsxs)(l.A,{children:[(0,K.jsx)(u.A,{variant:"h6",sx:{fontWeight:700,fontSize:"1.1rem",lineHeight:1.2},children:"AI Trading Assistant"}),(0,K.jsx)(u.A,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.75rem"},children:Q?(()=>{const e=Q.year_stats?Object.values(Q.year_stats).reduce(((e,t)=>e+(t.total_trades||0)),0):0;return e>0?"".concat(e," trade").concat(1!==e?"s":""," in ").concat(Q.name):"".concat(Q.name," - Ready for analysis")})():"Ready for trading analysis across all calendars"})]})]}),(0,K.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[Q&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(g.A,{title:"New Chat",children:(0,K.jsx)(h.A,{size:"small",onClick:async()=>{await Ie(),De(!1)},disabled:0===ge.length,sx:{color:"primary.main","&:hover":{backgroundColor:(0,c.X4)(ce.palette.primary.main,.1)},"&:disabled":{color:"text.disabled"}},children:(0,K.jsx)(M.A,{fontSize:"small"})})}),(0,K.jsx)(g.A,{title:ze?"Back to Chat":"Conversation History",children:(0,K.jsx)(h.A,{size:"small",onClick:()=>De(!ze),sx:{color:ze?"primary.main":"text.secondary","&:hover":{backgroundColor:(0,c.X4)(ce.palette.action.hover,.5)}},children:ze?(0,K.jsx)(E.A,{fontSize:"small"}):(0,K.jsx)(z.A,{fontSize:"small"})})})]}),(0,K.jsx)(g.A,{title:"API Key Settings",children:(0,K.jsx)(h.A,{size:"small",onClick:()=>Ke(!0),sx:{color:"text.secondary","&:hover":{backgroundColor:(0,c.X4)(ce.palette.action.hover,.5)}},children:(0,K.jsx)(D.A,{fontSize:"small"})})}),(0,K.jsx)(g.A,{title:"Close",children:(0,K.jsx)(h.A,{size:"small",onClick:r,sx:{color:"text.secondary","&:hover":{backgroundColor:(0,c.X4)(ce.palette.action.hover,.5)}},children:(0,K.jsx)(R.A,{fontSize:"small"})})})]})]}),(0,K.jsx)(l.A,{sx:{height:"720px",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:(0,K.jsxs)(l.A,{sx:{display:"flex",width:"200%",height:"100%",transform:ze?"translateX(-50%)":"translateX(0)",transition:"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[(0,K.jsx)(l.A,{sx:{width:"50%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:(0,K.jsx)(X.A,{ref:ue,messages:ge,isLoading:he,isTyping:pe,toolExecutionStatus:me,isAtMessageLimit:be,sendMessage:je,cancelRequest:we,setInputForEdit:ke,startNewChat:Ie,setMessages:Me,getWelcomeMessage:Ee,userId:null===de||void 0===de?void 0:de.uid,calendar:Q,trades:$,onTradeClick:(e,t)=>{if(te){t.find((t=>t.id===e))&&te(t,e,"AI Chat - Trade Gallery")}else B.logger.log("Trade clicked but gallery mode not available:",e)},onEventClick:e=>{B.logger.log("Economic event clicked:",e),Oe(e),Ue(!0)},onNoteClick:(e,t)=>{B.logger.log("Note clicked:",e),t?(Ge(t),Ye(!0)):B.logger.warn("Note not found in embedded notes:",e)},isReadOnly:Z,messageLimit:50})}),(0,K.jsxs)(l.A,{sx:{width:"50%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,K.jsx)(l.A,{sx:{p:2,pb:1},children:(0,K.jsx)(p.A,{fullWidth:!0,size:"small",placeholder:"Search conversations...",value:Fe,onChange:e=>Le(e.target.value),InputProps:{startAdornment:(0,K.jsx)(m.A,{position:"start",children:(0,K.jsx)(W.A,{fontSize:"small",sx:{color:"text.secondary"}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:(0,c.X4)(ce.palette.background.paper,.8),"&:hover":{backgroundColor:ce.palette.background.paper},"&.Mui-focused":{backgroundColor:ce.palette.background.paper}}}})}),(0,K.jsx)(l.A,{sx:(0,o.A)({flex:1,overflow:"auto"},(0,O.J)(ce)),children:fe?(0,K.jsx)(x.A,{sx:{p:0},children:Array.from({length:10}).map(((e,t)=>(0,K.jsxs)(s.Fragment,{children:[(0,K.jsx)(f.Ay,{sx:{py:2,px:2},children:(0,K.jsxs)(l.A,{sx:{width:"100%"},children:[(0,K.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,K.jsx)(L.A,{height:20,width:"60%",borderRadius:4,variant:"wave",intensity:"medium"}),(0,K.jsx)(L.A,{height:20,width:60,borderRadius:10,variant:"pulse",intensity:"low"})]}),(0,K.jsx)(L.A,{height:16,width:"90%",borderRadius:4,variant:"default",intensity:"low",sx:{mb:.5}}),(0,K.jsx)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:(0,K.jsx)(L.A,{height:14,width:120,borderRadius:4,variant:"default",intensity:"low"})})]})}),t<4&&(0,K.jsx)(y.A,{})]},t)))}):0===Je.length?(0,K.jsx)(l.A,{sx:{p:3},children:(0,K.jsx)(v.A,{severity:"info",children:Fe.trim()?'No conversations found matching "'.concat(Fe,'"'):"No conversation history yet. Start chatting with the AI to create your first conversation!"})}):(0,K.jsx)(x.A,{sx:{p:0},children:Je.map(((e,t)=>(0,K.jsxs)(s.Fragment,{children:[(0,K.jsx)(f.Ay,{disablePadding:!0,children:(0,K.jsxs)(A.A,{onClick:()=>(e=>{_e(e),De(!1)})(e),sx:{py:2,px:2,display:"flex",alignItems:"flex-start",gap:1,"&:hover":{backgroundColor:(0,c.X4)(ce.palette.primary.main,.08)}},children:[(0,K.jsxs)(l.A,{sx:{flex:1,minWidth:0},children:[(0,K.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,K.jsx)(u.A,{variant:"subtitle1",sx:{fontWeight:600,fontSize:"0.95rem",flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),(0,K.jsx)(b.A,{label:"".concat(e.message_count," msgs"),size:"small",sx:{height:20,fontSize:"0.7rem",backgroundColor:(0,c.X4)(ce.palette.primary.main,.1),color:"primary.main"}})]}),(0,K.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.85rem",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",mb:.5},children:Qe(e)}),(0,K.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,K.jsx)(P.A,{sx:{fontSize:14,color:"text.disabled"}}),(0,K.jsx)(u.A,{variant:"caption",color:"text.disabled",children:(0,F.A)(e.updated_at,"MMM d, yyyy \u2022 h:mm a")})]})]}),(0,K.jsx)(h.A,{onClick:t=>{return r=e.id,t.stopPropagation(),Ne(r),void We(!0);var r},size:"small",sx:{color:"error.main",flexShrink:0,mt:.5,"&:hover":{backgroundColor:(0,c.X4)(ce.palette.error.main,.1)}},children:(0,K.jsx)(N.A,{fontSize:"small"})})]})}),t<xe.length-1&&(0,K.jsx)(y.A,{})]},e.id)))})}),!fe&&ve&&(0,K.jsx)(l.A,{sx:{p:2,display:"flex",justifyContent:"center",borderTop:"1px solid ".concat((0,c.X4)(ce.palette.divider,.1))},children:(0,K.jsx)(j.A,{variant:"outlined",size:"small",onClick:Se,disabled:ye,startIcon:ye?(0,K.jsx)(w.A,{size:16,color:"inherit"}):null,sx:{borderRadius:2,textTransform:"none",px:3},children:ye?"Loading...":"Load More"})}),!fe&&xe.length>0&&(0,K.jsx)(l.A,{sx:{p:2,pt:ve?0:2,borderTop:ve?"none":"1px solid ".concat((0,c.X4)(ce.palette.divider,.1)),backgroundColor:(0,c.X4)(ce.palette.background.default,.5)},children:(0,K.jsxs)(u.A,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Showing ",xe.length," of ",Ae," conversation",1!==Ae?"s":""]})})]})]})})]})}),Xe&&Q&&(0,K.jsx)(G.A,{open:Be,onClose:()=>{Ue(!1),Oe(null)},event:Xe,calendarId:Q.id,tradeOperations:ee,isReadOnly:Z}),(0,K.jsxs)(k.A,{open:Re,onClose:$e,maxWidth:"xs",fullWidth:!0,sx:{zIndex:V.M.DIALOG},children:[(0,K.jsx)(C.A,{children:"Delete Conversation?"}),(0,K.jsx)(S.A,{children:(0,K.jsx)(_.A,{children:"Are you sure you want to delete this conversation? This action cannot be undone."})}),(0,K.jsxs)(T.A,{sx:{p:2,pt:1},children:[(0,K.jsx)(j.A,{onClick:$e,color:"inherit",children:"Cancel"}),(0,K.jsx)(j.A,{onClick:async()=>{if(!Pe)return;await Te(Pe)&&B.logger.log("Conversation deleted:",Pe),We(!1),Ne(null)},color:"error",variant:"contained",autoFocus:!0,children:"Delete"})]})]}),(0,K.jsx)(H.A,{open:Ve,onClose:()=>Ke(!1)}),He&&qe&&Q&&(0,K.jsx)(Y.Ay,{open:He,onClose:()=>{Ye(!1),Ge(null)},note:qe,calendarId:Q.id,onSave:e=>{Me((t=>t.map((t=>t.embeddedNotes&&t.embeddedNotes[e.id]?(0,o.A)((0,o.A)({},t),{},{embeddedNotes:(0,o.A)((0,o.A)({},t.embeddedNotes),{},{[e.id]:e})}):t))))},onDelete:e=>{Me((t=>t.map((t=>{if(t.embeddedNotes&&t.embeddedNotes[e]){const r=t.embeddedNotes,{[e]:s}=r,i=(0,n.A)(r,[e].map(a.A));return(0,o.A)((0,o.A)({},t),{},{embeddedNotes:i})}return t})))),Ye(!1),Ge(null)}})]})}},22011:(e,t,r)=>{r.r(t),r.d(t,{TradeCalendar:()=>To,createNewTradeData:()=>Co,default:()=>Io});var n=r(89379),a=r(65043),o=r(45852),s=r(60267),i=r(53969),l=r(55895),c=r(26020),d=r(29651),u=r(70298),g=r(26529),h=r(41859),p=r(42579),m=r(86995),x=r(40405),f=r(32911),y=r(91449),v=r(22555),A=r(83616),b=r(78916),j=r(61773),w=r(32306),k=r(63898),C=r(15483),S=r(66370),_=r(44188),T=r(62680),I=r(3830),M=r(102),E=r(1422),z=r(73069),D=r(72275),R=r(2431),W=r(40494),P=r(39993),N=r(72128),F=r(86255),L=r(90238),X=r(31555),O=r(51010),B=r(43596),U=r(33498),q=r(16819),G=r(23893),H=r(85662),Y=r(98349),V=r(5780),K=r(94808),J=r(77409),$=r(58309),Q=r(49221),Z=r(41831),ee=r(78018),te=r(28636),re=r(70579);const ne=e=>{let{open:t,onClose:r,date:o,trades:s,account_balance:l,showAddForm:c,onDateChange:d,tradeOperations:u,onOpenAIChatMode:p,weekTrades:m}=e;const{calendarId:x,calendar:f,onOpenGalleryMode:y,isReadOnly:v=!1}=u,[A,b]=(0,a.useState)(null),[j,w]=(0,a.useState)(0),[k,C]=(0,a.useState)(0),[S,_]=(0,a.useState)(!1),T=o.getTime(),I=null===f||void 0===f?void 0:f.id;(0,a.useEffect)((()=>{(async()=>{if(t&&f)try{const e=(0,$.b4)(o),t=await(0,Q.jp)(e,f);C(t)}catch(e){ee.logger.error("Error fetching cumulative P&L:",e),C(0)}})()}),[t,T,I]),(0,a.useEffect)((()=>{(async()=>{if(t&&x)try{const e=new Z.P,t=(await e.getTradesByDay(x,o,["amount"])).reduce(((e,t)=>e+t.amount),0);w(t)}catch(e){ee.logger.error("Error fetching day total P&L:",e),w(0)}})()}),[t,T,x]);const M=(0,a.useCallback)((()=>{const e=new Date(o);e.setDate(e.getDate()-1),d(e)}),[o,d]),E=(0,a.useCallback)((()=>{const e=(0,$.b4)(o);(0,Y.A)(e,(0,V.A)(new Date))||d(e)}),[o,d]),D=(0,a.useCallback)((e=>{b((t=>t===e?null:e))}),[]),R=(0,a.useCallback)((async()=>{c(null)}),[c]),W=(0,a.useCallback)((e=>{c(e)}),[c]),N=(0,a.useCallback)((()=>{if(y&&s&&s.length>0){const e="".concat((0,P.A)(o,"EEEE, MMMM d, yyyy")," - ").concat(s.length," Trade").concat(s.length>1?"s":"");y(s,A||s[0].id,e),r()}}),[y,s,o,A,r]),F=(0,a.useCallback)((e=>{if(p){const t="AI Analysis - ".concat(e.name||(0,P.A)(o,"MMM d, yyyy"));b(null),p(s,e.id,t)}}),[p,s,o]),L=(0,a.useCallback)((()=>{_(!0)}),[]),X=(null===s||void 0===s?void 0:s.length)||0,O=(0,a.useMemo)((()=>(0,n.A)((0,n.A)({},u),{},{onEditTrade:v?void 0:W,onOpenAIChat:p?F:void 0})),[u,v,W,p,F]);return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(K.mY,{open:t,onClose:()=>{r()},title:"Daily Trades",maxWidth:"md",fullWidth:!0,hideCloseButton:!1,primaryButtonText:v?void 0:"Add Trade",primaryButtonAction:v?void 0:()=>R(),hideFooterCancelButton:!1,actions:(0,re.jsxs)(re.Fragment,{children:[f&&(0,re.jsx)(g.A,{title:"View economic events for this day",children:(0,re.jsx)(h.A,{variant:"outlined",startIcon:(0,re.jsx)(z.A,{}),onClick:L,sx:{mr:1},children:"Events"})}),y&&X>0&&(0,re.jsx)(g.A,{title:"View trades in gallery mode",children:(0,re.jsx)(h.A,{variant:"outlined",startIcon:(0,re.jsx)(H.A,{}),onClick:N,sx:{mr:1},children:"Gallery View"})})]}),children:(0,re.jsxs)(i.A,{sx:{p:3},children:[(0,re.jsx)(J.A1,{title:(0,P.A)(o,"EEEE, MMMM d, yyyy"),account_balance:l+k,formInputVisible:!1,total_pnl:j,onPrevDay:M,onNextDay:E}),x&&f&&(0,re.jsx)(J.Ju,{calendarId:x,currentBalance:l+k,currentDate:o,calendar:f,weekTrades:m}),(0,re.jsx)(J.p,{trades:s,expandedTradeId:A,onTradeClick:D,tradeOperations:O,hideActions:v,enableBulkSelection:!v&&X>1})]})}),f&&(0,re.jsx)(te.A,{open:S,onClose:()=>_(!1),calendar:f,tradeOperations:u,isReadOnly:v,initialDate:o})]})};var ae=r(94799),oe=r(6013),se=r(99130),ie=r(17105),le=r(7609),ce=r(20234),de=r(93201),ue=r(82327);const ge=e=>{let{progress:t,isMet:r,tooltipText:n="Shows progress towards your target goal"}=e;const a=(0,s.A)(),o=(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",bgcolor:r?(0,d.X4)(a.palette.success.main,.9):(0,d.X4)(a.palette.primary.main,.1),color:r?"white":"primary.main",borderRadius:"12px",width:"auto",height:22,px:.8,border:"1px solid ".concat((0,d.X4)(a.palette.primary.main,.2))},children:[r?(0,re.jsx)(de.A,{sx:{fontSize:"0.875rem",mr:.3}}):(0,re.jsx)(ue.A,{sx:{fontSize:"0.875rem",mr:.3}}),(0,re.jsxs)(l.A,{variant:"caption",sx:{fontWeight:600,fontSize:r?"0.5rem":"0.7rem"},children:[Math.min(Math.max(t,0),100).toFixed(0),"%"]})]});return(0,re.jsx)(g.A,{title:n,arrow:!0,placement:"top",children:o})};var he=r(46577);const pe=e=>{let{open:t,onClose:r,onDateSelect:o,initialDate:c,accountBalance:u,monthlyTarget:g,yearlyTarget:x,yearStats:f,onOpenGalleryMode:y}=e;const v=(0,s.A)(),A=(0,m.A)(v.breakpoints.down("sm")),[b,j]=a.useState(c||new Date),w=b.getFullYear(),_=["January","February","March","April","May","June","July","August","September","October","November","December"];a.useEffect((()=>{c&&j(c)}),[c]);const T=b.getMonth(),I=a.useMemo((()=>{const e=f[w.toString()],t=new Date(w,0,1);if(!e)return{totalTrades:0,yearlyPnL:0,yearlyWinCount:0,yearlyLossCount:0,yearlyWinRate:"0",yearlyGrowthPercentage:"0",accountValueAtStartOfYear:u,startOfYear:t};let r=u;return Object.entries(f).forEach((e=>{let[t,n]=e;parseInt(t)<w&&(r+=n.yearly_pnl)})),{totalTrades:e.total_trades,yearlyPnL:e.yearly_pnl,yearlyWinCount:e.win_count,yearlyLossCount:e.loss_count,yearlyWinRate:e.win_rate.toFixed(1),yearlyGrowthPercentage:e.yearly_growth_percentage.toFixed(2),accountValueAtStartOfYear:r,startOfYear:t}}),[w,f,u]),{totalTrades:M,yearlyPnL:E,yearlyWinCount:z,yearlyLossCount:D,yearlyWinRate:R,yearlyGrowthPercentage:W,accountValueAtStartOfYear:P,startOfYear:N}=I,F=a.useMemo((()=>{const e=new Map,t=f[w.toString()];if(!t){for(let t=0;t<12;t++)e.set(t,{monthPnL:0,tradeCount:0,accountValueAtStartOfMonth:u,targetProgress:null,growthPercentage:"0"});return e}for(let r=0;r<12;r++){const n=t.monthly_stats[r];let a=null;if(g&&g>0&&n.account_value_at_start>0){const e=g/100*n.account_value_at_start,t=e>0?n.month_pnl/e*100:0;a={progress:Math.min(t,100),isMet:n.month_pnl>=e,rawProgress:t}}e.set(r,{monthPnL:n.month_pnl,tradeCount:n.trade_count,accountValueAtStartOfMonth:n.account_value_at_start,targetProgress:a,growthPercentage:n.growth_percentage.toFixed(2)})}return e}),[w,f,u,g]),L=a.useMemo((()=>{const e=f[w.toString()];return!e||e.best_month_pnl<=0?{name:"None",pnl:0}:{name:_[e.best_month_index],pnl:e.best_month_pnl}}),[w,f,_]),X=a.useMemo((()=>{if(!x||x<=0||P<=0)return null;const e=x/100*P,t=e>0?E/e*100:0;return{progress:Math.min(t,100),isMet:E>=e,rawProgress:t}}),[x,P,E]),O=(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[(0,re.jsx)(k.A,{sx:{fontSize:{xs:"1.5rem",sm:"1.6rem",md:"1.75rem"},color:v.palette.primary.main}}),(0,re.jsx)(l.A,{variant:"h5",sx:{fontWeight:700,flex:1,color:"text.primary",fontSize:{xs:"1.25rem",sm:"1.35rem",md:"1.5rem"},ml:{xs:1,sm:1.25,md:1.5}},children:"Select Month"}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[w!==(new Date).getFullYear()&&(0,re.jsx)(h.A,{onClick:()=>j(new Date),size:A?"small":"medium",variant:"outlined",startIcon:(0,re.jsx)(k.A,{sx:{fontSize:"1.05rem"}}),sx:{ml:1,textTransform:"none",fontWeight:600,borderRadius:1.5,px:{xs:1.5,sm:1.75,md:2}},children:"Today"}),(0,re.jsx)(p.A,{onClick:()=>j((e=>(0,le.A)(e,1))),sx:{color:"text.primary",bgcolor:(0,d.X4)(v.palette.primary.main,.05)},children:(0,re.jsx)(C.A,{})}),(0,re.jsx)(l.A,{variant:"h5",sx:{fontWeight:800,color:"text.primary",minWidth:{xs:64,sm:72,md:80},textAlign:"center",letterSpacing:"-0.5px"},children:w}),(0,re.jsx)(p.A,{onClick:()=>j((e=>(0,ce.A)(e,1))),sx:{color:"text.primary",bgcolor:(0,d.X4)(v.palette.primary.main,.05)},children:(0,re.jsx)(S.A,{})})]})]}),B=(0,re.jsxs)(i.A,{sx:{display:"flex",gap:{xs:1.5,sm:2}},children:[(0,re.jsx)(h.A,{onClick:r,variant:"outlined",size:A?"medium":"large",sx:{textTransform:"none",fontWeight:600,borderRadius:1.5,px:{xs:2,sm:2.5,md:3}},children:"Cancel"}),y&&M>0&&(0,re.jsx)(h.A,{onClick:()=>{if(y){const e=f[w.toString()],t=(null===e||void 0===e?void 0:e.total_trades)||0,n="".concat(w," - All Trades (").concat(t," trades)");y([],void 0,n,w),r()}},variant:"contained",size:A?"medium":"large",startIcon:(0,re.jsx)(H.A,{}),sx:{textTransform:"none",fontWeight:600,borderRadius:1.5,px:{xs:2,sm:2.5,md:3}},children:"Gallery View"})]});return(0,re.jsx)(K.mY,{open:t,onClose:r,title:O,actions:B,maxWidth:"sm",fullWidth:!0,hideFooterCancelButton:!0,children:(0,re.jsxs)(i.A,{sx:(0,n.A)({pt:{xs:"12px",sm:"16px",md:"24px"},pb:{xs:"12px",sm:"16px",md:"24px"}},(0,he.J)(v)),children:[(0,re.jsxs)(ae.A,{elevation:0,sx:{px:{xs:2,sm:2.5,md:3},py:{xs:1.5,sm:2,md:2},mb:2,borderRadius:2,bgcolor:e=>(0,d.X4)(e.palette.background.default,.5),border:"1px solid",borderColor:e=>e.palette.divider,position:"relative",overflow:"hidden"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:{xs:2,sm:2.25,md:2.5},pl:1},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"row",gap:.5},children:[(0,re.jsx)(l.A,{variant:"h6",sx:{color:"text.primary",fontSize:{xs:"1rem",sm:"1.05rem",md:"1.1rem"},fontWeight:600},children:"Yearly Statistics"}),X&&(0,re.jsx)(ge,{progress:X.rawProgress,isMet:X.isMet,tooltipText:"".concat(X.isMet?"Yearly target achieved":"Progress towards yearly target",": ").concat(X.rawProgress.toFixed(0),"%")})]}),(0,re.jsx)(i.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1,bgcolor:e=>(0,d.X4)(e.palette.success.light,.1),py:.75,px:1.5,borderRadius:1,border:"1px solid",borderColor:"success.light"},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontSize:"0.85rem",fontWeight:500,color:"text.secondary"},children:"Best Month:"}),(0,re.jsxs)(l.A,{variant:"body2",sx:{fontSize:"0.85rem",fontWeight:700,color:"success.main"},children:[L.name," ($",L.pnl.toLocaleString(),")"]})]})})]}),(0,re.jsxs)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"1fr 1fr 1fr"},gap:{xs:2,sm:3,md:4},width:"100%"},children:[(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:1},children:[(0,re.jsx)(i.A,{sx:{p:.7,borderRadius:1,bgcolor:e=>(0,d.X4)(e.palette.primary.main,.1),display:"flex",alignItems:"center",justifyContent:"center",mb:1},children:(0,re.jsx)(oe.A,{sx:{fontSize:{xs:"1.05rem",sm:"1.15rem",md:"1.2rem"},color:"primary.main"}})}),(0,re.jsx)(l.A,{variant:"body1",sx:{fontSize:"1rem",fontWeight:600,color:"text.primary",textAlign:"center"},children:"Yearly P&L"})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[(0,re.jsxs)(l.A,{variant:"h5",sx:{fontWeight:700,fontSize:{xs:"1.35rem",sm:"1.4rem",md:"1.5rem"},color:e=>E>0?e.palette.success.main:E<0?e.palette.error.main:"dark"===e.palette.mode?"grey.300":"text.primary",textAlign:"center"},children:["$",Math.abs(E).toLocaleString()]}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:500,color:"text.secondary",fontSize:{xs:"0.85rem",sm:"0.9rem"},textAlign:"center"},children:"Growth"}),(0,re.jsxs)(l.A,{variant:"body2",sx:{fontWeight:700,color:e=>E>0?e.palette.success.main:E<0?e.palette.error.main:"dark"===e.palette.mode?"grey.300":"text.primary",fontSize:"1rem",textAlign:"center"},children:[W,"%"]})]})]})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:1},children:[(0,re.jsx)(i.A,{sx:{p:.7,borderRadius:1,bgcolor:e=>(0,d.X4)(e.palette.success.main,.1),display:"flex",alignItems:"center",justifyContent:"center",mb:1},children:(0,re.jsx)(se.A,{sx:{fontSize:{xs:"1.05rem",sm:"1.15rem",md:"1.2rem"},color:"success.main"}})}),(0,re.jsx)(l.A,{variant:"body1",sx:{fontSize:"1rem",fontWeight:600,color:"text.primary",textAlign:"center"},children:"Win Rate"})]}),(0,re.jsxs)(l.A,{variant:"h5",sx:{fontWeight:700,fontSize:{xs:"1.35rem",sm:"1.4rem",md:"1.5rem"},color:parseFloat(R)>50?"success.main":"text.primary",textAlign:"center"},children:[R,"%"]}),(0,re.jsxs)(l.A,{variant:"body1",sx:{fontWeight:500,fontSize:"1rem",color:"text.secondary",mt:.5,textAlign:"center"},children:[z," Ws / ",D," Ls"]})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:1},children:[(0,re.jsx)(i.A,{sx:{p:.7,borderRadius:1,bgcolor:e=>(0,d.X4)(e.palette.info.main,.1),display:"flex",alignItems:"center",justifyContent:"center",mb:1},children:(0,re.jsx)(ie.A,{sx:{fontSize:{xs:"1.05rem",sm:"1.15rem",md:"1.2rem"},color:"info.main"}})}),(0,re.jsx)(l.A,{variant:"body1",sx:{fontSize:"1rem",fontWeight:600,color:"text.primary",textAlign:"center"},children:"Total Trades"})]}),(0,re.jsx)(l.A,{variant:"h5",sx:{fontWeight:700,fontSize:{xs:"1.35rem",sm:"1.4rem",md:"1.5rem"},color:"text.primary",textAlign:"center"},children:M}),(0,re.jsx)(l.A,{variant:"body1",sx:{fontWeight:500,fontSize:"1rem",color:"text.secondary",mt:.5,textAlign:"center"},children:"Trades this year"})]})]})]}),(0,re.jsx)(l.A,{variant:"h6",sx:{color:"text.primary",mb:{xs:1.5,sm:1.75,md:2},fontSize:{xs:"1rem",sm:"1.05rem",md:"1.1rem"},fontWeight:600,pl:1},children:"Select a Month"}),(0,re.jsx)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:{xs:1,sm:1.25,md:1.5}},children:_.map(((e,t)=>{const a=F.get(t),{monthPnL:s,targetProgress:u,growthPercentage:g,tradeCount:h}=a,p=0!==s;return(0,re.jsxs)(ae.A,{onClick:()=>(e=>{const t=new Date(w,e,1);o(t),r()})(t),elevation:0,sx:(0,n.A)((0,n.A)({p:{xs:1.5,sm:2,md:2.5},cursor:"pointer",display:"flex",flexDirection:"column",gap:{xs:.75,sm:.85,md:1},height:"100%",bgcolor:e=>p?"dark"===e.palette.mode?(0,d.X4)("#fff",.08):(0,d.X4)(e.palette.primary.main,.04):"dark"===e.palette.mode?"transparent":"#f5f5f5",border:"1px solid",borderColor:e=>T===t&&w===(null===c||void 0===c?void 0:c.getFullYear())?e.palette.primary.main:"dark"===e.palette.mode?(0,d.X4)("#fff",.12):e.palette.grey[200],borderRadius:2,transition:"all 0.2s",position:"relative",overflow:"hidden"},T===t&&w===(null===c||void 0===c?void 0:c.getFullYear())&&{"&::before":{content:'""',position:"absolute",top:0,left:0,width:"100%",height:"4px",backgroundColor:"primary.main"}}),{},{"&:hover":{bgcolor:e=>"dark"===e.palette.mode?(0,d.X4)("#fff",.12):(0,d.X4)(e.palette.primary.main,.08),borderColor:"primary.main",transform:"translateY(-2px)",boxShadow:e=>"0 4px 12px ".concat((0,d.X4)(e.palette.primary.main,.2))}}),children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5,mr:1},children:[(0,re.jsx)(l.A,{variant:"h6",sx:{color:e=>T===t&&w===(null===c||void 0===c?void 0:c.getFullYear())?e.palette.primary.main:e.palette.text.primary,fontWeight:700,fontSize:{xs:"1rem",sm:"1.05rem",md:"1.1rem"},whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),u&&p&&(0,re.jsx)(i.A,{sx:{ml:1},children:(0,re.jsx)(ge,{progress:u.rawProgress,isMet:u.isMet,tooltipText:"".concat(u.isMet?"Monthly target achieved":"Progress towards monthly target",": ").concat(u.rawProgress.toFixed(0),"%")})})]}),p&&(0,re.jsx)(re.Fragment,{children:(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,re.jsxs)(l.A,{variant:"h6",sx:{color:s>0?"success.main":"error.main",fontSize:{xs:"1.1rem",sm:"1.15rem",md:"1.2rem"},fontWeight:700,display:"flex",alignItems:"center",gap:.5},children:["$",Math.abs(s).toLocaleString(),(0,re.jsx)(i.A,{component:"span",sx:{fontSize:{xs:"0.8rem",sm:"0.85rem",md:"0.9rem"},fontWeight:600},children:s>0?"\u2191":"\u2193"})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"caption",sx:{fontWeight:500,color:"text.secondary",fontSize:"0.75rem"},children:"Growth"}),(0,re.jsxs)(l.A,{variant:"caption",sx:{fontWeight:600,color:s>0?"success.main":"error.main",fontSize:"0.75rem"},children:[g,"%"]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"caption",sx:{fontWeight:500,color:"text.secondary",fontSize:"0.75rem"},children:"Trades:"}),(0,re.jsx)(l.A,{variant:"caption",sx:{fontWeight:600,color:"text.primary",fontSize:"0.75rem"},children:h})]})]})})]},e)}))})]})})};var me=r(83759),xe=r(24343),fe=r(33699),ye=r(10256),ve=r(67203),Ae=r(47471),be=r(1725),je=r(85030),we=r(94527),ke=r(95315),Ce=r(57401),Se=r(66185),_e=r(63745),Te=r(40847),Ie=r(21553),Me=r(68165),Ee=r(81084);const ze=e=>{let{open:t,onClose:r,allTags:o,calendarId:c,onTagUpdated:u,requiredTagGroups:p=[],onUpdateCalendarProperty:m}=e;const x=(0,s.A)(),[f,y]=(0,a.useState)(""),[v,A]=(0,a.useState)(""),[b,j]=(0,a.useState)(null),[w,k]=(0,a.useState)(p);(0,a.useEffect)((()=>{k(p)}),[p]);const C=(0,a.useMemo)((()=>(0,Ee.GI)(o)),[o]);(0,a.useEffect)((()=>{v&&!C.includes(v)&&A("")}),[C,v]);const S=(0,a.useMemo)((()=>{let e=o;if(v&&(e=e.filter((e=>(0,Ee.dn)(e)&&(0,Ee.Oo)(e)===v))),f){const t=f.toLowerCase();e=e.filter((e=>e.toLowerCase().includes(t)||(0,Ee.t)(e).toLowerCase().includes(t)))}return e}),[o,f,v]),_=(0,a.useMemo)((()=>{const e={};return S.forEach((t=>{if((0,Ee.dn)(t)){const r=(0,Ee.Oo)(t);e[r]||(e[r]=[]),e[r].push(t)}else e.Ungrouped||(e.Ungrouped=[]),e.Ungrouped.push(t)})),e}),[S]),T=e=>{k(e),m&&m(c,(t=>(0,n.A)((0,n.A)({},t),{},{required_tag_groups:e})))};return(0,re.jsxs)(K.mY,{open:t,onClose:r,title:"Tag Management",maxWidth:"md",fullWidth:!0,children:[(0,re.jsxs)(i.A,{sx:{p:2},children:[(0,re.jsxs)(i.A,{sx:{mb:3},children:[(0,re.jsx)(l.A,{variant:"body1",gutterBottom:!0,children:"Manage your tags and set required tag groups for new trades."}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"When a tag group is set as required, every new trade must include at least one tag from this group."})]}),(0,re.jsxs)(i.A,{sx:{mb:3},children:[(0,re.jsx)(l.A,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Required Tag Groups"}),(0,re.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:w.length>0?w.map((e=>(0,re.jsx)(me.A,{label:e,color:"primary",variant:"outlined",sx:{fontWeight:600}},e))):(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No required tag groups set. Edit a tag group to make it required."})})]}),(0,re.jsxs)(i.A,{sx:{mb:3},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",gap:2,mb:2},children:[(0,re.jsx)(xe.A,{fullWidth:!0,placeholder:"Search tags...",value:f,onChange:e=>y(e.target.value),InputProps:{startAdornment:(0,re.jsx)(fe.A,{position:"start",children:(0,re.jsx)(_e.A,{})})},size:"small"}),(0,re.jsx)(ye.A,{size:"small",sx:{minWidth:150},children:(0,re.jsxs)(ve.A,{value:v,onChange:e=>A(e.target.value),displayEmpty:!0,startAdornment:(0,re.jsx)(fe.A,{position:"start",children:(0,re.jsx)(Te.A,{fontSize:"small"})}),children:[(0,re.jsx)(Ae.A,{value:"",children:"All Groups"}),C.map((e=>(0,re.jsx)(Ae.A,{value:e,children:e},e)))]})})]}),(0,re.jsx)(i.A,{sx:(0,n.A)((0,n.A)({maxHeight:"400px",overflow:"auto",border:"1px solid ".concat(x.palette.divider),borderRadius:1},x.typography.body2),(0,he.J)(x)),children:Object.entries(_).length>0?Object.entries(_).map((e=>{let[t,r]=e;return(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{p:1.5,bgcolor:(0,d.X4)(x.palette.primary.main,.05),display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(l.A,{variant:"subtitle2",fontWeight:600,children:t}),"Ungrouped"!==t&&(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",ml:1},children:[(0,re.jsx)(be.A,{control:(0,re.jsx)(je.A,{checked:w.includes(t),onChange:e=>{const r=e.target.checked?[...w,t]:w.filter((e=>e!==t));T(r)},color:"primary",size:"small"}),label:(0,re.jsx)(l.A,{variant:"caption",sx:{fontWeight:500},children:"Required"})}),(0,re.jsx)(g.A,{title:"When a tag group is set as required, every new trade must include at least one tag from this group",children:(0,re.jsx)(Ie.A,{sx:{ml:.5,color:"text.secondary",fontSize:"0.875rem"}})})]})]}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[r.length," tag",1!==r.length?"s":""]})]}),(0,re.jsx)(we.A,{}),(0,re.jsx)(ke.A,{disablePadding:!0,children:r.map((e=>(0,re.jsx)(Ce.Ay,{secondaryAction:(0,re.jsx)(h.A,{color:"primary",sx:{minWidth:"auto",p:.5},onClick:()=>j(e),children:"Edit"}),sx:{"&:hover":{bgcolor:(0,d.X4)(x.palette.primary.main,.05)}},children:(0,re.jsx)(Se.A,{primary:(0,re.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,re.jsx)(me.A,{label:(0,Ee.t)(e,!0),size:"small",sx:(0,Ee.dO)(e,x)})})})},e)))})]},t)})):(0,re.jsx)(i.A,{sx:{p:3,textAlign:"center"},children:(0,re.jsx)(l.A,{color:"text.secondary",children:"No tags found matching your search criteria."})})})]})]}),b&&(0,re.jsx)(Me.A,{open:!!b,onClose:()=>j(null),tag:b,calendarId:c,onSuccess:(e,t,r)=>{ee.logger.log("Tag update completed: ".concat(e," -> ").concat(t,", ").concat(r," trades updated"));const n=(0,Ee.dn)(e)?(0,Ee.Oo)(e):null,a=(0,Ee.dn)(t)?(0,Ee.Oo)(t):null;if(n&&a&&n!==a&&v===n&&A(a),n&&a&&n!==a){const e=w.map((e=>e===n?a:e));k(e)}t.trim(),u&&u(e,t)},onDelete:(e,t)=>{ee.logger.log("Tag deletion completed: ".concat(e,", ").concat(t," trades updated"));const r=(0,Ee.dn)(e)?(0,Ee.Oo)(e):null;if(r&&w.includes(r)){if(0===o.filter((t=>t!==e&&(0,Ee.dn)(t)&&(0,Ee.Oo)(t)===r)).length){const e=w.filter((e=>e!==r));k(e),T(e)}}u&&u(e,"")},onTagUpdated:u})]})};var De=r(19e3),Re=r(78403),We=r(38517),Pe=r(81911),Ne=r(78776),Fe=r(85877),Le=r(36081),Xe=r(22950),Oe=r(25272),Be=r(64),Ue=r(27421),qe=r(4890),Ge=r(95007),He=r(16476),Ye=r(74675);const Ve=e=>{let{open:t,onClose:r,calendarId:o,allTags:c,onTagCreated:d}=e;const u=(0,s.A)(),{user:g}=(0,Ye.h)(),[h,p]=(0,a.useState)(""),[m,x]=(0,a.useState)(""),[f,y]=(0,a.useState)(""),[v,A]=(0,a.useState)(!1),[b,j]=(0,a.useState)(null);(0,a.useEffect)((()=>{t&&(p(""),x(""),y(""),j(null))}),[t]);const w=async e=>{e&&e.preventDefault();const t=h.trim();if(!t)return void j("Tag name is required");const n=m.trim(),a=n?(0,Ee.$4)("".concat(n,":").concat(t)):t;if(c.includes(a))j("This tag already exists");else{A(!0),j(null);try{f.trim()&&null!==g&&void 0!==g&&g.id&&await He.G.saveTagDefinition(g.id,a,f),d&&await d(a),r(!0)}catch(o){ee.logger.error("Error creating tag:",o),j(o instanceof Error?o.message:"Failed to create tag")}finally{A(!1)}}};return(0,re.jsx)(K.mY,{open:t,onClose:()=>!v&&r(),maxWidth:"sm",fullWidth:!0,title:"Create New Tag",primaryButtonText:v?"Creating...":"Create Tag",primaryButtonAction:w,isSubmitting:v,cancelButtonText:"Cancel",cancelButtonAction:()=>r(),hideCloseButton:v,children:(0,re.jsxs)(i.A,{component:"form",onSubmit:w,sx:{display:"flex",flexDirection:"column",gap:3,mt:1},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Add a new tag to your calendar. You can also group it by category for better organization."}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:2},children:[(0,re.jsx)(xe.A,{label:"Group (optional)",value:m,onChange:e=>{const t=e.target.value;t.includes(":")||x(t)},fullWidth:!0,placeholder:"e.g. Strategy",disabled:v}),(0,re.jsx)(xe.A,{label:"Tag Name",value:h,onChange:e=>{const t=e.target.value;t.includes(":")||p(t)},fullWidth:!0,required:!0,autoFocus:!0,error:!!b,helperText:b,placeholder:"e.g. Breakout",disabled:v})]}),(0,re.jsx)(xe.A,{label:"Definition (optional)",value:f,onChange:e=>y(e.target.value),fullWidth:!0,multiline:!0,rows:3,disabled:v,placeholder:"What does this tag mean? Helps the AI analyze your trades.",inputProps:{maxLength:2024},helperText:(0,re.jsxs)(i.A,{component:"span",sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(Ge.A,{sx:{fontSize:14}}),"Help the AI understand your trading context"]}),sx:{"& .MuiInputBase-input":(0,n.A)({},(0,he.J)(u))}})]})})},Ke=e=>{let{open:t,onClose:r,allTags:o,calendarId:c,onTagUpdated:u,requiredTagGroups:m=[],onUpdateCalendarProperty:x,isReadOnly:f=!1,calendarOwnerId:y}=e;const v=(0,s.A)(),{user:A}=(0,Ye.h)(),[b,j]=(0,a.useState)(""),[w,k]=(0,a.useState)(""),[C,S]=(0,a.useState)(null),[_,T]=(0,a.useState)(null),[I,M]=(0,a.useState)(!1),[E,z]=(0,a.useState)(m),[D,R]=(0,a.useState)({}),[W,P]=(0,a.useState)({});(0,a.useEffect)((()=>{z(m)}),[m]);const N=(0,a.useCallback)((async()=>{const e=f?y:null===A||void 0===A?void 0:A.id;if(e)try{const t=await He.G.fetchTagDefinitions(e);R(t)}catch(t){ee.logger.error("Error fetching tag definitions:",t)}}),[null===A||void 0===A?void 0:A.id,f,y]);(0,a.useEffect)((()=>{t&&N()}),[t,N]);const F=(0,a.useMemo)((()=>(0,Ee.GI)(o)),[o]);(0,a.useEffect)((()=>{w&&!F.includes(w)&&k("")}),[F,w]);const L=(0,a.useMemo)((()=>{let e=o;if(w&&(e=e.filter((e=>(0,Ee.dn)(e)&&(0,Ee.Oo)(e)===w))),b){const t=b.toLowerCase();e=e.filter((e=>e.toLowerCase().includes(t)||(0,Ee.t)(e).toLowerCase().includes(t)))}return e}),[o,b,w]),X=(0,a.useMemo)((()=>{const e={};return L.forEach((t=>{if((0,Ee.dn)(t)){const r=(0,Ee.Oo)(t);e[r]||(e[r]=[]),e[r].push(t)}else e.Ungrouped||(e.Ungrouped=[]),e.Ungrouped.push(t)})),e}),[L]),O=e=>{z(e),x&&x(c,(t=>(0,n.A)((0,n.A)({},t),{},{required_tag_groups:e})))};return(0,re.jsxs)(qe.A,{open:t,onClose:r,title:"Tag Management",icon:(0,re.jsx)(Le.A,{}),width:{xs:"100%",sm:500},headerVariant:"enhanced",headerActions:!f&&(0,re.jsx)(g.A,{title:"Create new tag",arrow:!0,children:(0,re.jsx)(p.A,{color:"primary",onClick:()=>M(!0),sx:{bgcolor:(0,d.X4)(v.palette.primary.main,.1),"&:hover":{bgcolor:(0,d.X4)(v.palette.primary.main,.2)}},children:(0,re.jsx)(Xe.A,{})})}),contentSx:(0,n.A)({p:2},(0,he.J)(v)),children:[(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{mb:3},children:[(0,re.jsx)(l.A,{variant:"body1",gutterBottom:!0,children:f?"View tags and their definitions to better understand this trader's terminology.":"Manage your tags and set required tag groups for new trades."}),!f&&(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"When a tag group is set as required, every new trade must include at least one tag from this group."}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mt:4},children:"Adding definitions to your tags helps the AI assistant and traders understand your trading terminology and provide more accurate analysis."})]})]}),!f&&(0,re.jsxs)(i.A,{sx:{mb:3},children:[(0,re.jsx)(l.A,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Required Tag Groups"}),(0,re.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:E.length>0?E.map((e=>(0,re.jsx)(me.A,{label:e,color:"primary",variant:"outlined",sx:{fontWeight:600},onDelete:()=>{const t=E.filter((t=>t!==e));O(t)}},e))):(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No required tag groups set. Edit a tag group to make it required."})})]}),(0,re.jsxs)(i.A,{sx:{mb:3},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",gap:2,mb:2},children:[(0,re.jsx)(xe.A,{fullWidth:!0,placeholder:"Search tags...",value:b,onChange:e=>j(e.target.value),InputProps:{startAdornment:(0,re.jsx)(fe.A,{position:"start",children:(0,re.jsx)(_e.A,{})})},size:"small"}),(0,re.jsx)(ye.A,{size:"small",sx:{minWidth:150},children:(0,re.jsxs)(ve.A,{value:w,onChange:e=>k(e.target.value),displayEmpty:!0,startAdornment:(0,re.jsx)(fe.A,{position:"start",children:(0,re.jsx)(Te.A,{fontSize:"small"})}),children:[(0,re.jsx)(Ae.A,{value:"",children:"All Groups"}),F.map((e=>(0,re.jsx)(Ae.A,{value:e,children:e},e)))]})})]}),(0,re.jsx)(i.A,{sx:(0,n.A)((0,n.A)({maxHeight:"100%",overflow:"auto",border:"1px solid ".concat(v.palette.divider),borderRadius:1},v.typography.body2),(0,he.J)(v)),children:Object.entries(X).length>0?Object.entries(X).map((e=>{let[t,r]=e;return(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{p:1.5,bgcolor:(0,d.X4)(v.palette.primary.main,.05),display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(l.A,{variant:"subtitle2",fontWeight:600,children:t}),"Ungrouped"!==t&&!f&&(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",ml:1},children:[(0,re.jsx)(be.A,{control:(0,re.jsx)(je.A,{checked:E.includes(t),onChange:e=>{const r=e.target.checked?[...E,t]:E.filter((e=>e!==t));O(r)},color:"primary",size:"small"}),label:null}),(0,re.jsx)(g.A,{title:"When a tag group is set as required, every new trade must include at least one tag from this group",children:(0,re.jsx)(Ie.A,{sx:{ml:-1.5,color:"text.secondary",fontSize:"0.875rem"}})})]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[r.length," tag",1!==r.length?"s":""]}),(0,re.jsx)(p.A,{size:"small",onClick:()=>(e=>{P((t=>(0,n.A)((0,n.A)({},t),{},{[e]:!t[e]})))})(t),children:W[t]?(0,re.jsx)(Oe.A,{fontSize:"small"}):(0,re.jsx)(Be.A,{fontSize:"small"})})]})]}),(0,re.jsx)(we.A,{}),(0,re.jsx)(De.A,{in:!W[t],timeout:"auto",unmountOnExit:!0,children:(0,re.jsx)(ke.A,{disablePadding:!0,children:r.map((e=>(0,re.jsx)(Ce.Ay,{disablePadding:!0,secondaryAction:f?void 0:(0,re.jsx)(h.A,{color:"primary",sx:{minWidth:"auto",p:.5},onClick:t=>{t.stopPropagation(),S(e)},children:"Edit"}),children:(0,re.jsx)(Re.A,{onClick:()=>T(e),sx:{"&:hover":{bgcolor:(0,d.X4)(v.palette.primary.main,.05)}},children:(0,re.jsx)(Se.A,{primary:(0,re.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,re.jsx)(me.A,{label:(0,Ee.t)(e,!0),size:"small",sx:(0,Ee.dO)(e,v)})}),secondary:(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:4,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mt:.5,ml:.5,opacity:D[e]?1:.6},children:D[e]||(f?"No definition":"No definition \u2014 click Edit to add one")})})})},e)))})})]},t)})):(0,re.jsx)(i.A,{sx:{p:3,textAlign:"center"},children:(0,re.jsx)(l.A,{color:"text.secondary",children:"No tags found matching your search criteria."})})})]})]}),C&&(0,re.jsx)(Me.A,{open:!!C,onClose:e=>{S(null),e&&N()},tag:C,calendarId:c,onSuccess:(e,t,r)=>{ee.logger.log("Tag update completed: ".concat(e," -> ").concat(t,", ").concat(r," trades updated"));const n=(0,Ee.dn)(e)?(0,Ee.Oo)(e):null,a=(0,Ee.dn)(t)?(0,Ee.Oo)(t):null;n&&a&&n!==a&&w===n&&k(a),u&&u(e,t)},onDelete:(e,t)=>{ee.logger.log("Tag deletion completed: ".concat(e,", ").concat(t," trades updated"));const r=(0,Ee.dn)(e)?(0,Ee.Oo)(e):null;if(r&&w===r){0===o.filter((t=>t!==e&&(0,Ee.dn)(t)&&(0,Ee.Oo)(t)===r)).length&&k("")}u&&u(e,"")},onTagUpdated:u,initialDefinition:D[C]||""}),(0,re.jsx)(Ve,{open:I,onClose:e=>{M(!1),e&&N()},calendarId:c,allTags:o,onTagCreated:async e=>{x&&(await x(c,(t=>{const r=t.tags||[];return r.includes(e)?t:(0,n.A)((0,n.A)({},t),{},{tags:[...r,e]})})),N())}}),(0,re.jsxs)(We.A,{open:!!_,onClose:()=>T(null),maxWidth:"sm",fullWidth:!0,children:[(0,re.jsxs)(Pe.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,re.jsx)(Le.A,{sx:{color:"primary.main"}}),(0,re.jsx)(l.A,{variant:"h6",component:"span",children:"Tag Details"})]}),(0,re.jsx)(p.A,{onClick:()=>T(null),size:"small",sx:{color:"text.secondary"},children:(0,re.jsx)(Ue.A,{})})]}),(0,re.jsx)(Ne.A,{dividers:!0,sx:(0,n.A)({},(0,he.J)(v)),children:_&&(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{mb:3},children:[(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"Tag"}),(0,re.jsx)(me.A,{label:(0,Ee.t)(_,!0),sx:(0,n.A)((0,n.A)({},(0,Ee.dO)(_,v)),{},{fontSize:"1rem",height:36,"& .MuiChip-label":{px:2}})})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"Definition"}),(0,re.jsx)(l.A,{variant:"body1",sx:{whiteSpace:"pre-wrap",color:D[_]?"text.primary":"text.secondary",fontStyle:D[_]?"normal":"italic"},children:D[_]||"No definition available for this tag."})]})]})}),(0,re.jsxs)(Fe.A,{children:[(0,re.jsx)(h.A,{onClick:()=>T(null),children:"Close"}),!f&&_&&(0,re.jsx)(h.A,{variant:"contained",onClick:()=>{S(_),T(null)},children:"Edit Tag"})]})]})]})};var Je=r(80045),$e=r(64020),Qe=r(56465),Ze=r(17060),et=r(45984),tt=r(68826),rt=r(97388),nt=r(68545),at=r(86296),ot=r(73200);const st=e=>{let{count:t=3,containerSx:r={}}=e;const a=(0,s.A)();return(0,re.jsx)(i.A,{sx:(0,n.A)({display:"flex",flexDirection:"column",gap:2},r),children:Array.from({length:t},((e,t)=>(0,re.jsxs)(i.A,{sx:{p:2,borderRadius:2,bgcolor:(0,d.X4)(a.palette.background.paper,.6),border:"1px solid ".concat((0,d.X4)(a.palette.divider,.1))},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,re.jsx)(ot.A,{height:20,width:"40%",borderRadius:4,variant:"wave",intensity:"medium"}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(ot.A,{height:16,width:16,borderRadius:"50%",variant:"wave",intensity:"medium"}),(0,re.jsx)(ot.A,{height:20,width:80,borderRadius:4,variant:"wave",intensity:"medium"})]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[(0,re.jsx)(ot.A,{height:14,width:14,borderRadius:"50%",variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:14,width:14,borderRadius:"50%",variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:12,width:80,borderRadius:4,variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:14,width:14,borderRadius:"50%",variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:12,width:60,borderRadius:4,variant:"wave",intensity:"low"})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:[(0,re.jsx)(ot.A,{height:20,width:80,borderRadius:10,variant:"wave",intensity:"medium"}),(0,re.jsx)(ot.A,{height:20,width:60,borderRadius:10,variant:"wave",intensity:"medium"}),(0,re.jsx)(ot.A,{height:20,width:70,borderRadius:10,variant:"wave",intensity:"medium"})]})]},t)))})};var it=r(87498);const lt=["key"],ct=["key"],dt=e=>{let{open:t,onClose:r,calendarId:o,allTags:c,onTradeClick:u,selectedTags:g=[],onTagsChange:m}=e;const x=(0,s.A)(),[f,y]=(0,a.useState)(""),[v,b]=(0,a.useState)(1),[j,w]=(0,a.useState)([]),[k,C]=(0,a.useState)(!1),[S,_]=(0,a.useState)(0),[T,I]=(0,a.useState)(0),[M,E]=(0,a.useState)(""),[z,D]=(0,a.useState)(!1),[R,W]=(0,a.useState)(""),[P,N]=(0,a.useState)({type:"all",startDate:null,endDate:null}),F=(0,a.useMemo)((()=>(0,Ee.GI)(c)),[c]),L=(0,a.useMemo)((()=>R?(0,Ee.o)(c,R):c),[c,R]),X=(0,a.useMemo)((()=>{let e=0;return g.length>0&&e++,"all"!==P.type&&e++,e}),[g,P]);(0,a.useEffect)((()=>{const e=setTimeout((()=>{E(f)}),300);return()=>clearTimeout(e)}),[f]),(0,a.useEffect)((()=>{b(1)}),[M,g,P]),(0,a.useEffect)((()=>{(async()=>{if(!M.trim()&&0===g.length&&"all"===P.type)return w([]),_(0),void I(0);C(!0);try{const e=await(0,it.getTradeRepository)().searchTrades(o,{searchQuery:M.trim()||void 0,selectedTags:g.length>0?g:void 0,dateFilter:"all"!==P.type?{type:P.type,startDate:P.startDate||void 0,endDate:P.endDate||void 0}:void 0,page:v,pageSize:20});w(e.trades),_(e.totalCount),I(e.totalPages)}catch(e){console.error("Search failed:",e),w([]),_(0),I(0)}finally{C(!1)}})()}),[o,M,g,P,v]);const O=(0,a.useCallback)((e=>{N((t=>(0,n.A)((0,n.A)({},t),{},{type:e,startDate:"all"===e?null:t.startDate,endDate:"all"===e?null:t.endDate})))}),[]),B=(0,a.useCallback)((e=>{N((t=>(0,n.A)((0,n.A)({},t),{},{startDate:e})))}),[]),U=(0,a.useCallback)((e=>{N((t=>(0,n.A)((0,n.A)({},t),{},{endDate:e})))}),[]),q=(0,a.useCallback)((()=>{N({type:"all",startDate:null,endDate:null})}),[]),G=(0,a.useCallback)((()=>{null===m||void 0===m||m([]),N({type:"all",startDate:null,endDate:null}),W("")}),[m]),H=(0,a.useCallback)((e=>{null===u||void 0===u||u(e),r()}),[u,r]);return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)(qe.A,{open:t,onClose:r,title:"Search & Filter Trades",subtitle:"Find trades by tags, notes, or date ranges",icon:(0,re.jsx)(_e.A,{}),width:{xs:"100%",sm:450},contentSx:(0,n.A)({},(0,he.J)(x)),headerVariant:"enhanced",children:[(0,re.jsxs)(i.A,{sx:{p:3,borderBottom:"1px solid ".concat((0,d.X4)(x.palette.divider,.1)),background:(0,d.X4)(x.palette.background.default,.3)},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",gap:1,alignItems:"flex-start"},children:[(0,re.jsx)(xe.A,{fullWidth:!0,placeholder:"Search by ID, name, tags, events, or session...",value:f,onChange:e=>y(e.target.value),slotProps:{input:{startAdornment:(0,re.jsx)(fe.A,{position:"start",children:(0,re.jsx)(_e.A,{sx:{color:"text.secondary"}})})}},variant:"outlined",size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:(0,d.X4)(x.palette.background.paper,.8),backdropFilter:"blur(8px)","&:hover":{backgroundColor:(0,d.X4)(x.palette.background.paper,.9)},"&.Mui-focused":{backgroundColor:(0,d.X4)(x.palette.background.paper,1)}}}}),(0,re.jsx)($e.A,{badgeContent:X,color:"primary",sx:{"& .MuiBadge-badge":{fontSize:"0.65rem",height:18,minWidth:18}},children:(0,re.jsx)(p.A,{onClick:()=>D(!0),size:"large",sx:{bgcolor:X>0?(0,d.X4)(x.palette.primary.main,.15):(0,d.X4)(x.palette.text.secondary,.15),borderRadius:2,border:"1px solid ".concat(X>0?(0,d.X4)(x.palette.primary.main,.3):(0,d.X4)(x.palette.divider,.3)),"&:hover":{bgcolor:X>0?(0,d.X4)(x.palette.primary.main,.25):(0,d.X4)(x.palette.text.secondary,.25)}},children:(0,re.jsx)(A.A,{sx:{color:X>0?"primary.main":"text.secondary"}})})})]}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{mt:1.5,display:"block",fontSize:"0.75rem"},children:"\ud83d\udca1 Use multiple tags separated by spaces, commas, or semicolons to find trades with ALL specified tags"}),X>0&&(0,re.jsxs)(i.A,{sx:{display:"flex",gap:.5,mt:1.5,flexWrap:"wrap",alignItems:"center"},children:[g.length>0&&(0,re.jsx)(me.A,{label:"".concat(g.length," tag").concat(g.length>1?"s":""),size:"small",color:"primary",variant:"outlined",onDelete:()=>null===m||void 0===m?void 0:m([]),sx:{height:24,fontSize:"0.75rem"}}),"all"!==P.type&&(0,re.jsx)(me.A,{label:"single"===P.type?"Date filter":"Date range",size:"small",color:"secondary",variant:"outlined",onDelete:q,sx:{height:24,fontSize:"0.75rem"}}),(0,re.jsx)(h.A,{size:"small",onClick:G,sx:{fontSize:"0.7rem",py:0,minHeight:24,color:"text.secondary"},children:"Clear all"})]})]}),(0,re.jsxs)(i.A,{sx:(0,n.A)({flex:1,overflow:"auto"},(0,he.J)(x)),children:[(f.trim()||g.length>0||"all"!==P.type)&&(0,re.jsx)(i.A,{sx:(0,n.A)({flex:1,overflow:"auto",background:(0,d.X4)(x.palette.background.default,.2)},(0,he.J)(x)),children:(0,re.jsxs)(i.A,{sx:{p:3},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1,flexWrap:"wrap"},children:[(0,re.jsxs)(l.A,{variant:"subtitle2",sx:{fontWeight:600},children:[f.trim()?"Search Results":"Filtered Results"," (",S,")"]}),g.length>0&&(0,re.jsx)(me.A,{label:"".concat(g.length," tag filter").concat(g.length>1?"s":""),size:"small",color:"secondary",variant:"outlined",sx:{fontSize:"0.7rem",height:20}}),"all"!==P.type&&(0,re.jsx)(me.A,{label:"".concat("single"===P.type?"Single date":"Date range"," filter"),size:"small",color:"info",variant:"outlined",sx:{fontSize:"0.7rem",height:20}})]}),k?(0,re.jsx)(st,{count:6}):0===j.length?(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"calc(100vh - 400px)",textAlign:"center"},children:[(0,re.jsx)(_e.A,{sx:{fontSize:48,color:"text.disabled",mb:2}}),(0,re.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"No trades found"}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Try searching with different keywords"})]}):(0,re.jsx)(i.A,{sx:(0,n.A)({display:"flex",flexDirection:"column",gap:2},(0,he.J)(x)),children:j.map((e=>(0,re.jsx)(at.A,{trade:e,onClick:()=>H(e),showTags:!0,showImages:!1},e.id)))}),T>1&&j.length>0&&(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3,borderTop:"1px solid ".concat((0,d.X4)(x.palette.divider,.1)),gap:2},children:[(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Showing ",20*(v-1)+1,"-",Math.min(20*v,S)," of ",S," trades"]}),(0,re.jsx)(Qe.A,{count:T,page:v,onChange:(e,t)=>b(t),color:"primary",size:"small",showFirstButton:!0,showLastButton:!0,sx:{"& .MuiPaginationItem-root":{borderRadius:2}}})]})]})}),!f.trim()&&0===g.length&&"all"===P.type&&(0,re.jsxs)(i.A,{sx:{textAlign:"center",py:6,px:3},children:[(0,re.jsx)(_e.A,{sx:{fontSize:64,color:"text.disabled",mb:2}}),(0,re.jsx)(l.A,{variant:"h6",sx:{mb:1,fontWeight:600,color:"text.secondary"},children:"Search Your Trades"}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",maxWidth:400,mx:"auto",mb:2},children:"Search by trade name, tags, notes, events or session. Use the filter button to narrow down results."})]})]})]}),(0,re.jsxs)(We.A,{open:z,onClose:()=>D(!1),maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:3,maxHeight:"80vh"}},children:[(0,re.jsx)(Pe.A,{sx:{pb:1},children:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(A.A,{color:"primary"}),(0,re.jsx)(l.A,{variant:"h6",children:"Filters"})]}),(0,re.jsx)(p.A,{onClick:()=>D(!1),size:"small",children:(0,re.jsx)(Ue.A,{})})]})}),(0,re.jsxs)(Ne.A,{sx:{pt:2},children:[m&&(0,re.jsxs)(i.A,{sx:{mb:3},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[(0,re.jsx)(A.A,{sx:{fontSize:20,color:"text.secondary"}}),(0,re.jsx)(l.A,{variant:"subtitle2",fontWeight:600,children:"Filter by Tags"}),g.length>0&&(0,re.jsx)(me.A,{label:g.length,size:"small",color:"primary",sx:{height:20,fontSize:"0.7rem"}})]}),F.length>0&&(0,re.jsx)(K.pp,{label:"Tag Group",value:R,onChange:e=>W(e.target.value),options:[{value:"",label:"All Tags"},...F.map((e=>({value:e,label:e})))],size:"small",sx:{mb:2}}),(0,re.jsx)(Ze.A,{multiple:!0,options:L,value:g,onChange:(e,t)=>null===m||void 0===m?void 0:m(t),slotProps:{listbox:{sx:(0,n.A)({},(0,he.J)(x))}},renderInput:e=>(0,re.jsx)(xe.A,(0,n.A)((0,n.A)({},e),{},{variant:"outlined",label:"Select Tags",placeholder:"Choose tags",fullWidth:!0,size:"small"})),renderTags:(e,t)=>e.map(((e,r)=>{const a=t({index:r}),{key:o}=a,s=(0,Je.A)(a,lt);return(0,re.jsx)(me.A,(0,n.A)((0,n.A)({label:(0,Ee.t)(e,!0)},s),{},{sx:(0,Ee.dO)(e,x),title:(0,Ee.dn)(e)?"Group: ".concat((0,Ee.Oo)(e)):void 0}),o)})),renderOption:(e,t)=>{const{key:r}=e,a=(0,Je.A)(e,ct);return(0,re.jsx)("li",(0,n.A)((0,n.A)({},a),{},{children:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Ee.dn)(t)&&(0,re.jsx)(me.A,{label:(0,Ee.Oo)(t),size:"small",sx:(0,n.A)((0,n.A)({},(0,Ee.dO)(t,x)),{},{height:"18px",fontSize:"0.7rem"})}),(0,Ee.t)(t,!0)]})}),r)}})]}),(0,re.jsx)(we.A,{sx:{my:2}}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[(0,re.jsx)(rt.A,{sx:{fontSize:20,color:"text.secondary"}}),(0,re.jsx)(l.A,{variant:"subtitle2",fontWeight:600,children:"Filter by Date"}),"all"!==P.type&&(0,re.jsx)(me.A,{label:"single"===P.type?"Single":"Range",size:"small",color:"secondary",sx:{height:20,fontSize:"0.7rem"}})]}),(0,re.jsx)(ye.A,{component:"fieldset",sx:{width:"100%",mb:2},children:(0,re.jsxs)(et.A,{value:P.type,onChange:e=>O(e.target.value),sx:{gap:.5},children:[(0,re.jsx)(be.A,{value:"all",control:(0,re.jsx)(tt.A,{size:"small"}),label:"All dates",sx:{margin:0}}),(0,re.jsx)(be.A,{value:"single",control:(0,re.jsx)(tt.A,{size:"small"}),label:"Specific date",sx:{margin:0}}),(0,re.jsx)(be.A,{value:"range",control:(0,re.jsx)(tt.A,{size:"small"}),label:"Date range",sx:{margin:0}})]})}),"single"===P.type&&(0,re.jsx)(nt.l,{label:"Select Date",value:P.startDate,onChange:B,slotProps:{textField:{fullWidth:!0,size:"small"}}}),"range"===P.type&&(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,re.jsx)(nt.l,{label:"Start Date",value:P.startDate,onChange:B,slotProps:{textField:{fullWidth:!0,size:"small"}}}),(0,re.jsx)(nt.l,{label:"End Date",value:P.endDate,onChange:U,minDate:P.startDate||void 0,slotProps:{textField:{fullWidth:!0,size:"small"}}})]})]})]}),(0,re.jsxs)(Fe.A,{sx:{px:3,pb:2},children:[(0,re.jsx)(h.A,{onClick:G,color:"inherit",disabled:0===X,children:"Clear All"}),(0,re.jsx)(h.A,{onClick:()=>D(!1),variant:"contained",color:"primary",children:"Apply"})]})]})]})};var ut=r(58128);(0,ut.Ay)(i.A)((e=>{let{theme:t}=e;return{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:t.spacing(1),padding:t.spacing(2),backgroundColor:t.palette.background.paper,borderRadius:t.shape.borderRadius,boxShadow:t.shadows[1],width:"100%",minHeight:"600px",alignContent:"start"}}));const gt=(0,ut.Ay)(i.A)((e=>{let{theme:t}=e;return{aspectRatio:"1",minHeight:"30px",borderRadius:t.shape.borderRadius,overflow:"hidden",backgroundColor:t.palette.background.default,[t.breakpoints.down("sm")]:{aspectRatio:"auto",minHeight:"56px"}}})),ht=(0,ut.Ay)(i.A)((e=>{let{theme:t}=e;return{padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary,fontSize:"0.875rem",fontWeight:500,border:"1px solid ".concat(t.palette.divider),backgroundColor:t.palette.background.default,borderRadius:t.shape.borderRadius}}));var pt=r(64924),mt=r(91283),xt=r(32515),ft=r(33474),yt=r(4239),vt=r(4395),At=r(79801),bt=r(87777),jt=r(12043),wt=r(91658),kt=r(50103),Ct=r(5362),St=r(11238);const _t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"xlsx";if(0===e.length)return;const a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=[...e].sort(((e,t)=>new Date(e.trade_date).getTime()-new Date(t.trade_date).getTime()));let a=0,o=t;return r.map((e=>(a+=e.amount,o+=e.amount,(0,n.A)((0,n.A)({},e),{},{cumulativePnL:a,accountBalance:o})))).map((e=>{var t,r,n;return{Date:(0,P.A)(new Date(e.trade_date),"MM/dd/yyyy"),Name:e.name?e.name:"",Type:e.trade_type.charAt(0).toUpperCase()+e.trade_type.slice(1),Amount:e.amount,"P&L":e.amount>0?"+".concat(e.amount.toFixed(2)):e.amount.toFixed(2),"Cumulative P&L":e.cumulativePnL>0?"+".concat(e.cumulativePnL.toFixed(2)):e.cumulativePnL.toFixed(2),"Account Balance":e.accountBalance.toFixed(2),"Entry Price":e.entry_price||"","Exit Price":e.exit_price||"",Tags:(null===(t=e.tags)||void 0===t?void 0:t.join(", "))||"","Risk to Reward":(null===(r=e.risk_to_reward)||void 0===r?void 0:r.toFixed(2))||"",Session:e.session||"",Notes:e.notes||"",Images:(null===(n=e.images)||void 0===n?void 0:n.map((e=>e.url)).join(", "))||""}}))}(e,t),o=(0,P.A)(new Date,"yyyy-MM-dd"),s="trades_".concat(o,".").concat(r);"xlsx"===r?((e,t)=>{const r=St.Wp.book_new(),n=St.Wp.json_to_sheet(e);n["!cols"]=[{wch:12},{wch:25},{wch:8},{wch:10},{wch:10},{wch:15},{wch:15},{wch:15},{wch:15},{wch:30},{wch:12},{wch:12},{wch:50},{wch:50}],St.Wp.book_append_sheet(r,n,"Trades"),St._h(r,t)})(a,s):((e,t)=>{const r=Object.keys(e[0]),n=[];n.push(r.join(","));for(const l of e){const e=r.map((e=>{const t=l[e],r=String(t).replace(/"/g,'""');return r.includes(",")||r.includes('"')||r.includes("\n")?'"'.concat(r,'"'):t}));n.push(e.join(","))}const a=n.join("\n"),o=new Blob([a],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(o),i=document.createElement("a");i.setAttribute("href",s),i.setAttribute("download",t),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)})(a,s)},Tt=e=>{if(0===e.length)return 0;const t=e.filter((e=>"win"===e.trade_type)).length,r=t+e.filter((e=>"loss"===e.trade_type)).length;return 0===r?0:t/r*100},It=e=>{const t=e.filter((e=>e.amount>0)).reduce(((e,t)=>e+t.amount),0),r=Math.abs(e.filter((e=>e.amount<0||"loss"===e.trade_type)).reduce(((e,t)=>e+t.amount),0));return 0===r?t>0?50:0:t/r},Mt=(e,t,r,n,a)=>{if(!r||r<=0||!t)return 0;const o=(e=>e.reduce(((e,t)=>e+t.amount),0))(e);let s=t;if(n&&a){s=t+a.filter((e=>new Date(e.trade_date)<n)).reduce(((e,t)=>e+t.amount),0)}if(s<=0)return 0;const i=r/100*s;return Math.min(Math.max(o/i*100,0),100)};var Et=r(53407),zt=r(79693),Dt=r(99147),Rt=r(80172),Wt=r(44337),Pt=r(22672),Nt=r(91244),Ft=r(16128),Lt=r(71101),Xt=r(89935),Ot=r(88234),Bt=r(81839);const Ut=["MM/dd/yyyy","M/d/yyyy","yyyy-MM-dd","yyyy/MM/dd","dd/MM/yyyy","dd-MM-yyyy","MM-dd-yyyy","M-d-yyyy","MMMM d, yyyy","MMM d, yyyy","MMMM dd, yyyy","MMM dd, yyyy"];function qt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"us";const r=e;if("number"===typeof e)return{success:!0,value:e,originalValue:r};if(null===e||void 0===e||""===e)return{success:!1,error:"Empty or null number",originalValue:r};let n=String(e).trim();if(""===n)return{success:!1,error:"Empty string",originalValue:r};const a=n.match(/^\(([0-9,.]+)\)$/);if(a&&(n="-".concat(a[1])),n=n.replace(/[$\u20ac\xa3\xa5\u20b9]/g,""),n.includes("%")){n=n.replace("%","");const e=qt(n,t);if(e.success&&void 0!==e.value)return{success:!0,value:e.value/100,originalValue:r}}"eu"===t?(n=n.replace(/\./g,""),n=n.replace(/,/g,".")):n=n.replace(/,/g,"");const o=parseFloat(n);return isNaN(o)?{success:!1,error:'Could not parse number: "'.concat(e,'"'),originalValue:r}:{success:!0,value:o,originalValue:r}}function Gt(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};switch(t){case"date":return function(e){const t=e;if(e instanceof Date)return{success:!0,value:e,originalValue:t};if(null===e||void 0===e||""===e)return{success:!1,error:"Empty or null date",originalValue:t};const r=String(e).trim();for(const s of Ut)try{const e=(0,Bt.A)(r,s,new Date);if(!isNaN(e.getTime()))return{success:!0,value:e,originalValue:t}}catch(o){}const n=r.match(/(January|February|March|April|May|June|July|August|September|October|November|December)\s+(\d{1,2})(?:st|nd|rd|th)?(?:,)?\s+(\d{4})/i);if(n){const[,e,r,a]=n,o=["january","february","march","april","may","june","july","august","september","october","november","december"].indexOf(e.toLowerCase());if(-1!==o){const e=new Date(parseInt(a),o,parseInt(r));if(!isNaN(e.getTime()))return{success:!0,value:e,originalValue:t}}}const a=new Date(r);return isNaN(a.getTime())?{success:!1,error:'Could not parse date: "'.concat(r,'"'),originalValue:t}:{success:!0,value:a,originalValue:t}}(e);case"number":return qt(e,r.numberFormat);case"boolean":return function(e){const t=e;if("boolean"===typeof e)return{success:!0,value:e,originalValue:t};if(null===e||void 0===e)return{success:!1,error:"Empty or null boolean",originalValue:t};const r=String(e).trim().toLowerCase();return["true","1","yes","y","t","on","checked"].includes(r)?{success:!0,value:!0,originalValue:t}:["false","0","no","n","f","off","unchecked",""].includes(r)?{success:!0,value:!1,originalValue:t}:{success:!1,error:'Could not parse boolean: "'.concat(e,'"'),originalValue:t}}(e);case"array":return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";const r=e;return Array.isArray(e)?{success:!0,value:e.map((e=>String(e).trim())).filter(Boolean),originalValue:r}:null===e||void 0===e||""===e?{success:!0,value:[],originalValue:r}:{success:!0,value:String(e).split(t).map((e=>e.trim())).filter(Boolean),originalValue:r}}(e,r.arrayDelimiter);case"string":return null===e||void 0===e?{success:!0,value:"",originalValue:e}:{success:!0,value:String(e),originalValue:e};default:return{success:!1,error:"Unknown field type: ".concat(t),originalValue:e}}}const Ht={trade_date:{name:"trade_date",displayName:"Trade Date",type:"date",required:!0,description:"Date when the trade was executed",examples:["2025-01-15","01/15/2025","January 15, 2025"]},amount:{name:"amount",displayName:"Amount (P&L)",type:"number",required:!0,description:"Profit or loss amount (positive for wins, negative for losses)",examples:["100.50","-50.25","$1,234.56"]},trade_type:{name:"trade_type",displayName:"Trade Type",type:"string",required:!1,description:"Type of trade result (win/loss/breakeven). Auto-derived from amount if not provided.",examples:["win","loss","breakeven"]},name:{name:"name",displayName:"Name",type:"string",required:!1,description:"Name or symbol of the trade",examples:["AAPL","EUR/USD","Gold Futures"]},entry_price:{name:"entry_price",displayName:"Entry Price",type:"number",required:!1,description:"Price at which the trade was entered",examples:["150.25","1.2345"]},exit_price:{name:"exit_price",displayName:"Exit Price",type:"number",required:!1,description:"Price at which the trade was exited",examples:["155.75","1.2450"]},stop_loss:{name:"stop_loss",displayName:"Stop Loss",type:"number",required:!1,description:"Stop loss price level",examples:["148.00","1.2300"]},take_profit:{name:"take_profit",displayName:"Take Profit",type:"number",required:!1,description:"Take profit price level",examples:["160.00","1.2600"]},risk_to_reward:{name:"risk_to_reward",displayName:"Risk to Reward",type:"number",required:!1,description:"Risk to reward ratio",examples:["2","3.5","1:2"]},partials_taken:{name:"partials_taken",displayName:"Partials Taken",type:"boolean",required:!1,description:"Whether partial profits were taken",examples:["true","false","yes","no"]},session:{name:"session",displayName:"Session",type:"string",required:!1,description:"Trading session",examples:["London","New York","Asian"]},notes:{name:"notes",displayName:"Notes",type:"string",required:!1,description:"Trade notes and comments",examples:["Good entry","Breakout trade","Revenge trading - avoid"]},tags:{name:"tags",displayName:"Tags",type:"array",required:!1,description:"Tags for categorization",examples:["Strategy:Breakout","Setup:Flag, Market:Bullish"]},images:{name:"images",displayName:"Images",type:"array",required:!1,description:"Image URLs (single URL or comma-separated list)",examples:["https://example.com/image.jpg","https://example.com/img1.jpg, https://example.com/img2.jpg"]}};function Yt(e,t,r){const n=Ht[e];if(null===t||void 0===t||""===t)return n.required?{isValid:!1,error:{row:0,column:e,field:e,severity:"error",message:'Required field "'.concat(n.displayName,'" is empty')}}:{isValid:!0,convertedValue:void 0};const a={numberFormat:r.numberFormat,arrayDelimiter:","},o=Gt(t,n.type,a);return o.success?function(e,t){switch(t){case"string":return"string"===typeof e;case"number":return"number"===typeof e&&!isNaN(e);case"date":return e instanceof Date&&!isNaN(e.getTime());case"boolean":return"boolean"===typeof e;case"array":return Array.isArray(e);default:return(0,ee.warn)("Unknown field type for validation: ".concat(t)),!1}}(o.value,n.type)?{isValid:!0,convertedValue:o.value}:{isValid:!1,error:{row:0,column:e,field:e,severity:"error",message:"Invalid ".concat(e," value after conversion"),value:o.value}}:{isValid:!1,error:{row:0,column:e,field:e,severity:"error",message:o.error||"Failed to convert ".concat(e),value:t,suggestedFix:"Expected ".concat(n.type,", got: ").concat(typeof t)}}}function Vt(e,t,r,n){const a={},o=[],s=[];for(const l of t){const{fileColumn:t,target:s}=l,i=e[t];if("ignore"===s)continue;if("create_tag"===s){if(i&&String(i).trim()){a.tags||(a.tags=[]);const e="".concat(t,":").concat(String(i).trim()),r=(0,Ee.$4)(e);a.tags.push(r)}continue}const c=s,d=Yt(c,i,r);if(d.isValid){if(void 0!==d.convertedValue)if("images"===c&&Array.isArray(d.convertedValue)){const e=d.convertedValue;a[c]=e.map(((e,t)=>({id:crypto.randomUUID(),url:e.trim(),calendar_id:""})))}else a[c]=d.convertedValue}else d.error&&(d.error.row=n,d.error.column=t,o.push(d.error))}if(a.trade_type||void 0===a.amount){if(a.trade_type&&"string"===typeof a.trade_type){const e=function(e){const t=e;if(null===e||void 0===e||""===e)return{success:!1,error:"Empty trade type",originalValue:t};const r=String(e).trim().toLowerCase();return["win","profit","w","positive","+","green"].includes(r)?{success:!0,value:"win",originalValue:t}:["loss","lose","l","negative","-","red"].includes(r)?{success:!0,value:"loss",originalValue:t}:["breakeven","break-even","be","b","flat","zero","0","neutral"].includes(r)?{success:!0,value:"breakeven",originalValue:t}:{success:!1,error:'Could not parse trade type: "'.concat(e,'"'),originalValue:t}}(a.trade_type);e.success?a.trade_type=e.value:o.push({row:n,column:"trade_type",field:"trade_type",severity:"error",message:"Invalid trade type",value:a.trade_type,suggestedFix:'Must be "win", "loss", or "breakeven"'})}}else a.amount>0?a.trade_type="win":a.amount<0?a.trade_type="loss":a.trade_type="breakeven";if(r.defaultValues)for(const[l,c]of Object.entries(r.defaultValues))void 0===a[l]&&(a[l]=c);const i=["amount","trade_date"];for(const l of i)void 0===a[l]&&o.push({row:n,column:l,field:l,severity:"error",message:'Required field "'.concat(Ht[l].displayName,'" is missing')});return a.name||s.push({row:n,column:"name",field:"name",severity:"warning",message:"Trade name is empty"}),{trade:a,errors:o,warnings:s}}const Kt={trade_date:["date","trade date","trade_date","tradedate","day","timestamp","time","executed","execution date","entry date"],amount:["amount","p&l","pnl","profit","loss","profit/loss","profit loss","net","net amount","result","pl"],trade_type:["type","trade type","trade_type","tradetype","result","outcome","status","win/loss","win loss"],name:["name","trade name","trade_name","tradename","title","symbol","ticker","instrument","asset","pair","description"],entry_price:["entry","entry price","entry_price","entryprice","buy price","buy","open price","open","purchase price","in","entry point"],exit_price:["exit","exit price","exit_price","exitprice","sell price","sell","close price","close","sale price","out","exit point"],stop_loss:["stop loss","stop_loss","stoploss","sl","s/l","s.l","stop","stop price"],take_profit:["take profit","take_profit","takeprofit","tp","t/p","t.p","target","target price","profit target"],risk_to_reward:["risk to reward","risk_to_reward","risktoreward","r:r","rr","r/r","r2r","risk reward","risk:reward","reward risk","reward:risk"],partials_taken:["partials","partials taken","partials_taken","partial","partial profit","scaled out","scale out","partials_out"],session:["session","trading session","market session","time session","period","shift"],notes:["notes","note","comments","comment","description","details","remarks","memo","observations"],tags:["tags","tag","categories","category","labels","label","keywords"],images:["images","image","imgs","img","pictures","picture","photos","photo","screenshots","screenshot","image url","image urls","image_url","image_urls","imageurl","imageurls"]};function Jt(e,t){const r=e.toLowerCase().trim(),n=t.toLowerCase().trim();if(r===n)return 1;if(r.includes(n)||n.includes(r))return.8;const a=[],o=r.length,s=n.length;for(let i=0;i<=o;i++)a[i]=[i];for(let i=0;i<=s;i++)a[0][i]=i;for(let i=1;i<=o;i++)for(let e=1;e<=s;e++){const t=r[i-1]===n[e-1]?0:1;a[i][e]=Math.min(a[i-1][e]+1,a[i][e-1]+1,a[i-1][e-1]+t)}return 1-a[o][s]/Math.max(o,s)}function $t(e){let t=null,r=0,n="";const a=e.toLowerCase().trim();for(const[o,s]of Object.entries(Kt))for(const e of s){const s=Jt(a,e);s>r&&(r=s,t=o,n=1===s?"exact match":s>=.8?"contains match":"similar match")}return r<.6?{field:null,confidence:0,reason:"no clear match found"}:{field:t,confidence:Math.round(100*r),reason:n}}function Qt(e,t){const r=e.filter((e=>null!==e&&void 0!==e&&""!==e));if(0===r.length)return{isCompatible:!0,validPercentage:100};if(["amount","entry_price","exit_price","stop_loss","take_profit","risk_to_reward"].includes(t)){let e=0;for(const n of r){const t=String(n).trim().replace(/[$,]/g,""),r=parseFloat(t);!isNaN(r)&&isFinite(r)&&e++}const t=Math.round(e/r.length*100);return t<70?{isCompatible:!1,reason:"Only ".concat(t,"% of values are valid numbers. Column contains non-numeric values like text."),validPercentage:t}:{isCompatible:!0,validPercentage:t}}if(["trade_date"].includes(t)){let e=0;for(const n of r)(n instanceof Date||!isNaN(Date.parse(String(n))))&&e++;const t=Math.round(e/r.length*100);return t<70?{isCompatible:!1,reason:"Only ".concat(t,"% of values are valid dates."),validPercentage:t}:{isCompatible:!0,validPercentage:t}}if(["partials_taken"].includes(t)){let e=0;const t=["true","false","yes","no","1","0","y","n"];for(const a of r){const r=String(a).toLowerCase().trim();("boolean"===typeof a||t.includes(r))&&e++}const n=Math.round(e/r.length*100);return n<70?{isCompatible:!1,reason:"Only ".concat(n,"% of values are valid boolean values."),validPercentage:n}:{isCompatible:!0,validPercentage:n}}return{isCompatible:!0,validPercentage:100}}const Zt=e=>{let{fileColumns:t,columnMappings:r,sampleData:n,onMappingChange:a}=e;const o=(0,s.A)(),c=Object.keys(Ht),u=new Set(r.filter((e=>"ignore"!==e.target&&"create_tag"!==e.target)).map((e=>e.target))),h=c.filter((e=>Ht[e].required)).filter((e=>!u.has(e))),p=r.filter((e=>"ignore"!==e.target&&"create_tag"!==e.target)).map((e=>({fileColumn:e.fileColumn,targetField:Ht[e.target].displayName}))),m=e=>{if(!e)return null;const t=function(e){return e>=80?"high":e>=60?"medium":e>=40?"low":"none"}(e);switch(t){case"high":return(0,re.jsx)(de.A,{sx:{fontSize:16,color:"success.main"}});case"medium":return(0,re.jsx)(Lt.A,{sx:{fontSize:16,color:"warning.main"}});case"low":return(0,re.jsx)(Xt.A,{sx:{fontSize:16,color:"error.main"}});default:return null}};return(0,re.jsxs)(i.A,{children:[(0,re.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Column Mapping"}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:'Map each file column to a trade field, ignore it, or choose "Create Tag" to convert it to a tag.'}),(0,re.jsxs)(i.A,{sx:{mb:3,p:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:1},children:[h.length>0&&(0,re.jsxs)(i.A,{sx:{mb:p.length>0?1.5:0},children:[(0,re.jsxs)(l.A,{variant:"body2",component:"span",color:"text.secondary",children:["Missing columns:"," "]}),h.map(((e,t)=>(0,re.jsxs)(l.A,{variant:"body2",component:"span",sx:{fontWeight:700,color:"error.main"},children:[Ht[e].displayName,t<h.length-1?", ":""]},e)))]}),p.length>0&&(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(l.A,{variant:"body2",component:"span",color:"text.secondary",children:["Valid columns:"," "]}),p.map(((e,t)=>(0,re.jsxs)(l.A,{variant:"body2",component:"span",sx:{fontWeight:700,color:"success.main"},children:[e.fileColumn," \u2192 ",e.targetField,t<p.length-1?", ":""]},e.fileColumn)))]}),0===h.length&&0===p.length&&(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No columns mapped yet. Start mapping columns below."})]}),(0,re.jsx)(i.A,{children:(0,re.jsx)(Nt.A,{sx:{border:"1px solid",borderColor:"divider"},children:(0,re.jsxs)(Ft.A,{children:[(0,re.jsx)(l.A,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"File Columns"}),(0,re.jsx)(i.A,{sx:{display:"flex",flexDirection:"column",gap:1.5,mt:2},children:t.map((e=>{const t=r.find((t=>t.fileColumn===e)),s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;const r=n.slice(0,t).map((t=>t[e])).filter((e=>null!==e&&void 0!==e&&""!==e)).map((e=>String(e)));return Array.from(new Set(r))}(e);return(0,re.jsxs)(i.A,{sx:{p:1.5,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:1},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:.5},children:[(0,re.jsx)(l.A,{variant:"caption",fontWeight:600,sx:{color:"text.secondary"},children:"File Column:"}),(0,re.jsx)(l.A,{variant:"body2",fontWeight:600,sx:{flex:1,mb:1},children:e}),(null===t||void 0===t?void 0:t.autoDetected)&&t.confidence&&(0,re.jsx)(g.A,{title:"".concat(t.confidence,"% confidence - Auto-detected"),children:(0,re.jsx)(i.A,{sx:{display:"flex",alignItems:"center"},children:m(t.confidence)})})]}),s.length>0&&(0,re.jsxs)(i.A,{sx:{mb:1.5,display:"flex",flexWrap:"wrap",gap:.5},children:[(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Sample data:"}),s.map(((e,t)=>(0,re.jsx)(me.A,{label:e.length>20?"".concat(e.substring(0,20),"..."):e,size:"small",sx:{mr:.5,mb:.5,height:20,fontSize:"0.7rem",bgcolor:(0,d.X4)(o.palette.secondary.main,.1)}},t)))]}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:['Map column "',e,'" to:']}),(0,re.jsx)(ye.A,{fullWidth:!0,size:"small",children:(0,re.jsxs)(ve.A,{value:(null===t||void 0===t?void 0:t.target)||"ignore",onChange:t=>a(e,t.target.value),sx:{fontSize:"0.875rem"},children:[(0,re.jsx)(Ae.A,{value:"ignore",children:(0,re.jsx)("em",{children:"Ignore this column"})}),(0,re.jsx)(Ae.A,{value:"create_tag",children:"Create Tag from this column"}),(0,re.jsx)(Ae.A,{disabled:!0,sx:{opacity:.5,fontSize:"0.75rem"},children:"\u2500\u2500\u2500\u2500 Trade Fields \u2500\u2500\u2500\u2500"}),c.map((e=>{const r=Ht[e],n=u.has(e)&&(null===t||void 0===t?void 0:t.target)!==e;return(0,re.jsx)(Ae.A,{value:e,disabled:n,sx:{fontSize:"0.875rem"},children:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{flex:1},children:r.displayName}),r.required&&(0,re.jsx)(me.A,{label:"Required",size:"small",sx:{height:16,fontSize:"0.65rem",bgcolor:(0,d.X4)("#f44336",.1),color:"error.main"}}),n&&(0,re.jsx)(me.A,{label:"Mapped",size:"small",sx:{height:16,fontSize:"0.65rem",bgcolor:(0,d.X4)("#2196f3",.1),color:"info.main"}})]})},e)}))]})}),(null===t||void 0===t?void 0:t.target)&&"ignore"!==t.target&&"create_tag"!==t.target&&(0,re.jsxs)(i.A,{sx:{mt:1,display:"flex",alignItems:"start",gap:.5},children:[(0,re.jsx)(Ot.A,{sx:{fontSize:14,color:"text.secondary",mt:.25}}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:Ht[t.target].description})]})]},e)}))})]})})})]})};var er=r(28259),tr=r(87443),rr=r(10756),nr=r(86172),ar=r(81341),or=r(34375);const sr=e=>{let{previewRows:t,mappedFields:r,maxRows:n=10}=e;const[o,s]=(0,a.useState)(!1),[c,u]=(0,a.useState)(null),m=o?t:t.slice(0,n),x=t.length>n,f=(e,t)=>{if(null===e||void 0===e)return"-";switch(Ht[t].type){case"date":return e instanceof Date?(0,P.A)(e,"MM/dd/yyyy"):String(e);case"number":return"number"===typeof e?e.toFixed(2):String(e);case"boolean":return e?"Yes":"No";case"array":return Array.isArray(e)?"images"===t&&e.length>0&&"object"===typeof e[0]&&"url"in e[0]?e.map((e=>e.url)).join(", "):e.join(", "):String(e);default:return String(e)}},y=e=>e.errors.length>0?(0,re.jsx)(Xt.A,{sx:{fontSize:20,color:"error.main"}}):e.warnings.length>0?(0,re.jsx)(Lt.A,{sx:{fontSize:20,color:"warning.main"}}):(0,re.jsx)(de.A,{sx:{fontSize:20,color:"success.main"}}),v=e=>e.errors.length>0?(0,d.X4)("#f44336",.05):e.warnings.length>0?(0,d.X4)("#ff9800",.05):"transparent";return(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,re.jsx)(l.A,{variant:"h6",children:"Data Preview"}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:["Showing ",m.length," of ",t.length," rows"]})]}),(0,re.jsx)(er.A,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,maxHeight:500,overflow:"auto","&::-webkit-scrollbar":{width:"8px",height:"8px"},"&::-webkit-scrollbar-track":{bgcolor:(0,d.X4)("#000",.05),borderRadius:1},"&::-webkit-scrollbar-thumb":{bgcolor:(0,d.X4)("#000",.2),borderRadius:1,"&:hover":{bgcolor:(0,d.X4)("#000",.3)}}},children:(0,re.jsxs)(tr.A,{stickyHeader:!0,size:"small",children:[(0,re.jsx)(rr.A,{children:(0,re.jsxs)(nr.A,{children:[(0,re.jsx)(ar.A,{sx:{width:40,bgcolor:"background.paper"},children:"Status"}),(0,re.jsx)(ar.A,{sx:{width:60,bgcolor:"background.paper"},children:"Row"}),r.map((e=>(0,re.jsx)(ar.A,{sx:{bgcolor:"background.paper",minWidth:120},children:(0,re.jsx)(l.A,{variant:"caption",fontWeight:600,children:Ht[e].displayName})},e))),(0,re.jsx)(ar.A,{sx:{width:40,bgcolor:"background.paper"}})]})}),(0,re.jsx)(or.A,{children:m.map(((e,t)=>{const n=c===t,o=e.errors.length>0||e.warnings.length>0;return(0,re.jsxs)(a.Fragment,{children:[(0,re.jsxs)(nr.A,{sx:{bgcolor:v(e),"&:hover":{bgcolor:(0,d.X4)("#000",.02)}},children:[(0,re.jsx)(ar.A,{children:(0,re.jsx)(g.A,{title:e.errors.length>0?"".concat(e.errors.length," error(s)"):e.warnings.length>0?"".concat(e.warnings.length," warning(s)"):"Valid",children:y(e)})}),(0,re.jsx)(ar.A,{children:(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:e.rowIndex+1})}),r.map((t=>{const r=e.mappedData[t],n=e.errors.some((e=>e.field===t)),a=e.warnings.some((e=>e.field===t));return(0,re.jsx)(ar.A,{sx:{bgcolor:n?(0,d.X4)("#f44336",.08):a?(0,d.X4)("#ff9800",.08):"transparent",maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(0,re.jsx)(g.A,{title:f(r,t),placement:"top",children:(0,re.jsx)(l.A,{variant:"caption",sx:{color:n?"error.main":a?"warning.main":"text.primary",fontWeight:n||a?600:400,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"},children:f(r,t)})})},t)})),(0,re.jsx)(ar.A,{children:o&&(0,re.jsx)(p.A,{size:"small",onClick:()=>(e=>{u(c===e?null:e)})(t),children:n?(0,re.jsx)(Be.A,{}):(0,re.jsx)(Oe.A,{})})})]}),o&&(0,re.jsx)(nr.A,{children:(0,re.jsx)(ar.A,{colSpan:r.length+3,sx:{p:0,border:"none"},children:(0,re.jsx)(De.A,{in:n,timeout:"auto",children:(0,re.jsxs)(i.A,{sx:{p:2,bgcolor:(0,d.X4)(e.errors.length>0?"#f44336":"#ff9800",.05),borderBottom:"1px solid",borderColor:"divider"},children:[e.errors.length>0&&(0,re.jsxs)(i.A,{sx:{mb:e.warnings.length>0?2:0},children:[(0,re.jsx)(l.A,{variant:"caption",fontWeight:600,color:"error.main",sx:{display:"block",mb:1},children:"Errors:"}),e.errors.map(((e,t)=>(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"start",gap:1,mb:.5,p:.75,bgcolor:"background.paper",borderRadius:.5,border:"1px solid",borderColor:(0,d.X4)("#f44336",.3)},children:[(0,re.jsx)(Xt.A,{sx:{fontSize:16,color:"error.main",mt:.25}}),(0,re.jsxs)(i.A,{sx:{flex:1},children:[(0,re.jsxs)(l.A,{variant:"caption",color:"error.main",children:[e.column,": ",e.message]}),e.suggestedFix&&(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.25},children:["\ud83d\udca1 ",e.suggestedFix]})]})]},t)))]}),e.warnings.length>0&&(0,re.jsxs)(i.A,{children:[(0,re.jsx)(l.A,{variant:"caption",fontWeight:600,color:"warning.main",sx:{display:"block",mb:1},children:"Warnings:"}),e.warnings.map(((e,t)=>(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"start",gap:1,mb:.5,p:.75,bgcolor:"background.paper",borderRadius:.5,border:"1px solid",borderColor:(0,d.X4)("#ff9800",.3)},children:[(0,re.jsx)(Lt.A,{sx:{fontSize:16,color:"warning.main",mt:.25}}),(0,re.jsxs)(l.A,{variant:"caption",color:"warning.main",children:[e.column,": ",e.message]})]},t)))]})]})})})})]},e.rowIndex)}))})]})}),x&&!o&&(0,re.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,re.jsxs)(h.A,{variant:"outlined",size:"small",onClick:()=>s(!0),children:["Show All ",t.length," Rows"]})}),o&&x&&(0,re.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,re.jsx)(h.A,{variant:"outlined",size:"small",onClick:()=>s(!1),children:"Show Less"})})]})};var ir=r(98258);const lr=e=>{let{summary:t}=e;const{totalRows:r,validRows:n,rowsWithWarnings:a,rowsWithErrors:o,willImport:s,conversions:u}=t,g=r>0?n/r*100:0;return(0,re.jsx)(Nt.A,{sx:{bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:(0,re.jsxs)(Ft.A,{children:[(0,re.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Validation Summary"}),(0,re.jsxs)(i.A,{sx:{mb:3},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Valid Rows"}),(0,re.jsxs)(l.A,{variant:"body2",fontWeight:600,children:[n," / ",r," (",g.toFixed(0),"%)"]})]}),(0,re.jsx)(c.A,{variant:"determinate",value:g,sx:{height:8,borderRadius:1,bgcolor:(0,d.X4)("#f44336",.1),"& .MuiLinearProgress-bar":{bgcolor:g>=80?"success.main":g>=50?"warning.main":"error.main",borderRadius:1}}})]}),(0,re.jsxs)(ke.A,{dense:!0,disablePadding:!0,children:[(0,re.jsxs)(Ce.Ay,{disablePadding:!0,sx:{mb:1},children:[(0,re.jsx)(At.A,{sx:{minWidth:36},children:(0,re.jsx)(de.A,{sx:{color:"success.main",fontSize:20}})}),(0,re.jsx)(Se.A,{primary:(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)(l.A,{variant:"body2",children:"Valid rows"}),(0,re.jsx)(me.A,{label:n,size:"small",sx:{bgcolor:(0,d.X4)("#4caf50",.1),color:"success.main",fontWeight:600}})]})})]}),a>0&&(0,re.jsxs)(Ce.Ay,{disablePadding:!0,sx:{mb:1},children:[(0,re.jsx)(At.A,{sx:{minWidth:36},children:(0,re.jsx)(Lt.A,{sx:{color:"warning.main",fontSize:20}})}),(0,re.jsx)(Se.A,{primary:(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)(l.A,{variant:"body2",children:"Rows with warnings"}),(0,re.jsx)(me.A,{label:a,size:"small",sx:{bgcolor:(0,d.X4)("#ff9800",.1),color:"warning.main",fontWeight:600}})]})})]}),o>0&&(0,re.jsxs)(Ce.Ay,{disablePadding:!0,sx:{mb:1},children:[(0,re.jsx)(At.A,{sx:{minWidth:36},children:(0,re.jsx)(Xt.A,{sx:{color:"error.main",fontSize:20}})}),(0,re.jsx)(Se.A,{primary:(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)(l.A,{variant:"body2",children:"Rows with errors"}),(0,re.jsx)(me.A,{label:o,size:"small",sx:{bgcolor:(0,d.X4)("#f44336",.1),color:"error.main",fontWeight:600}})]})})]}),u.length>0&&(0,re.jsxs)(Ce.Ay,{disablePadding:!0,sx:{mb:1},children:[(0,re.jsx)(At.A,{sx:{minWidth:36},children:(0,re.jsx)(ir.A,{sx:{color:"info.main",fontSize:20}})}),(0,re.jsx)(Se.A,{primary:(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)(l.A,{variant:"body2",children:"Type conversions"}),(0,re.jsx)(me.A,{label:u.length,size:"small",sx:{bgcolor:(0,d.X4)("#2196f3",.1),color:"info.main",fontWeight:600}})]})})]})]}),u.length>0&&(0,re.jsxs)(i.A,{sx:{mt:2,pt:2,borderTop:"1px solid",borderColor:"divider"},children:[(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"Conversions:"}),u.map(((e,t)=>(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5,p:.5,bgcolor:(0,d.X4)("#2196f3",.05),borderRadius:.5},children:[(0,re.jsx)(Ie.A,{sx:{fontSize:16,color:"info.main"}}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[e.affectedRows," ",e.field," values: ",e.fromType," \u2192 ",e.toType]})]},t)))]}),(0,re.jsxs)(i.A,{sx:{mt:2,pt:2,borderTop:"1px solid",borderColor:"divider",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)(l.A,{variant:"body2",fontWeight:600,children:"Will import:"}),(0,re.jsx)(me.A,{label:"".concat(s," trades"),size:"small",color:"primary",sx:{fontWeight:600}})]})]})})},cr=e=>{let{conversions:t}=e;const[r,n]=a.useState(null);return 0===t.length?null:(0,re.jsx)(Nt.A,{sx:{bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:(0,re.jsxs)(Ft.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[(0,re.jsx)(ir.A,{sx:{color:"info.main"}}),(0,re.jsx)(l.A,{variant:"h6",children:"Type Conversions"}),(0,re.jsx)(me.A,{label:t.length,size:"small",color:"info",sx:{ml:"auto"}})]}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The following data type conversions will be applied during import:"}),(0,re.jsx)(ke.A,{disablePadding:!0,children:t.map(((e,t)=>{const a=r===t,o=Ht[e.field];return(0,re.jsxs)(Ce.Ay,{disablePadding:!0,sx:{mb:1,flexDirection:"column",alignItems:"stretch",bgcolor:(0,d.X4)("#2196f3",.05),borderRadius:1,border:"1px solid",borderColor:(0,d.X4)("#2196f3",.2),overflow:"hidden"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",p:1.5,cursor:"pointer","&:hover":{bgcolor:(0,d.X4)("#2196f3",.08)}},onClick:()=>(e=>{n(r===e?null:e)})(t),children:[(0,re.jsxs)(i.A,{sx:{flex:1},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,re.jsx)(l.A,{variant:"body2",fontWeight:600,children:o.displayName}),(0,re.jsx)(me.A,{label:"".concat(e.affectedRows," rows"),size:"small",sx:{height:20,fontSize:"0.7rem",bgcolor:(0,d.X4)("#2196f3",.15),color:"info.main"}})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(me.A,{label:e.fromType,size:"small",variant:"outlined",sx:{height:22,fontSize:"0.7rem",borderColor:(0,d.X4)("#666",.3)}}),(0,re.jsx)(ir.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,re.jsx)(me.A,{label:e.toType,size:"small",sx:{height:22,fontSize:"0.7rem",bgcolor:(0,d.X4)("#4caf50",.1),color:"success.main",border:"1px solid",borderColor:(0,d.X4)("#4caf50",.3)}}),e.warnings>0&&(0,re.jsx)(g.A,{title:"".concat(e.warnings," warnings"),children:(0,re.jsx)(me.A,{label:"\u26a0 ".concat(e.warnings),size:"small",sx:{height:22,fontSize:"0.7rem",bgcolor:(0,d.X4)("#ff9800",.1),color:"warning.main"}})})]})]}),(0,re.jsx)(p.A,{size:"small",sx:{ml:1},children:a?(0,re.jsx)(Be.A,{}):(0,re.jsx)(Oe.A,{})})]}),(0,re.jsx)(De.A,{in:a,timeout:"auto",children:(0,re.jsx)(i.A,{sx:{px:1.5,pb:1.5,pt:0},children:(0,re.jsxs)(i.A,{sx:{bgcolor:"background.paper",borderRadius:1,p:1.5,border:"1px solid",borderColor:"divider"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"start",gap:1,mb:1},children:[(0,re.jsx)(Ie.A,{sx:{fontSize:16,color:"text.secondary",mt:.25}}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:o.description})]}),e.examples.length>0&&(0,re.jsxs)(i.A,{sx:{mt:1.5},children:[(0,re.jsx)(l.A,{variant:"caption",fontWeight:600,sx:{display:"block",mb:1},children:"Example conversions:"}),e.examples.map(((e,t)=>(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5,p:.75,bgcolor:(0,d.X4)("#000",.02),borderRadius:.5,fontSize:"0.75rem"},children:[(0,re.jsx)(l.A,{variant:"caption",sx:{fontFamily:"monospace",px:.75,py:.25,bgcolor:(0,d.X4)("#f44336",.1),color:"error.dark",borderRadius:.5},children:String(e.original)}),(0,re.jsx)(ir.A,{sx:{fontSize:14,color:"text.secondary"}}),(0,re.jsx)(l.A,{variant:"caption",sx:{fontFamily:"monospace",px:.75,py:.25,bgcolor:(0,d.X4)("#4caf50",.1),color:"success.dark",borderRadius:.5},children:"object"===typeof e.converted?JSON.stringify(e.converted):String(e.converted)})]},t)))]})]})})})]},t)}))}),(0,re.jsx)(i.A,{sx:{mt:2,p:1.5,bgcolor:(0,d.X4)("#2196f3",.05),borderRadius:1,border:"1px solid",borderColor:(0,d.X4)("#2196f3",.2)},children:(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[(0,re.jsx)("strong",{children:"Note:"})," All conversions are automatic and will be applied when you import the data. If any conversion fails, that row will be marked with an error."]})})]})})};var dr=r(52912);const ur="trade_import_mappings";function gr(){try{const e=localStorage.getItem(ur);if(!e)return[];return JSON.parse(e).map((e=>(0,n.A)((0,n.A)({},e),{},{createdAt:new Date(e.createdAt),lastUsed:e.lastUsed?new Date(e.lastUsed):void 0})))}catch(e){return(0,ee.error)("Failed to load mapping templates:",e),[]}}const hr=e=>{let{open:t,onClose:r,onApplyTemplate:n}=e;const[o,s]=(0,a.useState)([]),[c,u]=(0,a.useState)(null),[g,m]=(0,a.useState)(!1),[x,v]=(0,a.useState)(""),[A,b]=(0,a.useState)("success"),[j,w]=(0,a.useState)(!1),[k,C]=(0,a.useState)(null);(0,a.useEffect)((()=>{t&&S()}),[t]);const S=()=>{const e=gr();s(e)},_=()=>{w(!1),C(null)};return(0,re.jsxs)(We.A,{open:t,onClose:r,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{"& .MuiDialogContent-root":{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{bgcolor:(0,d.X4)("#000",.05),borderRadius:1},"&::-webkit-scrollbar-thumb":{bgcolor:(0,d.X4)("#000",.2),borderRadius:1,"&:hover":{bgcolor:(0,d.X4)("#000",.3)}}}}},children:[(0,re.jsx)(Pe.A,{children:"Mapping Templates"}),(0,re.jsxs)(Ne.A,{children:[0===o.length?(0,re.jsx)(i.A,{sx:{py:4,textAlign:"center"},children:(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No saved templates yet. Create templates by mapping columns and saving them for future use."})}):(0,re.jsx)(ke.A,{children:o.map((e=>(0,re.jsxs)(Ce.Ay,{onClick:()=>u(e.id),sx:{mb:1,border:"1px solid",borderColor:c===e.id?"primary.main":"divider",borderRadius:1,bgcolor:c===e.id?(0,d.X4)("#2196f3",.05):"transparent",cursor:"pointer","&:hover":{bgcolor:(0,d.X4)("#2196f3",.08)}},children:[(0,re.jsx)(Se.A,{primary:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(l.A,{variant:"body2",fontWeight:600,children:e.name}),c===e.id&&(0,re.jsx)(de.A,{sx:{fontSize:18,color:"primary.main"}})]}),secondary:(0,re.jsxs)(i.A,{children:[e.description&&(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:e.description}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:.5,mt:.5,flexWrap:"wrap"},children:[(0,re.jsx)(me.A,{label:"".concat(e.fileColumns.length," columns"),size:"small",sx:{height:18,fontSize:"0.65rem"}}),(0,re.jsx)(me.A,{label:(0,P.A)(e.createdAt,"MM/dd/yyyy"),size:"small",sx:{height:18,fontSize:"0.65rem"}}),e.lastUsed&&(0,re.jsx)(me.A,{label:"Used ".concat((0,P.A)(e.lastUsed,"MM/dd/yyyy")),size:"small",sx:{height:18,fontSize:"0.65rem"}})]})]})}),(0,re.jsx)(dr.A,{children:(0,re.jsx)(p.A,{edge:"end",size:"small",onClick:t=>{var r;t.stopPropagation(),r=e.id,C(r),w(!0)},children:(0,re.jsx)(Ct.A,{})})})]},e.id)))}),(0,re.jsxs)(i.A,{sx:{mt:2,display:"flex",gap:1},children:[(0,re.jsx)("input",{type:"file",accept:".json",style:{display:"none"},id:"import-templates",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!r)return;const n=new FileReader;n.onload=e=>{try{var t;const r=function(e){try{const t=JSON.parse(e),r=gr();let n=0;for(const e of t)r.some((t=>t.id===e.id))||(e.createdAt=new Date(e.createdAt),e.lastUsed&&(e.lastUsed=new Date(e.lastUsed)),r.push(e),n++);return localStorage.setItem(ur,JSON.stringify(r)),n}catch(t){throw(0,ee.error)("Failed to import templates:",t),new Error("Failed to import templates")}}(null===(t=e.target)||void 0===t?void 0:t.result);v("Successfully imported ".concat(r," template(s)")),b("success"),m(!0),S()}catch(r){v("Failed to import templates"),b("error"),m(!0)}},n.readAsText(r),e.target.value=""}}),(0,re.jsx)("label",{htmlFor:"import-templates",style:{flex:1},children:(0,re.jsx)(h.A,{component:"span",size:"small",variant:"outlined",startIcon:(0,re.jsx)(wt.A,{}),fullWidth:!0,children:"Import"})}),(0,re.jsx)(h.A,{size:"small",variant:"outlined",startIcon:(0,re.jsx)(kt.A,{}),onClick:()=>{!function(){try{const e=gr(),t=JSON.stringify(e,null,2),r=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download="trade-import-templates-".concat((new Date).toISOString().split("T")[0],".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}catch(e){throw(0,ee.error)("Failed to export templates:",e),new Error("Failed to export templates")}}()},disabled:0===o.length,sx:{flex:1},children:"Export"})]})]}),(0,re.jsxs)(Fe.A,{children:[(0,re.jsx)(h.A,{onClick:r,children:"Cancel"}),(0,re.jsx)(h.A,{onClick:()=>{const e=o.find((e=>e.id===c));e&&(n(e),r())},variant:"contained",disabled:!c,children:"Apply Template"})]}),(0,re.jsx)(f.A,{open:g,autoHideDuration:3e3,onClose:()=>m(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,re.jsx)(y.A,{onClose:()=>m(!1),severity:A,variant:"filled",sx:{width:"100%"},children:x})}),(0,re.jsxs)(We.A,{open:j,onClose:_,maxWidth:"xs",fullWidth:!0,children:[(0,re.jsx)(Pe.A,{children:"Delete Template?"}),(0,re.jsx)(Ne.A,{children:(0,re.jsx)(l.A,{variant:"body2",children:"Are you sure you want to delete this template? This action cannot be undone."})}),(0,re.jsxs)(Fe.A,{children:[(0,re.jsx)(h.A,{onClick:_,children:"Cancel"}),(0,re.jsx)(h.A,{onClick:()=>{k&&(!function(e){try{const t=gr(),r=t.filter((t=>t.id!==e));return r.length===t.length?((0,ee.warn)("Template with ID ".concat(e," not found")),!1):(localStorage.setItem(ur,JSON.stringify(r)),!0)}catch(t){return(0,ee.error)("Failed to delete mapping template:",t),!1}}(k),S(),w(!1),C(null))},variant:"contained",color:"error",children:"Delete"})]})]})]})},pr=["Upload & Parse","Map Columns","Preview & Validate"],mr=e=>{let{open:t,onClose:r,onImport:o,file:s}=e;const[c,u]=(0,a.useState)(0),[g,m]=(0,a.useState)(null),[x,v]=(0,a.useState)([]),[A,b]=(0,a.useState)([]),[j,w]=(0,a.useState)(null),[k,C]=(0,a.useState)(!1),[S,_]=(0,a.useState)(null),[T,I]=(0,a.useState)(!1),[M,E]=(0,a.useState)(""),[z,D]=(0,a.useState)(!1),[R,W]=(0,a.useState)(!1),[P,N]=(0,a.useState)(""),[F,L]=(0,a.useState)("success"),X={skipErrorRows:!0,createTagsFromUnmapped:!0,numberFormat:"us"};(0,a.useEffect)((()=>{t&&s?O(s):t||(u(0),m(null),v([]),b([]),w(null),_(null))}),[t,s]),(0,a.useEffect)((()=>{g&&x.length>0&&c>=1&&G()}),[x,g]);const O=async e=>{C(!0),_(null);try{var t;let r;r="csv"===(null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase())?await q(e):await B(e),m(r);const a=function(e){const t=[],r=new Set;for(const n of e){const{field:e,confidence:a,reason:o}=$t(n);e&&!r.has(e)?(t.push({fileColumn:n,target:e,confidence:a,autoDetected:!0}),r.add(e)):t.push({fileColumn:n,target:"ignore",confidence:0,autoDetected:!1})}return t}(r.columns),{correctedMappings:o,corrections:s}=function(e,t){const r=[];return{correctedMappings:e.map((e=>{if("ignore"===e.target||"create_tag"===e.target)return e;const a=Qt(t.rows.slice(0,100).map((t=>t[e.fileColumn])),e.target);return a.isCompatible?e:(r.push({column:e.fileColumn,originalTarget:e.target,reason:a.reason||"Incompatible data type"}),(0,n.A)((0,n.A)({},e),{},{target:"ignore",autoDetected:!1}))})),corrections:r}}(a,r);if(s.length>0){const e=s.map((e=>'"'.concat(e.column,'" cannot be mapped to "').concat(e.originalTarget,'": ').concat(e.reason))).join("\n");N("\u26a0\ufe0f Auto-corrected ".concat(s.length," incompatible mapping(s):\n").concat(e,'\n\nThese columns have been set to "Ignore".')),L("error"),W(!0)}v(o),u(1)}catch(r){_(r instanceof Error?r.message:"Failed to parse file")}finally{C(!1)}},B=async e=>new Promise(((t,r)=>{const n=new FileReader;n.onload=n=>{try{var a;const r=new Uint8Array(null===(a=n.target)||void 0===a?void 0:a.result),o=St.LF(r,{type:"array"}),s=o.Sheets[o.SheetNames[0]],i=St.Wp.sheet_to_json(s);if(0===i.length)throw new Error("No data found in file");const l=Object.keys(i[0]);t({columns:l,rows:i,fileType:"xlsx",fileName:e.name,rowCount:i.length})}catch(o){r(o)}},n.onerror=()=>r(new Error("Failed to read file")),n.readAsArrayBuffer(e)})),U=e=>{const t=[];let r="",n=!1;for(let a=0;a<e.length;a++){const o=e[a],s=e[a+1];'"'===o?n&&'"'===s?(r+='"',a++):n=!n:","!==o||n?r+=o:(t.push(r.trim()),r="")}return t.push(r.trim()),t},q=async e=>new Promise(((t,r)=>{const n=new FileReader;n.onload=n=>{try{var a;const r=(null===(a=n.target)||void 0===a?void 0:a.result).split("\n").filter((e=>e.trim()));if(r.length<2)throw new Error("CSV file must have at least a header and one data row");const o=U(r[0]),s=[];for(let e=1;e<r.length;e++){const t=U(r[e]),n={};o.forEach(((e,r)=>{n[e]=t[r]||""})),s.push(n)}t({columns:o,rows:s,fileType:"csv",fileName:e.name,rowCount:s.length})}catch(o){r(o)}},n.onerror=()=>r(new Error("Failed to read file")),n.readAsText(e)})),G=()=>{if(!g)return;const{previewRows:e,validationSummary:t}=function(e,t,r){const n=[],a=[],o=new Map;let s=0,i=0,l=0;e.forEach(((e,c)=>{const{trade:d,errors:u,warnings:g}=Vt(e,t,r,c),h=0===u.length;h&&s++,g.length>0&&i++,u.length>0&&l++,n.push({rowIndex:c,data:e,mappedData:d,errors:u,warnings:g,isValid:h}),a.push(...u);for(const r of t){if("ignore"===r.target||"create_tag"===r.target)continue;const t=r.target,n=Ht[t],a=e[r.fileColumn],s=d[t];if(void 0!==a&&void 0!==s){const e=typeof a;if(e!==n.type&&!("date"===n.type&&a instanceof Date)&&("array"!==n.type||!Array.isArray(a))){o.has(t)||o.set(t,{field:t,fromType:e,toType:n.type,affectedRows:0,examples:[],warnings:0});const r=o.get(t);r.affectedRows++,r.examples.length<3&&r.examples.push({original:a,converted:s}),g.some((e=>e.field===t))&&r.warnings++}}}}));const c={totalRows:e.length,validRows:s,rowsWithWarnings:i,rowsWithErrors:l,willImport:r.skipErrorRows?s:e.length,conversions:Array.from(o.values()),errors:a};return{previewRows:n,validationSummary:c}}(g.rows,x,X);b(e),w(t)};return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)(We.A,{open:t,onClose:r,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"90vh","& .MuiDialogContent-root":{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{bgcolor:(0,d.X4)("#000",.05),borderRadius:1},"&::-webkit-scrollbar-thumb":{bgcolor:(0,d.X4)("#000",.2),borderRadius:1,"&:hover":{bgcolor:(0,d.X4)("#000",.3)}}}}},children:[(0,re.jsx)(Pe.A,{children:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsx)(l.A,{variant:"h6",children:"Import Trades"}),(0,re.jsx)(p.A,{onClick:r,size:"small",children:(0,re.jsx)(Ue.A,{})})]})}),(0,re.jsxs)(Ne.A,{dividers:!0,children:[(0,re.jsx)(Et.A,{activeStep:c,sx:{mb:3},children:pr.map((e=>(0,re.jsx)(zt.A,{children:(0,re.jsx)(Dt.A,{children:e})},e)))}),S&&(0,re.jsx)(y.A,{severity:"error",sx:{mb:2},onClose:()=>_(null),children:S}),k&&(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:[(0,re.jsx)(Rt.A,{}),(0,re.jsx)(l.A,{variant:"body2",sx:{ml:2},children:"Processing file..."})]}),!k&&g&&(0,re.jsxs)(re.Fragment,{children:[0===c&&(0,re.jsxs)(i.A,{sx:{py:4,textAlign:"center"},children:[(0,re.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"File Loaded Successfully"}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[g.fileName," - ",g.rowCount," rows, ",g.columns.length," columns"]})]}),1===c&&(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{mb:2,display:"flex",gap:1},children:[(0,re.jsx)(h.A,{size:"small",variant:"outlined",startIcon:(0,re.jsx)(Wt.A,{}),onClick:()=>I(!0),children:"Load Template"}),(0,re.jsx)(h.A,{size:"small",variant:"outlined",startIcon:(0,re.jsx)(Pt.A,{}),onClick:()=>D(!z),children:"Save as Template"})]}),z&&(0,re.jsxs)(i.A,{sx:{mb:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"Save Mapping Template"}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,re.jsx)("input",{type:"text",placeholder:"Template name",value:M,onChange:e=>E(e.target.value),style:{flex:1,padding:"8px",borderRadius:"4px",border:"1px solid #ccc"}}),(0,re.jsx)(h.A,{variant:"contained",size:"small",onClick:()=>{if(g&&M.trim())try{!function(e,t,r,n){try{const a=gr(),o=a.findIndex((t=>t.name===e)),s={id:o>=0?a[o].id:crypto.randomUUID(),name:e,description:n,createdAt:o>=0?a[o].createdAt:new Date,lastUsed:new Date,columnMappings:t,fileColumns:r};return o>=0?a[o]=s:a.push(s),a.length>50&&(a.sort(((e,t)=>{const r=e.lastUsed||e.createdAt;return(t.lastUsed||t.createdAt).getTime()-r.getTime()})),a.splice(50)),localStorage.setItem(ur,JSON.stringify(a)),s}catch(a){throw(0,ee.error)("Failed to save mapping template:",a),new Error("Failed to save mapping template")}}(M.trim(),x,g.columns,"Template for ".concat(g.fileName)),D(!1),E(""),N("Template saved successfully!"),L("success"),W(!0)}catch(e){N("Failed to save template"),L("error"),W(!0)}},disabled:!M.trim(),children:"Save"})]})]}),(0,re.jsx)(Zt,{fileColumns:g.columns,columnMappings:x,sampleData:g.rows.slice(0,5),onMappingChange:(e,t)=>{if("ignore"!==t&&"create_tag"!==t&&g){const r=Qt(g.rows.slice(0,100).map((t=>t[e])),t);if(!r.isCompatible)return N('\u274c Cannot map "'.concat(e,'" to "').concat(t,'": ').concat(r.reason,"\n\n")+'This column will remain set to "Ignore". Clean your data or choose a different field.'),L("error"),void W(!0)}v((r=>r.map((r=>r.fileColumn===e?(0,n.A)((0,n.A)({},r),{},{target:t,autoDetected:!1}):r))))}})]}),2===c&&j&&(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,re.jsxs)(y.A,{severity:"warning",sx:{mb:1},children:[(0,re.jsx)(l.A,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"\u26a0\ufe0f Important: Importing will replace all existing trades"}),(0,re.jsx)(l.A,{variant:"body2",children:"All current trades in this calendar will be permanently deleted before importing the new trades. This action cannot be undone. Make sure you have a backup if needed."})]}),(0,re.jsx)(lr,{summary:j}),j.conversions.length>0&&(0,re.jsx)(cr,{conversions:j.conversions}),(()=>{const e=A.some((e=>(e.mappedData.tags||[]).some((e=>e.toLowerCase().startsWith("pair:"))))),t=A.some((e=>e.mappedData.session));return e?t?(0,re.jsxs)(y.A,{severity:"success",sx:{mb:1},children:[(0,re.jsx)(l.A,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Economic Events Will Be Fetched \u2713"}),(0,re.jsx)(l.A,{variant:"caption",children:"Trades have pair tags and session information. Relevant economic events will be automatically attached during import."})]}):(0,re.jsxs)(y.A,{severity:"info",sx:{mb:1},children:[(0,re.jsx)(l.A,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Partial Economic Events"}),(0,re.jsx)(l.A,{variant:"caption",children:"Pair tags detected, but no session information. Economic events will only be fetched for trades with a trading session (London, New York, Asian)."})]}):(0,re.jsxs)(y.A,{severity:"warning",sx:{mb:1},children:[(0,re.jsx)(l.A,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Economic Events Not Available"}),(0,re.jsx)(l.A,{variant:"caption",children:'No pair tags detected in your import. Trades will be imported without economic events. To include economic events, ensure you have a "Pair" column (e.g., EURUSD, GBPJPY) mapped to "Tags" or "Create Tag".'})]})})(),(0,re.jsx)(sr,{previewRows:A,mappedFields:x.filter((e=>"ignore"!==e.target&&"create_tag"!==e.target)).map((e=>e.target)),maxRows:10})]})]})]}),(0,re.jsxs)(Fe.A,{children:[(0,re.jsx)(h.A,{onClick:r,children:"Cancel"}),c>0&&(0,re.jsx)(h.A,{onClick:()=>{_(null),u((e=>e-1))},children:"Back"}),c<pr.length-1&&(0,re.jsx)(h.A,{onClick:()=>{if(1===c){const e=function(e){const t=e.filter((e=>"ignore"!==e.target&&"create_tag"!==e.target)).map((e=>e.target)),r=["amount","trade_date"].filter((e=>!t.includes(e)));return{isValid:0===r.length,missingFields:r}}(x);if(!e.isValid)return void _("Required fields not mapped: ".concat(e.missingFields.join(", ")));if(null===g||void 0===g?void 0:g.columns.some((e=>e.toLowerCase().includes("pair")||e.toLowerCase().includes("symbol")||e.toLowerCase().includes("instrument")))){const e=x.find((e=>{const t=e.fileColumn.toLowerCase();return t.includes("pair")||t.includes("symbol")||t.includes("instrument")}));"ignore"===(null===e||void 0===e?void 0:e.target)&&(N('\u26a0\ufe0f Warning: Pair/Symbol column is set to "Ignore". Trades will not have economic events attached. Consider mapping it to "Tags" or "Create Tag".'),L("error"),W(!0))}G()}_(null),u((e=>e+1))},variant:"contained",disabled:k||!g,children:"Next"}),c===pr.length-1&&(0,re.jsxs)(h.A,{onClick:()=>{if(!j)return;const e=A.filter((e=>e.isValid||!X.skipErrorRows)).map((e=>e.mappedData));o(e),r()},variant:"contained",disabled:!j||0===j.validRows,children:["Import ",(null===j||void 0===j?void 0:j.willImport)||0," Trades"]})]})]}),(0,re.jsx)(hr,{open:T,onClose:()=>I(!1),onApplyTemplate:e=>{if(!g)return;const t=new Map(e.columnMappings.map((e=>[e.fileColumn,e]))),r=x.map((e=>{const r=t.get(e.fileColumn);return r||e}));v(r),function(e){try{const t=gr(),r=t.find((t=>t.id===e));r&&(r.lastUsed=new Date,localStorage.setItem(ur,JSON.stringify(t)))}catch(t){(0,ee.error)("Failed to update template last used:",t)}}(e.id),I(!1)}}),(0,re.jsx)(f.A,{open:R,autoHideDuration:3e3,onClose:()=>W(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,re.jsx)(y.A,{onClose:()=>W(!1),severity:F,variant:"filled",sx:{width:"100%"},children:P})})]})};var xr=r(19170),fr=r(23275);const yr={weights:{consistency:40,riskManagement:25,performance:20,discipline:15},thresholds:{minTradesForScore:3,lookbackPeriod:30,consistencyTolerance:15},targets:{win_rate:60,profit_factor:1.5,max_drawdown:5,avgRiskReward:2},selectedTags:[],excludedTagsFromPatterns:[]};class vr{constructor(e){this.workerFactory=e,this.worker=null,this.pendingRequests=new Map,this.messageIdCounter=0,this.handleMessage=e=>{const t=e.data,r=this.pendingRequests.get(t.id);if(r)if(r.timeout&&clearTimeout(r.timeout),this.pendingRequests.delete(t.id),t.error){const e=new Error(t.error.message);e.stack=t.error.stack,r.reject(e)}else r.resolve(t.payload);else ee.logger.warn("Received response for unknown request ID:",t.id)},this.handleError=e=>{ee.logger.error("Worker error:",e.error),this.pendingRequests.forEach((t=>{t.timeout&&clearTimeout(t.timeout),t.reject(new Error("Worker error: ".concat(e.message)))})),this.pendingRequests.clear(),this.terminate()}}ensureWorker(){return this.worker||(this.worker=this.workerFactory(),this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)),this.worker}async request(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;const n=this.ensureWorker(),a="".concat(e,"-").concat(++this.messageIdCounter);return new Promise(((o,s)=>{const i=setTimeout((()=>{this.pendingRequests.delete(a),s(new Error("Worker request timeout after ".concat(r,"ms")))}),r);this.pendingRequests.set(a,{resolve:o,reject:s,timeout:i});const l={id:a,type:e,payload:t};n.postMessage(l)}))}terminate(){this.worker&&(this.worker.removeEventListener("message",this.handleMessage),this.worker.removeEventListener("error",this.handleError),this.worker.terminate(),this.worker=null),this.pendingRequests.forEach((e=>{e.timeout&&clearTimeout(e.timeout),e.reject(new Error("Worker terminated"))})),this.pendingRequests.clear()}isActive(){return null!==this.worker}}let Ar=null;function br(){return Ar||(Ar=new vr((()=>function(e){const t=new Blob([e],{type:"application/javascript"}),r=URL.createObjectURL(t),n=new Worker(r);return URL.revokeObjectURL(r),n}("\n// ============================================================================\n// Tag Pattern Generation\n// ============================================================================\n\nfunction generateTagCombinations(trades, excludedTags, minTrades) {\n  const allTags = new Set();\n  const tagPairs = new Set();\n  const tagTriples = new Set();\n\n  // Collect all tags and their combinations\n  trades.forEach(trade => {\n    if (trade.tags && trade.tags.length > 0) {\n      // Filter out system tags like Partials and excluded tags\n      const filteredTags = trade.tags.filter(tag =>\n        !tag.startsWith('Partials:') &&\n        (!excludedTags || !excludedTags.includes(tag))\n      );\n\n      // Single tags\n      filteredTags.forEach(tag => allTags.add(tag));\n\n      // Tag pairs\n      if (filteredTags.length >= 2) {\n        for (let i = 0; i < filteredTags.length; i++) {\n          for (let j = i + 1; j < filteredTags.length; j++) {\n            const pair = [filteredTags[i], filteredTags[j]].sort().join('|');\n            tagPairs.add(pair);\n          }\n        }\n      }\n\n      // Tag triples (for high-volume traders)\n      if (filteredTags.length >= 3) {\n        for (let i = 0; i < filteredTags.length; i++) {\n          for (let j = i + 1; j < filteredTags.length; j++) {\n            for (let k = j + 1; k < filteredTags.length; k++) {\n              const triple = [filteredTags[i], filteredTags[j], filteredTags[k]].sort().join('|');\n              tagTriples.add(triple);\n            }\n          }\n        }\n      }\n    }\n  });\n\n  // Convert to arrays\n  const combinations = [];\n\n  // Add single tags\n  allTags.forEach(tag => combinations.push([tag]));\n\n  // Add pairs\n  tagPairs.forEach(pair => combinations.push(pair.split('|')));\n\n  // Add triples (only if we have enough trades)\n  if (trades.length > (minTrades || 50)) {\n    tagTriples.forEach(triple => combinations.push(triple.split('|')));\n  }\n\n  return combinations;\n}\n\n// ============================================================================\n// Message Handler\n// ============================================================================\n\nself.addEventListener('message', (event) => {\n  const request = event.data;\n\n  try {\n    if (request.type === 'GENERATE_TAG_COMBINATIONS') {\n      const { trades, excludedTags, minTrades } = request.payload;\n\n      const combinations = generateTagCombinations(trades, excludedTags, minTrades);\n\n      const response = {\n        id: request.id,\n        type: request.type,\n        payload: { combinations }\n      };\n\n      self.postMessage(response);\n    } else {\n      throw new Error('Unknown request type: ' + request.type);\n    }\n  } catch (error) {\n    const response = {\n      id: request.id,\n      type: request.type,\n      error: {\n        message: error.message,\n        stack: error.stack\n      }\n    };\n\n    self.postMessage(response);\n  }\n});\n")))),Ar}const jr=new class{constructor(){this.minTradesForAnalysis=5,this.minTradesForCombination=3,this.recentPeriodDays=30,this.historicalPeriodDays=90}async analyzeTagPatterns(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,r=arguments.length>2?arguments[2]:void 0;const n=(0,xr.A)(t,this.recentPeriodDays),a=(0,xr.A)(t,this.historicalPeriodDays),o=e.filter((e=>(0,Y.A)(new Date(e.trade_date),n))),s=e.filter((e=>(0,Y.A)(new Date(e.trade_date),a)&&!(0,Y.A)(new Date(e.trade_date),n)));let i;try{i=await async function(e,t,r){const n=br(),a={trades:e,excludedTags:t,minTrades:r};return(await n.request("GENERATE_TAG_COMBINATIONS",a)).combinations}(e,null===r||void 0===r?void 0:r.excludedTagsFromPatterns)}catch(h){ee.logger.error("Tag pattern worker failed, using fallback:",h),i=this.generateTagCombinations(e,null===r||void 0===r?void 0:r.excludedTagsFromPatterns)}const l=i.map((t=>this.analyzeTagCombination(t,o,s,e))).filter((e=>e.total_trades>=this.minTradesForCombination)),c=[...l].sort(((e,t)=>{const r=t.win_rate-e.win_rate;return Math.abs(r)<5?t.total_trades-e.total_trades:r})).slice(0,10),d=l.filter((e=>"declining"===e.trend&&e.total_trades>=this.minTradesForAnalysis)).sort(((e,t)=>e.recentWinRate-e.historicalWinRate-(t.recentWinRate-t.historicalWinRate))).slice(0,5),u=this.generateInsights(c,d,e),g=this.generateMarketConditionAlerts(l,e);return{insights:[...u,...g],topCombinations:c,decliningCombinations:d,marketConditionAlerts:g}}generateTagCombinations(e,t){const r=new Set,n=new Set,a=new Set;e.forEach((e=>{if(e.tags&&e.tags.length>0){const o=e.tags.filter((e=>!e.startsWith("Partials:")&&(!t||!t.includes(e))));if(o.forEach((e=>r.add(e))),o.length>=2)for(let e=0;e<o.length;e++)for(let t=e+1;t<o.length;t++){const r=[o[e],o[t]].sort().join("|");n.add(r)}if(o.length>=3)for(let e=0;e<o.length;e++)for(let t=e+1;t<o.length;t++)for(let r=t+1;r<o.length;r++){const n=[o[e],o[t],o[r]].sort().join("|");a.add(n)}}}));const o=[];return r.forEach((e=>o.push([e]))),n.forEach((e=>o.push(e.split("|")))),e.length>50&&a.forEach((e=>o.push(e.split("|")))),o}analyzeTagCombination(e,t,r,n){const a=n.filter((t=>t.tags&&e.every((e=>t.tags.includes(e))))),o=t.filter((t=>t.tags&&e.every((e=>t.tags.includes(e))))),s=r.filter((t=>t.tags&&e.every((e=>t.tags.includes(e))))),i=a.filter((e=>"win"===e.trade_type)).length,l=a.filter((e=>"loss"===e.trade_type)).length,c=i+l,d=c>0?i/c*100:0,u=a.reduce(((e,t)=>e+t.amount),0),g=a.length>0?u/a.length:0,h=o.filter((e=>"win"===e.trade_type)).length,p=h+o.filter((e=>"loss"===e.trade_type)).length,m=p>0?h/p*100:0,x=s.filter((e=>"win"===e.trade_type)).length,f=x+s.filter((e=>"loss"===e.trade_type)).length,y=f>0?x/f*100:0;let v="stable";if(p>=3&&f>=3){const e=m-y;e>10?v="improving":e<-10&&(v="declining")}return{tags:e,win_rate:d,total_trades:a.length,wins:i,losses:l,total_pnl:u,avgPnL:g,trend:v,recentWinRate:m,historicalWinRate:y}}generateInsights(e,t,r){const n=[];return e.slice(0,3).forEach(((e,t)=>{e.win_rate>70&&e.total_trades>=this.minTradesForAnalysis&&n.push({type:"high_performance",title:"High-Performance Pattern #".concat(t+1),description:'The combination "'.concat(e.tags.join(" + "),'" shows exceptional performance with ').concat(e.win_rate.toFixed(1),"% win rate across ").concat(e.total_trades," trades."),tagCombination:e.tags,win_rate:e.win_rate,confidence:Math.min(95,50+2*e.total_trades),recommendation:'Consider focusing more on trades that match this pattern. Your success rate with "'.concat(e.tags.join(" + "),'" is significantly above average.'),severity:e.win_rate>80?"high":"medium"})})),t.forEach(((e,t)=>{const r=e.historicalWinRate-e.recentWinRate;r>15&&n.push({type:"declining_pattern",title:"Declining Pattern Alert",description:'The combination "'.concat(e.tags.join(" + "),'" has declined from ').concat(e.historicalWinRate.toFixed(1),"% to ").concat(e.recentWinRate.toFixed(1),"% win rate recently."),tagCombination:e.tags,win_rate:e.recentWinRate,confidence:Math.min(90,40+3*e.total_trades),recommendation:'Review your approach with "'.concat(e.tags.join(" + "),'" trades. Market conditions may have changed, requiring strategy adjustment.'),severity:r>25?"high":"medium"})})),n}generateMarketConditionAlerts(e,t){const r=[];return e.filter((e=>e.tags.some((e=>["Asia","London","NY AM","NY PM"].includes(e))))).forEach((e=>{if("declining"===e.trend&&e.total_trades>=5){const t=e.tags.find((e=>["Asia","London","NY AM","NY PM"].includes(e)));t&&r.push({type:"market_condition",title:"".concat(t," Session Performance Decline"),description:"Your performance during ".concat(t,' session with "').concat(e.tags.filter((e=>e!==t)).join(" + "),'" has declined recently.'),tagCombination:e.tags,win_rate:e.recentWinRate,confidence:75,recommendation:"Consider adjusting your strategy for ".concat(t," session or reducing position sizes during this time until performance improves."),severity:"medium"})}})),r.slice(0,2)}getTagCombinationStats(e,t){const r=(0,xr.A)(new Date,this.recentPeriodDays),n=(0,xr.A)(new Date,this.historicalPeriodDays),a=e.filter((e=>(0,Y.A)(new Date(e.trade_date),r))),o=e.filter((e=>(0,Y.A)(new Date(e.trade_date),n)&&!(0,Y.A)(new Date(e.trade_date),r)));return this.analyzeTagCombination(t,a,o,e)}};var wr=r(5410),kr=r(407),Cr=r(12382);const Sr=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr;this.settings=void 0,this.dynamicRiskSettings=void 0,this.settings=e}updateDynamicRiskSettings(e){this.dynamicRiskSettings=e}async calculateScore(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"weekly",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:yr;const o=this.getTradesForPeriod(e,t,r);await new Promise((e=>setTimeout(e,0)));const s=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(0===t.length)return{preferredSessions:[],commonTags:[],avgTradesPerDay:0,avgTradesPerWeek:0,avgPositionSize:0,avgRiskReward:0,win_rate:0,profit_factor:0,max_drawdown:0,tradingDays:[]};const s=(0,xr.A)(e,r),i=t.filter((e=>new Date(e.trade_date)>=s)),l=i.reduce(((e,t)=>(t.session&&(e[t.session]=(e[t.session]||0)+1),e)),{}),c=Object.entries(l).sort(((e,t)=>{let[,r]=e,[,n]=t;return n-r})).slice(0,2).map((e=>{let[t]=e;return t})),d=i.reduce(((e,t)=>(t.tags&&t.tags.forEach((t=>{a&&0!==a.length&&!a.includes(t)||(e[t]=(e[t]||0)+1)})),e)),{}),u=Object.entries(d).sort(((e,t)=>{let[,r]=e,[,n]=t;return n-r})).slice(0,5).map((e=>{let[t]=e;return t})),g=r,h=i.length/g,p=7*h,m=i.length>0?o?i.reduce(((e,r)=>e+(0,Q.G7)(r,t,o)),0)/i.length:Math.abs(i.reduce(((e,t)=>e+t.amount),0))/i.length:0,x=i.filter((e=>e.risk_to_reward&&e.risk_to_reward>0)),f=x.length>0?x.reduce(((e,t)=>e+(t.risk_to_reward||0)),0)/x.length:0,y=Tt(i),v=o?(()=>{const e=i.map((e=>(0,n.A)((0,n.A)({},e),{},{amount:(0,Q.G7)(e,t,o)})));return It(e)})():It(i);let A=0,b=0,j=0;i.forEach((e=>{const r=o?(0,Q.G7)(e,t,o):e.amount;j+=r,j>b&&(b=j);const n=(b-j)/Math.max(b,1)*100;n>A&&(A=n)}));const w=i.reduce(((e,t)=>{const r=(0,fr.A)(new Date(t.trade_date));return e[r]=(e[r]||0)+1,e}),{}),k=Object.entries(w).filter((e=>{let[,t]=e;return t>=.5*h})).map((e=>{let[t]=e;return parseInt(t)})).sort(((e,t)=>e-t));return{preferredSessions:c,commonTags:u,avgTradesPerDay:h,avgTradesPerWeek:p,avgPositionSize:m,avgRiskReward:f,win_rate:y,profit_factor:v,max_drawdown:A,tradingDays:k}}(r,this.getHistoricalTrades(e,r),this.settings.thresholds.lookbackPeriod,this.settings.selectedTags,this.dynamicRiskSettings);await new Promise((e=>setTimeout(e,0)));const i=((e,t,r,n,a)=>{if(e.length<r.thresholds.minTradesForScore)return{score:0,factors:{sessionConsistency:0,tagConsistency:0,timingConsistency:0,sizeConsistency:0}};const o=e.filter((e=>e.session)),s=o.length>0&&t.preferredSessions.length>0?o.filter((e=>t.preferredSessions.includes(e.session))).length/o.length*100:50,i=e.filter((e=>e.tags&&e.tags.length>0)),l=i.length>0&&t.commonTags.length>0?i.filter((e=>e.tags.some((e=>t.commonTags.includes(e))))).length/i.length*100:50,c=e.length>0&&t.tradingDays.length>0?e.filter((e=>t.tradingDays.includes((0,fr.A)(new Date(e.trade_date))))).length/e.length*100:50,d=e.length>0?a&&n?e.reduce(((e,t)=>e+(0,Q.G7)(t,n,a)),0)/e.length:Math.abs(e.reduce(((e,t)=>e+t.amount),0))/e.length:0,u=t.avgPositionSize>0?Math.abs(d-t.avgPositionSize)/t.avgPositionSize:0,g=Math.max(0,100-100*u),h={sessionConsistency:isNaN(s)?50:s,tagConsistency:isNaN(l)?50:l,timingConsistency:isNaN(c)?50:c,sizeConsistency:isNaN(g)?50:g},p=(h.sessionConsistency+h.tagConsistency+h.timingConsistency+h.sizeConsistency)/4;return{score:isNaN(p)?0:p,factors:h}})(o,s,this.settings,e,this.dynamicRiskSettings),l=((e,t,r,n,a)=>{if(e.length<r.thresholds.minTradesForScore)return{score:0,factors:{riskRewardRatio:0,positionSizing:0,maxDrawdownAdherence:0,stopLossUsage:0}};const o=e.filter((e=>e.risk_to_reward&&e.risk_to_reward>0)),s=o.length>0?o.reduce(((e,t)=>e+(t.risk_to_reward||0)),0)/o.length:0,i=r.targets.avgRiskReward>0?Math.abs(s-r.targets.avgRiskReward)/r.targets.avgRiskReward:0,l=s>0?Math.max(0,100-100*i):50,c=a&&n?e.map((e=>(0,Q.G7)(e,n,a))):e.map((e=>Math.abs(e.amount))),d=c.length>0?c.reduce(((e,t)=>e+t),0)/c.length:0,u=c.length>0?c.reduce(((e,t)=>e+Math.pow(t-d,2)),0)/c.length:0,g=Math.sqrt(u),h=d>0?Math.max(0,100-g/d*100):50;let p=0,m=0,x=0;e.forEach((e=>{const t=a&&n?(0,Q.G7)(e,n,a):e.amount;x+=t,x>m&&(m=x);const r=m>0?(m-x)/m*100:0;r>p&&(p=r)}));const f=p<=r.targets.max_drawdown?100:Math.max(0,100-10*(p-r.targets.max_drawdown)),y=e.filter((e=>"loss"===e.trade_type)),v=y.length>0?a&&n?Math.abs(y.reduce(((e,t)=>e+(0,Q.G7)(t,n,a)),0))/y.length:Math.abs(y.reduce(((e,t)=>e+t.amount),0))/y.length:0,A=e.filter((e=>"win"===e.trade_type)),b=A.length>0?a&&n?A.reduce(((e,t)=>e+(0,Q.G7)(t,n,a)),0)/A.length:A.reduce(((e,t)=>e+t.amount),0)/A.length:0,j=b>0&&v>0?Math.min(100,b/v*50):50,w={riskRewardRatio:isNaN(l)?50:l,positionSizing:isNaN(h)?50:h,maxDrawdownAdherence:isNaN(f)?50:f,stopLossUsage:isNaN(j)?50:j},k=(w.riskRewardRatio+w.positionSizing+w.maxDrawdownAdherence+w.stopLossUsage)/4;return{score:isNaN(k)?0:k,factors:w}})(o,0,this.settings,e,this.dynamicRiskSettings),c=((e,t,r,a,o)=>{if(e.length<r.thresholds.minTradesForScore)return{score:0,factors:{winRateConsistency:0,profitFactorStability:0,returnsConsistency:0,volatilityControl:0}};const s=Tt(e),i=o&&a?(()=>{const t=e.map((e=>(0,n.A)((0,n.A)({},e),{},{amount:(0,Q.G7)(e,a,o)})));return It(t)})():It(e),l=t.win_rate>0?Math.abs(s-t.win_rate)/t.win_rate:0,c=t.win_rate>0?Math.max(0,100-100*l):50,d=t.profit_factor>0?Math.abs(i-t.profit_factor)/t.profit_factor:0,u=t.profit_factor>0?Math.max(0,100-100*d):50,g=o&&a?e.map((e=>(0,Q.G7)(e,a,o))):e.map((e=>e.amount)),h=g.length>0?g.reduce(((e,t)=>e+t),0)/g.length:0,p=g.length>0?g.reduce(((e,t)=>e+Math.pow(t-h,2)),0)/g.length:0,m=Math.sqrt(p),x=Math.abs(h)>0?Math.max(0,100-m/Math.abs(h)*50):50;let f=0,y=0,v=0;e.forEach((e=>{const t=o&&a?(0,Q.G7)(e,a,o):e.amount;v+=t,v>y&&(y=v);const r=y>0?(y-v)/y*100:0;r>f&&(f=r)}));const A=t.max_drawdown>0&&f<=1.2*t.max_drawdown?100:t.max_drawdown>0?Math.max(0,100-5*(f-t.max_drawdown)):50,b={winRateConsistency:isNaN(c)?50:c,profitFactorStability:isNaN(u)?50:u,returnsConsistency:isNaN(x)?50:x,volatilityControl:isNaN(A)?50:A},j=(b.winRateConsistency+b.profitFactorStability+b.returnsConsistency+b.volatilityControl)/4;return{score:isNaN(j)?0:j,factors:b}})(o,s,this.settings,e,this.dynamicRiskSettings),d=((e,t,r,n,a)=>{if(e.length<r.thresholds.minTradesForScore)return{score:0,factors:{tradingPlanAdherence:0,emotionalControl:0,overtrading:0,ruleFollowing:0}};const o=e.filter((e=>e.session)),s=o.length>0&&t.preferredSessions.length>0?e.filter((e=>e.session&&t.preferredSessions.includes(e.session))).length/o.length*100:50,i=e.filter((e=>e.tags&&e.tags.length>0)),l=(s+(i.length>0&&t.commonTags.length>0?e.filter((e=>e.tags&&e.tags.some((e=>t.commonTags.includes(e))))).length/i.length*100:50))/2,c=a&&n?e.map((e=>(0,Q.G7)(e,n,a))):e.map((e=>Math.abs(e.amount))),d=c.length>0?c.reduce(((e,t)=>e+t),0)/c.length:0,u=c.length>0?c.reduce(((e,t)=>e+Math.pow(t-d,2)),0)/c.length:0,g=d>0?Math.sqrt(u)/d:0,h=Math.max(0,100-200*g),p=e.length/30,m=t.avgTradesPerDay,x=m>0?p/m:p/.1,f=x<=1.5?100:Math.max(0,100-50*(x-1.5)),y=e.length>0?e.filter((e=>e.session&&e.tags&&e.tags.length>0&&(e.risk_to_reward||"breakeven"===e.trade_type))).length/e.length*100:0,v={tradingPlanAdherence:isNaN(l)?50:l,emotionalControl:isNaN(h)?50:h,overtrading:isNaN(f)?50:f,ruleFollowing:isNaN(y)?50:y},A=(v.tradingPlanAdherence+v.emotionalControl+v.overtrading+v.ruleFollowing)/4;return{score:isNaN(A)?0:A,factors:v}})(o,s,this.settings,e,this.dynamicRiskSettings),u=(i.score*this.settings.weights.consistency+l.score*this.settings.weights.riskManagement+c.score*this.settings.weights.performance+d.score*this.settings.weights.discipline)/100,g=isNaN(u)?0:u,h={consistency:isNaN(i.score)?0:i.score,riskManagement:isNaN(l.score)?0:l.score,performance:isNaN(c.score)?0:c.score,discipline:isNaN(d.score)?0:d.score,overall:g},p={consistency:i,riskManagement:l,performance:c,discipline:d},m=this.calculateTrend(e,t,r),x=e.length>=10?await jr.analyzeTagPatterns(e,r,a):void 0,{recommendations:f,strengths:y,weaknesses:v}=((e,t,r)=>{const n=[],a=[],o=[];return e.consistency.score<70?(e.consistency.factors.sessionConsistency<70&&(n.push("Focus on trading during your most profitable sessions"),o.push("Inconsistent session timing")),e.consistency.factors.tagConsistency<70&&(n.push("Stick to your proven trading strategies and setups"),o.push("Deviating from successful patterns"))):a.push("Consistent trading approach"),e.riskManagement.score<70?(e.riskManagement.factors.maxDrawdownAdherence<70&&(n.push("Reduce position sizes to control drawdown"),o.push("Excessive drawdown risk")),e.riskManagement.factors.riskRewardRatio<70&&(n.push("Improve risk/reward ratios on your trades"),o.push("Poor risk/reward management"))):a.push("Strong risk management"),e.performance.score<70?e.performance.factors.winRateConsistency<70&&(n.push("Focus on quality setups to maintain win rate"),o.push("Declining win rate")):a.push("Consistent performance"),e.discipline.score<70?(e.discipline.factors.overtrading<70&&(n.push("Reduce trading frequency and focus on quality"),o.push("Overtrading detected")),e.discipline.factors.emotionalControl<70&&(n.push("Work on emotional control and position sizing"),o.push("Emotional trading patterns"))):a.push("Good trading discipline"),r&&r.insights&&r.insights.slice(0,2).forEach((e=>{"high_performance"===e.trade_type?(n.push('Focus on "'.concat(e.tagCombination.join(" + "),'" pattern (').concat(e.win_rate.toFixed(1),"% win rate)")),a.push("Strong performance with ".concat(e.tagCombination.join(" + ")," combination"))):"declining_pattern"===e.trade_type&&(n.push('Review "'.concat(e.tagCombination.join(" + "),'" strategy - performance declining')),o.push("Declining performance in ".concat(e.tagCombination.join(" + ")," trades")))})),{recommendations:n,strengths:a,weaknesses:o}})(p,0,x);return{currentScore:h,breakdown:p,pattern:s,recommendations:f,strengths:y,weaknesses:v,trend:m,tagPatternAnalysis:x}}async getScoreHistory(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:yr;const a=[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Date,s="monthly"===t||"yearly"===t?1:this.settings.thresholds.minTradesForScore;for(let i=0;i<r;i++){let r;switch(t){case"daily":r=xr.A(o,i);break;case"weekly":r=wr.A(o,i);break;case"monthly":r=U.A(o,i);break;case"yearly":r=le.A(o,i)}const l=this.getTradesForPeriod(e,t,r);if(l.length>=s){const o=await this.calculateScore(e,t,r,n);a.push({date:r,period:t,metrics:o.currentScore,breakdown:o.breakdown,tradeCount:l.length})}i%3===0&&await new Promise((e=>setTimeout(e,0)))}return a.reverse()}getTradesForPeriod(e,t,r){return e.filter((e=>{const n=new Date(e.trade_date);switch(t){case"daily":return kr.A(n,r);case"weekly":return D.A(n,r,{weekStartsOn:0});case"monthly":return R.A(n,r);case"yearly":return Cr.A(n,r);default:return!1}}))}getHistoricalTrades(e,t){const r=xr.A(t,this.settings.thresholds.lookbackPeriod);return e.filter((e=>{const n=new Date(e.trade_date);return n>=r&&n<=t}))}calculateTrend(e,t,r){try{const n=new Date;if(!this.isCurrentPeriod(r,t,n))return"stable";const a=this.getTradesForPeriod(e,t,r),o=new Date(r);switch(t){case"daily":o.setDate(o.getDate()-1);break;case"weekly":o.setDate(o.getDate()-7);break;case"monthly":o.setMonth(o.getMonth()-1);break;case"yearly":o.setFullYear(o.getFullYear()-1)}const s=this.getTradesForPeriod(e,t,o);if(a.length<2||s.length<2)return"stable";const i=this.calculateSimpleScore(a),l=i-this.calculateSimpleScore(s),c=5;return l>c?"improving":l<-c?"declining":"stable"}catch(n){return ee.logger.error("Error calculating trend:",n),"stable"}}isCurrentPeriod(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date;switch(t){case"daily":return kr.A(e,r);case"weekly":return D.A(e,r,{weekStartsOn:0});case"monthly":return R.A(e,r);case"yearly":return Cr.A(e,r);default:return!1}}calculateSimpleScore(e){if(0===e.length)return 0;const t=e.filter((e=>"win"===e.trade_type)).length/e.length*100,r=e.reduce(((e,t)=>e+t.amount),0)/e.length;return(t+(r>0?Math.min(100,10*r):Math.max(0,50+10*r)))/2}updateSettings(e){this.settings=(0,n.A)((0,n.A)({},this.settings),e)}getSettings(){return(0,n.A)({},this.settings)}async calculateMultiPeriodScore(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yr;console.log("ScoreService: calculateMultiPeriodScore called",{tradesCount:e.length,targetDate:t.toISOString(),sampleTrade:e[0]});const[n,a,o,s]=await Promise.all([this.calculateScore(e,"daily",t,r),this.calculateScore(e,"weekly",t,r),this.calculateScore(e,"monthly",t,r),this.calculateScore(e,"yearly",t,r)]);return console.log("ScoreService: Multi-period scores calculated",{daily:{overall:n.currentScore.overall,tradesCount:this.getTradesForPeriod(e,"daily",t).length},weekly:{overall:a.currentScore.overall,tradesCount:this.getTradesForPeriod(e,"weekly",t).length},monthly:{overall:o.currentScore.overall,tradesCount:this.getTradesForPeriod(e,"monthly",t).length},yearly:{overall:s.currentScore.overall,tradesCount:this.getTradesForPeriod(e,"yearly",t).length}}),{daily:n,weekly:a,monthly:o,yearly:s}}async getScoreSummary(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yr;const r=await this.calculateScore(e,"weekly",new Date,t),n=[{name:"Consistency",value:r.currentScore.consistency},{name:"Risk Management",value:r.currentScore.riskManagement},{name:"Performance",value:r.currentScore.performance},{name:"Discipline",value:r.currentScore.discipline}].reduce(((e,t)=>t.value<e.value?t:e)),a="".concat(n.name,": ").concat(n.value.toFixed(0),"%"),o=r.recommendations[0]||"Keep following your trading plan";return{currentWeekly:r.currentScore,trend:r.trend,keyMetric:a,recommendation:o}}};var _r=r(92248),Tr=r(69863),Ir=r(30143),Mr=r(23792),Er=r(82518),zr=r(9700),Dr=r(12690);const Rr=e=>{let{score:t,trend:r,period:n,compact:a=!1}=e;const o=(0,s.A)(),h=e=>e>=50?o.palette.success.main:e>=30?o.palette.warning.main:o.palette.error.main,p=()=>{switch(r){case"improving":return(0,re.jsx)(oe.A,{sx:{color:o.palette.success.main}});case"declining":return(0,re.jsx)(_r.A,{sx:{color:o.palette.error.main}});default:return(0,re.jsx)(Tr.A,{sx:{color:o.palette.text.secondary}})}},m=()=>{switch(r){case"improving":return o.palette.success.main;case"declining":return o.palette.error.main;default:return o.palette.text.secondary}},x=e=>{let{value:t,height:r}=e;return(0,re.jsx)(c.A,{variant:"determinate",value:isNaN(t)?0:t,sx:{height:r,borderRadius:r/2,backgroundColor:"dark"===o.palette.mode?(0,d.X4)(o.palette.common.white,.1):o.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:h(t),borderRadius:r/2}}})},f=e=>{switch(e.toLowerCase()){case"consistency":return"Consistency Score measures how well you stick to your established trading patterns:\n\n\u2022 Pattern Adherence (40%): How closely your trades match your historical successful patterns\n\u2022 Session Consistency (30%): Trading during your most profitable time periods\n\u2022 Strategy Consistency (30%): Using your most successful trading strategies\n\nHigher scores indicate better discipline in following proven patterns.";case"risk mgmt":case"risk management":return"Risk Management Score evaluates your discipline in managing risk and position sizing:\n\n\u2022 Position Sizing (35%): Consistency in risk per trade vs your target\n\u2022 Stop Loss Usage (25%): Proper use of stop losses on trades\n\u2022 Risk/Reward Ratio (25%): Achieving your target risk/reward ratios\n\u2022 Drawdown Control (15%): Keeping drawdowns within acceptable limits\n\nHigher scores indicate better risk control and capital preservation.";case"performance":return"Performance Score measures the consistency of your trading results vs historical patterns:\n\n\u2022 Win Rate Consistency (40%): How close your win rate is to your historical average\n\u2022 Profit Factor Stability (35%): Maintaining consistent profit factors over time\n\u2022 Return Consistency (25%): Steady returns without extreme volatility\n\nHigher scores indicate more predictable and stable trading performance.";case"discipline":return"Discipline Score evaluates your emotional control and trading discipline:\n\n\u2022 Trade Frequency (30%): Avoiding overtrading or undertrading\n\u2022 Plan Adherence (25%): Following your predetermined trading plan\n\u2022 Emotional Control (25%): Avoiding revenge trading and FOMO\n\u2022 Exit Discipline (20%): Taking profits and losses according to plan\n\nHigher scores indicate better emotional control and systematic trading.";default:return"This score component measures specific aspects of your trading performance and discipline."}},y=[{name:"Consistency",value:t.consistency,icon:(0,re.jsx)(Ir.A,{}),description:"How well you stick to your trading patterns"},{name:"Risk Mgmt",value:t.riskManagement,icon:(0,re.jsx)(Mr.A,{}),description:"Risk management and position sizing discipline"},{name:"Performance",value:t.performance,icon:(0,re.jsx)(Er.A,{}),description:"Performance consistency vs historical patterns"},{name:"Discipline",value:t.discipline,icon:(0,re.jsx)(zr.A,{}),description:"Trading discipline and emotional control"}];return a?(0,re.jsx)(Nt.A,{sx:{minWidth:200,backgroundColor:"dark"===o.palette.mode?(0,d.X4)(o.palette.background.paper,.8):o.palette.background.paper,borderRadius:2,boxShadow:o.shadows[2],border:"1px solid ".concat("dark"===o.palette.mode?(0,d.X4)(o.palette.common.white,.1):(0,d.X4)(o.palette.common.black,.1)),transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:o.shadows[4]}},children:(0,re.jsxs)(Ft.A,{sx:{p:2,"&:last-child":{pb:2}},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:1,children:[(0,re.jsxs)(l.A,{variant:"subtitle2",sx:{color:o.palette.text.secondary,fontWeight:500},children:[n.charAt(0).toUpperCase()+n.slice(1)," Score"]}),p()]}),(0,re.jsxs)(l.A,{variant:"h4",sx:{color:h(t.overall),fontWeight:"bold",mb:.5},children:[isNaN(t.overall)?"0":t.overall.toFixed(0),"%"]}),(0,re.jsx)(l.A,{variant:"caption",sx:{color:m(),fontWeight:500,display:"flex",alignItems:"center",gap:.5,mb:1},children:r.charAt(0).toUpperCase()+r.slice(1)}),(0,re.jsx)(x,{value:t.overall,height:6})]})}):(0,re.jsx)(Nt.A,{sx:{backgroundColor:"dark"===o.palette.mode?(0,d.X4)(o.palette.background.paper,.8):o.palette.background.paper,borderRadius:2,boxShadow:o.shadows[2],border:"1px solid ".concat("dark"===o.palette.mode?(0,d.X4)(o.palette.common.white,.1):(0,d.X4)(o.palette.common.black,.1)),transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:o.shadows[4]}},children:(0,re.jsxs)(Ft.A,{sx:{p:3},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:2,children:[(0,re.jsxs)(l.A,{variant:"h6",sx:{color:o.palette.text.primary,fontWeight:600},children:["\ud83d\udcca ",n.charAt(0).toUpperCase()+n.slice(1)," Trading Score"]}),(0,re.jsx)(me.A,{icon:p(),label:r.charAt(0).toUpperCase()+r.slice(1),size:"small",sx:{backgroundColor:(0,d.X4)(m(),.1),color:m(),fontWeight:500,border:"1px solid ".concat((0,d.X4)(m(),.3)),"& .MuiChip-icon":{color:m()}}})]}),(0,re.jsxs)(i.A,{sx:{textAlign:"center",mb:3},children:[(0,re.jsxs)(l.A,{variant:"h2",sx:{color:h(t.overall),fontWeight:"bold",mb:1},children:[isNaN(t.overall)?"0":t.overall.toFixed(0),"%"]}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Overall Trading Score"}),(0,re.jsx)(x,{value:t.overall,height:8})]}),(0,re.jsx)(u.A,{spacing:2,children:y.map((e=>(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:.5,children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,re.jsx)(i.A,{sx:{color:o.palette.text.secondary},children:e.icon}),(0,re.jsx)(l.A,{variant:"body2",fontWeight:"medium",children:e.name}),["Risk Management","Performance","Discipline"].includes(e.name)&&(0,re.jsx)(g.A,{title:(0,re.jsx)(i.A,{sx:{p:1,maxWidth:400},children:(0,re.jsx)(l.A,{variant:"body2",sx:{whiteSpace:"pre-line"},children:f(e.name)})}),placement:"top",arrow:!0,children:(0,re.jsx)(Dr.A,{sx:{fontSize:16,color:o.palette.text.secondary,cursor:"help","&:hover":{color:o.palette.primary.main}}})})]}),(0,re.jsxs)(l.A,{variant:"body2",fontWeight:"bold",sx:{color:h(e.value)},children:[isNaN(e.value)?"0":e.value.toFixed(0),"%"]})]}),(0,re.jsx)(x,{value:e.value,height:4})]},e.name)))})]})})};var Wr=r(21798),Pr=r(71407),Nr=r(6428);const Fr=e=>{let{breakdown:t,pattern:r,recommendations:n,strengths:o,weaknesses:h}=e;const p=(0,s.A)(),[m,x]=(0,a.useState)(""),f=e=>e>=50?p.palette.success.main:e>=30?p.palette.warning.main:p.palette.error.main,v=[{id:"consistency",name:"Consistency",icon:(0,re.jsx)(Ir.A,{}),score:t.consistency.score,factors:t.consistency.factors,description:"How well you stick to your established trading patterns"},{id:"riskManagement",name:"Risk Management",icon:(0,re.jsx)(Mr.A,{}),score:t.riskManagement.score,factors:t.riskManagement.factors,description:"Your discipline in managing risk and position sizing"},{id:"performance",name:"Performance",icon:(0,re.jsx)(Er.A,{}),score:t.performance.score,factors:t.performance.factors,description:"Consistency of performance vs your historical patterns"},{id:"discipline",name:"Discipline",icon:(0,re.jsx)(zr.A,{}),score:t.discipline.score,factors:t.discipline.factors,description:"Trading discipline and emotional control"}],A=e=>e.replace(/([A-Z])/g," $1").replace(/^./,(e=>e.toUpperCase())).trim(),b=e=>{switch(e.toLowerCase()){case"consistency":return"Consistency Score measures how well you stick to your established trading patterns:\n\n\u2022 Session Consistency (25%): % of trades in your top 2 preferred sessions\n\u2022 Tag Consistency (25%): % of trades using your top 5 common strategies\n\u2022 Timing Consistency (25%): % of trades on your preferred trading days\n\u2022 Size Consistency (25%): Deviation from historical average position size\n\nCalculation: Average of all four factors. Uses 30-day lookback for historical patterns.\nHigher scores indicate better discipline in following proven patterns.";case"risk management":return"Risk Management Score evaluates your discipline in managing risk and position sizing:\n\n\u2022 Risk/Reward Ratio (25%): Deviation from target R:R settings\n\u2022 Position Sizing (25%): Variance in trade sizes (coefficient of variation)\n\u2022 Max Drawdown Adherence (25%): Staying within drawdown limits\n\u2022 Stop Loss Usage (25%): Win/loss ratio indicating stop discipline\n\nCalculation: Average of all four factors. Uses normalized amounts for dynamic risk.\nHigher scores indicate better risk control and capital preservation.";case"performance":return"Performance Score measures the consistency of your trading results vs historical patterns:\n\n\u2022 Win Rate Consistency (25%): Deviation from historical win rate\n\u2022 Profit Factor Stability (25%): Deviation from historical profit factor\n\u2022 Returns Consistency (25%): Variance in trade returns (coefficient of variation)\n\u2022 Volatility Control (25%): Current vs historical maximum drawdown\n\nCalculation: Average of all four factors. Uses normalized amounts for dynamic risk.\nHigher scores indicate more predictable and stable trading performance.";case"discipline":return"Discipline Score evaluates your emotional control and trading discipline:\n\n\u2022 Trading Plan Adherence (25%): Average of session and tag adherence\n\u2022 Emotional Control (25%): Position size variance (coefficient of variation)\n\u2022 Overtrading (25%): Current vs historical trading frequency\n\u2022 Rule Following (25%): % of trades with complete data entry\n\nCalculation: Average of all four factors. Uses normalized amounts for emotional control.\nHigher scores indicate better emotional control and systematic trading.";default:return"This score component measures specific aspects of your trading performance and discipline."}},j=(e,t)=>{if("discipline"===e.toLowerCase())switch(t.toLowerCase()){case"overtrading":return"Measures if you are taking too many trades relative to your historical average.\n\nCalculation: Compares your current trading frequency (trades per day) to your historical pattern. Score = 100 if frequency ratio \u2264 1.5x, then decreases as ratio increases.\n\nHigher scores = appropriate frequency (better). Lower scores = overtrading detected (worse).";case"emotionalcontrol":return"Evaluates your ability to stick to your trading plan without letting emotions drive decisions.\n\nCalculation: Measures variance in your position sizes (normalized for dynamic risk). Uses coefficient of variation: StdDev/Average. Score = 100 - (coefficient \xd7 200).\n\nHigher scores = good emotional control (better). Lower scores = emotional trading patterns (worse).";case"tradingplanadhrence":case"tradingplanadherence":case"planadhrence":case"plan_adherence":return"Measures how well you follow your predetermined trading rules and strategies.\n\nCalculation: Average of session adherence (% of trades in your preferred sessions) and tag adherence (% of trades using your common strategies).\n\nHigher scores = better plan execution (better). Lower scores = poor discipline (worse).";case"rulefollowing":case"rule_following":return"Evaluates how consistently you fill out required trade information.\n\nCalculation: Percentage of trades that have session, tags, and risk/reward data filled out (breakeven trades exempt from risk/reward requirement).\n\nHigher scores = complete data entry (better). Lower scores = incomplete records (worse).";case"exitdiscipline":case"exit_discipline":return"Evaluates your ability to take profits and cut losses according to your plan.\n\nCalculation: Analyzes exit timing patterns and adherence to predetermined exit rules.\n\nHigher scores = good exit discipline (better). Lower scores = poor exit timing (worse).";default:return"This factor measures a specific aspect of your trading discipline and emotional control."}if("consistency"===e.toLowerCase())switch(t.toLowerCase()){case"sessionconsistency":case"session_consistency":return"Measures how consistently you trade during your most profitable sessions.\n\nCalculation: (Trades in preferred sessions / Total trades with session data) \xd7 100. Preferred sessions are your top 2 most-traded sessions from historical data.\n\nHigher scores = better session discipline (better). Lower scores = inconsistent timing (worse).";case"tagconsistency":case"tag_consistency":return"Evaluates how consistently you use your most successful trading strategies and setups.\n\nCalculation: (Trades using common tags / Total trades with tags) \xd7 100. Common tags are your top 5 most-used strategy tags from historical data.\n\nHigher scores = sticking to proven patterns (better). Lower scores = random experimentation (worse).";case"timingconsistency":case"timing_consistency":return"Measures how consistently you trade on your preferred days of the week.\n\nCalculation: (Trades on preferred days / Total trades) \xd7 100. Preferred days are determined from your historical trading pattern (days with significant activity).\n\nHigher scores = following established schedule (better). Lower scores = impulsive trading (worse).";case"sizeconsistency":case"size_consistency":return"Evaluates the consistency of your position sizes relative to your historical average.\n\nCalculation: Compares current average trade size to historical pattern. Score = 100 - (deviation percentage \xd7 100). Uses normalized amounts for dynamic risk.\n\nHigher scores = disciplined sizing (better). Lower scores = emotional deviations (worse).";default:return"This factor measures a specific aspect of your trading consistency and pattern adherence."}if("risk management"===e.toLowerCase())switch(t.toLowerCase()){case"riskrewardratio":case"risk_reward_ratio":return"Measures how well your actual risk/reward ratios match your target settings.\n\nCalculation: Compares average R:R of trades with R:R data to your target R:R setting. Score = 100 - (deviation percentage \xd7 100).\n\nHigher scores = better adherence to targets (better). Lower scores = deviation from targets (worse).";case"positionsizing":case"position_sizing":return"Measures how consistent your trade sizes are relative to each other.\n\nCalculation: Uses coefficient of variation (StdDev/Average) of trade sizes. Score = 100 - (coefficient \xd7 100). Uses normalized amounts for dynamic risk.\n\nHigher scores = consistent position sizing (better risk control). Lower scores = highly variable trade sizes (poor risk management).";case"maxdrawdownadherence":case"max_drawdown_adherence":return"Measures how well you stay within your maximum drawdown limits.\n\nCalculation: Tracks running P&L to find maximum drawdown percentage. Score = 100 if \u2264 target, then decreases by 10 points per 1% over target. Uses normalized amounts for dynamic risk.\n\nHigher scores = better capital preservation (better). Lower scores = excessive drawdown risk (worse).";case"stoplossusage":case"stop_loss_usage":return"Approximates your use of stop losses by analyzing the ratio between average wins and losses.\n\nCalculation: (Average win / Average loss) \xd7 50, capped at 100. Uses normalized amounts for dynamic risk. Assumes good stop loss discipline creates reasonable win/loss ratios.\n\nHigher scores = better stop loss discipline (better). Lower scores = poor risk control (worse).";default:return"This factor measures a specific aspect of your risk management and capital preservation."}if("performance"===e.toLowerCase())switch(t.toLowerCase()){case"winrateconsistency":case"win_rate_consistency":return"Measures how consistent your current win rate is compared to your historical average.\n\nCalculation: Compares current win rate (wins/total trades) to historical pattern. Score = 100 - (deviation percentage \xd7 100).\n\nHigher scores = maintaining consistent win rate (better). Lower scores = declining or volatile win rate (worse).";case"profitfactorstability":case"profit_factor_stability":return"Evaluates how stable your profit factor is compared to your historical pattern.\n\nCalculation: Profit factor = Total profits / Total losses. Compares current to historical pattern. Score = 100 - (deviation percentage \xd7 100). Uses normalized amounts for dynamic risk.\n\nHigher scores = stable profitability (better). Lower scores = declining profit factor (worse).";case"returnsconsistency":case"returns_consistency":return"Measures the consistency of your trade returns by analyzing the variance in your trade amounts.\n\nCalculation: Uses coefficient of variation (StdDev/Average) of trade returns. Score = 100 - (coefficient \xd7 50). Uses normalized amounts for dynamic risk.\n\nHigher scores = consistent returns (better). Lower scores = erratic performance (worse).";case"volatilitycontrol":case"volatility_control":return"Evaluates your ability to control drawdowns and maintain stable equity curves compared to your historical patterns.\n\nCalculation: Compares current maximum drawdown to historical pattern. Score = 100 if within 120% of historical, then decreases by 5 points per 1% excess. Uses normalized amounts for dynamic risk.\n\nHigher scores = good volatility control (better). Lower scores = excessive volatility (worse).";default:return"This factor measures a specific aspect of your trading performance consistency."}return"This factor contributes to your overall score in this category."};return(0,re.jsx)(Nt.A,{sx:{backgroundColor:"dark"===p.palette.mode?(0,d.X4)(p.palette.background.paper,.8):p.palette.background.paper,borderRadius:2,boxShadow:p.shadows[2],border:"1px solid ".concat("dark"===p.palette.mode?(0,d.X4)(p.palette.common.white,.1):(0,d.X4)(p.palette.common.black,.1))},children:(0,re.jsxs)(Ft.A,{sx:{p:3},children:[(0,re.jsx)(l.A,{variant:"h6",gutterBottom:!0,sx:{color:p.palette.text.primary,fontWeight:600,mb:3},children:"\ud83d\udd0d Score Breakdown & Analysis"}),(0,re.jsxs)(u.A,{spacing:2,mb:3,children:[n.length>0&&(0,re.jsxs)(y.A,{severity:"info",icon:(0,re.jsx)(oe.A,{}),children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"Key Recommendations"}),(0,re.jsx)(ke.A,{dense:!0,children:n.slice(0,3).map(((e,t)=>(0,re.jsx)(Ce.Ay,{sx:{py:0},children:(0,re.jsx)(Se.A,{primary:e})},t)))})]}),o.length>0&&(0,re.jsxs)(y.A,{severity:"success",icon:(0,re.jsx)(de.A,{}),children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"Your Strengths"}),(0,re.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:o.map(((e,t)=>(0,re.jsx)(me.A,{label:e,size:"small",color:"success",variant:"outlined"},t)))})]}),h.length>0&&(0,re.jsxs)(y.A,{severity:"warning",icon:(0,re.jsx)(Lt.A,{}),children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"Areas for Improvement"}),(0,re.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:h.map(((e,t)=>(0,re.jsx)(me.A,{label:e,size:"small",color:"warning",variant:"outlined"},t)))})]})]}),(0,re.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,sx:{mt:2},children:"Detailed Analysis"}),v.map((e=>{return(0,re.jsx)(i.A,{sx:{backgroundColor:"dark"===p.palette.mode?(0,d.X4)(p.palette.background.paper,.6):(0,d.X4)(p.palette.background.paper,.8),borderRadius:3,border:"1px solid ".concat("dark"===p.palette.mode?(0,d.X4)(p.palette.common.white,.1):(0,d.X4)(p.palette.common.black,.1)),overflow:"hidden",transition:"all 0.2s ease-in-out",mb:2,"&:hover":{transform:"translateY(-1px)",boxShadow:p.shadows[3]}},children:(0,re.jsxs)(Wr.A,{expanded:m===e.id,onChange:(r=e.id,(e,t)=>{x(!!t&&r)}),sx:{backgroundColor:"transparent",boxShadow:"none","&:before":{display:"none"},"& .MuiAccordionSummary-root":{borderRadius:3}},children:[(0,re.jsx)(Pr.A,{expandIcon:(0,re.jsx)(Oe.A,{}),children:(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",spacing:2,sx:{width:"100%"},children:[(0,re.jsx)(i.A,{sx:{color:p.palette.text.secondary},children:e.icon}),(0,re.jsxs)(i.A,{sx:{flexGrow:1},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,re.jsx)(l.A,{variant:"subtitle2",fontWeight:"medium",children:e.name}),["Risk Management","Performance","Discipline"].includes(e.name)&&(0,re.jsx)(g.A,{title:(0,re.jsx)(i.A,{sx:{p:1,maxWidth:400},children:(0,re.jsx)(l.A,{variant:"body2",sx:{whiteSpace:"pre-line"},children:b(e.name)})}),placement:"top",arrow:!0,children:(0,re.jsx)(Dr.A,{sx:{fontSize:16,color:p.palette.text.secondary,cursor:"help","&:hover":{color:p.palette.primary.main}}})})]}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:e.description})]}),(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",spacing:1,children:[(t=e.score,t>=50?(0,re.jsx)(de.A,{sx:{color:p.palette.success.main}}):t>=30?(0,re.jsx)(Lt.A,{sx:{color:p.palette.warning.main}}):(0,re.jsx)(Xt.A,{sx:{color:p.palette.error.main}})),(0,re.jsxs)(l.A,{variant:"h6",sx:{color:f(e.score),fontWeight:"bold"},children:[isNaN(e.score)?"0":e.score.toFixed(0),"%"]})]})]})}),(0,re.jsx)(Nr.A,{children:(0,re.jsxs)(u.A,{spacing:2,children:[(0,re.jsx)(c.A,{variant:"determinate",value:isNaN(e.score)?0:e.score,sx:{height:8,borderRadius:4,backgroundColor:"dark"===p.palette.mode?(0,d.X4)(p.palette.common.white,.1):p.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:f(e.score),borderRadius:4}}}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Factor Breakdown:"}),(0,re.jsx)(u.A,{spacing:1,children:Object.entries(e.factors).map((t=>{let[r,n]=t;return(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(u.A,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:.5,children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,re.jsx)(l.A,{variant:"body2",children:A(r)}),["discipline","risk management","consistency","performance"].includes(e.name.toLowerCase())&&(0,re.jsx)(g.A,{title:(0,re.jsx)(i.A,{sx:{p:1,maxWidth:300},children:(0,re.jsx)(l.A,{variant:"body2",children:j(e.name,r)})}),placement:"top",arrow:!0,children:(0,re.jsx)(Dr.A,{sx:{fontSize:14,color:p.palette.text.secondary,cursor:"help","&:hover":{color:p.palette.primary.main}}})})]}),(0,re.jsxs)(l.A,{variant:"body2",fontWeight:"medium",sx:{color:f(n)},children:[isNaN(n)?"0":n.toFixed(0),"%"]})]}),(0,re.jsx)(c.A,{variant:"determinate",value:isNaN(n)?0:n,sx:{height:4,borderRadius:2,backgroundColor:"dark"===p.palette.mode?(0,d.X4)(p.palette.common.white,.1):p.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:f(n),borderRadius:2}}})]},r)}))})]})})]})},e.id);var t,r})),(0,re.jsxs)(i.A,{sx:{mt:3,p:2,backgroundColor:"dark"===p.palette.mode?(0,d.X4)(p.palette.background.paper,.4):p.palette.grey[50],borderRadius:2,border:"1px solid ".concat("dark"===p.palette.mode?(0,d.X4)(p.palette.common.white,.1):(0,d.X4)(p.palette.common.black,.1))},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",spacing:1,sx:{mb:1},children:[(0,re.jsx)(l.A,{variant:"subtitle2",sx:{color:p.palette.text.primary,fontWeight:600},children:"\ud83d\udcc8 Your Trading Pattern"}),(0,re.jsx)(g.A,{title:(0,re.jsxs)(i.A,{sx:{p:1,maxWidth:380},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{mb:1,fontWeight:600},children:"How Your Trading Pattern is Established:"}),(0,re.jsxs)(l.A,{variant:"body2",sx:{mb:1},children:["\u2022 ",(0,re.jsx)("strong",{children:"Preferred Sessions:"})," Your top 2 most frequently traded sessions based on historical data"]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{mb:1},children:["\u2022 ",(0,re.jsx)("strong",{children:"Common Strategies:"})," Your top 5 most-used tags/strategies from past trades"]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{mb:1},children:["\u2022 ",(0,re.jsx)("strong",{children:"Trading Frequency:"})," Average trades per week calculated from your trading history"]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{mb:1},children:["\u2022 ",(0,re.jsx)("strong",{children:"Win Rate & Profit Factor:"})," Historical averages used as benchmarks for consistency scoring"]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{mb:1,color:"warning.main"},children:["\u2022 ",(0,re.jsx)("strong",{children:"Lookback Period:"})," Pattern is based on trades from the last 30 days to reflect your current trading style"]}),(0,re.jsx)(l.A,{variant:"body2",sx:{fontStyle:"italic",mt:1},children:"Patterns are automatically updated as you add more trades. Requires minimum 3 trades for reliable pattern detection."})]}),placement:"top",arrow:!0,children:(0,re.jsx)(Dr.A,{sx:{fontSize:18,color:p.palette.text.secondary,cursor:"help","&:hover":{color:p.palette.primary.main}}})})]}),(0,re.jsxs)(u.A,{spacing:1,children:[(0,re.jsxs)(l.A,{variant:"body2",sx:{color:p.palette.text.secondary},children:[(0,re.jsx)("strong",{style:{color:p.palette.text.primary},children:"Preferred Sessions:"})," ",r.preferredSessions.join(", ")||"Not established"]}),(0,re.jsxs)(i.A,{children:[(0,re.jsx)(l.A,{variant:"body2",sx:{color:p.palette.text.secondary,mb:1},children:(0,re.jsx)("strong",{style:{color:p.palette.text.primary},children:"Common Strategies:"})}),r.commonTags.length>0?(0,re.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:r.commonTags.slice(0,5).map(((e,t)=>(0,re.jsx)(me.A,{label:e,size:"small",sx:(0,Ee.dO)(e,p)},t)))}):(0,re.jsx)(l.A,{variant:"body2",sx:{color:p.palette.text.secondary,fontStyle:"italic"},children:"Not established"})]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:p.palette.text.secondary},children:[(0,re.jsx)("strong",{style:{color:p.palette.text.primary},children:"Trading Frequency:"})," ",isNaN(r.avgTradesPerWeek)?"0.0":r.avgTradesPerWeek.toFixed(1)," trades/week"]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:p.palette.text.secondary},children:[(0,re.jsx)("strong",{style:{color:p.palette.text.primary},children:"Win Rate:"})," ",isNaN(r.win_rate)?"0.0":r.win_rate.toFixed(1),"%"]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:p.palette.text.secondary},children:[(0,re.jsx)("strong",{style:{color:p.palette.text.primary},children:"Profit Factor:"})," ",isNaN(r.profit_factor)?"0.00":r.profit_factor.toFixed(2)]})]})]})]})})};var Lr=r(50108),Xr=r(877),Or=r(87734),Br=r(52185),Ur=r(6026),qr=r(86150),Gr=r(13839),Hr=r(75748),Yr=r(21327),Vr=r(90168),Kr=r(54521);const Jr=e=>{let{history:t,period:r,onPeriodChange:n,availablePeriods:o=["daily","weekly","monthly","yearly"],isLoading:g=!1}=e;const h=(0,s.A)(),p=((0,m.A)(h.breakpoints.down("sm")),[{label:"Daily",value:"daily"},{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"},{label:"Yearly",value:"yearly"}]),x=(0,a.useMemo)((()=>p.filter((e=>o.includes(e.value)))),[o]),f=(0,a.useMemo)((()=>t.map((e=>({date:e.date,dateLabel:(0,P.A)(e.date,"daily"===r||"weekly"===r?"MMM dd":"monthly"===r?"MMM yyyy":"yyyy"),overall:e.metrics.overall,consistency:e.metrics.consistency,riskManagement:e.metrics.riskManagement,performance:e.metrics.performance,discipline:e.metrics.discipline,tradeCount:e.tradeCount})))),[t,r]),y=e=>{let{active:t,payload:r,label:n}=e;if(t&&r&&r.length){const e=r[0].payload;return(0,re.jsxs)(i.A,{sx:{backgroundColor:"dark"===h.palette.mode?(0,d.X4)(h.palette.background.paper,.95):h.palette.background.paper,border:"1px solid ".concat(h.palette.divider),borderRadius:2,p:2,boxShadow:h.shadows[8],backdropFilter:"blur(10px)"},children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:n}),(0,re.jsxs)(u.A,{spacing:.5,children:[(0,re.jsxs)(l.A,{variant:"body2",children:[(0,re.jsx)("strong",{children:"Overall Score:"})," ",e.overall.toFixed(0),"%"]}),(0,re.jsxs)(l.A,{variant:"body2",children:[(0,re.jsx)("strong",{children:"Trades:"})," ",e.tradeCount]}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Consistency: ",e.consistency.toFixed(0),"%"]}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Risk Mgmt: ",e.riskManagement.toFixed(0),"%"]}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Performance: ",e.performance.toFixed(0),"%"]}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Discipline: ",e.discipline.toFixed(0),"%"]})]})]})}return null},v=(0,a.useMemo)((()=>0===f.length?0:f.reduce(((e,t)=>e+t.overall),0)/f.length),[f]),A=f.length>0?f[f.length-1].overall:0,b=f.length>1?A-f[f.length-2].overall:0;return(0,re.jsx)(Nt.A,{sx:{backgroundColor:"dark"===h.palette.mode?(0,d.X4)(h.palette.background.paper,.8):h.palette.background.paper,borderRadius:2,boxShadow:h.shadows[2],border:"1px solid ".concat("dark"===h.palette.mode?(0,d.X4)(h.palette.common.white,.1):(0,d.X4)(h.palette.common.black,.1))},children:(0,re.jsxs)(Ft.A,{sx:{p:3},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:3,children:[(0,re.jsx)(l.A,{variant:"h6",sx:{color:h.palette.text.primary,fontWeight:600},children:"\ud83d\udcc8 Score History"}),(0,re.jsx)(Kr.A,{tabs:x,activeTab:(w=r,x.findIndex((e=>e.value===w))),onTabChange:(e,t)=>{var r;const a=null===(r=x[t])||void 0===r?void 0:r.value;a&&n(a)},size:"small"})]}),g&&(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",mb:2},children:[(0,re.jsx)(c.A,{sx:{width:{xs:"100%",sm:"auto"},minWidth:{sm:200},borderRadius:1,mb:.5}}),(0,re.jsx)(l.A,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.7rem"},children:"Loading..."})]}),0===f.length?(0,re.jsx)(i.A,{sx:{textAlign:"center",py:4},children:(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Not enough data for ",r," score history.",(0,re.jsx)("br",{}),"Complete more trades to see your score trends."]})}):(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)(u.A,{direction:{xs:"column",sm:"row"},spacing:3,mb:3,children:[(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(l.A,{variant:"h4",sx:{color:(j=A,j>=50?h.palette.success.main:j>=30?h.palette.warning.main:h.palette.error.main),fontWeight:"bold"},children:[A.toFixed(0),"%"]}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Latest Score"})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(l.A,{variant:"h4",sx:{color:b>=0?h.palette.success.main:h.palette.error.main,fontWeight:"bold"},children:[b>=0?"+":"",b.toFixed(0),"%"]}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Change"})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(l.A,{variant:"h4",sx:{color:h.palette.text.primary,fontWeight:"bold"},children:[v.toFixed(0),"%"]}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Average"})]})]}),(0,re.jsx)(i.A,{sx:{height:{xs:220,sm:300},mb:2},children:(0,re.jsx)(Lr.u,{width:"100%",height:"100%",children:(0,re.jsxs)(Xr.Q,{data:f,children:[(0,re.jsx)("defs",{children:(0,re.jsxs)("linearGradient",{id:"overallGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,re.jsx)("stop",{offset:"5%",stopColor:h.palette.primary.main,stopOpacity:"dark"===h.palette.mode?.4:.3}),(0,re.jsx)("stop",{offset:"95%",stopColor:h.palette.primary.main,stopOpacity:0})]})}),(0,re.jsx)(Or.d,{strokeDasharray:"3 3",stroke:"dark"===h.palette.mode?(0,d.X4)(h.palette.common.white,.1):h.palette.divider}),(0,re.jsx)(Br.W,{dataKey:"dateLabel",stroke:h.palette.text.secondary,fontSize:12,tick:{fill:h.palette.text.secondary}}),(0,re.jsx)(Ur.h,{domain:[0,100],stroke:h.palette.text.secondary,fontSize:12,tick:{fill:h.palette.text.secondary}}),(0,re.jsx)(qr.m,{content:(0,re.jsx)(y,{})}),(0,re.jsx)(Gr.G,{type:"monotone",dataKey:"overall",stroke:h.palette.primary.main,strokeWidth:3,fill:"url(#overallGradient)",name:"Overall Score"})]})})}),(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Score Components"}),(0,re.jsx)(i.A,{sx:{height:{xs:160,sm:200}},children:(0,re.jsx)(Lr.u,{width:"100%",height:"100%",children:(0,re.jsxs)(Hr.b,{data:f,children:[(0,re.jsx)(Or.d,{strokeDasharray:"3 3",stroke:"dark"===h.palette.mode?(0,d.X4)(h.palette.common.white,.1):h.palette.divider}),(0,re.jsx)(Br.W,{dataKey:"dateLabel",stroke:h.palette.text.secondary,fontSize:12,tick:{fill:h.palette.text.secondary}}),(0,re.jsx)(Ur.h,{domain:[0,100],stroke:h.palette.text.secondary,fontSize:12,tick:{fill:h.palette.text.secondary}}),(0,re.jsx)(qr.m,{content:(0,re.jsx)(y,{})}),(0,re.jsx)(Yr.s,{}),(0,re.jsx)(Vr.N,{type:"monotone",dataKey:"consistency",stroke:h.palette.info.main,strokeWidth:2,dot:!1,name:"Consistency"}),(0,re.jsx)(Vr.N,{type:"monotone",dataKey:"riskManagement",stroke:h.palette.success.main,strokeWidth:2,dot:!1,name:"Risk Mgmt"}),(0,re.jsx)(Vr.N,{type:"monotone",dataKey:"performance",stroke:h.palette.warning.main,strokeWidth:2,dot:!1,name:"Performance"}),(0,re.jsx)(Vr.N,{type:"monotone",dataKey:"discipline",stroke:h.palette.error.main,strokeWidth:2,dot:!1,name:"Discipline"})]})})})]})]})});var j,w};var $r=r(43971),Qr=r(48640),Zr=r(38398),en=r(54895),tn=r(17347);const rn=e=>{let{trades:t,excludedTags:r,onExcludedTagsChange:o,allTags:c}=e;const m=(0,s.A)(),[x,f]=(0,a.useState)(""),v=(0,a.useMemo)((()=>{if(c&&c.length>0)return c.filter((e=>!e.startsWith("Partials:"))).sort();const e=new Set;return t.forEach((t=>{t.tags&&t.tags.forEach((t=>{t.startsWith("Partials:")||e.add(t)}))})),Array.from(e).sort()}),[c,t]),A=(0,a.useMemo)((()=>{if(!x)return v;const e=x.toLowerCase();return v.filter((t=>t.toLowerCase().includes(e)||(0,Ee.t)(t).toLowerCase().includes(e)))}),[v,x]),b=(0,a.useMemo)((()=>A.filter((e=>!r.includes(e)))),[A,r]),j=(0,a.useMemo)((()=>{const e={};return b.forEach((t=>{if((0,Ee.dn)(t)){const r=(0,Ee.Oo)(t);e[r]||(e[r]=[]),e[r].push(t)}else e.Ungrouped||(e.Ungrouped=[]),e.Ungrouped.push(t)})),e}),[b]);return(0,re.jsx)(Nt.A,{sx:{backgroundColor:"dark"===m.palette.mode?"rgba(255, 255, 255, 0.02)":"rgba(0, 0, 0, 0.02)",border:"1px solid ".concat(m.palette.divider),borderRadius:2},children:(0,re.jsxs)(Ft.A,{sx:{p:3},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",spacing:1,mb:2,children:[(0,re.jsx)(l.A,{variant:"h6",sx:{fontWeight:600},children:"\ud83d\udeab Excluded Tags from Pattern Analysis"}),(0,re.jsx)(g.A,{title:"Tags excluded from pattern analysis won't be considered when identifying high-performing or declining tag combinations. This is useful for filtering out temporary or irrelevant tags.",children:(0,re.jsx)(p.A,{size:"small",children:(0,re.jsx)(Dr.A,{fontSize:"small"})})})]}),(0,re.jsx)(y.A,{severity:"info",sx:{mb:3},children:(0,re.jsx)(l.A,{variant:"body2",children:"Excluded tags will not be included in pattern analysis calculations. This helps focus the analysis on meaningful trading patterns by filtering out temporary, experimental, or irrelevant tags."})}),(0,re.jsxs)(i.A,{mb:3,children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"Add Tag to Exclude"}),(0,re.jsx)(xe.A,{placeholder:"Search for tags to exclude...",variant:"outlined",size:"small",value:x,onChange:e=>f(e.target.value),slotProps:{input:{startAdornment:(0,re.jsx)(fe.A,{position:"start",children:(0,re.jsx)(_e.A,{})})}},sx:{width:"100%","& .MuiOutlinedInput-root":{backgroundColor:"dark"===m.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.02)"}}})]}),Object.keys(j).length>0&&(0,re.jsx)(i.A,{sx:(0,n.A)({maxHeight:"250px",overflow:"auto",border:"1px solid ".concat(m.palette.divider),borderRadius:1,mb:3},(0,he.J)(m)),children:Object.entries(j).map((e=>{let[t,n]=e;return(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{p:1.5,bgcolor:(0,d.X4)(m.palette.primary.main,.05),display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(l.A,{variant:"subtitle2",fontWeight:600,children:t}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[n.length," tag",1!==n.length?"s":""]})]}),(0,re.jsx)(h.A,{size:"small",variant:"outlined",onClick:()=>(e=>{const t=j[e]||[],n=[...r,...t];o(n)})(t),sx:{minWidth:"auto",px:1},children:"Add All"})]}),(0,re.jsx)(we.A,{}),(0,re.jsx)(ke.A,{disablePadding:!0,children:n.map((e=>(0,re.jsx)(Ce.Ay,{secondaryAction:(0,re.jsx)(h.A,{size:"small",variant:"text",onClick:()=>(e=>{e&&!r.includes(e)&&o([...r,e])})(e),sx:{minWidth:"auto",p:.5},children:"Add"}),sx:{"&:hover":{bgcolor:(0,d.X4)(m.palette.primary.main,.05)}},children:(0,re.jsx)(Se.A,{primary:(0,re.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,re.jsx)(me.A,{label:(0,Ee.t)(e,!0),size:"small",sx:(0,Ee.dO)(e,m)})})})},e)))})]},t)}))}),0===Object.keys(j).length&&(0,re.jsx)(i.A,{sx:{p:2,textAlign:"center",color:"text.secondary",border:"1px solid ".concat(m.palette.divider),borderRadius:1,mb:3},children:(0,re.jsx)(l.A,{variant:"body2",children:x?"No matching tags found":"No tags available to exclude"})}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:["Currently Excluded Tags (",r.length,")"]}),0===r.length?(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:"No tags are currently excluded from pattern analysis."}):(0,re.jsx)(u.A,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:r.map((e=>(0,re.jsx)(me.A,{label:(0,Ee.t)(e),onDelete:()=>{return t=e,void o(r.filter((e=>e!==t)));var t},deleteIcon:(0,re.jsx)(Ue.A,{sx:{color:"dark"===m.palette.mode?"white":"inherit","&:hover":{color:m.palette.error.main}}}),sx:(0,n.A)((0,n.A)({},(0,Ee.dO)(e,m)),{},{"& .MuiChip-deleteIcon":{color:"dark"===m.palette.mode?"white":"inherit","&:hover":{color:m.palette.error.main}}})},e)))})]}),v.length>0&&(0,re.jsx)(i.A,{mt:3,p:2,sx:{backgroundColor:"dark"===m.palette.mode?"rgba(255, 255, 255, 0.02)":"rgba(0, 0, 0, 0.02)",borderRadius:1,border:"1px solid ".concat(m.palette.divider)},children:(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[(0,re.jsx)("strong",{children:"Pattern Analysis Coverage:"})," ",b.length," of ",v.length," tags will be included in pattern analysis",r.length>0&&(0,re.jsxs)("span",{children:[" (",r.length," excluded)"]})]})})]})})},nn=e=>{let{trades:t,selectedTags:r,onTagsChange:o,allTags:c}=e;const g=(0,s.A)(),[p,m]=(0,a.useState)(""),x=(0,a.useMemo)((()=>{if(c&&c.length>0)return c.filter((e=>!e.startsWith("Partials:"))).sort();const e=new Set;return t.forEach((t=>{t.tags&&t.tags.forEach((t=>{t.startsWith("Partials:")||e.add(t)}))})),Array.from(e).sort()}),[c,t]),f=(0,a.useMemo)((()=>{const e={};return x.forEach((r=>{const n=t.filter((e=>e.tags&&e.tags.includes(r))).length,a=t.length>0?Math.round(n/t.length*100):0;e[r]={count:n,percentage:a}})),e}),[x,t]),y=(0,a.useMemo)((()=>{if(!p)return x;const e=p.toLowerCase();return x.filter((t=>t.toLowerCase().includes(e)||(0,Ee.t)(t).toLowerCase().includes(e)))}),[x,p]),v=(0,a.useMemo)((()=>y.filter((e=>!r.includes(e)))),[y,r]),A=(0,a.useMemo)((()=>{const e={};return v.forEach((t=>{if((0,Ee.dn)(t)){const r=(0,Ee.Oo)(t);e[r]||(e[r]=[]),e[r].push(t)}else e.Ungrouped||(e.Ungrouped=[]),e.Ungrouped.push(t)})),e}),[v]);return(0,re.jsxs)(i.A,{children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Select specific tags to track their usage frequency across your trades. This will show how often you use each selected strategy in the Analysis tab."}),(0,re.jsxs)(i.A,{mb:2,children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"Add Tags to Track"}),(0,re.jsx)(xe.A,{placeholder:"Search for tags to track...",variant:"outlined",size:"small",value:p,onChange:e=>m(e.target.value),slotProps:{input:{startAdornment:(0,re.jsx)(fe.A,{position:"start",children:(0,re.jsx)(_e.A,{})})}},sx:{width:"100%","& .MuiOutlinedInput-root":{backgroundColor:"dark"===g.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.02)"}}})]}),Object.keys(A).length>0&&(0,re.jsx)(i.A,{sx:(0,n.A)({maxHeight:"300px",overflow:"auto",border:"1px solid ".concat(g.palette.divider),borderRadius:1,mb:2},(0,he.J)(g)),children:Object.entries(A).map((e=>{let[t,n]=e;return(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{p:1.5,bgcolor:(0,d.X4)(g.palette.primary.main,.05),display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(l.A,{variant:"subtitle2",fontWeight:600,children:t}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[n.length," tag",1!==n.length?"s":""]})]}),(0,re.jsx)(h.A,{size:"small",variant:"outlined",onClick:()=>(e=>{const t=A[e]||[],n=[...r,...t];o(n)})(t),sx:{minWidth:"auto",px:1},children:"Add All"})]}),(0,re.jsx)(we.A,{}),(0,re.jsx)(ke.A,{disablePadding:!0,children:n.map((e=>{const t=f[e]||{count:0,percentage:0};return(0,re.jsx)(Ce.Ay,{secondaryAction:(0,re.jsx)(h.A,{size:"small",variant:"text",onClick:()=>(e=>{e&&!r.includes(e)&&o([...r,e])})(e),sx:{minWidth:"auto",p:.5},children:"Add"}),sx:{"&:hover":{bgcolor:(0,d.X4)(g.palette.primary.main,.05)}},children:(0,re.jsx)(Se.A,{primary:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(me.A,{label:(0,Ee.t)(e,!0),size:"small",sx:(0,Ee.dO)(e,g)}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[t.count," trades (",t.percentage,"%)"]})]})})},e)}))})]},t)}))}),0===Object.keys(A).length&&(0,re.jsx)(i.A,{sx:{p:2,textAlign:"center",color:"text.secondary",border:"1px solid ".concat(g.palette.divider),borderRadius:1,mb:2},children:(0,re.jsx)(l.A,{variant:"body2",children:p?"No matching tags found":"All tags are already selected"})}),r.length>0&&(0,re.jsxs)(i.A,{sx:{mt:2,p:2,bgcolor:"background.default",borderRadius:1},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:1,children:[(0,re.jsxs)(l.A,{variant:"subtitle2",children:["Selected Tags (",r.length,"):"]}),(0,re.jsx)(me.A,{label:"Clear All",size:"small",onClick:()=>{o([])},sx:{cursor:"pointer"}})]}),(0,re.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:r.map((e=>{const t=f[e]||{count:0,percentage:0};return(0,re.jsx)(me.A,{label:"".concat(e," (").concat(t.percentage,"%)"),size:"small",sx:(0,n.A)((0,n.A)({},(0,Ee.dO)(e,g)),{},{"& .MuiChip-deleteIcon":{color:"inherit","&:hover":{color:"inherit",opacity:.7}}}),onDelete:()=>(e=>{o(r.filter((t=>t!==e)))})(e)},e)}))})]})]})},an=e=>{let{settings:t,onSettingsChange:r,onSave:o,isSaving:c=!1,trades:g,selectedTags:p,onTagsChange:m,allTags:x}=e;const f=(0,s.A)(),[v,A]=(0,a.useState)(t),[b,j]=(0,a.useState)(!1),w=e=>(t,a)=>{const o=Array.isArray(a)?a[0]:a,s=(0,n.A)((0,n.A)({},v.weights),{},{[e]:o});if(100!==Object.values(s).reduce(((e,t)=>e+t),0)){const t=Object.keys(s).filter((t=>t!==e)),r=100-o,n=t.reduce(((e,t)=>e+s[t]),0);n>0&&t.forEach((e=>{s[e]=s[e]/n*r}))}const i=(0,n.A)((0,n.A)({},v),{},{weights:s});A(i),j(!0),r(i)},k=e=>t=>{const a=parseFloat(t.target.value)||0,o=(0,n.A)((0,n.A)({},v),{},{thresholds:(0,n.A)((0,n.A)({},v.thresholds),{},{[e]:a})});A(o),j(!0),r(o)},C=e=>t=>{const a=parseFloat(t.target.value)||0,o=(0,n.A)((0,n.A)({},v),{},{targets:(0,n.A)((0,n.A)({},v.targets),{},{[e]:a})});A(o),j(!0),r(o)},S=Object.values(v.weights).reduce(((e,t)=>e+t),0);return(0,re.jsx)(Nt.A,{sx:{backgroundColor:"dark"===f.palette.mode?(0,d.X4)(f.palette.background.paper,.8):f.palette.background.paper,borderRadius:3,boxShadow:f.shadows[2],border:"1px solid ".concat("dark"===f.palette.mode?(0,d.X4)(f.palette.common.white,.1):(0,d.X4)(f.palette.common.black,.1)),transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-1px)",boxShadow:f.shadows[4]}},children:(0,re.jsxs)(Ft.A,{sx:{p:3},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:3,children:[(0,re.jsx)(l.A,{variant:"h6",sx:{color:f.palette.text.primary,fontWeight:600},children:"\u2699\ufe0f Score Settings"}),(0,re.jsxs)(u.A,{direction:"row",spacing:1,children:[(0,re.jsx)(h.A,{startIcon:(0,re.jsx)(Zr.A,{}),onClick:()=>{A(yr),j(!0),r(yr)},size:"small",variant:"outlined",sx:{borderColor:"dark"===f.palette.mode?(0,d.X4)(f.palette.common.white,.3):f.palette.primary.main,color:"dark"===f.palette.mode?f.palette.common.white:f.palette.primary.main,"&:hover":{borderColor:f.palette.primary.main,backgroundColor:(0,d.X4)(f.palette.primary.main,.05)}},children:"Reset"}),o&&(0,re.jsx)(h.A,{startIcon:(0,re.jsx)(en.A,{}),onClick:()=>{o&&o(),j(!1)},size:"small",variant:"contained",disabled:!b||c,sx:{backgroundColor:f.palette.primary.main,"&:hover":{backgroundColor:f.palette.primary.dark},"&:disabled":{backgroundColor:"dark"===f.palette.mode?(0,d.X4)(f.palette.common.white,.1):f.palette.grey[300]}},children:c?"Saving...":"Save"})]})]}),b&&(0,re.jsx)(y.A,{severity:"info",sx:{mb:2},children:"You have unsaved changes. Click Save to apply them permanently."}),(0,re.jsxs)(u.A,{children:[(0,re.jsxs)(Wr.A,{children:[(0,re.jsx)(Pr.A,{expandIcon:(0,re.jsx)(Oe.A,{}),children:(0,re.jsx)(l.A,{variant:"subtitle1",fontWeight:"medium",children:"Score Component Weights"})}),(0,re.jsxs)(Nr.A,{children:[(0,re.jsx)(y.A,{severity:"info",icon:(0,re.jsx)(tn.A,{}),sx:{mb:2},children:"Adjust how much each component contributes to your overall score. Total must equal 100%."}),(0,re.jsxs)(u.A,{spacing:3,children:[(0,re.jsxs)(i.A,{children:[(0,re.jsxs)($r.A,{children:["Consistency (",v.weights.consistency.toFixed(0),"%)"]}),(0,re.jsx)(i.A,{sx:{px:2},children:(0,re.jsx)(Qr.Ay,{value:v.weights.consistency,onChange:w("consistency"),min:0,max:100,step:5,marks:[{value:0,label:"0%"},{value:50,label:"50%"},{value:100,label:"100%"}],sx:{"& .MuiSlider-markLabel":{fontSize:"0.75rem"},'& .MuiSlider-markLabel[data-index="0"]':{transform:"translateX(0%)"},'& .MuiSlider-markLabel[data-index="2"]':{transform:"translateX(-100%)"}}})}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"How well you stick to your trading patterns"})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)($r.A,{children:["Risk Management (",v.weights.riskManagement.toFixed(0),"%)"]}),(0,re.jsx)(i.A,{sx:{px:2},children:(0,re.jsx)(Qr.Ay,{value:v.weights.riskManagement,onChange:w("riskManagement"),min:0,max:100,step:5,marks:[{value:0,label:"0%"},{value:50,label:"50%"},{value:100,label:"100%"}],sx:{"& .MuiSlider-markLabel":{fontSize:"0.75rem"},'& .MuiSlider-markLabel[data-index="0"]':{transform:"translateX(0%)"},'& .MuiSlider-markLabel[data-index="2"]':{transform:"translateX(-100%)"}}})}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Risk management and position sizing discipline"})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)($r.A,{children:["Performance (",v.weights.performance.toFixed(0),"%)"]}),(0,re.jsx)(i.A,{sx:{px:2},children:(0,re.jsx)(Qr.Ay,{value:v.weights.performance,onChange:w("performance"),min:0,max:100,step:5,marks:[{value:0,label:"0%"},{value:50,label:"50%"},{value:100,label:"100%"}],sx:{"& .MuiSlider-markLabel":{fontSize:"0.75rem"},'& .MuiSlider-markLabel[data-index="0"]':{transform:"translateX(0%)"},'& .MuiSlider-markLabel[data-index="2"]':{transform:"translateX(-100%)"}}})}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Performance consistency vs historical patterns"})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)($r.A,{children:["Discipline (",v.weights.discipline.toFixed(0),"%)"]}),(0,re.jsx)(i.A,{sx:{px:2},children:(0,re.jsx)(Qr.Ay,{value:v.weights.discipline,onChange:w("discipline"),min:0,max:100,step:5,marks:[{value:0,label:"0%"},{value:50,label:"50%"},{value:100,label:"100%"}],sx:{"& .MuiSlider-markLabel":{fontSize:"0.75rem"},'& .MuiSlider-markLabel[data-index="0"]':{transform:"translateX(0%)"},'& .MuiSlider-markLabel[data-index="2"]':{transform:"translateX(-100%)"}}})}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Trading discipline and emotional control"})]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:100===S?"success.main":"error.main",fontWeight:"medium"},children:["Total: ",S.toFixed(0),"% ",100!==S&&"(Must equal 100%)"]})]})]})]}),(0,re.jsxs)(Wr.A,{children:[(0,re.jsx)(Pr.A,{expandIcon:(0,re.jsx)(Oe.A,{}),children:(0,re.jsx)(l.A,{variant:"subtitle1",fontWeight:"medium",children:"Calculation Thresholds"})}),(0,re.jsx)(Nr.A,{children:(0,re.jsxs)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(3, 1fr)"},gap:2},children:[(0,re.jsx)(xe.A,{label:"Min Trades for Score",type:"number",value:v.thresholds.minTradesForScore,onChange:k("minTradesForScore"),fullWidth:!0,size:"small",helperText:"Minimum trades needed to calculate score"}),(0,re.jsx)(xe.A,{label:"Lookback Period (days)",type:"number",value:v.thresholds.lookbackPeriod,onChange:k("lookbackPeriod"),fullWidth:!0,size:"small",helperText:"Days to look back for pattern analysis"}),(0,re.jsx)(xe.A,{label:"Consistency Tolerance (%)",type:"number",value:v.thresholds.consistencyTolerance,onChange:k("consistencyTolerance"),fullWidth:!0,size:"small",helperText:"Acceptable deviation from patterns"})]})})]}),(0,re.jsxs)(Wr.A,{children:[(0,re.jsx)(Pr.A,{expandIcon:(0,re.jsx)(Oe.A,{}),children:(0,re.jsx)(l.A,{variant:"subtitle1",fontWeight:"medium",children:"Performance Targets"})}),(0,re.jsx)(Nr.A,{children:(0,re.jsxs)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:2},children:[(0,re.jsx)(xe.A,{label:"Target Win Rate (%)",type:"number",value:v.targets.win_rate,onChange:C("win_rate"),fullWidth:!0,size:"small",helperText:"Your target win rate percentage"}),(0,re.jsx)(xe.A,{label:"Target Profit Factor",type:"number",inputProps:{step:.1},value:v.targets.profit_factor,onChange:C("profit_factor"),fullWidth:!0,size:"small",helperText:"Your target profit factor"}),(0,re.jsx)(xe.A,{label:"Max Drawdown (%)",type:"number",value:v.targets.max_drawdown,onChange:C("max_drawdown"),fullWidth:!0,size:"small",helperText:"Maximum acceptable drawdown"}),(0,re.jsx)(xe.A,{label:"Avg Risk/Reward Ratio",type:"number",inputProps:{step:.1},value:v.targets.avgRiskReward,onChange:C("avgRiskReward"),fullWidth:!0,size:"small",helperText:"Your target risk/reward ratio"})]})})]}),(0,re.jsxs)(Wr.A,{children:[(0,re.jsx)(Pr.A,{expandIcon:(0,re.jsx)(Oe.A,{}),children:(0,re.jsx)(l.A,{variant:"subtitle1",fontWeight:"medium",children:"Common Strategies Tracking"})}),(0,re.jsx)(Nr.A,{children:(0,re.jsx)(nn,{trades:g,selectedTags:p,onTagsChange:e=>{j(!0),m(e)},allTags:x})})]}),(0,re.jsxs)(Wr.A,{children:[(0,re.jsx)(Pr.A,{expandIcon:(0,re.jsx)(Oe.A,{}),children:(0,re.jsx)(l.A,{variant:"subtitle1",fontWeight:"medium",children:"Pattern Analysis Settings"})}),(0,re.jsx)(Nr.A,{children:(0,re.jsx)(rn,{trades:g,excludedTags:v.excludedTagsFromPatterns||[],onExcludedTagsChange:e=>{const t=(0,n.A)((0,n.A)({},v),{},{excludedTagsFromPatterns:e});A(t),j(!0),r(t)},allTags:x})})]})]})]})})},on=e=>{let{trades:t,selectedDate:r=new Date,settings:n}=e;const o=(0,s.A)(),[h,m]=(0,a.useState)(null),[x,f]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{if(t.length<10)m(null);else{f(!0);try{const e=await jr.analyzeTagPatterns(t,r,n);m(e)}catch(e){console.error("Error analyzing tag patterns:",e),m(null)}finally{f(!1)}}})()}),[t,r,n]);const v=e=>{switch(e){case"high_performance":return(0,re.jsx)(oe.A,{sx:{color:o.palette.success.main}});case"declining_pattern":return(0,re.jsx)(_r.A,{sx:{color:o.palette.error.main}});case"market_condition":return(0,re.jsx)(Lt.A,{sx:{color:o.palette.warning.main}});default:return(0,re.jsx)(Ie.A,{sx:{color:o.palette.info.main}})}},A=e=>{switch(e){case"high":return o.palette.error.main;case"medium":return o.palette.warning.main;case"low":return o.palette.info.main;default:return o.palette.text.secondary}},b=e=>e>=70?o.palette.success.main:e>=50?o.palette.warning.main:o.palette.error.main,j=e=>"".concat(e.toFixed(1),"%");return x?(0,re.jsx)(Nt.A,{sx:{borderRadius:3,boxShadow:"none",border:"1px solid ".concat(o.palette.divider),mb:3},children:(0,re.jsxs)(Ft.A,{children:[(0,re.jsx)(l.A,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600},children:"\ud83d\udd0d Tag Pattern Analysis"}),(0,re.jsxs)(i.A,{sx:{mt:2},children:[(0,re.jsx)(c.A,{}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Analyzing tag patterns with Web Worker..."})]})]})}):!h||t.length<10?(0,re.jsx)(Nt.A,{sx:{backgroundColor:"dark"===o.palette.mode?(0,d.X4)(o.palette.background.paper,.8):o.palette.background.paper,borderRadius:2,boxShadow:o.shadows[2],border:"1px solid ".concat("dark"===o.palette.mode?(0,d.X4)(o.palette.common.white,.1):(0,d.X4)(o.palette.common.black,.1))},children:(0,re.jsxs)(Ft.A,{sx:{p:3},children:[(0,re.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\ud83c\udff7\ufe0f Tag Pattern Analysis"}),(0,re.jsx)(y.A,{severity:"info",children:"Add more trades to see tag pattern analysis. We need at least 10 trades to identify meaningful patterns and trends."})]})}):(0,re.jsx)(Nt.A,{sx:{backgroundColor:"dark"===o.palette.mode?(0,d.X4)(o.palette.background.paper,.8):o.palette.background.paper,borderRadius:2,boxShadow:o.shadows[2],border:"1px solid ".concat("dark"===o.palette.mode?(0,d.X4)(o.palette.common.white,.1):(0,d.X4)(o.palette.common.black,.1))},children:(0,re.jsxs)(Ft.A,{sx:{p:3},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:3,children:[(0,re.jsx)(l.A,{variant:"h6",sx:{fontWeight:600},children:"\ud83c\udff7\ufe0f Tag Pattern Analysis"}),(0,re.jsx)(g.A,{title:"Analysis of tag combinations to identify high-performing patterns and declining trends",children:(0,re.jsx)(p.A,{size:"small",children:(0,re.jsx)(Dr.A,{fontSize:"small"})})})]}),h.insights.length>0&&(0,re.jsxs)(i.A,{mb:3,children:[(0,re.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:600},children:"\ud83d\udca1 Key Insights"}),(0,re.jsx)(u.A,{spacing:2,children:h.insights.slice(0,3).map(((e,t)=>(0,re.jsxs)(y.A,{severity:"high_performance"===e.type?"success":"declining_pattern"===e.type?"error":"warning",icon:v(e.type),sx:{backgroundColor:(0,d.X4)(A(e.severity),.1),border:"1px solid ".concat((0,d.X4)(A(e.severity),.2)),"& .MuiAlert-icon":{color:A(e.severity)}},children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:e.title}),(0,re.jsx)(l.A,{variant:"body2",gutterBottom:!0,children:e.description}),(0,re.jsx)(i.A,{sx:{mt:1,mb:1},children:(0,re.jsx)(u.A,{direction:"row",spacing:1,flexWrap:"wrap",children:e.tagCombination.map((e=>(0,re.jsx)(me.A,{label:(0,Ee.t)(e),size:"small",sx:(0,Ee.dO)(e,o)},e)))})}),(0,re.jsxs)(l.A,{variant:"body2",sx:{fontStyle:"italic"},children:["\ud83d\udca1 ",e.recommendation]})]},t)))})]}),h.topCombinations.length>0&&(0,re.jsxs)(Wr.A,{defaultExpanded:!0,children:[(0,re.jsx)(Pr.A,{expandIcon:(0,re.jsx)(Oe.A,{}),children:(0,re.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:600},children:"\ud83c\udfc6 Top Performing Tag Combinations"})}),(0,re.jsx)(Nr.A,{children:(0,re.jsx)(u.A,{spacing:2,children:h.topCombinations.slice(0,5).map(((e,t)=>(0,re.jsxs)(i.A,{sx:{p:2,borderRadius:2,backgroundColor:"dark"===o.palette.mode?(0,d.X4)(o.palette.background.paper,.4):(0,d.X4)(o.palette.background.paper,.8),border:"1px solid ".concat((0,d.X4)(o.palette.divider,.2))},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:1,children:[(0,re.jsx)(u.A,{direction:"row",spacing:1,flexWrap:"wrap",children:e.tags.map((e=>(0,re.jsx)(me.A,{label:(0,Ee.t)(e),size:"small",sx:(0,Ee.dO)(e,o)},e)))}),(0,re.jsx)(l.A,{variant:"h6",sx:{color:b(e.win_rate),fontWeight:"bold"},children:j(e.win_rate)})]}),(0,re.jsx)(c.A,{variant:"determinate",value:e.win_rate,sx:{height:6,borderRadius:3,backgroundColor:"dark"===o.palette.mode?(0,d.X4)(o.palette.common.white,.1):o.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:b(e.win_rate),borderRadius:3}}}),(0,re.jsxs)(u.A,{direction:"row",spacing:3,mt:1,children:[(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[(0,re.jsx)("strong",{children:"Trades:"})," ",e.total_trades]}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[(0,re.jsx)("strong",{children:"W/L:"})," ",e.wins,"/",e.losses]}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[(0,re.jsx)("strong",{children:"Avg P&L:"})," ",e.avgPnL>0?"+":"",e.avgPnL.toFixed(2)]}),"stable"!==e.trend&&(0,re.jsx)(l.A,{variant:"caption",sx:{color:"improving"===e.trend?o.palette.success.main:o.palette.error.main,fontWeight:600},children:"improving"===e.trend?"\ud83d\udcc8 Improving":"\ud83d\udcc9 Declining"})]})]},t)))})})]}),h.decliningCombinations.length>0&&(0,re.jsxs)(Wr.A,{sx:{mt:2},children:[(0,re.jsx)(Pr.A,{expandIcon:(0,re.jsx)(Oe.A,{}),children:(0,re.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:600,color:o.palette.error.main},children:"\ud83d\udcc9 Declining Patterns"})}),(0,re.jsx)(Nr.A,{children:(0,re.jsx)(u.A,{spacing:2,children:h.decliningCombinations.map(((e,t)=>(0,re.jsxs)(i.A,{sx:{p:2,borderRadius:2,backgroundColor:(0,d.X4)(o.palette.error.main,.05),border:"1px solid ".concat((0,d.X4)(o.palette.error.main,.2))},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:1,children:[(0,re.jsx)(u.A,{direction:"row",spacing:1,flexWrap:"wrap",children:e.tags.map((e=>(0,re.jsx)(me.A,{label:(0,Ee.t)(e),size:"small",sx:(0,Ee.dO)(e,o)},e)))}),(0,re.jsxs)(u.A,{alignItems:"flex-end",children:[(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[j(e.historicalWinRate)," \u2192 ",j(e.recentWinRate)]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:o.palette.error.main,fontWeight:600},children:["-",(e.historicalWinRate-e.recentWinRate).toFixed(1),"%"]})]})]}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["This combination has declined from ",j(e.historicalWinRate)," to ",j(e.recentWinRate)," win rate recently. Consider reviewing your approach or market conditions."]})]},t)))})})]}),0===h.insights.length&&0===h.topCombinations.length&&(0,re.jsxs)(y.A,{severity:"info",sx:{mt:2},children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"\ud83d\udcca Building Pattern Database"}),(0,re.jsx)(l.A,{variant:"body2",children:"Continue trading to build a larger dataset. More trades will help identify stronger patterns and trends in your tag combinations."})]})]})})},sn=e=>{let{trades:t,selectedDate:r,calendarId:o,scoreSettings:g,onUpdateCalendarProperty:h,accountBalance:x,dynamicRiskSettings:f,allTags:v,timePeriod:A="all"}=e;const b=(0,s.A)(),j=(0,m.A)(b.breakpoints.down("sm")),[w,k]=(0,a.useState)(0),C="monthly",[S,_]=(0,a.useState)("monthly"),[T,I]=(0,a.useState)(g||Sr.getSettings()),[M,E]=(0,a.useState)((null===g||void 0===g?void 0:g.selectedTags)||[]),[z,D]=(0,a.useState)(!1),[R,W]=(0,a.useState)(!1),[P,N]=(0,a.useState)(!1),[F,L]=(0,a.useState)(!1),[X,O]=(0,a.useState)(null),[B,U]=(0,a.useState)([]),[q,G]=(0,a.useState)(null),H=(0,a.useRef)(new Map),[Y,V]=(0,a.useState)(!1),[K,J]=(0,a.useState)(null);(0,a.useEffect)((()=>{g&&(I(g),E(g.selectedTags||[]))}),[g]),(0,a.useEffect)((()=>{Sr.updateSettings(T)}),[T]),(0,a.useEffect)((()=>{const e=(0,n.A)((0,n.A)({},T),{},{selectedTags:M});Sr.updateSettings(e)}),[M,T]);const $=a.useMemo((()=>{switch(A){case"month":return["daily","weekly"];case"year":return["daily","weekly","monthly"];default:return["daily","weekly","monthly","yearly"]}}),[A]);(0,a.useEffect)((()=>{$.includes(S)||_($[$.length-1])}),[$,S]),(0,a.useEffect)((()=>{void 0!==x&&Sr.updateDynamicRiskSettings({account_balance:x,risk_per_trade:null===f||void 0===f?void 0:f.risk_per_trade,dynamic_risk_enabled:null===f||void 0===f?void 0:f.dynamic_risk_enabled,increased_risk_percentage:null===f||void 0===f?void 0:f.increased_risk_percentage,profit_threshold_percentage:null===f||void 0===f?void 0:f.profit_threshold_percentage})}),[x,f]),(0,a.useEffect)((()=>{if(0===t.length)return void O(null);(async()=>{W(!0);try{const e=(0,n.A)((0,n.A)({},T),{},{selectedTags:M});Sr.updateSettings(e);const a=await Sr.calculateScore(t,C,r,e);O(a)}catch(e){ee.logger.error("Error calculating score:",e),O(null)}finally{W(!1)}})()}),[t,C,r,M,T]),(0,a.useEffect)((()=>{if(0===t.length)return U([]),void N(!1);(async()=>{const e=JSON.stringify({tradesCount:t.length,historyPeriod:S,selectedTags:M.sort(),settingsKey:"".concat(T.thresholds.minTradesForScore,"-").concat(T.weights.consistency),selectedDate:r.toISOString().split("T")[0],timePeriod:A}),a=H.current.get(e);if(a)return U(a),void N(!1);N(!0);try{const a=(0,n.A)((0,n.A)({},T),{},{selectedTags:M});Sr.updateSettings(a);let o=12;"month"===A?"daily"===S?o=31:"weekly"===S?o=5:"monthly"===S&&(o=1):"year"===A?"daily"===S?o=365:"weekly"===S?o=53:"monthly"===S?o=12:"yearly"===S&&(o=1):o=12;let s=await Sr.getScoreHistory(t,S,o,a,r);if("month"===A){const e=new Date(r.getFullYear(),r.getMonth(),1),t=new Date(r.getFullYear(),r.getMonth()+1,0);s=s.filter((r=>{const n=new Date(r.date);return n>=e&&n<=t}))}else if("year"===A){const e=new Date(r.getFullYear(),0,1),t=new Date(r.getFullYear(),11,31);s=s.filter((r=>{const n=new Date(r.date);return n>=e&&n<=t}))}if(H.current.set(e,s),H.current.size>10){const e=H.current.keys().next().value;e&&H.current.delete(e)}U(s)}catch(o){ee.logger.error("Error calculating score history:",o),U([])}finally{N(!1)}})()}),[t,S,M,T,r,A]),(0,a.useEffect)((()=>{if(0===t.length)return ee.logger.warn("ScoreSection: No trades available for multi-period calculation"),G(null),void L(!1);(async()=>{L(!0);try{ee.logger.debug("ScoreSection: Starting multi-period score calculation",{tradesCount:t.length,selectedDate:r.toISOString(),selectedTags:M.length});const e=(0,n.A)((0,n.A)({},T),{},{selectedTags:M});Sr.updateSettings(e);const a=await Sr.calculateMultiPeriodScore(t,r,e);ee.logger.debug("ScoreSection: Multi-period scores calculated successfully",{dailyScore:a.daily.currentScore.overall,weeklyScore:a.weekly.currentScore.overall,monthlyScore:a.monthly.currentScore.overall,yearlyScore:a.yearly.currentScore.overall}),G(a)}catch(e){ee.logger.error("ScoreSection: Error calculating multi-period scores:",e),console.error("ScoreSection multi-period calculation error details:",{error:e,tradesCount:t.length,selectedDate:r.toISOString(),sampleTrade:t[0]}),G(null)}finally{L(!1)}})()}),[t,r,M,T]);const Q=e=>{if(!q)return;const t=q[e];t&&(J({analysis:t,period:e}),V(!0))},Z=()=>{V(!1),J(null)},te=async e=>{if(h){D(!0);try{const t=(0,n.A)((0,n.A)({},T),{},{selectedTags:null!==e&&void 0!==e?e:M});await h(o,(e=>(0,n.A)((0,n.A)({},e),{},{score_settings:t})))}catch(t){ee.logger.error("Error saving score settings:",t)}finally{D(!1)}}};return(0,a.useEffect)((()=>{if(!g&&!h){const t=localStorage.getItem("scoreSettings");if(t)try{const e=JSON.parse(t);I(e),E(e.selectedTags||[])}catch(e){ee.logger.error("Error loading saved settings from localStorage:",e)}}}),[g,h]),0===t.length?(0,re.jsxs)(ae.A,{sx:{p:{xs:2,sm:3}},children:[(0,re.jsx)(l.A,{variant:j?"subtitle1":"h6",gutterBottom:!0,children:"\ud83d\udcca Trading Score"}),(0,re.jsx)(y.A,{severity:"info",children:"Start adding trades to see your trading score and performance analysis. The scoring system will evaluate your consistency, risk management, performance, and discipline."})]}):t.length<T.thresholds.minTradesForScore?(0,re.jsxs)(ae.A,{sx:{p:{xs:2,sm:3}},children:[(0,re.jsx)(l.A,{variant:j?"subtitle1":"h6",gutterBottom:!0,children:"\ud83d\udcca Trading Score"}),(0,re.jsxs)(y.A,{severity:"warning",children:["You need at least ",T.thresholds.minTradesForScore," trades to calculate your score. Current trades: ",t.length]})]}):(0,re.jsxs)(ae.A,{"data-testid":"score-section",sx:{p:0,backgroundColor:"dark"===b.palette.mode?(0,d.X4)(b.palette.background.paper,.8):b.palette.background.paper,borderRadius:2,boxShadow:b.shadows[2],border:"1px solid ".concat("dark"===b.palette.mode?"rgba(204, 204, 204, 0.1)":(0,d.X4)(b.palette.common.black,.1))},children:[(0,re.jsx)(i.A,{sx:{px:{xs:2,sm:3},pt:{xs:2,sm:3}},children:(0,re.jsxs)(u.A,{direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},justifyContent:"space-between",mb:{xs:2,sm:3},children:[(0,re.jsx)(l.A,{variant:"h6",sx:{color:b.palette.text.primary,fontWeight:600},children:"\ud83d\udcca Trading Score Analysis"}),(0,re.jsx)(Kr.A,{tabs:[{label:"Overview"},{label:"History"},{label:"Patterns"},{label:"Settings"}],activeTab:w,onTabChange:(e,t)=>{k(t)}})]})}),(0,re.jsxs)(i.A,{sx:{px:{xs:2,sm:3},pb:{xs:2,sm:3}},children:[(0,re.jsx)(Kr.K,{value:w,index:0,children:(0,re.jsxs)(i.A,{children:[F&&(0,re.jsx)(c.A,{sx:{mb:2,borderRadius:1}}),(0,re.jsxs)(u.A,{spacing:4,children:[q?(0,re.jsxs)(i.A,{children:[(0,re.jsx)(l.A,{variant:"body2",sx:{color:b.palette.text.secondary,mb:1,fontStyle:"italic"},children:"Click on any score card to see detailed breakdown"}),(0,re.jsxs)(u.A,{direction:{xs:"column",sm:"row"},spacing:2,sx:{flexWrap:"wrap"},children:[(0,re.jsx)(i.A,{onClick:()=>Q("daily"),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-2px)"},flex:{xs:"1",sm:"1 1 calc(50% - 8px)",md:"1 1 calc(25% - 12px)"}},children:(0,re.jsx)(Rr,{score:q.daily.currentScore,trend:q.daily.trend,period:"daily",compact:!0})}),(0,re.jsx)(i.A,{onClick:()=>Q("weekly"),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-2px)"},flex:{xs:"1",sm:"1 1 calc(50% - 8px)",md:"1 1 calc(25% - 12px)"}},children:(0,re.jsx)(Rr,{score:q.weekly.currentScore,trend:q.weekly.trend,period:"weekly",compact:!0})}),(0,re.jsx)(i.A,{onClick:()=>Q("monthly"),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-2px)"},flex:{xs:"1",sm:"1 1 calc(50% - 8px)",md:"1 1 calc(25% - 12px)"}},children:(0,re.jsx)(Rr,{score:q.monthly.currentScore,trend:q.monthly.trend,period:"monthly",compact:!0})}),(0,re.jsx)(i.A,{onClick:()=>Q("yearly"),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-2px)"},flex:{xs:"1",sm:"1 1 calc(50% - 8px)",md:"1 1 calc(25% - 12px)"}},children:(0,re.jsx)(Rr,{score:q.yearly.currentScore,trend:q.yearly.trend,period:"yearly",compact:!0})})]})]}):(0,re.jsxs)(y.A,{severity:"warning",children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"\ud83d\udcca No Score Data Available"}),(0,re.jsxs)(l.A,{variant:"body2",children:["Unable to calculate multi-period scores. This could be because:",(0,re.jsx)("br",{}),"\u2022 No trades found for the current periods",(0,re.jsx)("br",{}),"\u2022 Insufficient trade data for analysis",(0,re.jsx)("br",{}),"\u2022 All trades are outside the selected date range"]})]}),X&&X.recommendations.length>0&&(0,re.jsxs)(y.A,{severity:"info",sx:{backgroundColor:"dark"===b.palette.mode?(0,d.X4)(b.palette.info.main,.1):(0,d.X4)(b.palette.info.main,.05),border:"1px solid ".concat((0,d.X4)(b.palette.info.main,.2)),borderRadius:2,"& .MuiAlert-icon":{color:b.palette.info.main}},children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"\ud83d\udca1 Quick Tip"}),(0,re.jsx)(l.A,{variant:"body2",children:X.recommendations[0]})]}),!q&&!X&&(0,re.jsxs)(y.A,{severity:"info",children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"\ud83c\udfaf Get Started with Scoring"}),(0,re.jsxs)(l.A,{variant:"body2",children:["To see your trading score analysis:",(0,re.jsx)("br",{}),"\u2022 Add at least ",T.thresholds.minTradesForScore," trades",(0,re.jsx)("br",{}),"\u2022 Ensure trades have dates within the current periods",(0,re.jsx)("br",{}),"\u2022 Include session, tags, and risk/reward data for better analysis"]})]})]})]})}),(0,re.jsx)(Kr.K,{value:w,index:1,children:(0,re.jsx)(Jr,{history:B,period:S,onPeriodChange:e=>{_(e)},availablePeriods:$,isLoading:P})}),(0,re.jsx)(Kr.K,{value:w,index:2,children:(0,re.jsx)(on,{trades:t,selectedDate:r,settings:T})}),(0,re.jsx)(Kr.K,{value:w,index:3,children:(0,re.jsx)(u.A,{spacing:3,children:(0,re.jsx)(an,{settings:T,onSettingsChange:e=>{I(e)},onSave:te,isSaving:z,trades:t,selectedTags:M,onTagsChange:async e=>{E(e),h&&await te(e)},allTags:v})})})]}),(0,re.jsxs)(We.A,{open:Y,onClose:Z,maxWidth:"lg",fullWidth:!0,fullScreen:j,sx:{"& .MuiDialog-paper":{backgroundColor:"dark"===b.palette.mode?(0,d.X4)(b.palette.background.paper,.95):b.palette.background.paper,borderRadius:2,maxHeight:"90vh"},"& .MuiDialogContent-root":(0,n.A)({},(0,he.J)(b))},children:[(0,re.jsxs)(Pe.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1,fontWeight:600},children:[K?"\ud83d\udcca ".concat(K.period.charAt(0).toUpperCase()+K.period.slice(1)," Score Analysis"):"Score Analysis",(0,re.jsx)(p.A,{onClick:Z,sx:{color:b.palette.text.secondary,"&:hover":{backgroundColor:(0,d.X4)(b.palette.text.secondary,.1)}},children:(0,re.jsx)(Ue.A,{})})]}),(0,re.jsx)(Ne.A,{sx:{pt:1},children:K&&(0,re.jsx)(Fr,{breakdown:K.analysis.breakdown,pattern:K.analysis.pattern,recommendations:K.analysis.recommendations,strengths:K.analysis.strengths,weaknesses:K.analysis.weaknesses})})]})]})},ln=(e,t,r)=>{if(!e)return[];switch(r){case"month":return e.filter((e=>(0,R.A)(new Date(e.trade_date),t)));case"year":return e.filter((e=>new Date(e.trade_date).getFullYear()===t.getFullYear()));default:return e}},cn=function(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||0===e.length)return[];const n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map(((t,r)=>{const n=e.filter((e=>{const t=new Date(e.trade_date);return(0,fr.A)(t)===r})),a=n.length,o=n.filter((e=>"win"===e.trade_type)).length,s=n.filter((e=>"loss"===e.trade_type)).length,i=a>0?o/a*100:0,l=n.reduce(((e,t)=>e+t.amount),0);return{day:t,dayIndex:r,totalTrades:a,winTrades:o,lossTrades:s,winRate:i,pnl:l,trades:n}})),a={neutral:t.palette.grey[500],sunday:"#FF6384",monday:"#36A2EB",tuesday:"#FFCE56",wednesday:"#4BC0C0",thursday:"#9966FF",friday:"#FF9F40",saturday:"#C9CBCF"};return n.map((e=>({day:e.day.substring(0,3),fullDay:e.day,total_trades:e.totalTrades,win_trades:e.winTrades,loss_trades:e.lossTrades,value:r?e.winRate:e.pnl,win_rate:e.winRate,pnl:e.pnl,trades:e.trades,color:a[e.day.toLowerCase()]||a.neutral})))};var dn=r(73849);const un=e=>{let{height:t=300,width:r="100%"}=e;const n=(0,s.A)(),o=(0,a.useMemo)((()=>Array.from({length:7},(()=>60*Math.random()+40))),[]);return(0,re.jsxs)(i.A,{sx:{bgcolor:"dark"===n.palette.mode?"rgba(255, 255, 255, 0.02)":"rgba(0, 0, 0, 0.02)",borderRadius:2,m:2,overflow:"hidden",width:r,height:t,p:2},children:[(0,re.jsx)(dn.A,{variant:"text",width:"40%",height:32,sx:{mb:2}}),(0,re.jsx)(i.A,{sx:{display:"flex",alignItems:"end",gap:1,height:"80%",mb:2},children:o.map(((e,t)=>(0,re.jsx)(dn.A,{variant:"rectangular",width:"12%",height:"".concat(e,"%"),sx:{borderRadius:1,transition:"height 0.3s ease-in-out"}},t)))}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:2},children:[(0,re.jsx)(dn.A,{variant:"text",width:80,height:20}),(0,re.jsx)(dn.A,{variant:"text",width:80,height:20})]})]})};var gn=r(35054),hn=r(73243);const pn=e=>{const{x:t,y:r,payload:n}=e,a=n.value,o=(0,G.Fl)(a);return(0,re.jsx)("g",{transform:"translate(".concat(t,",").concat(r,")"),children:(0,re.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:"#666",fontSize:12,children:o})})},mn=e=>{let{active:t,payload:r,label:n,type:a}=e;const o=(0,s.A)();if(t&&r&&r.length){const e=r[0].payload;return(0,re.jsxs)(ae.A,{sx:{p:1.5,boxShadow:o.shadows[3]},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:n}),(0,re.jsx)(l.A,{variant:"body2",sx:{color:e.dailyChange>0?"#4caf50":e.dailyChange<0?"#f44336":"text.secondary",fontWeight:"bold"},children:(0,G.Fl)(e.dailyChange)}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Cumulative P&L: ",(0,G.Fl)(e.cumulativePnL)]}),e.trades&&e.trades.length>0&&(0,re.jsxs)(l.A,{variant:"body2",sx:{color:o.palette.primary.main,fontSize:"0.75rem",mt:.5},children:["Click to view ",e.trades.length," trade",e.trades.length>1?"s":""]})]})}return null},xn=e=>{let{chartData:t,targetValue:r,monthly_target:a,setMultipleTradesDialog:o,timePeriod:c}=e;const u=(0,s.A)(),g="#4caf50",h="#f44336",p="#9e9e9e";return(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,re.jsx)(l.A,{variant:"h6",children:"Cumulative P&L"}),a&&null!==r&&(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",bgcolor:(0,d.X4)(u.palette.primary.main,.1),px:1.5,py:.5,borderRadius:1,fontSize:"0.875rem"},children:["Target: ",a,"% ($",null===r||void 0===r?void 0:r.toFixed(2),")"]})]}),(0,re.jsx)(Lr.u,{width:"100%",height:300,children:(0,re.jsxs)(Xr.Q,{data:t,children:[(0,re.jsxs)("defs",{children:[(0,re.jsxs)("linearGradient",{id:"colorPnLWin",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,re.jsx)("stop",{offset:"5%",stopColor:g,stopOpacity:.2}),(0,re.jsx)("stop",{offset:"95%",stopColor:g,stopOpacity:0})]}),(0,re.jsxs)("linearGradient",{id:"colorPnLLoss",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,re.jsx)("stop",{offset:"5%",stopColor:h,stopOpacity:.2}),(0,re.jsx)("stop",{offset:"95%",stopColor:h,stopOpacity:0})]})]}),(0,re.jsx)(Or.d,{strokeDasharray:"3 3",vertical:!1}),(0,re.jsx)(Br.W,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:u.palette.text.secondary,fontSize:"year"===c?8:12}}),(0,re.jsx)(Ur.h,{axisLine:!1,tickLine:!1,tick:(0,re.jsx)(pn,{})}),(0,re.jsx)(qr.m,{content:e=>(0,re.jsx)(mn,(0,n.A)((0,n.A)({},e),{},{type:"cumulative"}))}),null!==r&&(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(hn.e,{y:r,stroke:u.palette.primary.main,strokeDasharray:"4 4",strokeWidth:2}),(0,re.jsx)(Gr.G,{type:"monotone",dataKey:"cumulativePnL",stroke:"none",fill:u.palette.primary.main,fillOpacity:.05,baseValue:r})]}),(0,re.jsx)(hn.e,{y:0,stroke:p,strokeDasharray:"3 3"}),(0,re.jsx)(Gr.G,{type:"monotone",dataKey:"cumulativePnL",stroke:g,fill:"url(#colorPnLWin)",strokeWidth:2,name:"Cumulative P&L",style:{cursor:"pointer"},activeDot:e=>{const{cx:r,cy:n,index:a}=e;return(0,re.jsx)("circle",{cx:r,cy:n,r:6,stroke:u.palette.background.paper,strokeWidth:2,fill:u.palette.primary.main,style:{cursor:"pointer"},onClick:()=>{(0,ee.log)("Dot clicked, Index:",a);const e=t[a];if(e&&e.trades&&e.trades.length>0){const t=(0,P.A)(e.fullDate,"MMMM d, yyyy");o({open:!0,trades:e.trades,title:t,expandedTradeId:1===e.trades.length?e.trades[0].id:null})}}})},dot:{r:3,fill:g,stroke:u.palette.background.paper,strokeWidth:1}})]})})]})};var fn=r(82291),yn=r(38643),vn=r(17869);const An=e=>{const{x:t,y:r,payload:n}=e,a=n.value,o=(0,G.Fl)(a);return(0,re.jsx)("g",{transform:"translate(".concat(t,",").concat(r,")"),children:(0,re.jsx)("text",{x:0,y:0,dy:5,textAnchor:"end",fill:"#666",fontSize:12,children:o})})},bn=e=>{let{active:t,payload:r,label:n,type:a}=e;const o=(0,s.A)();if(t&&r&&r.length){const e=r[0].payload;return(0,re.jsxs)(ae.A,{sx:{p:1.5,boxShadow:o.shadows[3]},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:n}),(0,re.jsx)(l.A,{variant:"body2",sx:{color:e.isWin?"#4caf50":e.isLoss?"#f44336":"text.secondary",fontWeight:"bold"},children:(0,G.Fl)(e.pnl)}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:e.isWin?"Win":e.isLoss?"Loss":"Break Even"}),e.trades&&e.trades.length>0&&(0,re.jsxs)(l.A,{variant:"body2",sx:{color:o.palette.primary.main,fontSize:"0.75rem",mt:.5},children:["Click to view ",e.trades.length," trade",e.trades.length>1?"s":""]})]})}return null},jn=e=>{let{chartData:t,drawdownViolationValue:r,setMultipleTradesDialog:a,timePeriod:o}=e;const c=(0,s.A)(),d="#4caf50",u="#f44336",g="#9e9e9e",h="#ff9800";return(0,re.jsxs)(i.A,{children:[(0,re.jsx)(l.A,{variant:"h6",sx:{mb:2},children:"Daily P&L"}),(0,re.jsx)(Lr.u,{width:"100%",height:300,children:(0,re.jsxs)(fn.E,{data:t,children:[(0,re.jsx)(Or.d,{strokeDasharray:"3 3",vertical:!1}),(0,re.jsx)(Br.W,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:c.palette.text.secondary,fontSize:"year"===o?8:12}}),(0,re.jsx)(Ur.h,{axisLine:!1,tickLine:!1,tick:(0,re.jsx)(An,{})}),(0,re.jsx)(qr.m,{content:e=>(0,re.jsx)(bn,(0,n.A)((0,n.A)({},e),{},{type:"daily"}))}),(0,re.jsx)(hn.e,{y:0,stroke:g,strokeDasharray:"3 3"}),(0,re.jsx)(hn.e,{y:r,stroke:c.palette.error.main,strokeDasharray:"3 3",strokeWidth:2,label:{position:"right",value:"Max Drawdown: ".concat((0,G.Fl)(r)),fill:c.palette.error.main,fontSize:12,fontWeight:"bold"}}),(0,re.jsx)(yn.y,{dataKey:"pnl",name:"Daily P&L",radius:[4,4,0,0],onClick:e=>{if((0,ee.log)("Bar clicked:",e),e&&e.payload){const t=e.payload;if(t.trades&&t.trades.length>0){const e=(0,P.A)(t.fullDate,"MMMM d, yyyy");a({open:!0,trades:t.trades,title:e,expandedTradeId:1===t.trades.length?t.trades[0].id:null})}}},style:{cursor:"pointer"},children:t.map(((e,t)=>(0,re.jsx)(vn.f,{fill:e.isWin?d:e.isLoss?u:h,fillOpacity:.8},"cell-".concat(t))))})]})})]})},wn=e=>{let{chartData:t,targetValue:r,monthly_target:n,drawdownViolationValue:o,setMultipleTradesDialog:s,timePeriod:l}=e;const[c,d]=(0,a.useState)(0);return(0,re.jsxs)(ae.A,{sx:{p:0,mb:3,borderRadius:2},children:[(0,re.jsx)(i.A,{sx:{px:3,pt:3},children:(0,re.jsx)(i.A,{sx:{display:"flex",justifyContent:"start",mb:2},children:(0,re.jsx)(Kr.A,{tabs:[{label:"Cumulative P&L"},{label:"Daily P&L"}],activeTab:c,onTabChange:(e,t)=>{d(t)}})})}),(0,re.jsxs)(i.A,{sx:{px:3,pb:3},children:[(0,re.jsx)(Kr.K,{value:c,index:0,children:(0,re.jsx)(xn,{chartData:t,targetValue:r,monthly_target:n,setMultipleTradesDialog:s,timePeriod:l})}),(0,re.jsx)(Kr.K,{value:c,index:1,children:(0,re.jsx)(jn,{chartData:t,drawdownViolationValue:o,setMultipleTradesDialog:s,timePeriod:l})})]})]})},kn=a.memo(wn);var Cn=r(60163),Sn=r(4240);const _n=e=>{let{winLossData:t,onPieClick:r}=e;const n=(0,s.A)();a.useEffect((()=>{const e=document.createElement("style");return e.innerHTML="\n      .recharts-sector:focus,\n      .recharts-sector:focus-visible,\n      .recharts-pie:focus,\n      .recharts-pie:focus-visible,\n      .recharts-pie-sector:focus,\n      .recharts-pie-sector:focus-visible,\n      .recharts-layer:focus,\n      .recharts-layer:focus-visible,\n      .recharts-surface:focus,\n      .recharts-surface:focus-visible {\n        outline: none !important;\n        stroke: none !important;\n        stroke-width: 0 !important;\n        box-shadow: none !important;\n      }\n\n      /* Target all SVG elements in the chart */\n      .recharts-wrapper svg *:focus,\n      .recharts-wrapper svg *:focus-visible,\n      .win-loss-chart-container svg *:focus,\n      .win-loss-chart-container svg *:focus-visible {\n        outline: none !important;\n        stroke-width: 0 !important;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}}),[]);const o={win:"dark"===n.palette.mode?"#66bb6a":"#4caf50",loss:"dark"===n.palette.mode?"#ef5350":"#f44336",zero:"dark"===n.palette.mode?"#bdbdbd":"#9e9e9e",breakEven:"dark"===n.palette.mode?"#ffb74d":"#ff9800"},c=100,u=60,g=3,h=4;n.palette.mode;return(0,re.jsxs)(ae.A,{elevation:"dark"===n.palette.mode?2:1,sx:{p:3,borderRadius:2,height:"100%",display:"flex",flexDirection:"column",bgcolor:n.palette.background.paper},children:[(0,re.jsx)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,pb:1.5},children:(0,re.jsx)(l.A,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:"Win/Loss Distribution"})}),(0,re.jsx)(i.A,{sx:{flex:1,minHeight:300},className:"win-loss-chart-container",children:(0,re.jsx)(Lr.u,{width:"100%",height:"100%",children:(0,re.jsxs)(Cn.r,{style:{outline:"none"},tabIndex:-1,margin:{top:5,right:5,bottom:5,left:5},children:[(0,re.jsx)(qr.m,{content:e=>{let{active:a,payload:s}=e;if(a&&s&&s.length){const e=s[0].payload;return(0,re.jsxs)(ae.A,{sx:{p:1.5,boxShadow:n.shadows[3]},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:e.name}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:"Wins"===e.name?o.win:"Losses"===e.name?o.loss:"Breakeven"===e.name?o.breakEven:o.zero,fontWeight:"bold"},children:[e.value," trade",1!==e.value?"s":""]}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[(e.value/t.reduce(((e,t)=>e+t.value),0)*100).toFixed(1),"% of total"]}),r&&(0,re.jsx)(l.A,{variant:"body2",sx:{color:n.palette.primary.main,fontSize:"0.75rem",mt:.5},children:"Click to view trades"})]})}return null}}),(0,re.jsx)(Sn.F,{data:t,cx:"50%",cy:"50%",labelLine:!1,outerRadius:c,strokeWidth:0,innerRadius:u,fill:"#8884d8",dataKey:"value",label:e=>{let{name:t,percent:r}=e;return r<.05?null:"".concat(t," ").concat((100*r).toFixed(0),"%")},paddingAngle:g,cornerRadius:h,onClick:e=>{r&&r(e.name)},cursor:"pointer",style:{outline:"none",filter:"drop-shadow(0px 2px 5px rgba(0,0,0,0.1))"},tabIndex:-1,children:t.map(((e,t)=>{const r="Wins"===e.name?o.win:"Losses"===e.name?o.loss:"Breakeven"===e.name?o.breakEven:o.zero;return(0,re.jsx)(vn.f,{fill:r,strokeWidth:1,stroke:n.palette.background.paper,style:{outline:"none",transition:"opacity 0.3s"}},"cell-".concat(t))}))}),(0,re.jsx)(Yr.s,{verticalAlign:"bottom",align:"center",layout:"horizontal",iconSize:12,iconType:"circle",wrapperStyle:{paddingTop:15,fontSize:"0.85rem",fontWeight:500}})]})})}),(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"center",mt:2,pt:1.5,flexDirection:"column",alignItems:"center",marginTop:"auto"},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:"Showing win/loss distribution for all trades"}),r&&(0,re.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5,bgcolor:(0,d.X4)(n.palette.primary.main,.08),px:1.5,py:.5,borderRadius:1},children:(0,re.jsx)(l.A,{variant:"caption",color:"primary",sx:{fontWeight:500},children:"Click on a segment to view trades"})})]})]})},Tn=e=>{let{winLossStats:t,trades:r,onTradeClick:n}=e;const o=(0,s.A)(),c=a.useMemo((()=>{const e=r.filter((e=>"win"===e.trade_type));return 0===e.length?null:e.reduce(((e,t)=>t.amount>e.amount?t:e),e[0])}),[r]),h=a.useMemo((()=>{const e=r.filter((e=>"loss"===e.trade_type));return 0===e.length?null:e.reduce(((e,t)=>t.amount<e.amount?t:e),e[0])}),[r]);return(0,re.jsx)(i.A,{children:(t.winners.total>0||t.losers.total>0)&&(0,re.jsxs)(i.A,{sx:{display:"flex",gap:2,mb:3},children:[(0,re.jsxs)(ae.A,{sx:{flex:1,p:2,border:"4px solid ".concat((0,d.X4)(o.palette.success.main,.1)),borderRadius:2},children:[(0,re.jsx)(l.A,{variant:"subtitle1",sx:{color:o.palette.success.main,mb:2},children:"Winners"}),(0,re.jsxs)(u.A,{spacing:1.5,children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Total winners"}),(0,re.jsx)(g.A,{title:"Total number of winning trades in the selected period",arrow:!0,children:(0,re.jsx)(tn.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"body2",children:t.winners.total})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Best win"}),(0,re.jsx)(g.A,{title:"Your largest winning trade as a percentage of your account",arrow:!0,children:(0,re.jsx)(tn.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"body2",children:c?(0,G.vv)(c.amount):"0"})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Average win"}),(0,re.jsx)(g.A,{title:"The average size of your winning trades as a percentage of your account",arrow:!0,children:(0,re.jsx)(tn.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"body2",children:(0,G.vv)(t.winners.avgAmount)})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Max consecutive wins"}),(0,re.jsx)(g.A,{title:"Your longest streak of consecutive winning trades",arrow:!0,children:(0,re.jsx)(tn.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"body2",children:t.winners.maxConsecutive})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Avg consecutive wins"}),(0,re.jsx)(g.A,{title:"The average number of wins you achieve in a row before a loss",arrow:!0,children:(0,re.jsx)(tn.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"body2",children:t.winners.avgConsecutive.toFixed(1)})]})]})]}),(0,re.jsxs)(ae.A,{sx:{flex:1,p:2,border:"4px solid ".concat((0,d.X4)(o.palette.error.main,.1)),borderRadius:2},children:[(0,re.jsx)(l.A,{variant:"subtitle1",sx:{color:o.palette.error.main,mb:2},children:"Losers"}),(0,re.jsxs)(u.A,{spacing:1.5,children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Total losers"}),(0,re.jsx)(g.A,{title:"Total number of losing trades in the selected period",arrow:!0,children:(0,re.jsx)(tn.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"body2",children:t.losers.total})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Worst loss"}),(0,re.jsx)(g.A,{title:"Your largest losing trade as a percentage of your account",arrow:!0,children:(0,re.jsx)(tn.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"body2",children:h?(0,G.vv)(Math.abs(h.amount)):"0"})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Average loss"}),(0,re.jsx)(g.A,{title:"The average size of your losing trades as a percentage of your account",arrow:!0,children:(0,re.jsx)(tn.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"body2",children:(0,G.vv)(Math.abs(t.losers.avgAmount))})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Max consecutive losses"}),(0,re.jsx)(g.A,{title:"Your longest streak of consecutive losing trades",arrow:!0,children:(0,re.jsx)(tn.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"body2",children:t.losers.maxConsecutive})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Avg consecutive losses"}),(0,re.jsx)(g.A,{title:"The average number of losses you have in a row before a win",arrow:!0,children:(0,re.jsx)(tn.A,{sx:{fontSize:14,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"body2",children:t.losers.avgConsecutive.toFixed(1)})]})]})]})]})})};var In=r(55467);const Mn=["key"],En=e=>{let{open:t,onClose:r,title:o="Filter by Tags",allTags:c,selectedTags:d,onTagsChange:u,showClearButton:g=!0,showApplyButton:p=!0}=e;const m=(0,s.A)(),[x,f]=(0,a.useState)(""),y=(0,a.useMemo)((()=>(0,Ee.GI)(c)),[c]),v=(0,a.useMemo)((()=>x?(0,Ee.o)(c,x):c),[c,x]),A=(0,re.jsx)(l.A,{variant:"h6",children:o}),b=g||p?(0,re.jsxs)(i.A,{children:[g&&(0,re.jsx)(h.A,{onClick:()=>{u([])},color:"inherit",children:"Clear All"}),p&&(0,re.jsx)(h.A,{onClick:r,color:"primary",children:"Apply"})]}):void 0;return(0,re.jsxs)(K.mY,{open:t,onClose:r,title:A,actions:b,maxWidth:"sm",fullWidth:!0,children:[(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[y.length>0&&(0,re.jsx)(K.pp,{label:"Filter by Tag Group",value:x,onChange:e=>f(e.target.value),options:[{value:"",label:"All Tags"},...y.map((e=>({value:e,label:e})))],size:"small"}),(0,re.jsx)(Ze.A,{multiple:!0,options:v,value:d,onChange:(e,t)=>u(t),slotProps:{popper:{sx:{zIndex:In.M.DIALOG_POPUP}},listbox:{sx:(0,n.A)({},(0,he.J)(m))}},renderInput:e=>(0,re.jsx)(xe.A,(0,n.A)((0,n.A)({},e),{},{variant:"outlined",label:"Select Tags",placeholder:"Choose tags to filter",fullWidth:!0})),renderTags:(e,t)=>e.map(((e,r)=>(0,re.jsx)(me.A,(0,n.A)((0,n.A)({label:(0,Ee.t)(e,!0)},t({index:r})),{},{sx:(0,Ee.dO)(e,m),title:(0,Ee.dn)(e)?"Group: ".concat((0,Ee.Oo)(e)):void 0})))),renderOption:(e,t)=>{const{key:r}=e,a=(0,Je.A)(e,Mn);return(0,re.jsx)("li",(0,n.A)((0,n.A)({},a),{},{children:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Ee.dn)(t)&&(0,re.jsx)(me.A,{label:(0,Ee.Oo)(t),size:"small",sx:(0,n.A)((0,n.A)({},(0,Ee.dO)(t,m)),{},{height:"18px",fontSize:"0.7rem"})}),(0,Ee.t)(t,!0)]})}),r)}})]}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:d.length>0?"Selected ".concat(d.length," tag").concat(d.length>1?"s":""):"Select tags to filter. When no tags are selected, all items will be shown."})]})};class zn{static getInstance(){return zn.instance||(zn.instance=new zn),zn.instance}calculateTagPerformanceFromTrades(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{if(0===t.length)return[];return t.map((t=>{const n=e.filter((e=>{var n;return!(null===(n=e.tags)||void 0===n||!n.includes(t))&&!(r.length>0&&!r.every((t=>{var r;return null===(r=e.tags)||void 0===r?void 0:r.includes(t)})))}));if(0===n.length)return null;const a=n.filter((e=>"win"===e.trade_type)),o=n.filter((e=>"loss"===e.trade_type)),s=n.filter((e=>"breakeven"===e.trade_type)),i=n.length,l=n.reduce(((e,t)=>e+t.amount),0),c=i>0?l/i:0,d=a.length>0?Math.max(...a.map((e=>e.amount))):0,u=o.length>0?Math.min(...o.map((e=>e.amount))):0,g=i>0?Math.round(a.length/i*100*100)/100:0;return{tag:t,wins:a.length,losses:o.length,breakevens:s.length,total_trades:i,win_rate:g,total_pnl:l,avg_pnl:c,max_win:d,max_loss:u}})).filter((e=>null!==e))}catch(n){throw ee.logger.error("Error in calculateTagPerformanceFromTrades:",n),n}}}zn.instance=void 0;const Dn=zn.getInstance(),Rn=e=>{let{trades:t,selectedDate:r,timePeriod:n,allTags:o,primaryTags:c,secondaryTags:u,setPrimaryTags:p,setSecondaryTags:m,setMultipleTradesDialog:x}=e;const f=(0,s.A)(),[y,v]=(0,a.useState)(!1),[A,b]=(0,a.useState)(!1),[j,w]=(0,a.useState)([]),[k,C]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(()=>{if(0!==c.length){C(!0);try{const e=Dn.calculateTagPerformanceFromTrades(t,c,u).map((e=>({tag:e.tag.substring(e.tag.indexOf(":")+1,e.tag.length),wins:e.wins,losses:e.losses,breakevens:e.breakevens,total_trades:e.total_trades,win_rate:e.win_rate,total_pnl:e.total_pnl,avg_pnl:e.avg_pnl,max_win:e.max_win,max_loss:e.max_loss,trades:[]})));w(e)}catch(e){console.error("Error calculating filtered tag stats:",e),w([])}finally{C(!1)}}else w([])})()}),[t,c,u]);const S="#4caf50",_="#f44336";return(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(l.A,{variant:"h6",children:"Tag Performance Analysis"}),(0,re.jsx)(g.A,{title:"Analyze how different tags perform. Select primary tags to filter, and optionally secondary tags to see how they perform in combination.",arrow:!0,placement:"top",children:(0,re.jsx)(tn.A,{sx:{fontSize:16,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,re.jsx)(g.A,{title:"Select primary tags to filter trades that have ANY of these tags. These are your main strategies or setups to analyze.",arrow:!0,placement:"top",children:(0,re.jsx)(h.A,{variant:"outlined",size:"small",onClick:()=>v(!0),sx:{textTransform:"none"},children:c.length>0?"Primary: ".concat(c.length," tags"):"Select Primary Tags"})}),(0,re.jsx)(g.A,{title:"Select secondary tags to further filter trades that have ALL of these tags. Use this to analyze specific conditions within your primary strategies.",arrow:!0,placement:"top",children:(0,re.jsx)(h.A,{variant:"outlined",size:"small",onClick:()=>b(!0),color:u.length>0?"secondary":"primary",sx:{textTransform:"none",borderColor:u.length>0?"secondary.main":void 0},children:u.length>0?"Secondary: ".concat(u.length," tags"):"Select Secondary Tags"})}),(0,re.jsx)(En,{open:y,onClose:()=>v(!1),title:"Select Primary Tags",allTags:o,selectedTags:c,onTagsChange:e=>p(e),showApplyButton:!0,showClearButton:!0}),(0,re.jsx)(En,{open:A,onClose:()=>b(!1),title:"Select Secondary Tags",allTags:o,selectedTags:u,onTagsChange:e=>m(e),showApplyButton:!0,showClearButton:!0})]})]}),0===c.length&&0===u.length?(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:200,bgcolor:(0,d.X4)(f.palette.background.paper,.4),borderRadius:2,p:3},children:[(0,re.jsx)(l.A,{variant:"h6",color:"text.secondary",sx:{mb:1},children:"No Tags Selected"}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",align:"center",children:"Please select primary or secondary tags to view performance analysis."})]}):k?(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:300,bgcolor:(0,d.X4)(f.palette.background.paper,.4),borderRadius:2,p:3},children:[(0,re.jsx)(Rt.A,{size:40,sx:{mb:2}}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Calculating tag performance..."})]}):(0,re.jsx)(Lr.u,{width:"100%",height:300,children:(0,re.jsxs)(fn.E,{data:j,margin:{top:20,right:30,left:20,bottom:5},maxBarSize:50,children:[(0,re.jsx)(Or.d,{strokeDasharray:"3 3",vertical:!1}),(0,re.jsx)(Br.W,{dataKey:"tag",axisLine:!1,tickLine:!1,tick:{fill:f.palette.text.secondary,fontSize:12}}),(0,re.jsx)(Ur.h,{axisLine:!1,tickLine:!1,tick:{fill:f.palette.text.secondary,fontSize:12}}),(0,re.jsx)(qr.m,{content:e=>{let{active:t,payload:r,label:n}=e;if(t&&r&&r.length){const e=r[0].payload;return(0,re.jsxs)(ae.A,{sx:{p:1.5,bgcolor:"background.paper"},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:"bold"},children:n}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:S},children:["Wins: ",e.wins]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:_},children:["Losses: ",e.losses]}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Win Rate: ",e.win_rate,"%"]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:e.total_pnl>0?S:_,fontWeight:"bold",mt:.5},children:["P&L: ",(0,G.Fl)(e.total_pnl)]})]})}return null}}),(0,re.jsx)(Yr.s,{}),(0,re.jsx)(yn.y,{dataKey:"wins",name:"Wins",stackId:"trades",fill:S,radius:[4,4,0,0],onClick:e=>{if(e&&e.payload){const a=e.payload.tag,o=c.find((e=>e.endsWith(":".concat(a))))||a,s=t.filter((e=>{var t;return!(null===(t=e.tags)||void 0===t||!t.includes(o))&&(!(u.length>0&&!u.every((t=>{var r;return null===(r=e.tags)||void 0===r?void 0:r.includes(t)})))&&("win"===e.trade_type&&("month"===n?(0,R.A)(new Date(e.trade_date),r):"year"!==n||new Date(e.trade_date).getFullYear()===r.getFullYear())))}));s.length>0&&x({open:!0,trades:s,date:"Winning trades with tag: ".concat([o,...u].join(", ")),expandedTradeId:1===s.length?s[0].id:null})}},style:{cursor:"pointer"}}),(0,re.jsx)(yn.y,{dataKey:"losses",name:"Losses",stackId:"trades",fill:_,radius:[4,4,0,0],onClick:e=>{if(e&&e.payload){const a=e.payload.tag,o=c.find((e=>e.endsWith(":".concat(a))))||a,s=t.filter((e=>{var t;return!(null===(t=e.tags)||void 0===t||!t.includes(o))&&(!(u.length>0&&!u.every((t=>{var r;return null===(r=e.tags)||void 0===r?void 0:r.includes(t)})))&&("loss"===e.trade_type&&("month"===n?(0,R.A)(new Date(e.trade_date),r):"year"!==n||new Date(e.trade_date).getFullYear()===r.getFullYear())))}));s.length>0&&x({open:!0,trades:s,date:"Losing trades with tag: ".concat([o,...u].join(", ")),expandedTradeId:1===s.length?s[0].id:null})}},style:{cursor:"pointer"}})]})})]})},Wn=e=>{let{trades:t,selectedDate:r,timePeriod:n,allTags:o,primaryTags:c,secondaryTags:u,setPrimaryTags:p,setSecondaryTags:m,setMultipleTradesDialog:x}=e;const f=(0,s.A)(),[y,v]=(0,a.useState)(!1),[A,b]=(0,a.useState)(!1),[j,w]=(0,a.useState)("winRate"),[k,C]=(0,a.useState)([]),[S,_]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{if(0!==c.length){_(!0);try{const e=t.filter((e=>!(!e.tags||!c.some((t=>{var r;return null===(r=e.tags)||void 0===r?void 0:r.includes(t)})))&&!(u.length>0&&!u.every((t=>{var r;return null===(r=e.tags)||void 0===r?void 0:r.includes(t)}))))),r=cn(e,f,"winRate"===j);C(r)}catch(e){console.error("Error calculating day of week data:",e),C([])}finally{_(!1)}}else C([])})()}),[t,c,u,j,f]);const T=e=>{let{active:t,payload:r,label:n}=e;if(t&&r&&r.length){const e=r[0].payload;return(0,re.jsxs)(ae.A,{sx:{p:1.5,bgcolor:"background.paper"},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:"bold"},children:e.fullDay}),(0,re.jsxs)(l.A,{variant:"body2",children:["Total Trades: ",e.total_trades]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:f.palette.success.main},children:["Wins: ",e.winTrades]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:f.palette.error.main},children:["Losses: ",e.lossTrades]}),(0,re.jsxs)(l.A,{variant:"body2",children:["Win Rate: ",e.win_rate.toFixed(1),"%"]}),(0,re.jsxs)(l.A,{variant:"body2",children:["P&L: ",(0,G.vv)(e.pnl)]})]})}return null};return(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(l.A,{variant:"h6",children:"Tag Performance by Day of Week"}),(0,re.jsx)(g.A,{title:"Analyze how selected tags perform on different days of the week. This helps identify which strategies work better on specific days.",arrow:!0,placement:"top",children:(0,re.jsx)(tn.A,{sx:{fontSize:16,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,re.jsx)(h.A,{variant:"winRate"===j?"contained":"outlined",size:"small",onClick:()=>w("winRate"),sx:{textTransform:"none"},children:"Win Rate"}),(0,re.jsx)(h.A,{variant:"pnl"===j?"contained":"outlined",size:"small",onClick:()=>w("pnl"),sx:{textTransform:"none"},children:"P&L"}),(0,re.jsx)(g.A,{title:"Select primary tags to filter trades that have ANY of these tags. These are your main strategies or setups to analyze.",arrow:!0,placement:"top",children:(0,re.jsx)(h.A,{variant:"outlined",size:"small",onClick:()=>v(!0),sx:{textTransform:"none"},children:c.length>0?"Primary: ".concat(c.length," tags"):"Select Primary Tags"})}),(0,re.jsx)(g.A,{title:"Select secondary tags to further filter trades that have ALL of these tags. Use this to analyze specific conditions within your primary strategies.",arrow:!0,placement:"top",children:(0,re.jsx)(h.A,{variant:"outlined",size:"small",onClick:()=>b(!0),color:u.length>0?"secondary":"primary",sx:{textTransform:"none",borderColor:u.length>0?"secondary.main":void 0},children:u.length>0?"Secondary: ".concat(u.length," tags"):"Select Secondary Tags"})}),(0,re.jsx)(En,{open:y,onClose:()=>v(!1),title:"Select Primary Tags",allTags:o,selectedTags:c,onTagsChange:e=>p(e),showApplyButton:!0,showClearButton:!0}),(0,re.jsx)(En,{open:A,onClose:()=>b(!1),title:"Select Secondary Tags",allTags:o,selectedTags:u,onTagsChange:e=>m(e),showApplyButton:!0,showClearButton:!0})]})]}),0===c.length?(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:200,bgcolor:(0,d.X4)(f.palette.background.paper,.4),borderRadius:2,p:3},children:[(0,re.jsx)(l.A,{variant:"h6",color:"text.secondary",sx:{mb:1},children:"No Tags Selected"}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",align:"center",children:"Please select primary tags to view day of week performance analysis."})]}):S?(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:300,bgcolor:(0,d.X4)(f.palette.background.paper,.4),borderRadius:2,p:3},children:[(0,re.jsx)(Rt.A,{size:40,sx:{mb:2}}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Calculating day of week performance..."})]}):(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)(i.A,{sx:{mb:2},children:[(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",sx:{lineHeight:1.6},children:["This chart shows how your selected trading strategies (tags) perform on different days of the week.","winRate"===j?" Higher bars indicate better win rates on those days. ":" Higher bars indicate better profitability on those days. ","Click on any bar to see the specific trades for that day."]}),k.some((e=>e.total_trades>0))?(0,re.jsx)(l.A,{variant:"body2",color:"primary",sx:{mt:1,fontWeight:500},children:"winRate"===j?"Best day for selected strategies: ".concat(k.reduce(((e,t)=>t.total_trades>0&&t.win_rate>e.win_rate?t:e),{win_rate:0,fullDay:"None"}).fullDay):"Most profitable day: ".concat(k.reduce(((e,t)=>t.total_trades>0&&t.pnl>e.pnl?t:e),{pnl:-1/0,fullDay:"None"}).fullDay)}):null]}),(0,re.jsx)(Lr.u,{width:"100%",height:300,children:(0,re.jsxs)(fn.E,{data:k,margin:{top:20,right:30,left:20,bottom:5},maxBarSize:50,children:[(0,re.jsx)(Or.d,{strokeDasharray:"3 3",vertical:!1}),(0,re.jsx)(Br.W,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fill:f.palette.text.secondary,fontSize:12}}),(0,re.jsx)(Ur.h,{axisLine:!1,tickLine:!1,tick:{fill:f.palette.text.secondary,fontSize:12},domain:"winRate"===j?[0,100]:["auto","auto"],tickFormatter:"winRate"===j?e=>"".concat(e,"%"):e=>(0,G.vv)(e).replace("$","")}),(0,re.jsx)(qr.m,{content:(0,re.jsx)(T,{})}),(0,re.jsx)(Yr.s,{}),(0,re.jsx)(yn.y,{dataKey:"value",name:"winRate"===j?"Win Rate":"P&L",fill:f.palette.primary.main,radius:[4,4,0,0],onClick:e=>{if(e&&e.payload&&x){const t=e.payload.trades;t.length>0&&x({open:!0,trades:t,showChartInfo:!1,date:"".concat("winRate"===j?"Win Rate":"P&L"," for ").concat(e.payload.fullDay),expandedTradeId:1===t.length?t[0].id:null})}},style:{cursor:"pointer"},children:k.map(((e,t)=>(0,re.jsx)(vn.f,{fill:e.color},"cell-".concat(t))))})]})})]})]})};var Pn=r(10988),Nn=r(45837);const Fn=e=>{let{dailySummaryData:t,trades:r,setMultipleTradesDialog:o}=e;const c=(0,s.A)(),[u,h]=a.useState(0),[p,m]=a.useState(10),x=a.useMemo((()=>t&&0!==t.length?t.reduce(((e,t)=>e+t.pnl),0):0),[t]),f=a.useMemo((()=>{const e=u*p,r=e+p;return t.slice(e,r)}),[t,u,p]);return a.useEffect((()=>{h(0)}),[t.length]),(0,re.jsxs)(ae.A,{sx:{p:3,borderRadius:2,height:"100%",display:"flex",flexDirection:"column"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(l.A,{variant:"h6",children:"Daily Summary"}),(0,re.jsx)(g.A,{title:"Daily trading summary showing trades, session, and P&L for each day",arrow:!0,placement:"top",children:(0,re.jsx)(tn.A,{sx:{fontSize:16,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),t&&t.length>0&&(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,bgcolor:(0,d.X4)(x>0?c.palette.success.main:x<0?c.palette.error.main:c.palette.grey[500],.1),px:1.5,py:.5,borderRadius:2,border:"1px solid ".concat((0,d.X4)(x>0?c.palette.success.main:x<0?c.palette.error.main:c.palette.grey[500],.2))},children:[x>0?(0,re.jsx)(oe.A,{sx:{color:c.palette.success.main}}):x<0?(0,re.jsx)(_r.A,{sx:{color:c.palette.error.main}}):(0,re.jsx)(Tr.A,{sx:{color:c.palette.grey[500]}}),(0,re.jsxs)(l.A,{variant:"subtitle1",sx:{fontWeight:600,color:x>0?c.palette.success.main:x<0?c.palette.error.main:"text.secondary"},children:["Total P&L: ",(0,G.Fl)(x)]})]})]}),(0,re.jsx)(er.A,{sx:(0,n.A)({flex:1,overflow:"auto"},(0,he.J)(c)),children:(0,re.jsxs)(tr.A,{stickyHeader:!0,size:"small",children:[(0,re.jsx)(rr.A,{children:(0,re.jsxs)(nr.A,{children:[(0,re.jsx)(ar.A,{sx:{fontWeight:600,backgroundColor:c.palette.background.paper,borderBottom:"2px solid ".concat(c.palette.divider),color:"text.secondary"},children:"DATE"}),(0,re.jsx)(ar.A,{align:"right",sx:{fontWeight:600,backgroundColor:c.palette.background.paper,borderBottom:"2px solid ".concat(c.palette.divider),color:"text.secondary"},children:"TRADES"}),(0,re.jsx)(ar.A,{align:"center",sx:{fontWeight:600,backgroundColor:c.palette.background.paper,borderBottom:"2px solid ".concat(c.palette.divider),color:"text.secondary"},children:"SESSION"}),(0,re.jsx)(ar.A,{align:"right",sx:{fontWeight:600,backgroundColor:c.palette.background.paper,borderBottom:"2px solid ".concat(c.palette.divider),color:"text.secondary"},children:"P/L"})]})}),(0,re.jsx)(or.A,{children:f.map(((e,t)=>{const n=new Date(e.trade_date);return(0,Nn.A)(n)?(0,re.jsxs)(nr.A,{onClick:()=>{const e=r.filter((e=>(0,P.A)(new Date(e.trade_date),"yyyy-MM-dd")===(0,P.A)(n,"yyyy-MM-dd")));e.length>0&&o({open:!0,trades:e,date:(0,P.A)(n,"dd/MM/yyyy"),expandedTradeId:1===e.length?e[0].id:null})},sx:{"&:last-child td, &:last-child th":{border:0},"&:hover":{backgroundColor:(0,d.X4)(c.palette.primary.main,.04),cursor:"pointer"},bgcolor:e.pnl>0?(0,d.X4)(c.palette.success.main,.05):e.pnl<0?(0,d.X4)(c.palette.error.main,.05):"transparent"},children:[(0,re.jsx)(ar.A,{sx:{fontWeight:500,color:"text.primary"},children:(0,P.A)(n,"dd/MM/yyyy")}),(0,re.jsx)(ar.A,{align:"right",sx:{fontWeight:500,color:"text.primary"},children:e.trades}),(0,re.jsx)(ar.A,{align:"center",children:e.session?(0,re.jsx)(l.A,{sx:{color:"text.primary",fontWeight:500},children:e.session}):(0,re.jsx)(l.A,{sx:{color:"text.secondary",fontStyle:"italic"},children:"\u2014"})}),(0,re.jsx)(ar.A,{align:"right",sx:{color:e.pnl>0?c.palette.success.main:e.pnl<0?c.palette.error.main:"text.secondary",fontWeight:600,fontSize:"0.875rem"},children:(0,G.Fl)(e.pnl)})]},(0,P.A)(n,"yyyy-MM-dd")):(console.error("Invalid trade_date in dailySummaryData:",e),null)}))})]})}),(0,re.jsx)(Pn.A,{rowsPerPageOptions:[5,10,25,50],component:"div",count:t.length,rowsPerPage:p,page:u,onPageChange:(e,t)=>{h(t)},onRowsPerPageChange:e=>{m(parseInt(e.target.value,10)),h(0)},sx:{borderTop:"1px solid ".concat(c.palette.divider),".MuiTablePagination-toolbar":{minHeight:52}}})]})},Ln=e=>{let{sessionStats:t,trades:r,selectedDate:n,timePeriod:a,setMultipleTradesDialog:o}=e;const c=(0,s.A)(),g="#4caf50",h="#f44336",p={Asia:"#2962ff",London:"#388e3c","NY AM":"#f57c00","NY PM":"#9c27b0"};return(0,re.jsxs)(ae.A,{elevation:"dark"===c.palette.mode?2:1,sx:{p:3,borderRadius:2,height:"100%",display:"flex",flexDirection:"column",bgcolor:c.palette.background.paper},children:[(0,re.jsx)(l.A,{variant:"h6",sx:{mb:2},children:"Session Performance"}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:3,flex:1},children:[(0,re.jsx)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)"},gap:2,gridAutoRows:"minmax(min-content, max-content)"},children:t.map((e=>{var t,s,m,x;return(0,re.jsxs)(ae.A,{sx:{p:2,border:"1px solid ".concat((0,d.X4)(p[e.session],.3)),borderRadius:2,bgcolor:"dark"===c.palette.mode?"rgba(0, 0, 0, 0.2)":"rgba(0, 0, 0, 0.02)",opacity:0===e.total_trades?.5:1,cursor:e.total_trades>0?"pointer":"default",transition:"all 0.2s","&:hover":{boxShadow:e.total_trades>0?c.shadows[2]:"none",bgcolor:e.total_trades>0?(0,d.X4)(c.palette.primary.main,.05):"dark"===c.palette.mode?"rgba(0, 0, 0, 0.2)":"rgba(0, 0, 0, 0.02)"}},onClick:()=>{if(e.total_trades>0){const t=r.filter((t=>{var r,o;return(null===(r=t.session)||void 0===r?void 0:r.toLowerCase())===(null===(o=e.session)||void 0===o?void 0:o.toLowerCase())&&("month"===a?(0,R.A)(new Date(t.trade_date),n):"year"!==a||new Date(t.trade_date).getFullYear()===n.getFullYear())}));o({open:!0,trades:t,tradeIds:t.map((e=>e.id)),title:"".concat(e.session," Session Trades"),expandedTradeId:1===t.length?t[0].id:null})}},children:[(0,re.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{color:p[e.session]},children:e.session}),(0,re.jsxs)(u.A,{spacing:1,children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Total Trades"}),(0,re.jsx)(l.A,{variant:"body2",children:e.total_trades})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Win Rate"}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:(null!==(t=e.win_rate)&&void 0!==t?t:0)>=50?c.palette.success.main:c.palette.error.main},children:[(null!==(s=e.win_rate)&&void 0!==s?s:0).toFixed(1),"%"]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"P&L"}),(0,re.jsx)(l.A,{variant:"body2",sx:{color:e.total_pnl>0?c.palette.success.main:c.palette.error.main,fontWeight:500},children:(0,G.Fl)(e.total_pnl)})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Avg P&L per Trade"}),(0,re.jsx)(l.A,{variant:"body2",sx:{ml:1,color:e.averagePnL>0?c.palette.success.main:c.palette.error.main},children:(0,G.Fl)(e.averagePnL)})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Account %"}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:(null!==(m=e.pnlPercentage)&&void 0!==m?m:0)>0?c.palette.success.main:c.palette.error.main},children:[(null!==(x=e.pnlPercentage)&&void 0!==x?x:0).toFixed(2),"%"]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:1,mt:1},children:[(0,re.jsx)(i.A,{sx:{flex:e.winners,height:6,bgcolor:g,borderRadius:1}}),(0,re.jsx)(i.A,{sx:{flex:e.losers,height:6,bgcolor:h,borderRadius:1}})]}),(0,re.jsx)(i.A,{sx:{height:3,bgcolor:(0,d.X4)(p[e.session],.2),borderRadius:1,mt:1}})]})]},e.session)}))}),t.some((e=>e.total_trades>0))&&(0,re.jsxs)(i.A,{sx:{p:2,bgcolor:"dark"===c.palette.mode?"rgba(33, 150, 243, 0.1)":"rgba(33, 150, 243, 0.05)",border:"1px solid ".concat((0,d.X4)(c.palette.info.main,.2)),borderRadius:2,mt:1},children:[(0,re.jsx)(l.A,{variant:"subtitle2",sx:{color:c.palette.info.main,fontWeight:600,mb:1,display:"flex",alignItems:"center",gap:1},children:"\ud83d\udca1 Pro Tip"}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:(()=>{const e=t.filter((e=>e.total_trades>0));if(0===e.length)return"No trading data available for analysis.";const r=e.reduce(((e,t)=>t.total_pnl>e.total_pnl?t:e)),n=e.reduce(((e,t)=>t.win_rate>e.win_rate?t:e)),a=e.reduce(((e,t)=>t.averagePnL>e.averagePnL?t:e));var o,s,i;if(r.total_pnl>0)return r.session===n.session&&r.session===a.session?"".concat(r.session," session is your strongest performer with the highest total P&L (").concat((0,G.Fl)(r.total_pnl),"), best win rate (").concat((null!==(o=r.win_rate)&&void 0!==o?o:0).toFixed(1),"%), and highest average per trade (").concat((0,G.Fl)(r.averagePnL),"). Consider focusing more trades during this session."):r.session===n.session?"".concat(r.session," session has both the highest total P&L (").concat((0,G.Fl)(r.total_pnl),") and best win rate (").concat((null!==(s=r.win_rate)&&void 0!==s?s:0).toFixed(1),"%). ").concat(a.session," session has the best average per trade (").concat((0,G.Fl)(a.averagePnL),")."):"".concat(r.session," session is most profitable overall (").concat((0,G.Fl)(r.total_pnl),"), while ").concat(n.session," session has the highest win rate (").concat((null!==(i=n.win_rate)&&void 0!==i?i:0).toFixed(1),"%). Consider analyzing what makes each session successful.");{const t=e.reduce(((e,t)=>t.total_pnl>e.total_pnl?t:e));return"All sessions are currently showing losses. ".concat(t.session," session has the smallest loss (").concat((0,G.Fl)(t.total_pnl),"). Consider reviewing your strategy and risk management.")}})()})]})]})]})};var Xn=r(66562),On=r(90668);const Bn=e=>{let{open:t,trades:r,title:n,subtitle:o,showChartInfo:c,expandedTradeId:d,onClose:u,onTradeExpand:p,account_balance:m,tradeOperations:x}=e;const{onZoomImage:f,onUpdateTradeProperty:y,onEditTrade:v,onDeleteTrade:A,onDeleteMultipleTrades:b,onOpenGalleryMode:j,calendarId:w,economicFilter:k,calendar:C}=x,S=(0,s.A)(),[_,T]=(0,a.useState)(0),[I,M]=(0,a.useState)("winRate");(0,a.useEffect)((()=>{(async()=>{if(t&&C&&r&&0!==r.length)try{const e=r.reduce(((e,t)=>new Date(t.trade_date)>new Date(e.trade_date)?t:e)),t=(0,$.b4)(e.trade_date);if(isNaN(t.getTime()))return ee.logger.warn("Invalid trade date, skipping cumulative P&L calculation"),void T(0);const n=await(0,Q.jp)(t,C);T(n)}catch(e){ee.logger.error("Error fetching cumulative P&L:",e),T(0)}})()}),[t,r,C]);const[E,z]=a.useState(void 0),D=a.useMemo((()=>{let e=!1,t=!1;return(r||[]).forEach((r=>{"win"===r.trade_type?e=!0:"loss"===r.trade_type&&(t=!0)})),{containWins:e,containLosses:t,containBoth:e&&t}}),[r]);a.useEffect((()=>{let e=!0;return(async()=>{if(!r||0===r.length)return void(e&&z(void 0));const t=await Promise.resolve(cn(r,S,"winRate"===I&&D.containBoth));if(e){const e=Array.isArray(t)?t.reduce(((e,t)=>e+(t.total_trades>0?1:0)),0):0;z(e>1?t:void 0)}})(),()=>{e=!1}}),[I,c,r,S]);const[R,W]=a.useState(0);a.useEffect((()=>{let e=!0;return(async()=>{const t=(r||[]).reduce(((e,t)=>e+t.amount),0);e&&W(t)})(),()=>{e=!1}}),[r]);const P=(null===r||void 0===r?void 0:r.length)||0,N=(0,re.jsx)(re.Fragment,{children:(0,re.jsxs)(l.A,{variant:"h6",children:[P," ",1===P?"Trade":"Trades",n?" for ".concat(n.toLowerCase()):""]})}),F=j&&P>0?(0,re.jsx)(g.A,{title:"View trades in gallery mode",children:(0,re.jsx)(h.A,{variant:"contained",size:"large",startIcon:(0,re.jsx)(H.A,{}),onClick:()=>{j&&r&&r.length>0&&(j(r,d||r[0].id,"".concat(n," - ").concat(r.length," Trade").concat(r.length>1?"s":"")),u())},sx:{textTransform:"none",fontWeight:600,borderRadius:1.5,px:3},children:"Gallery View"})}):void 0;return(0,re.jsx)(K.mY,{open:t,onClose:u,maxWidth:"sm",fullWidth:!0,title:N,actions:F,children:(0,re.jsxs)(i.A,{sx:{p:2},children:[(0,re.jsx)(On.A,{title:o||"",account_balance:m+_,formInputVisible:!0,total_pnl:R,onPrevDay:()=>{},onNextDay:()=>{}}),E&&(0,re.jsxs)(re.Fragment,{children:[D.containBoth&&(0,re.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,re.jsx)(h.A,{variant:"winRate"===I?"contained":"outlined",size:"small",onClick:()=>M("winRate"),sx:{textTransform:"none"},children:"Win Rate"}),(0,re.jsx)(h.A,{variant:"pnl"===I?"contained":"outlined",size:"small",onClick:()=>M("pnl"),sx:{textTransform:"none"},children:"P&L"})]}),E.some((e=>e.total_trades>0))?(0,re.jsx)(l.A,{variant:"body2",color:"primary",sx:{mt:1,fontWeight:500},children:D.containBoth&&"winRate"===I?"Best day for selected strategies: ".concat(E.reduce(((e,t)=>t.total_trades>0&&t.win_rate>e.win_rate?t:e),{win_rate:0,fullDay:"None"}).fullDay):"Most profitable/un-profitable day: ".concat(E.reduce(((e,t)=>t.total_trades>0&&t.pnl>e.pnl?t:e),{pnl:-1/0,fullDay:"None"}).fullDay)}):null,(0,re.jsx)(Lr.u,{width:"100%",height:300,children:(0,re.jsxs)(fn.E,{data:E,margin:{top:20,right:30,left:20,bottom:5},maxBarSize:50,children:[(0,re.jsx)(Or.d,{strokeDasharray:"3 3",vertical:!1}),(0,re.jsx)(Br.W,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fill:S.palette.text.secondary,fontSize:12}}),(0,re.jsx)(Ur.h,{axisLine:!1,tickLine:!1,tick:{fill:S.palette.text.secondary,fontSize:12},domain:D.containBoth?[0,100]:["auto","auto"],tickFormatter:D.containBoth&&"winRate"===I?e=>"".concat(e,"%"):e=>(0,G.vv)(e).replace("$","")}),(0,re.jsx)(Yr.s,{}),(0,re.jsx)(qr.m,{content:e=>{let{active:t,payload:r,label:n}=e;if(t&&r&&r.length){const e=r[0].payload;return(0,re.jsxs)(ae.A,{sx:{p:1.5,bgcolor:"background.paper"},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:"bold"},children:e.fullDay}),(0,re.jsxs)(l.A,{variant:"body2",children:["Total Trades: ",e.total_trades]}),D.containWins&&(0,re.jsxs)(l.A,{variant:"body2",sx:{color:S.palette.success.main},children:["Wins: ",e.winTrades]}),D.containLosses&&(0,re.jsxs)(l.A,{variant:"body2",sx:{color:S.palette.error.main},children:["Losses: ",e.lossTrades]}),D.containBoth&&(0,re.jsxs)(l.A,{variant:"body2",children:["Win Rate: ",e.win_rate.toFixed(1),"%"]}),(0,re.jsxs)(l.A,{variant:"body2",children:["P&L: ",(0,G.vv)(e.pnl)]})]})}return null}}),(0,re.jsx)(yn.y,{dataKey:"value",name:D.containBoth&&"winRate"===I?"Win Rate":"P&L",fill:S.palette.primary.main,radius:[4,4,0,0],style:{cursor:"pointer"},children:E.map(((e,t)=>(0,re.jsx)(vn.f,{fill:e.color},"cell-".concat(t))))})]})})]}),(0,re.jsx)(Xn.A,{sx:{mt:0},trades:r,expandedTradeId:d,onTradeClick:p,hideActions:!v&&!A,enableBulkSelection:P>1&&!!b,tradeOperations:x})]})})},Un=e=>{let{riskRewardStats:t}=e;const r=(0,s.A)();return 0===t.data.length?null:(0,re.jsxs)(ae.A,{sx:{p:2,mb:2,borderRadius:2},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{color:"text.secondary"},children:"Average RR"}),(0,re.jsx)(g.A,{title:"Average Risk to reward ratio (RR) per trade. An RR of 2 means that for every 1$ you risk you will make 2$.",arrow:!0,placement:"top",children:(0,re.jsx)(tn.A,{sx:{fontSize:16,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"h4",sx:{fontWeight:500,color:"text.primary"},children:t.average.toFixed(2)})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{color:"text.secondary"},children:"Max RR"}),(0,re.jsx)(g.A,{title:"Maximum Risk to reward Ratio between all your trades. You can use the small graph at the bottom of this card to see the RR of every one of your trades.",arrow:!0,placement:"top",children:(0,re.jsx)(tn.A,{sx:{fontSize:16,color:"text.secondary",opacity:.7,cursor:"help"}})})]}),(0,re.jsx)(l.A,{variant:"h4",sx:{fontWeight:500,color:"text.primary"},children:t.max.toFixed(2)})]})]}),(0,re.jsx)(i.A,{sx:{height:60,mt:2},children:(0,re.jsx)(Lr.u,{width:"100%",height:"100%",children:(0,re.jsxs)(Xr.Q,{data:t.data,margin:{top:0,right:0,left:0,bottom:0},children:[(0,re.jsx)("defs",{children:(0,re.jsxs)("linearGradient",{id:"rrGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,re.jsx)("stop",{offset:"5%",stopColor:r.palette.primary.main,stopOpacity:.3}),(0,re.jsx)("stop",{offset:"95%",stopColor:r.palette.primary.main,stopOpacity:0})]})}),(0,re.jsx)(Gr.G,{type:"monotone",dataKey:"rr",stroke:r.palette.primary.main,strokeWidth:2,fill:"url(#rrGradient)",dot:!1})]})})})]})};var qn=r(3353),Gn=r(64321),Hn=r(59168);const Yn=function(e){return e?"https://flagcdn.com/".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"w40","/").concat(e.toLowerCase(),".png"):""},Vn=e=>{let{calendarId:t,trades:r,timePeriod:o,selectedDate:g,setMultipleTradesDialog:h,economicCorrelations:p}=e;const m=(0,s.A)(),[x,f]=(0,a.useState)("High"),[v,A]=(0,a.useState)("ALL"),[b,j]=(0,a.useState)([]),[w,k]=(0,a.useState)([]),[C,S]=(0,a.useState)({totalLosingTrades:0,totalWinningTrades:0,highImpactLossCorrelationRate:0,mediumImpactLossCorrelationRate:0,anyEventLossCorrelationRate:0,highImpactWinCorrelationRate:0,mediumImpactWinCorrelationRate:0,anyEventWinCorrelationRate:0,losingTradesWithHighImpact:0,losingTradesWithMediumImpact:0,losingTradesWithAnyEvents:0,winningTradesWithHighImpact:0,winningTradesWithMediumImpact:0,winningTradesWithAnyEvents:0,avgLossWithEvents:0,avgLossWithoutEvents:0,avgWinWithEvents:0,avgWinWithoutEvents:0,mostCommonEventTypes:[]}),[_,T]=(0,a.useState)(!1),I=[{label:"High",value:"High"},{label:"Medium",value:"Medium"}],M=[{value:"ALL",label:"All Currencies"},...(0,a.useMemo)((()=>{const e=r.map((e=>e.tags)).flat().filter((e=>null===e||void 0===e?void 0:e.includes("pair:"))).map((e=>null===e||void 0===e?void 0:e.split(":")[1])).filter((e=>void 0!==e)).map((e=>(0,Hn.Jl)(e))).flat();return Array.from(new Set(e))}),[r]).map((e=>({value:e,label:e})))];(0,a.useEffect)((()=>{if(!p)return j([]),k([]),void S({});const e="High"===x?p.high:p.medium;if(!e)return j([]),k([]),void S({});const t=e=>"ALL"===v?e:e.map((e=>{var t;return(0,n.A)((0,n.A)({},e),{},{economic_events:(null===(t=e.economic_events)||void 0===t?void 0:t.filter((e=>e.currency===v)))||[]})})).filter((e=>e.economic_events.length>0));j(t(e.losingTradeCorrelations||[])),k(t(e.winningTradeCorrelations||[])),S(e.correlationStats||{})}),[p,x,v]);const E=(0,a.useMemo)((()=>r.filter((e=>"loss"===e.trade_type))),[r]),z=(0,a.useMemo)((()=>r.filter((e=>"win"===e.trade_type))),[r]);if(0===E.length&&0===z.length)return(0,re.jsxs)(ae.A,{sx:{p:3,mb:3},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,re.jsx)(bt.A,{sx:{mr:1,color:m.palette.primary.main}}),(0,re.jsx)(l.A,{variant:"h6",children:"Economic Event Correlation Analysis"})]}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No trades found for the selected period."})]});return(0,re.jsx)(ae.A,{sx:{mb:3},children:(0,re.jsxs)(i.A,{sx:{p:3},children:[(0,re.jsxs)(u.A,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2,gap:2},children:[(0,re.jsx)(u.A,{direction:"row",alignItems:"center",spacing:2,sx:{flex:1},children:(0,re.jsxs)(l.A,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,color:m.palette.text.primary,fontWeight:600},children:[(0,re.jsx)(bt.A,{sx:{color:m.palette.primary.main}}),"Economic Event Correlation Analysis"]})}),(0,re.jsx)(Kr.A,{tabs:I,activeTab:(D=x,I.findIndex((e=>e.value===D))),onTabChange:(e,t)=>{var r;const n=null===(r=I[t])||void 0===r?void 0:r.value;n&&f(n)},size:"small"}),(0,re.jsxs)(ye.A,{size:"small",sx:{minWidth:120},children:[(0,re.jsx)(qn.A,{children:"Currency"}),(0,re.jsx)(ve.A,{value:v,onChange:e=>{A(e.target.value)},label:"Currency",children:M.map((e=>(0,re.jsx)(Ae.A,{value:e.value,children:e.label},e.value)))})]})]}),(0,re.jsxs)(y.A,{severity:"info",sx:{mb:2,backgroundColor:(0,d.X4)(m.palette.info.main,.1),"& .MuiAlert-icon":{color:m.palette.info.main}},children:["This analysis correlates your trades with economic events that occurred during the same trading sessions to help identify patterns.","ALL"!==v&&(0,re.jsxs)(re.Fragment,{children:[" Currently filtering events for ",(0,re.jsx)("strong",{children:v})," currency."]})]}),_&&(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:4,gap:2},children:[(0,re.jsx)(Rt.A,{size:40}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Calculating economic event correlations..."})]}),!_&&(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)(l.A,{variant:"h6",sx:{mb:2,color:"error.main"},children:["Losing Trades - ",x," Impact Events"]}),(0,re.jsxs)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:2,mb:3},children:[(0,re.jsx)(Nt.A,{sx:{bgcolor:(0,d.X4)(m.palette.error.main,.1)},children:(0,re.jsxs)(Ft.A,{sx:{p:2,"&:last-child":{pb:2}},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,re.jsx)(_r.A,{sx:{color:m.palette.error.main,mr:1}}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Total Losing Trades"})]}),(0,re.jsx)(l.A,{variant:"h4",color:"error.main",children:C.totalLosingTrades||0})]})}),(0,re.jsx)(Nt.A,{sx:{bgcolor:(0,d.X4)("High"===x?m.palette.error.main:"Medium"===x?m.palette.warning.main:"Low"===x?m.palette.success.main:m.palette.secondary.main,.1)},children:(0,re.jsxs)(Ft.A,{sx:{p:2,"&:last-child":{pb:2}},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,re.jsx)(Gn.A,{sx:{color:"High"===x?m.palette.error.main:"Medium"===x?m.palette.warning.main:"Low"===x?m.palette.success.main:m.palette.secondary.main,mr:1}}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[x," Impact Events"]})]}),(0,re.jsxs)(l.A,{variant:"h4",sx:{color:"High"===x?"error.main":"Medium"===x?"warning.main":"Low"===x?"success.main":"secondary.main"},children:[(C.anyEventLossCorrelationRate||0).toFixed(1),"%"]}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[C.losingTradesWithEvents||0," trades"]})]})})]}),(0,re.jsxs)(l.A,{variant:"h6",sx:{mb:2,color:"success.main"},children:["Winning Trades - ",x," Impact Events"]}),(0,re.jsxs)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:2,mb:2},children:[(0,re.jsx)(Nt.A,{sx:{bgcolor:(0,d.X4)(m.palette.success.main,.1)},children:(0,re.jsxs)(Ft.A,{sx:{p:2,"&:last-child":{pb:2}},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,re.jsx)(oe.A,{sx:{color:m.palette.success.main,mr:1}}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Total Winning Trades"})]}),(0,re.jsx)(l.A,{variant:"h4",color:"success.main",children:C.totalWinningTrades||0})]})}),(0,re.jsx)(Nt.A,{sx:{bgcolor:(0,d.X4)("High"===x?m.palette.error.main:"Medium"===x?m.palette.warning.main:"Low"===x?m.palette.success.main:m.palette.secondary.main,.1)},children:(0,re.jsxs)(Ft.A,{sx:{p:2,"&:last-child":{pb:2}},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,re.jsx)(Gn.A,{sx:{color:"High"===x?m.palette.error.main:"Medium"===x?m.palette.warning.main:"Low"===x?m.palette.success.main:m.palette.secondary.main,mr:1}}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[x," Impact Events"]})]}),(0,re.jsxs)(l.A,{variant:"h4",sx:{color:"High"===x?"error.main":"Medium"===x?"warning.main":"Low"===x?"success.main":"secondary.main"},children:[(C.anyEventWinCorrelationRate||0).toFixed(1),"%"]}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[C.winningTradesWithEvents||0," trades"]})]})})]}),(0,re.jsxs)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},gap:2,mb:2},children:[(0,re.jsx)(Nt.A,{children:(0,re.jsxs)(Ft.A,{children:[(0,re.jsx)(l.A,{variant:"h6",sx:{mb:2},children:"Average Loss Comparison"}),(0,re.jsxs)(u.A,{spacing:2,children:[(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,re.jsx)(l.A,{variant:"body2",children:"With Economic Events"}),(0,re.jsx)(l.A,{variant:"body2",color:"error.main",children:(0,G.Fl)(C.avgLossWithEvents||0)})]}),(0,re.jsx)(c.A,{variant:"determinate",value:(C.avgLossWithEvents||0)>0?100:0,color:"error"})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,re.jsx)(l.A,{variant:"body2",children:"Without Economic Events"}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:(0,G.Fl)(C.avgLossWithoutEvents||0)})]}),(0,re.jsx)(c.A,{variant:"determinate",value:(C.avgLossWithoutEvents||0)>0?(C.avgLossWithoutEvents||0)/Math.max(C.avgLossWithEvents||0,C.avgLossWithoutEvents||0)*100:0,color:"inherit"})]})]})]})}),(0,re.jsx)(Nt.A,{children:(0,re.jsxs)(Ft.A,{children:[(0,re.jsx)(l.A,{variant:"h6",sx:{mb:2},children:"Average Win Comparison"}),(0,re.jsxs)(u.A,{spacing:2,children:[(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,re.jsx)(l.A,{variant:"body2",children:"With Economic Events"}),(0,re.jsx)(l.A,{variant:"body2",color:"success.main",children:(0,G.Fl)(C.avgWinWithEvents||0)})]}),(0,re.jsx)(c.A,{variant:"determinate",value:(C.avgWinWithEvents||0)>0?100:0,color:"success"})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,re.jsx)(l.A,{variant:"body2",children:"Without Economic Events"}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:(0,G.Fl)(C.avgWinWithoutEvents||0)})]}),(0,re.jsx)(c.A,{variant:"determinate",value:(C.avgWinWithoutEvents||0)>0?(C.avgWinWithoutEvents||0)/Math.max(C.avgWinWithEvents||0,C.avgWinWithoutEvents||0)*100:0,color:"inherit"})]})]})]})})]}),(0,re.jsx)(Nt.A,{children:(0,re.jsxs)(Ft.A,{children:[(0,re.jsx)(l.A,{variant:"h6",sx:{mb:2},children:"Most Common Event Types"}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[(C.mostCommonEventTypes||[]).map(((e,t)=>{var r;return(0,re.jsx)(Nt.A,{variant:"outlined",sx:{flex:"1 1 300px",minWidth:300,maxWidth:400},children:(0,re.jsxs)(Ft.A,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[(0,re.jsx)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:(0,re.jsxs)(i.A,{sx:{flex:1},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(null===(r=e.economicEventDetails)||void 0===r?void 0:r.flagCode)&&(0,re.jsx)(i.A,{component:"img",src:Yn(e.economicEventDetails.flagCode),alt:e.economicEventDetails.flagCode||"flag",sx:{width:20,height:15,borderRadius:.5,objectFit:"cover"},onError:e=>{e.target.style.display="none"}}),(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:500,lineHeight:1.2},children:e.event})]}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem"},children:[e.count||0," trades \u2022 ",(e.win_rate||0).toFixed(1),"% win rate"]})]})}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:1.5,alignItems:"center"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,cursor:h&&(e.losingTrades||[]).length>0?"pointer":"default",p:.5,borderRadius:1,"&:hover":h&&(e.losingTrades||[]).length>0?{bgcolor:(0,d.X4)(m.palette.error.main,.08)}:{}},onClick:t=>{t.stopPropagation(),h&&(e.losingTrades||[]).length>0&&h({open:!0,trades:e.losingTrades||[],title:'Losing trades during "'.concat(e.event,'" events'),subtitle:"".concat((e.losingTrades||[]).length," losing trades \u2022 Avg loss: ").concat((0,G.Fl)(e.avg_loss))})},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:600,color:"error.main"},children:(e.losingTrades||[]).length}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"losses"}),(0,re.jsxs)(l.A,{variant:"caption",color:"error.main",sx:{fontSize:"0.7rem"},children:["(",(0,G.Fl)(e.avg_loss),")"]})]}),(0,re.jsx)(i.A,{sx:{width:"1px",height:"16px",bgcolor:"divider"}}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,cursor:h&&(e.winningTrades||[]).length>0?"pointer":"default",p:.5,borderRadius:1,"&:hover":h&&(e.winningTrades||[]).length>0?{bgcolor:(0,d.X4)(m.palette.success.main,.08)}:{}},onClick:t=>{t.stopPropagation(),h&&(e.winningTrades||[]).length>0&&h({open:!0,trades:e.winningTrades||[],title:'Winning trades during "'.concat(e.event,'" events'),subtitle:"".concat((e.winningTrades||[]).length," winning trades \u2022 Avg win: ").concat((0,G.Fl)(e.avg_win))})},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:600,color:"success.main"},children:(e.winningTrades||[]).length}),(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"wins"}),(0,re.jsxs)(l.A,{variant:"caption",color:"success.main",sx:{fontSize:"0.7rem"},children:["(",(0,G.Fl)(e.avg_win),")"]})]})]})]})},t)})),0===(C.mostCommonEventTypes||[]).length&&(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No common event types found"})]})]})})]})]})});var D};var Kn=r(15213),Jn=r(63393);const $n=[{label:"Month",value:"month"},{label:"Year",value:"year"},{label:"All Time",value:"all"}],Qn=[{label:"Tag Performance"},{label:"Day of Week"}],Zn=[{label:"Basic",value:"basic"},{label:"Advanced",value:"advanced"}],ea=e=>{var t,r;let{selectedDate:o,monthlyTarget:c,accountBalance:d,maxDailyDrawdown:u,calendarId:g,scoreSettings:p,tabSize:x,timePeriod:f,onTimePeriodChange:v,hideTimePeriodTabs:A=!1,onPrimaryTagsChange:b=()=>{},onSecondaryTagsChange:j=()=>{},onEditTrade:w,onDeleteTrade:k,onUpdateTradeProperty:C,onUpdateCalendarProperty:S,dynamicRiskSettings:_,onOpenGalleryMode:T,economicFilter:I,calendar:M,isReadOnly:E=!1}=e;const z=(0,s.A)(),D=(0,m.A)(z.breakpoints.down("sm")),R=(0,a.useMemo)((()=>({large:D?240:400,medium:D?180:260,pair:D?280:500})),[D]),W=(0,Kn.eq)(),N=(0,a.useRef)(0),[F,L]=(0,a.useState)("month"),X=null!==f&&void 0!==f?f:F,O=(0,a.useCallback)((e=>{void 0===f&&L(e),null===v||void 0===v||v(e)}),[f,v]),[B,U]=(0,a.useState)("basic"),[q,G]=(0,a.useState)(!1),[H,Y]=(0,a.useState)(0),[V,K]=(0,a.useState)([]),[J,$]=(0,a.useState)([]),[Q,Z]=(0,a.useState)([]),[ne,oe]=(0,a.useState)(!1),se=Q,[ie]=(0,a.useState)((()=>new Date)),le=(0,a.useMemo)((()=>o||ie),[o,ie]),ce=null!==(t=null!==d&&void 0!==d?d:null===M||void 0===M?void 0:M.account_balance)&&void 0!==t?t:0,de=null!==(r=null!==u&&void 0!==u?u:null===M||void 0===M?void 0:M.max_daily_drawdown)&&void 0!==r?r:0,ue=null!==c&&void 0!==c?c:null===M||void 0===M?void 0:M.monthly_target,ge=null!==p&&void 0!==p?p:null===M||void 0===M?void 0:M.score_settings,he=null!==_&&void 0!==_?_:M?{account_balance:M.account_balance,risk_per_trade:M.risk_per_trade,dynamic_risk_enabled:M.dynamic_risk_enabled,increased_risk_percentage:M.increased_risk_percentage,profit_threshold_percentage:M.profit_threshold_percentage}:void 0,pe=I||(()=>(null===M||void 0===M?void 0:M.economic_calendar_filters)||te.C);(0,a.useEffect)((()=>{"advanced"===B&&G(!0)}),[B]);const[me,xe]=(0,a.useState)({open:!1,trades:[],showChartInfo:!0,title:"",subtitle:"",expandedTradeId:null}),fe=(0,a.useMemo)((()=>se.map((e=>e.id)).join(",")),[se.map((e=>e.id)).join(",")]);(0,a.useEffect)((()=>{if(me.open&&me.trades&&me.trades.length>0){const e=new Map(se.map((e=>[e.id,e]))),t=me.trades.filter((t=>e.has(t.id))).map((t=>e.get(t.id)));if(0===t.length)return void xe((e=>(0,n.A)((0,n.A)({},e),{},{open:!1})));me.trades.map((e=>e.id)).join(",")!==t.map((e=>e.id)).join(",")&&xe((e=>(0,n.A)((0,n.A)({},e),{},{trades:t})))}}),[fe,me.open]);const[ye,ve]=(0,a.useState)(null),[Ae,be]=(0,a.useState)([]),[je,we]=(0,a.useState)(null),[ke,Ce]=(0,a.useState)(null),[Se,_e]=(0,a.useState)(null);(0,a.useEffect)((()=>{if(!g)return ee.logger.warn("PerformanceCharts - No calendar ID provided"),Z([]),be([]),we(null),void oe(!1);(async()=>{oe(!0),_e(null);try{const e=(e=>new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0,0)))(le),{data:t,error:r}=await gn.N.rpc("calculate_chart_data",{p_calendar_id:g,p_time_period:X,p_selected_date:e.toISOString()});if(r)throw ee.logger.error("Error calling calculate_chart_data RPC:",r),r;const a=((null===t||void 0===t?void 0:t.trades)||[]).map((e=>(0,n.A)((0,n.A)({},e),{},{trade_date:e.trade_date?new Date(e.trade_date):e.trade_date,created_at:e.created_at?new Date(e.created_at):e.created_at,updated_at:e.updated_at?new Date(e.updated_at):e.updated_at}))),o=(null===t||void 0===t?void 0:t.chartData)||[],s=(null===t||void 0===t?void 0:t.economicCorrelations)||{high:null,medium:null},i=(null===t||void 0===t?void 0:t.performanceMetrics)||{winLossStats:{},tagStats:[],dailySummaryData:[],riskRewardStats:{average:0,max:0,data:[]},sessionStats:[],allTags:[],winLossData:[]};Z(a);const l=new Map;a.forEach((e=>{const t=new Date(e.trade_date).toDateString();l.has(t)||l.set(t,[]),l.get(t).push(e)}));const c=(o||[]).map(((e,t,r)=>{const n=t>0?r[t-1].cumulativePnl:0,a=e.cumulativePnl-n,o=new Date(e.date),s=o.toDateString();return{date:(0,P.A)(o,"month"===X?"MM/dd":"MM/dd/yyyy"),pnl:e.pnl,cumulativePnL:e.cumulativePnl,isIncreasing:e.cumulativePnl>n,isDecreasing:e.cumulativePnl<n,dailyChange:a,isWin:e.pnl>0,isLoss:e.pnl<0,isBreakEven:0===e.pnl,trades:l.get(s)||[],fullDate:o}}));be(c),we(i),Ce(s)}catch(e){ee.logger.error("Error loading data:",e),_e(e instanceof Error?e.message:"Failed to load data"),Z([]),be([]),we(null),Ce(null)}finally{oe(!1)}})()}),[g,le,X,ce]),(0,a.useEffect)((()=>{if(null===W||void 0===W||!W.lastSyncEvent)return;const{type:e,trade:t,timestamp:r}=W.lastSyncEvent;if(r<=N.current)return;if(N.current=r,t.calendar_id!==g)return;const a=(0,Jn.b)(t);Z((r=>{switch(e){case"update":{const e=r.findIndex((e=>e.id===t.id));if(-1===e)return r;const n=[...r];return n[e]=a,ee.logger.log("\ud83d\udce1 PerformanceCharts: Synced trade update for ".concat(t.id)),n}case"insert":return r.some((e=>e.id===t.id))?r:(ee.logger.log("\ud83d\udce1 PerformanceCharts: Synced trade insert for ".concat(t.id)),[...r,a]);case"delete":{const e=r.filter((e=>e.id!==t.id));return e.length===r.length?r:(ee.logger.log("\ud83d\udce1 PerformanceCharts: Synced trade delete for ".concat(t.id)),e)}default:return r}})),xe((r=>{if(!r.open)return r;switch(e){case"update":{const e=r.trades.findIndex((e=>e.id===t.id));if(-1===e)return r;const o=[...r.trades];return o[e]=a,(0,n.A)((0,n.A)({},r),{},{trades:o})}case"insert":default:return r;case"delete":{const e=r.trades.filter((e=>e.id!==t.id));return e.length===r.trades.length?r:0===e.length?(0,n.A)((0,n.A)({},r),{},{open:!1,trades:[]}):(0,n.A)((0,n.A)({},r),{},{trades:e})}}}))}),[null===W||void 0===W?void 0:W.lastSyncEvent,g]);const Te=(0,a.useMemo)((()=>{const e=ln(se,le,X);return ee.logger.debug("PerformanceCharts - Filtered trades:",{totalTrades:se.length,filteredCount:e.length,selectedDate:le.toISOString(),timePeriod:X,calendarId:g}),e}),[se,le,X,g]),Ie=(null===je||void 0===je?void 0:je.riskRewardStats)||{average:0,max:0,data:[]},Me=(null===je||void 0===je?void 0:je.winLossStats)||{total_trades:0,win_rate:0,winners:{total:0,avgAmount:0,maxConsecutive:0,avgConsecutive:0},losers:{total:0,avgAmount:0,maxConsecutive:0,avgConsecutive:0},breakevens:{total:0,avgAmount:0}},Ee=(null===je||void 0===je?void 0:je.winLossData)||[],ze=(null===je||void 0===je?void 0:je.dailySummaryData)||[],De=(null===je||void 0===je||je.tagStats,(null===je||void 0===je?void 0:je.sessionStats)||[]),Re=(null===je||void 0===je?void 0:je.allTags)||[],We=(0,a.useMemo)((()=>void 0===ue||ce<=0?null:ue/100*ce),[ue,ce]),Pe=(0,a.useMemo)((()=>-de/100*ce),[de,ce]),Ne=(0,a.useCallback)((e=>{xe((t=>(0,n.A)((0,n.A)({},t),{},{expandedTradeId:t.expandedTradeId===e?null:e})))}),[]),Fe=(0,a.useCallback)(((e,t,r)=>{ve({selectetdImageIndex:r||0,allImages:t||[e]})}),[]),Le=(0,a.useCallback)(((e,t)=>{Y(t)}),[]),Xe=(0,a.useMemo)((()=>({onEditTrade:E?void 0:w,onDeleteTrade:E?void 0:k,onDeleteMultipleTrades:void 0,onUpdateTradeProperty:E?void 0:C,onZoomImage:Fe,onOpenGalleryMode:T,economicFilter:pe,calendarId:g,calendar:M,isTradeUpdating:void 0,isReadOnly:E})),[w,k,C,T,pe,g,M,E]),Oe=(0,a.useCallback)((e=>{let t=[],r="";if("Wins"===e||"Losses"===e){let n;t=Te.filter((t=>"Wins"===e&&"win"===t.trade_type||"Losses"===e&&"loss"===t.trade_type)),n="month"===X?(0,P.A)(le,"MMMM yyyy"):"year"===X?(0,P.A)(le,"yyyy"):"All Time",r="".concat(e," for ").concat(n)}else t=Te.filter((t=>{var r;return null===(r=t.tags)||void 0===r?void 0:r.includes(e)})),r="Trades with tag: ".concat(e);t.length>0&&xe({open:!0,trades:t,title:r,expandedTradeId:1===t.length?t[0].id:null})}),[Te,X,le]);return(0,re.jsxs)(i.A,{sx:{p:{xs:1,sm:2},minHeight:{xs:"auto",sm:500}},children:[ye&&(0,re.jsx)(xt.A,{open:!!ye,onClose:()=>ve(null),imageProp:ye}),me.open&&(0,re.jsx)(Bn,{open:me.open,trades:me.trades,title:me.title,expandedTradeId:me.expandedTradeId,showChartInfo:me.showChartInfo||!0,onClose:()=>xe((e=>(0,n.A)((0,n.A)({},e),{},{open:!1}))),onTradeExpand:Ne,account_balance:ce,tradeOperations:Xe}),(0,re.jsx)(i.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},gap:{xs:2,sm:0},mb:2},children:!A&&(0,re.jsx)(Kr.A,{tabs:$n,activeTab:(Be=X,$n.findIndex((e=>e.value===Be))),onTabChange:(e,t)=>{var r;const n=null===(r=$n[t])||void 0===r?void 0:r.value;var a;n&&(O(a=n),null===v||void 0===v||v(a))},size:x||"small",sx:{alignSelf:{xs:"center",sm:"auto"}}})}),(0,re.jsx)(i.A,{sx:{mb:2},children:(0,re.jsx)(Kr.A,{tabs:Zn,fullWidth:!0,activeTab:"basic"===B?0:1,onTabChange:(e,t)=>U(0===t?"basic":"advanced")})}),ne&&(0,re.jsx)(un,{height:R.large}),Se&&!ne&&(0,re.jsx)(y.A,{severity:"error",sx:{mb:3},action:(0,re.jsx)(h.A,{color:"inherit",size:"small",onClick:()=>{_e(null),we(null)},children:"Retry"}),children:(0,re.jsxs)(l.A,{variant:"body2",children:["Failed to calculate performance metrics: ",Se]})}),!ne&&Te.length>0?(0,re.jsxs)(re.Fragment,{children:["basic"===B&&(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(Un,{riskRewardStats:Ie}),(0,re.jsx)(Tn,{winLossStats:Me,trades:Te,onTradeClick:Ne}),(0,re.jsx)(kn,{chartData:Ae,targetValue:We,monthly_target:ue,drawdownViolationValue:Pe,setMultipleTradesDialog:xe,timePeriod:X}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:{xs:2,md:3},mb:3,height:{xs:"auto",md:R.pair}},children:[(0,re.jsx)(i.A,{sx:{flex:1,width:{xs:"100%",md:"50%"},height:{xs:R.large,md:"100%"}},children:(0,re.jsx)(_n,{winLossData:Ee,onPieClick:Oe})}),(0,re.jsx)(i.A,{sx:{flex:1,width:{xs:"100%",md:"50%"},height:{xs:R.large,md:"100%"}},children:(0,re.jsx)(Fn,{dailySummaryData:ze,trades:se,setMultipleTradesDialog:xe})})]})]}),("advanced"===B||q)&&(0,re.jsxs)(i.A,{sx:{display:"advanced"===B?"block":"none"},children:[(0,re.jsx)(sn,{trades:se,selectedDate:le,calendarId:g,scoreSettings:ge,onUpdateCalendarProperty:S,accountBalance:ce,dynamicRiskSettings:he,timePeriod:X}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,re.jsxs)(ae.A,{sx:{p:{xs:2,sm:3},mb:3,borderRadius:2},children:[(0,re.jsx)(i.A,{sx:{display:"flex",justifyContent:{xs:"center",sm:"space-between"},alignItems:"center",mb:2},children:(0,re.jsx)(Kr.A,{tabs:Qn,activeTab:H,onTabChange:Le,size:"small",sx:{maxWidth:{xs:"100%",sm:"none"}}})}),0===H&&(0,re.jsx)(Rn,{trades:se,selectedDate:le,timePeriod:X,allTags:Re,primaryTags:V,secondaryTags:J,setPrimaryTags:e=>{K(e),b(e)},setSecondaryTags:e=>{$(e),j(e)},setMultipleTradesDialog:xe}),1===H&&(0,re.jsx)(Wn,{trades:se,selectedDate:le,timePeriod:X,allTags:Re,primaryTags:V,secondaryTags:J,setPrimaryTags:e=>{K(e),b(e)},setSecondaryTags:e=>{$(e),j(e)},setMultipleTradesDialog:xe})]}),(0,re.jsx)(Ln,{sessionStats:De,trades:se,selectedDate:le,timePeriod:X,setMultipleTradesDialog:xe}),(0,re.jsx)(Vn,{calendarId:g,trades:Te,timePeriod:X,selectedDate:le,setMultipleTradesDialog:xe,economicCorrelations:ke})]})]})]}):ne?null:(0,re.jsx)(i.A,{sx:{height:{xs:R.medium,sm:300},display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"dark"===z.palette.mode?"rgba(0, 0, 0, 0.2)":"rgba(0, 0, 0, 0.02)",borderRadius:2,border:"1px solid ".concat(z.palette.divider)},children:(0,re.jsxs)(l.A,{color:"text.secondary",children:["No trading data available for ","month"===X?(0,P.A)(le,"MMMM yyyy"):"year"===X?(0,P.A)(le,"yyyy"):"All Time"]})})]});var Be},ta=a.memo(ea),ra=e=>{let{trades:t,accountBalance:r,onImportTrades:o,onDeleteTrade:c,currentDate:u=new Date,monthlyTarget:x,onClearMonthTrades:v,isReadOnly:A=!1,onOpenGalleryMode:b,calendarId:j,scoreSettings:w,dynamicRiskSettings:k,onUpdateTradeProperty:C,onUpdateCalendarProperty:S,onEditTrade:_,economicFilter:T,maxDailyDrawdown:I}=e;const[M,E]=(0,a.useState)(!1),[z,D]=(0,a.useState)(null),R=Boolean(z),[W,N]=(0,a.useState)(!1),[F,L]=(0,a.useState)(!1),[X,O]=(0,a.useState)("month"),B=(0,s.A)(),U=(0,m.A)(B.breakpoints.down("sm")),[q,Y]=(0,a.useState)(null),V=t.filter((e=>new Date(e.trade_date).getMonth()===u.getMonth()&&new Date(e.trade_date).getFullYear()===u.getFullYear())),K=V.reduce(((e,t)=>e+t.amount),0),J=V.filter((e=>"win"===e.trade_type)).length,$=V.filter((e=>"loss"===e.trade_type)).length,Z=V.length>0?(J/V.length*100).toFixed(1):"0",ee=V.filter((e=>"win"===e.trade_type)).reduce(((e,t)=>e+t.amount),0),te=Math.abs(V.filter((e=>"loss"===e.trade_type)).reduce(((e,t)=>e+t.amount),0)),ne=te>0?(ee/te).toFixed(2):ee>0?"\u221e":"0",le=(V.length>0&&(Math.abs(K)/V.length).toFixed(0),J>0&&(ee/J).toFixed(0),$>0&&(te/$).toFixed(0),new Map);V.forEach((e=>{const t=new Date(e.trade_date).toDateString();le.set(t,(le.get(t)||0)+e.amount)}));let ce=0,de="",ue=0,ge="";if(le.size>0){const e=Array.from(le.entries()),t=e.reduce(((e,t)=>t[1]>e[1]?t:e)),r=e.reduce(((e,t)=>t[1]<e[1]?t:e));ce=t[1],de=(0,P.A)(new Date(t[0]),"EEE d"),ue=r[1],ge=(0,P.A)(new Date(r[0]),"EEE d")}const pe=new Date(u.getFullYear(),u.getMonth(),1),me=t?(0,Q.eJ)(K,r,t,pe).toFixed(1):r>0?(K/r*100).toFixed(2):"0",xe=t.filter((e=>new Date(e.trade_date)<pe)),fe=r+xe.reduce(((e,t)=>e+t.amount),0),ye=(x&&x>0?Mt(V,r,x,pe,t):0).toFixed(0),ve=!!x&&parseFloat(me)>=x,be=()=>{D(null)},je=e=>{0!==V.length&&(_t(t,r,e),be())},[we,ke]=(0,a.useState)(!1),[Ce,_e]=(0,a.useState)(""),[Te,Ie]=(0,a.useState)("success"),Me=()=>{ke(!1)};return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)(ae.A,{elevation:2,sx:{p:{xs:1.5,sm:2},borderRadius:2,position:"relative",width:"100%",pb:{xs:4,sm:2.5},overflow:"hidden",height:"100%",minHeight:{xs:"280px",sm:"320px"}},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsx)(l.A,{variant:U?"subtitle1":"h6",sx:{mb:{xs:1,sm:2},fontWeight:600,pl:.5},children:"Monthly Performance"}),(0,re.jsxs)(i.A,{sx:{position:"static",display:"flex",gap:1,justifyContent:"flex-end",mb:2,flex:1,alignItems:"center"},children:[(0,re.jsx)("input",{type:"file",accept:".xlsx,.csv",style:{display:"none"},id:"import-file",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&o&&(be(),Y(r),N(!0),e.target.value="")}}),j&&(0,re.jsx)(g.A,{title:"View detailed performance analytics",arrow:!0,children:(0,re.jsx)(p.A,{onClick:()=>L(!0),size:"small",sx:{color:"primary.main",bgcolor:"background.paper",border:"1px solid",borderColor:(0,d.X4)(B.palette.primary.main,.3),"&:hover":{bgcolor:(0,d.X4)(B.palette.primary.main,.1),color:"primary.main",borderColor:"primary.main"}},children:(0,re.jsx)(bt.A,{})})}),V.length>0&&b&&(0,re.jsx)(g.A,{title:"View all trades for this month in gallery mode",arrow:!0,children:(0,re.jsx)(p.A,{onClick:()=>{if(V.length>0&&b){const e=(0,P.A)(u,"MMMM yyyy"),t="".concat(e," - Monthly Trades (").concat(V.length," trades)");b(V,V[0].id,t)}},size:"small",sx:{color:"primary.main",bgcolor:"background.paper",border:"1px solid",borderColor:(0,d.X4)(B.palette.primary.main,.3),"&:hover":{bgcolor:(0,d.X4)(B.palette.primary.main,.1),color:"primary.main",borderColor:"primary.main"}},children:(0,re.jsx)(H.A,{})})}),(0,re.jsx)(g.A,{title:"More options",children:(0,re.jsx)(p.A,{onClick:e=>{D(e.currentTarget)},size:"small",sx:{color:"text.secondary",bgcolor:"background.paper",border:"1px solid",borderColor:"divider","&:hover":{bgcolor:"action.hover",color:"text.primary",borderColor:"text.primary"}},children:(0,re.jsx)(jt.A,{})})}),(0,re.jsxs)(vt.A,{anchorEl:z,open:R,onClose:be,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[!A&&(0,re.jsxs)(Ae.A,{onClick:()=>{var e;return null===(e=document.getElementById("import-file"))||void 0===e?void 0:e.click()},children:[(0,re.jsx)(At.A,{children:(0,re.jsx)(wt.A,{fontSize:"small"})}),(0,re.jsx)(Se.A,{children:"Import Trades"})]}),(0,re.jsxs)(Ae.A,{onClick:()=>je("xlsx"),disabled:0===V.length,children:[(0,re.jsx)(At.A,{children:(0,re.jsx)(kt.A,{fontSize:"small"})}),(0,re.jsx)(Se.A,{children:"Export XLSX"})]}),(0,re.jsxs)(Ae.A,{onClick:()=>je("csv"),disabled:0===V.length,children:[(0,re.jsx)(At.A,{children:(0,re.jsx)(kt.A,{fontSize:"small"})}),(0,re.jsx)(Se.A,{children:"Export CSV"})]}),!A&&(0,re.jsxs)(Ae.A,{onClick:()=>{be(),E(!0)},disabled:0===V.length,sx:{color:"error.main"},children:[(0,re.jsx)(At.A,{children:(0,re.jsx)(Ct.A,{fontSize:"small",sx:{color:"error.main"}})}),(0,re.jsx)(Se.A,{children:"Clear Month"})]})]})]})]}),(0,re.jsxs)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:{xs:1,sm:1.25,md:1.5}},children:[(0,re.jsxs)(i.A,{sx:{p:{xs:1.25,sm:2},borderRadius:2,bgcolor:e=>(0,d.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:{xs:.25,sm:.5}},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,re.jsx)(oe.A,{sx:{fontSize:{xs:"1rem",sm:"1.2rem"},color:K>0?"success.main":K<0?"error.main":"text.secondary"}}),(0,re.jsx)(l.A,{variant:"body1",sx:{fontWeight:600,color:"text.secondary",fontSize:{xs:"0.9rem",sm:"1rem"}},children:"Monthly P&L"})]}),(0,re.jsxs)(l.A,{variant:U?"h6":"h5",sx:{fontWeight:700,color:K>0?"success.main":K<0?"error.main":"text.primary",display:"flex",alignItems:"baseline",gap:{xs:.25,sm:.5}},children:[(0,G.vv)(K),(0,re.jsx)(g.A,{title:"Percentage calculated based on account value at start of ".concat((0,P.A)(u,"MMMM"),": ").concat((0,G.vv)(fe)," (excluding this month's trades for consistent comparison)"),placement:"top",children:(0,re.jsxs)(l.A,{component:"span",sx:{fontSize:{xs:"0.875rem",sm:"1rem"},color:K>0?"success.main":K<0?"error.main":"text.primary",fontWeight:600,cursor:"help"},children:["(",me,"%)"]})})]}),x&&(0,re.jsxs)(i.A,{sx:{width:"100%",mt:1.5},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:500,color:"text.secondary"},children:"Target Progress"}),(0,re.jsxs)(l.A,{variant:"body2",sx:{fontWeight:600,color:ve?"success.main":"primary.main"},children:[ye,"%"]})]}),(0,re.jsx)(i.A,{sx:{width:"100%",height:{xs:"6px",sm:"8px"},bgcolor:e=>(0,d.X4)(e.palette.divider,.5),borderRadius:"4px",overflow:"hidden"},children:(0,re.jsx)(i.A,{sx:{width:"".concat(Math.max(Math.min(parseFloat(ye),100),0),"%"),height:"100%",bgcolor:ve?"success.main":"primary.main",transition:"width 0.3s ease"}})})]})]}),(0,re.jsxs)(i.A,{sx:{p:{xs:1.25,sm:2},borderRadius:2,bgcolor:e=>(0,d.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:{xs:.25,sm:.5}},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,re.jsx)(se.A,{sx:{fontSize:{xs:"1rem",sm:"1.2rem"},color:parseFloat(Z)>50?"success.main":"text.secondary"}}),(0,re.jsx)(l.A,{variant:"body1",sx:{fontWeight:600,color:"text.secondary",fontSize:{xs:"0.9rem",sm:"1rem"}},children:"Win Rate"})]}),(0,re.jsxs)(l.A,{variant:U?"h6":"h5",sx:{fontWeight:700,color:parseFloat(Z)>50?"success.main":"text.primary"},children:[Z,"%"]}),(0,re.jsxs)(l.A,{variant:"body1",sx:{fontWeight:500,color:"text.secondary",mt:.5,fontSize:{xs:"0.875rem",sm:"1rem"}},children:[J," Wins / ",$," Losses"]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[(0,re.jsx)(i.A,{sx:{height:{xs:"6px",sm:"10px"},bgcolor:"success.main",borderRadius:"5px",flex:J||1}}),(0,re.jsx)(i.A,{sx:{height:{xs:"6px",sm:"10px"},bgcolor:"error.main",borderRadius:"5px",flex:$||1}})]})]}),(0,re.jsxs)(i.A,{sx:{p:{xs:1.25,sm:2},borderRadius:2,bgcolor:e=>(0,d.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:{xs:.25,sm:.5}},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,re.jsx)(ie.A,{sx:{fontSize:{xs:"1rem",sm:"1.2rem"},color:"text.secondary"}}),(0,re.jsx)(l.A,{variant:"body1",sx:{fontWeight:600,color:"text.secondary",fontSize:{xs:"0.9rem",sm:"1rem"}},children:"Trading Activity"})]}),(0,re.jsxs)(l.A,{variant:U?"h6":"h5",sx:{fontWeight:700,color:"text.primary"},children:[V.length," Trade",1===V.length?"":"s"]}),(0,re.jsxs)(l.A,{variant:"body1",sx:{fontWeight:500,color:"text.secondary",mt:.5,fontSize:{xs:"0.875rem",sm:"1rem"}},children:[V.length>0?(V.length/30*100).toFixed(0):0,"% of Month Active"]})]}),(0,re.jsxs)(i.A,{sx:{p:{xs:1,sm:1.5},borderRadius:2,bgcolor:e=>(0,d.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:.25},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:600,color:"text.secondary",fontSize:"0.75rem"},children:"Started With"}),(0,re.jsx)(l.A,{variant:"h6",sx:{fontWeight:700,color:"text.primary",fontSize:"1rem"},children:(0,G.vv)(fe)})]}),(0,re.jsxs)(i.A,{sx:{p:{xs:1,sm:1.5},borderRadius:2,bgcolor:e=>(0,d.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:.25},children:[(0,re.jsxs)(l.A,{variant:"body2",sx:{fontWeight:600,color:"text.secondary",fontSize:"0.75rem"},children:["Best Day ",de&&(0,re.jsx)(l.A,{component:"span",sx:{color:"secondary.main",fontWeight:700,fontSize:"0.65rem"},children:de})]}),(0,re.jsx)(l.A,{variant:"h6",sx:{fontWeight:700,color:"success.main",fontSize:"1rem"},children:ce>0?(0,G.vv)(ce):"No trades"})]}),(0,re.jsxs)(i.A,{sx:{p:{xs:1,sm:1.5},borderRadius:2,bgcolor:e=>(0,d.X4)(e.palette.background.default,.5),display:"flex",flexDirection:"column",gap:.25},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:600,color:"text.secondary",fontSize:"0.75rem"},children:"Profit Factor"}),(0,re.jsx)(l.A,{variant:"h6",sx:{fontWeight:700,color:parseFloat(ne)>1?"success.main":"text.primary",fontSize:"1rem"},children:ne})]})]})]}),(0,re.jsxs)(We.A,{open:M,onClose:()=>E(!1),maxWidth:"xs",fullWidth:!0,children:[(0,re.jsx)(Pe.A,{children:"Clear Trades"}),(0,re.jsx)(Ne.A,{children:(0,re.jsx)(l.A,{children:"Are you sure you want to clear all trades? This action cannot be undone."})}),(0,re.jsxs)(Fe.A,{children:[(0,re.jsx)(h.A,{onClick:()=>E(!1),children:"Cancel"}),(0,re.jsx)(h.A,{onClick:()=>{v&&v(u.getMonth(),u.getFullYear()),E(!1)},color:"error",children:"Clear"})]})]}),(0,re.jsx)(f.A,{open:we,autoHideDuration:"success"===Te?3e3:6e3,onClose:Me,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,re.jsx)(y.A,{onClose:Me,severity:Te,variant:"filled",sx:{width:"100%"},children:Ce})}),(0,re.jsx)(mr,{open:W,onClose:()=>{N(!1),Y(null)},onImport:async e=>{if(o)try{await o(e),_e("Successfully imported ".concat(e.length," trades")),Ie("success"),ke(!0),N(!1),Y(null)}catch(t){_e("Failed to import trades. Please try again."),Ie("error"),ke(!0)}},file:q}),j&&(0,re.jsxs)(We.A,{open:F,onClose:()=>L(!1),maxWidth:"lg",fullWidth:!0,fullScreen:U,sx:{"& .MuiDialog-paper":{borderRadius:2,boxShadow:"none",border:"1px solid ".concat(B.palette.divider),maxHeight:"90vh",overflow:"hidden"},"& .MuiDialogContent-root":(0,n.A)({},(0,he.J)(B))},children:[(0,re.jsx)(Pe.A,{sx:{pb:1},children:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,re.jsxs)(l.A,{variant:"h6",children:["Performance Analytics for ","month"===X?(0,P.A)(u,"MMMM yyyy"):"year"===X?(0,P.A)(u,"yyyy"):"All Time"]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(Kr.A,{tabs:$n,activeTab:$n.findIndex((e=>e.value===X)),onTabChange:(e,t)=>O($n[t].value),size:"small"}),(0,re.jsx)(p.A,{onClick:()=>L(!1),size:"small",children:(0,re.jsx)(Ue.A,{})})]})]})}),(0,re.jsx)(Ne.A,{sx:{p:0},children:(0,re.jsx)(ta,{selectedDate:u,accountBalance:r,maxDailyDrawdown:I||0,monthlyTarget:x,calendarId:j,scoreSettings:w,dynamicRiskSettings:k,timePeriod:X,onTimePeriodChange:O,hideTimePeriodTabs:!0,onEditTrade:_,onDeleteTrade:c,onUpdateTradeProperty:C,onUpdateCalendarProperty:S,onOpenGalleryMode:b,economicFilter:T,isReadOnly:A})})]})]})};var na=r(31191);const aa=e=>{let{balance:t,trades:r,totalProfit:n,onPerformanceClick:o,risk_per_trade:s,dynamicRiskSettings:c,onToggleDynamicRisk:u,isDynamicRiskToggled:h=!0,isReadOnly:p=!1,max_daily_drawdown:m}=e;const x=r.length>0&&t>0?(n/t*100).toFixed(2):"0",f=(0,a.useMemo)((()=>{if(s)return null!==c&&void 0!==c&&c.dynamic_risk_enabled&&c.increased_risk_percentage&&c.profit_threshold_percentage&&parseFloat(x)>=c.profit_threshold_percentage?c.increased_risk_percentage:s}),[s,c,x]),y=t+n;return(0,re.jsxs)(ae.A,{elevation:2,sx:{display:"flex",flexDirection:"column",gap:1.5,p:2,borderRadius:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",position:"relative",overflow:"hidden",height:"100%",minHeight:"320px"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,re.jsx)(l.A,{variant:"h6",sx:{color:"text.primary",fontWeight:600,pl:1},children:"Account Balance"})}),(0,re.jsxs)(l.A,{sx:{fontSize:"1.5rem",fontWeight:700,color:"text.primary",display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(i.A,{component:"span",sx:{fontSize:"1.1rem",color:"text.secondary",fontWeight:500},children:"$"}),t.toLocaleString()]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:e=>(0,d.X4)(e.palette.background.default,.5),p:1.5,borderRadius:1.5,mt:.5},children:[(0,re.jsxs)(i.A,{children:[(0,re.jsx)(l.A,{variant:"body2",sx:{color:"text.secondary",mb:.5,fontWeight:500},children:"Current P&L"}),(0,re.jsxs)(l.A,{variant:"h6",sx:{fontSize:"1.2rem",color:n>0?"success.main":n<0?"error.main":"text.secondary",fontWeight:700,display:"flex",alignItems:"center",gap:.5},children:["$",r.length>0?Math.abs(n).toLocaleString():"0",(0,re.jsxs)(l.A,{component:"span",sx:{fontSize:"0.9rem",color:n>0?"success.main":n<0?"error.main":"text.secondary",fontWeight:600},children:["(",x,"%)"]})]})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsx)(l.A,{variant:"body2",sx:{color:"text.secondary",mb:.5,fontWeight:500,textAlign:"right"},children:"Total Value"}),(0,re.jsxs)(l.A,{variant:"h6",sx:{fontSize:"1.2rem",color:y>t?"success.main":y<t?"error.main":"text.secondary",fontWeight:700},children:["$",y.toLocaleString()]})]})]}),(0,re.jsx)(i.A,{sx:{display:"flex",flexDirection:"column",gap:1,pointerEvents:s?"auto":"none"},children:(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,width:"100%"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:e=>(0,d.X4)(e.palette.primary.main,s?.08:.03),p:1.5,borderRadius:1.5,flex:1,pointerEvents:s?"auto":"none"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(na.A,{sx:{fontSize:"1rem",color:s?"primary.main":"text.disabled"}}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:s?"text.secondary":"text.disabled",fontWeight:500,fontSize:{xs:"0.75rem",md:"0.8125rem"}},children:["Risk (",f||0,"%)",s&&(null===c||void 0===c?void 0:c.dynamic_risk_enabled)&&f!==s&&(0,re.jsx)(i.A,{component:"span",sx:{ml:.5,color:"success.main",fontSize:"0.65rem",fontWeight:700},children:"UP"}),!s&&(0,re.jsx)(i.A,{component:"span",sx:{ml:1,color:"text.disabled",fontSize:"0.65rem",fontWeight:600},children:"(N/A)"})]})]}),(0,re.jsxs)(l.A,{variant:"body1",sx:{fontWeight:600,color:s?"primary.main":"text.disabled",fontSize:{xs:"0.9rem",md:"1rem"}},children:["$",f?(y*f/100).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:e=>(0,d.X4)(e.palette.error.main,m?.08:.03),p:1.5,borderRadius:1.5,flex:1,pointerEvents:m?"auto":"none"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(_r.A,{sx:{fontSize:"1rem",color:m?"error.main":"text.disabled"}}),(0,re.jsxs)(l.A,{variant:"body2",sx:{color:m?"text.secondary":"text.disabled",fontWeight:500,fontSize:{xs:"0.75rem",md:"0.8125rem"}},children:["Daily DD (",m||0,"%)",!m&&(0,re.jsx)(i.A,{component:"span",sx:{ml:1,color:"text.disabled",fontSize:"0.65rem",fontWeight:600},children:"(N/A)"})]})]}),(0,re.jsxs)(l.A,{variant:"body1",sx:{fontWeight:600,color:m?"error.main":"text.disabled",fontSize:{xs:"0.9rem",md:"1rem"}},children:["$",m?(y*m/100).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"]})]})]})}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:1,backgroundColor:e=>(0,d.X4)(e.palette.background.default,null!==c&&void 0!==c&&c.dynamic_risk_enabled?.5:.2),p:1,mt:1,borderRadius:1.5,fontSize:"0.75rem",opacity:null!==c&&void 0!==c&&c.dynamic_risk_enabled&&c.profit_threshold_percentage&&c.increased_risk_percentage?1:.5,pointerEvents:null!==c&&void 0!==c&&c.dynamic_risk_enabled&&c.profit_threshold_percentage&&c.increased_risk_percentage?"auto":"none"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(l.A,{variant:"caption",sx:{color:null!==c&&void 0!==c&&c.dynamic_risk_enabled?"text.secondary":"text.disabled"},children:["Dynamic Risk: ",null!==c&&void 0!==c&&c.dynamic_risk_enabled&&c.profit_threshold_percentage&&parseFloat(x)>=c.profit_threshold_percentage?(0,re.jsx)(i.A,{component:"span",sx:{color:"success.main",fontWeight:600},children:"Active"}):null!==c&&void 0!==c&&c.dynamic_risk_enabled?(0,re.jsx)(i.A,{component:"span",sx:{color:"text.secondary",fontWeight:600},children:"Inactive"}):(0,re.jsx)(i.A,{component:"span",sx:{color:"text.disabled",fontWeight:600},children:"Not Configured"})]}),(0,re.jsxs)(l.A,{variant:"caption",sx:{color:null!==c&&void 0!==c&&c.dynamic_risk_enabled?"text.secondary":"text.disabled"},children:["Threshold: ",(null===c||void 0===c?void 0:c.profit_threshold_percentage)||0,"% profit"]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(be.A,{control:(0,re.jsx)(je.A,{checked:h,onChange:p?void 0:e=>{u&&u(e.target.checked)},disabled:p||!(null!==c&&void 0!==c&&c.dynamic_risk_enabled),size:"small",color:"primary"}),label:(0,re.jsx)(l.A,{variant:"caption",sx:{color:null!==c&&void 0!==c&&c.dynamic_risk_enabled?"text.secondary":"text.disabled"},children:h?"Using actual trade amounts":"Using calculated amounts"}),sx:{m:0}}),(0,re.jsx)(g.A,{title:(0,re.jsxs)(i.A,{children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"\ud83c\udfaf Why This Tool Matters"}),(0,re.jsxs)(l.A,{variant:"body2",sx:{mb:1},children:[(0,re.jsx)("strong",{children:"Discover your true potential:"})," See how much more profitable you could be with consistent risk management"]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{mb:1},children:[(0,re.jsx)("strong",{children:"Identify position sizing issues:"})," Compare your actual trades vs. what optimal risk sizing would look like"]}),(0,re.jsxs)(l.A,{variant:"body2",sx:{mb:1},children:[(0,re.jsx)("strong",{children:"Improve your discipline:"})," Understand the impact of inconsistent position sizes on your overall performance"]}),(0,re.jsx)(l.A,{variant:"body2",sx:{color:"success.main",fontWeight:"bold"},children:"\ud83d\udcb0 Many traders discover they could be 20-50% more profitable with better risk management!"})]}),arrow:!0,placement:"top",enterDelay:300,leaveDelay:200,children:(0,re.jsx)(tn.A,{sx:{fontSize:16,color:null!==c&&void 0!==c&&c.dynamic_risk_enabled?"text.secondary":"text.disabled",cursor:"help","&:hover":null!==c&&void 0!==c&&c.dynamic_risk_enabled?{color:"primary.main"}:{}}})})]})]})]})},oa=a.memo(aa);var sa=r(9475),ia=r(32396),la=r(33539),ca=r(30838),da=r(83491);const ua=e=>{let{open:t,onClose:r,calendarId:n,onTradeClick:o,tradeOperations:c}=e;const{calendar:h}=c,m=(0,s.A)(),[x,f]=(0,a.useState)(0),[y,v]=(0,a.useState)(""),[A,j]=(0,a.useState)(null),[w,k]=(0,a.useState)(!1),[C,S]=(0,a.useState)([]),[_,T]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{if(t&&n){T(!0);try{const e=await it.getTradeRepository().fetchPinnedTrades(n);S(e),ee.logger.log("\ud83d\udccc Loaded ".concat(e.length," pinned trades from database"))}catch(e){ee.logger.error("Error loading pinned trades:",e),S([])}finally{T(!1)}}})()}),[t,n]);const M=(0,a.useMemo)((()=>(null===h||void 0===h?void 0:h.pinned_events)||[]),[null===h||void 0===h?void 0:h.pinned_events]),E=(0,a.useMemo)((()=>[...C].sort(((e,t)=>new Date(t.trade_date).getTime()-new Date(e.trade_date).getTime()))),[C]),D=(0,a.useMemo)((()=>{if(!y.trim())return E;const e=y.toLowerCase().trim();return E.filter((t=>{var r,n,a,o,s;return!(null===(r=t.name)||void 0===r||!r.toLowerCase().includes(e))||(!(null===(n=t.tags)||void 0===n||!n.some((t=>t.toLowerCase().includes(e))))||(!(null===(a=t.session)||void 0===a||!a.toLowerCase().includes(e))||(!(null===(o=t.economic_events)||void 0===o||!o.some((t=>t.name.toLowerCase().includes(e))))||!(null===(s=t.notes)||void 0===s||!s.toLowerCase().includes(e)))))}))}),[E,y]),R=(0,a.useMemo)((()=>{if(!y.trim())return M;const e=y.toLowerCase().trim();return M.filter((t=>{var r;return!!t.event.toLowerCase().includes(e)||!(null===(r=t.notes)||void 0===r||!r.toLowerCase().includes(e))}))}),[M,y]);return(0,re.jsxs)(qe.A,{open:t,onClose:r,title:0===x?"Pinned Trades":"Pinned Events",icon:0===x?(0,re.jsx)(I.A,{}):(0,re.jsx)(z.A,{}),width:{xs:"100%",sm:400},headerVariant:"enhanced",contentSx:(0,he.J)(m),children:[(0,re.jsx)(i.A,{sx:{p:2,borderBottom:"1px solid ".concat((0,d.X4)(m.palette.divider,.1))},children:(0,re.jsx)(Kr.A,{tabs:[{label:"Trades"},{label:"Events"}],activeTab:x,onTabChange:(e,t)=>{f(t),v("")},fullWidth:!0,size:"medium"})}),(0,re.jsx)(i.A,{sx:{p:2,borderBottom:"1px solid ".concat((0,d.X4)(m.palette.divider,.1)),backgroundColor:(0,d.X4)(m.palette.background.paper,.3)},children:(0,re.jsx)(xe.A,{fullWidth:!0,size:"small",placeholder:0===x?"Search pinned trades...":"Search pinned events...",value:y,onChange:e=>v(e.target.value),InputProps:{startAdornment:(0,re.jsx)(fe.A,{position:"start",children:(0,re.jsx)(_e.A,{sx:{fontSize:20,color:"text.secondary"}})}),endAdornment:y&&(0,re.jsx)(fe.A,{position:"end",children:(0,re.jsx)(p.A,{size:"small",onClick:()=>v(""),sx:{color:"text.secondary"},children:(0,re.jsx)(b.A,{sx:{fontSize:18}})})})},sx:{"& .MuiOutlinedInput-root":{backgroundColor:(0,d.X4)(m.palette.background.paper,.5),"&:hover":{backgroundColor:(0,d.X4)(m.palette.background.paper,.8)},"&.Mui-focused":{backgroundColor:m.palette.background.paper}}}})}),(0,re.jsx)(i.A,{sx:{flex:1},children:0===x?_?(0,re.jsx)(st,{count:6,containerSx:{p:2}}):0===E.length?(0,re.jsxs)(i.A,{sx:{p:4,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,re.jsx)(I.A,{sx:{fontSize:64,color:"text.disabled",mb:2}}),(0,re.jsx)(l.A,{variant:"h6",sx:{mb:1,fontWeight:600,color:"text.secondary"},children:"No Pinned Trades"}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",maxWidth:300},children:"Pin important trades to keep them easily accessible. Open any trade and click the pin button to add trades here."})]}):0===D.length?(0,re.jsxs)(i.A,{sx:{p:4,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,re.jsx)(_e.A,{sx:{fontSize:64,color:"text.disabled",mb:2}}),(0,re.jsx)(l.A,{variant:"h6",sx:{mb:1,fontWeight:600,color:"text.secondary"},children:"No Matching Trades"}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",maxWidth:300},children:['No pinned trades match your search query "',y,'". Try adjusting your search terms.']})]}):(0,re.jsx)(u.A,{spacing:2,sx:{p:2},children:D.map((e=>(0,re.jsx)(at.A,{trade:e,showTags:!0,onClick:()=>null===o||void 0===o?void 0:o(e,D,"Pinned Trades")},e.id)))}):0===M.length?(0,re.jsxs)(i.A,{sx:{p:4,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,re.jsx)(z.A,{sx:{fontSize:64,color:"text.disabled",mb:2}}),(0,re.jsx)(l.A,{variant:"h6",sx:{mb:1,fontWeight:600,color:"text.secondary"},children:"No Pinned Events"}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",maxWidth:300},children:"Pin important economic events from the calendar to track trades that occurred during those events."})]}):0===R.length?(0,re.jsxs)(i.A,{sx:{p:4,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,re.jsx)(_e.A,{sx:{fontSize:64,color:"text.disabled",mb:2}}),(0,re.jsx)(l.A,{variant:"h6",sx:{mb:1,fontWeight:600,color:"text.secondary"},children:"No Matching Events"}),(0,re.jsxs)(l.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",maxWidth:300},children:['No pinned events match your search query "',y,'". Try adjusting your search terms.']})]}):(0,re.jsx)(ke.A,{sx:{p:0},children:R.map(((e,t)=>{const r=((e,t)=>{switch(e){case"High":return t.palette.error.main;case"Medium":return t.palette.warning.main;case"Low":return t.palette.success.main;default:return t.palette.text.secondary}})(e.impact,m);return(0,re.jsxs)(a.Fragment,{children:[(0,re.jsx)(Ce.Ay,{disablePadding:!0,children:(0,re.jsx)(Re.A,{onClick:()=>(e=>{if(!h||!e.event_id)return void ee.logger.warn("Pinned event does not have event_id. Please re-pin the event to get the latest data.");const t={id:e.event_id,event_name:e.event,currency:e.currency||"USD",impact:e.impact||"Medium",flag_url:e.flag_url,country:e.country,actual_result_type:"",event_time:"",time_utc:"",actual_value:"",forecast_value:"",previous_value:"",event_date:""};j(t),k(!0)})(e),sx:{p:2,backgroundColor:(0,d.X4)(r,.03),borderLeft:"3px solid ".concat(r),"&:hover":{backgroundColor:(0,d.X4)(r,.08)}},children:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1.5,width:"100%"},children:[e.flag_url?(0,re.jsx)("img",{src:e.flag_url,alt:e.country||e.currency||"",style:{width:32,height:24,borderRadius:4,objectFit:"cover"}}):(0,re.jsx)(la.A,{sx:{width:32,height:32,backgroundColor:(0,d.X4)(r,.1),color:r},children:(0,re.jsx)(z.A,{sx:{fontSize:18}})}),(0,re.jsx)(i.A,{sx:{flex:1,minWidth:0},children:(0,re.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:600,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",mb:.5},children:e.event})}),e.notes&&(0,re.jsx)(g.A,{title:e.notes,arrow:!0,placement:"top",children:(0,re.jsx)(ca.A,{sx:{fontSize:18,color:(0,d.X4)(m.palette.info.main,.7),cursor:"pointer"}})})]})})}),t<R.length-1&&(0,re.jsx)(we.A,{})]},e.event)}))})}),A&&h&&(0,re.jsx)(da.A,{open:w,onClose:()=>{k(!1),j(null)},event:A,calendarId:h.id,tradeOperations:c})]})};var ga=r(59526),ha=r(92490),pa=r(22038),ma=r(19934),xa=r(3377),fa=r(58315),ya=r(99161),va=r(27496),Aa=r(96590),ba=r(28262),ja=r(75576),wa=r(62720);const ka=e=>{var t,r,o;let{open:c,onClose:u,trades:h,initialTradeId:m,setZoomedImage:x,title:f="Trade Gallery",calendarId:v,calendar:A,aiOnlyMode:b=!1,isReadOnly:j=!1,fetchYear:w,tradeOperations:C}=e;const{onUpdateTradeProperty:S,onOpenGalleryMode:_,onEditTrade:T,onDeleteTrade:I,onDeleteMultipleTrades:M,onUpdateCalendarProperty:z,isTradeUpdating:D}=C,R=(0,Kn.eq)(),W=(0,a.useRef)(0),N=(0,s.A)(),{user:F}=(0,Ye.h)(),L=(0,a.useRef)(null),[X,O]=(0,a.useState)(b?1:0),[B,U]=(0,a.useState)([]),[q,G]=(0,a.useState)(!1),[H,Y]=(0,a.useState)(!1),[V,K]=(0,a.useState)(1),J=void 0!==w&&null!==(t=null===A||void 0===A||null===(r=A.year_stats)||void 0===r||null===(o=r[w.toString()])||void 0===o?void 0:o.total_trades)&&void 0!==t?t:0,[$,Q]=(0,a.useState)(J),Z=0===h.length&&void 0!==w&&void 0!==v,te=Z?B:h,ne=(0,a.useMemo)((()=>{if(!m)return 0;const e=te.findIndex((e=>e.id===m));return e>=0?e:0}),[te,m]),[ae,oe]=(0,a.useState)(ne);(0,a.useEffect)((()=>{oe(ne)}),[ne]);const se=(0,a.useMemo)((()=>0===te.length?0:Math.min(Math.max(0,ae),te.length-1)),[ae,te.length]),ie=(0,a.useMemo)((()=>0===te.length?null:te[se]||null),[te,se]);(0,a.useEffect)((()=>{(async()=>{if(Z&&c&&v&&void 0!==w&&!(B.length>0)){G(!0);try{const e=await(0,it.getTradeRepository)().getTradesForYearPaginated(v,w,1,20);U(e.trades),Y(e.hasMore),K(1),Q(e.totalCount),oe(0),ee.logger.log("\ud83d\udcd6 Gallery: Initial fetch - ".concat(e.trades.length," trades, hasMore: ").concat(e.hasMore,", total: ").concat(e.totalCount))}catch(e){ee.logger.error("Error fetching initial trades:",e)}finally{G(!1)}}})()}),[Z,c,v,w]);const le=(0,a.useCallback)((async()=>{if(Z&&!q&&H&&v&&void 0!==w){G(!0);try{const e=V+1,t=await(0,it.getTradeRepository)().getTradesForYearPaginated(v,w,e,20);U((e=>[...e,...t.trades])),Y(t.hasMore),K(e),ee.logger.log("\ud83d\udcd6 Gallery: Loaded page ".concat(e," - ").concat(t.trades.length," more trades, hasMore: ").concat(t.hasMore))}catch(e){ee.logger.error("Error loading more trades:",e)}finally{G(!1)}}}),[Z,q,H,v,w,V]);(0,a.useEffect)((()=>{if(!Z||!H||q)return;te.length-se-1<=1&&le()}),[se,te.length,Z,H,q,le]),(0,a.useEffect)((()=>{c||(U([]),K(1),Y(!1)),Q(J)}),[c,J]),(0,a.useEffect)((()=>{if(null===R||void 0===R||!R.lastSyncEvent||!c)return;const{type:e,trade:t,timestamp:r}=R.lastSyncEvent;if(r<=W.current)return;if(W.current=r,v&&t.calendar_id!==v)return;const n=(0,Jn.b)(t);Z&&U((r=>{switch(e){case"update":{const e=r.findIndex((e=>e.id===t.id));if(-1===e)return r;const a=[...r];return a[e]=n,ee.logger.log("\ud83d\udcd6 Gallery: Synced trade update for ".concat(t.id)),a}case"delete":{const e=r.filter((e=>e.id!==t.id));return e.length===r.length?r:(ee.logger.log("\ud83d\udcd6 Gallery: Synced trade delete for ".concat(t.id)),e)}default:return r}}))}),[null===R||void 0===R?void 0:R.lastSyncEvent,c,v,Z]);const[ce,de]=(0,a.useState)(!1),[ue,ge]=(0,a.useState)(null),[pe,xe]=(0,a.useState)(!1),[fe,ye]=(0,a.useState)(null),[ve,Ae]=(0,a.useState)(!1),be=(0,a.useRef)(null);(0,a.useEffect)((()=>{O(b?1:0),de(!1)}),[se,b]);const je=(0,ba.o)({userId:null===F||void 0===F?void 0:F.uid,calendar:A,trade:ie||void 0,autoSaveConversation:!0});(0,a.useEffect)((()=>{const e=(null===ie||void 0===ie?void 0:ie.id)||null;null!==be.current&&be.current!==e&&(je.setMessages([]),de(!1)),be.current=e}),[null===ie||void 0===ie?void 0:ie.id,je.setMessages]),(0,a.useEffect)((()=>{1===X&&null!==ie&&void 0!==ie&&ie.id&&null!==F&&void 0!==F&&F.uid&&je.loadConversations()}),[X,null===ie||void 0===ie?void 0:ie.id,null===F||void 0===F?void 0:F.uid,je.loadConversations]);const Se=(0,a.useMemo)((()=>ie?[ie]:[]),[ie]),_e=(0,a.useMemo)((()=>{if(!ie)return[];const e=ie.name||"this trade",t=ie.trade_type,r="win"===t,n="loss"===t;return[{category:"Trade Analysis",questions:["Why did ".concat(e," ").concat(r?"succeed":n?"fail":"break even","?"),"What patterns do you see in this trade's setup?","Analyze the entry and exit timing for this trade"]},{category:"Compare & Learn",questions:["Show me similar trades from my history","How does this trade compare to my winning trades?","What could I have done differently in this trade?"]},{category:"Risk & Management",questions:["Was my position size appropriate for this trade?","Analyze the risk-reward ratio of this trade","Did I follow my trading rules on this trade?"]}]}),[ie]),Te=(0,a.useCallback)(((e,t)=>{O(t),de(!1)}),[]),Ie=(0,a.useCallback)((async()=>{await je.startNewChat(),de(!1)}),[je.startNewChat]),Me=(0,a.useCallback)((e=>{je.selectConversation(e),de(!1)}),[je.selectConversation]),Ee=(0,a.useCallback)((async(e,t)=>{t.stopPropagation(),await je.deleteConversation(e)}),[je.deleteConversation]),ze=(0,a.useCallback)((e=>{const t=e.messages.find((e=>"user"===e.role));return t&&t.content?t.content.substring(0,80)+(t.content.length>80?"...":""):"No messages"}),[]),De=se>=te.length-1,Pe=se<=0,Ne=q&&De&&H,Fe=(0,a.useCallback)((()=>{te.length<=1||(Z?se<te.length-1&&oe(se+1):oe((se+1)%te.length))}),[te.length,Z,se]),Le=(0,a.useCallback)((()=>{te.length<=1||(Z?se>0&&oe(se-1):oe((se-1+te.length)%te.length))}),[te.length,Z,se]),Xe=(0,a.useCallback)((()=>{L.current&&L.current.scrollBy({top:-200,behavior:"smooth"})}),[]),Oe=(0,a.useCallback)((()=>{L.current&&L.current.scrollBy({top:200,behavior:"smooth"})}),[]);(0,a.useEffect)((()=>{const e=e=>{c&&("ArrowLeft"===e.key?(e.preventDefault(),Le()):"ArrowRight"===e.key?(e.preventDefault(),Fe()):"ArrowUp"===e.key?(e.preventDefault(),Xe()):"ArrowDown"===e.key?(e.preventDefault(),Oe()):"Escape"===e.key&&(e.preventDefault(),u()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[c,Le,Fe,Xe,Oe,u]);const Be=Z&&q&&0===te.length;return ie||Be?(0,re.jsxs)(We.A,{open:c,onClose:u,maxWidth:"md",fullWidth:!0,sx:{zIndex:In.M.DIALOG_POPUP},PaperProps:{sx:{maxHeight:"90vh",display:"flex",flexDirection:"column",backgroundColor:N.palette.background.default,overflow:"hidden"}},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,borderBottom:"1px solid ".concat(N.palette.divider),backgroundColor:N.palette.background.paper},children:[(0,re.jsx)(i.A,{sx:{display:"flex",flex:1},children:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:2,minWidth:0},children:[(0,re.jsx)(g.A,{title:Be?"Loading...":Pe&&Z?"At first trade":"Previous trade (\u2190)",slotProps:{popper:{sx:{zIndex:In.M.TOOLTIP}}},children:(0,re.jsx)("span",{children:(0,re.jsx)(p.A,{onClick:Le,disabled:Be||te.length<=1||Pe&&Z,sx:{color:Be||te.length<=1||Pe&&Z?"text.disabled":"text.primary","&:hover":{backgroundColor:(0,d.X4)(N.palette.primary.main,.1)}},children:(0,re.jsx)(ha.A,{})})})}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:.5,minWidth:0},children:[(0,re.jsx)(l.A,{variant:"h6",sx:{fontWeight:600,wordBreak:"break-word",overflowWrap:"break-word"},children:f}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[Be?(0,re.jsx)(ot.A,{height:24,width:80,borderRadius:12,variant:"wave",intensity:"medium"}):(0,re.jsx)(me.A,{size:"small",label:Z?"".concat(se+1," of ").concat($):"".concat(se+1," of ").concat(te.length),sx:{backgroundColor:(0,d.X4)(N.palette.primary.main,.1),color:"primary.main",fontWeight:600}}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(k.A,{sx:{fontSize:16,color:"text.secondary"}}),Be?(0,re.jsx)(ot.A,{height:14,width:100,borderRadius:4,variant:"wave",intensity:"low"}):(0,re.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{wordBreak:"break-word",overflowWrap:"break-word"},children:(0,P.A)(new Date(ie.trade_date),"MMM d, yyyy")})]})]})]}),(0,re.jsx)(g.A,{title:Ne?"Loading more trades...":De&&!H&&Z?"At last trade":"Next trade (\u2192)",slotProps:{popper:{sx:{zIndex:In.M.TOOLTIP}}},children:(0,re.jsx)("span",{children:(0,re.jsx)(p.A,{onClick:Fe,disabled:te.length<=1||Ne||De&&!H&&Z,sx:{color:te.length<=1||De&&!H&&Z?"text.disabled":"text.primary","&:hover":{backgroundColor:(0,d.X4)(N.palette.primary.main,.1)}},children:Ne?(0,re.jsx)(Rt.A,{size:20,color:"primary"}):(0,re.jsx)(pa.A,{})})})})]})}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,ml:2},children:[(0,re.jsx)(Kr.A,{tabs:[{label:"Trade",icon:(0,re.jsx)(ma.A,{sx:{fontSize:18}})},{label:"Assistant",icon:(0,re.jsx)(E.A,{sx:{fontSize:18}})}],activeTab:X,onTabChange:Te,size:"small"}),1===X&&(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,ml:1},children:[(0,re.jsx)(g.A,{title:"New Chat",slotProps:{popper:{sx:{zIndex:In.M.TOOLTIP}}},children:(0,re.jsx)("span",{children:(0,re.jsx)(p.A,{size:"small",onClick:Ie,disabled:0===je.messages.length,sx:{color:"primary.main","&:hover":{backgroundColor:(0,d.X4)(N.palette.primary.main,.1)},"&:disabled":{color:"text.disabled"}},children:(0,re.jsx)(xa.A,{sx:{fontSize:18}})})})}),(0,re.jsx)(g.A,{title:ce?"Back to Chat":"Conversation History",slotProps:{popper:{sx:{zIndex:In.M.TOOLTIP}}},children:(0,re.jsx)(p.A,{size:"small",onClick:()=>de(!ce),sx:{color:ce?"primary.main":"text.secondary","&:hover":{backgroundColor:(0,d.X4)(N.palette.action.hover,.5)}},children:ce?(0,re.jsx)(fa.A,{sx:{fontSize:18}}):(0,re.jsx)(ya.A,{sx:{fontSize:18}})})})]})]}),(0,re.jsx)(p.A,{onClick:u,sx:{color:"text.secondary","&:hover":{backgroundColor:(0,d.X4)(N.palette.error.main,.1),color:"error.main"}},children:(0,re.jsx)(Ue.A,{})})]}),(0,re.jsx)(Kr.K,{value:X,index:0,children:(0,re.jsx)(i.A,{ref:L,sx:(0,n.A)({overflow:"auto",maxHeight:"calc(90vh - 180px)"},(0,he.J)(N)),children:Be?(0,re.jsxs)(i.A,{sx:{p:3,display:"flex",flexDirection:"column",gap:3},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,re.jsx)(ot.A,{height:28,width:28,borderRadius:4,variant:"wave",intensity:"medium"}),(0,re.jsx)(ot.A,{height:28,width:120,borderRadius:4,variant:"wave",intensity:"medium"})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(ot.A,{height:32,width:32,borderRadius:"50%",variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:32,width:32,borderRadius:"50%",variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:32,width:32,borderRadius:"50%",variant:"wave",intensity:"low"})]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(ot.A,{height:16,width:16,borderRadius:4,variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:16,width:80,borderRadius:4,variant:"wave",intensity:"low"})]}),(0,re.jsxs)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:[(0,re.jsxs)(i.A,{sx:{p:2,borderRadius:2,bgcolor:(0,d.X4)(N.palette.background.paper,.6),border:"1px solid ".concat((0,d.X4)(N.palette.divider,.1))},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,mb:1},children:[(0,re.jsx)(ot.A,{height:14,width:14,borderRadius:4,variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:14,width:30,borderRadius:4,variant:"wave",intensity:"low"})]}),(0,re.jsx)(ot.A,{height:28,width:80,borderRadius:4,variant:"wave",intensity:"medium"})]}),(0,re.jsxs)(i.A,{sx:{p:2,borderRadius:2,bgcolor:(0,d.X4)(N.palette.background.paper,.6),border:"1px solid ".concat((0,d.X4)(N.palette.divider,.1))},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,mb:1},children:[(0,re.jsx)(ot.A,{height:14,width:14,borderRadius:4,variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:14,width:35,borderRadius:4,variant:"wave",intensity:"low"})]}),(0,re.jsx)(ot.A,{height:20,width:130,borderRadius:4,variant:"wave",intensity:"medium"})]}),(0,re.jsxs)(i.A,{sx:{p:2,borderRadius:2,bgcolor:(0,d.X4)(N.palette.background.paper,.6),border:"1px solid ".concat((0,d.X4)(N.palette.divider,.1))},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,mb:1},children:[(0,re.jsx)(ot.A,{height:14,width:14,borderRadius:4,variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:14,width:90,borderRadius:4,variant:"wave",intensity:"low"})]}),(0,re.jsx)(ot.A,{height:24,width:40,borderRadius:4,variant:"wave",intensity:"medium",sx:{mb:.5}}),(0,re.jsx)(ot.A,{height:14,width:120,borderRadius:4,variant:"wave",intensity:"low"})]}),(0,re.jsxs)(i.A,{sx:{p:2,borderRadius:2,bgcolor:(0,d.X4)(N.palette.background.paper,.6),border:"1px solid ".concat((0,d.X4)(N.palette.divider,.1))},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,mb:1},children:[(0,re.jsx)(ot.A,{height:14,width:14,borderRadius:4,variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:14,width:55,borderRadius:4,variant:"wave",intensity:"low"})]}),(0,re.jsx)(ot.A,{height:20,width:60,borderRadius:4,variant:"wave",intensity:"medium"})]})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[(0,re.jsx)(ot.A,{height:16,width:16,borderRadius:4,variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:16,width:55,borderRadius:4,variant:"wave",intensity:"low"})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:2},children:[(0,re.jsx)(ot.A,{height:100,width:"100%",borderRadius:2,variant:"wave",intensity:"medium",sx:{flex:1}}),(0,re.jsx)(ot.A,{height:100,width:"100%",borderRadius:2,variant:"wave",intensity:"medium",sx:{flex:1}}),(0,re.jsx)(ot.A,{height:100,width:"100%",borderRadius:2,variant:"wave",intensity:"medium",sx:{flex:1}})]})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,re.jsx)(ot.A,{height:16,width:16,borderRadius:4,variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:16,width:40,borderRadius:4,variant:"wave",intensity:"low"})]}),(0,re.jsx)(ot.A,{height:20,width:20,borderRadius:4,variant:"wave",intensity:"low"})]}),(0,re.jsx)(i.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[140,180,100,160,80,100,80,120].map(((e,t)=>(0,re.jsx)(ot.A,{height:28,width:e,borderRadius:14,variant:"wave",intensity:"medium"},t)))})]}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[(0,re.jsx)(ot.A,{height:16,width:16,borderRadius:4,variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:16,width:180,borderRadius:4,variant:"wave",intensity:"low"})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,re.jsx)(ot.A,{height:40,width:"100%",borderRadius:8,variant:"wave",intensity:"low"}),(0,re.jsx)(ot.A,{height:40,width:"100%",borderRadius:8,variant:"wave",intensity:"low"})]})]})]}):ie?(0,re.jsx)(Aa.A,{tradeData:ie,isExpanded:!0,animate:!1,trades:h,tradeOperations:C,showAIButton:!1}):null})}),(0,re.jsx)(Kr.K,{value:X,index:1,children:(0,re.jsx)(i.A,{sx:{height:"calc(90vh - 180px)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:(0,re.jsxs)(i.A,{sx:{display:"flex",width:"200%",height:"100%",transform:ce?"translateX(-50%)":"translateX(0)",transition:"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[(0,re.jsx)(i.A,{sx:{width:"50%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:(0,re.jsx)(ja.A,(0,n.A)((0,n.A)({},je),{},{userId:null===F||void 0===F?void 0:F.uid,calendar:A,trades:Se,questionTemplates:_e,autoScroll:je.messages.length>0,onTradeClick:(e,t)=>{const r=te.findIndex((t=>t.id===e));r>=0&&te.length<=5?(oe(r),O(0)):_?_(t,e,"AI Chat - Trade Gallery"):ee.logger.log("Trade clicked but not found in gallery:",e)},onEventClick:e=>{ee.logger.log("Economic event clicked:",e),ge(e),xe(!0)},onNoteClick:(e,t)=>{ee.logger.log("Note clicked:",e),t?(ye(t),Ae(!0)):ee.logger.warn("Note not found in embedded notes:",e)},isReadOnly:j}))}),(0,re.jsxs)(i.A,{sx:{width:"50%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,re.jsxs)(i.A,{sx:{p:2,borderBottom:"1px solid ".concat((0,d.X4)(N.palette.divider,.1)),backgroundColor:(0,d.X4)(N.palette.background.paper,.8)},children:[(0,re.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:600},children:"Conversation History"}),(0,re.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[je.conversations.length," conversation",1!==je.conversations.length?"s":""," for this trade"]})]}),(0,re.jsx)(i.A,{sx:(0,n.A)({flex:1,overflow:"auto"},(0,he.J)(N)),children:je.loadingConversations?(0,re.jsx)(ke.A,{sx:{p:0},children:Array.from({length:5}).map(((e,t)=>(0,re.jsxs)(a.Fragment,{children:[(0,re.jsx)(Ce.Ay,{sx:{py:2,px:2},children:(0,re.jsxs)(i.A,{sx:{width:"100%"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,re.jsx)(ot.A,{height:20,width:"60%",borderRadius:4,variant:"wave",intensity:"medium"}),(0,re.jsx)(ot.A,{height:20,width:60,borderRadius:10,variant:"pulse",intensity:"low"})]}),(0,re.jsx)(ot.A,{height:16,width:"90%",borderRadius:4,variant:"default",intensity:"low",sx:{mb:.5}}),(0,re.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:(0,re.jsx)(ot.A,{height:14,width:120,borderRadius:4,variant:"default",intensity:"low"})})]})}),t<4&&(0,re.jsx)(we.A,{})]},t)))}):0===je.conversations.length?(0,re.jsx)(i.A,{sx:{p:3},children:(0,re.jsx)(y.A,{severity:"info",children:"No conversation history yet. Start chatting with the AI to create your first conversation for this trade!"})}):(0,re.jsx)(ke.A,{sx:{p:0},children:je.conversations.map(((e,t)=>(0,re.jsxs)(a.Fragment,{children:[(0,re.jsx)(Ce.Ay,{disablePadding:!0,children:(0,re.jsxs)(Re.A,{onClick:()=>Me(e),sx:{py:2,px:2,display:"flex",alignItems:"flex-start",gap:1,"&:hover":{backgroundColor:(0,d.X4)(N.palette.primary.main,.08)}},children:[(0,re.jsxs)(i.A,{sx:{flex:1,minWidth:0},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,re.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:600,fontSize:"0.95rem",flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),(0,re.jsx)(me.A,{label:"".concat(e.message_count," msgs"),size:"small",sx:{height:20,fontSize:"0.7rem",backgroundColor:(0,d.X4)(N.palette.primary.main,.1),color:"primary.main"}})]}),(0,re.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.85rem",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",mb:.5},children:ze(e)}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,re.jsx)(va.A,{sx:{fontSize:14,color:"text.disabled"}}),(0,re.jsx)(l.A,{variant:"caption",color:"text.disabled",children:(0,P.A)(e.updated_at,"MMM d, yyyy \u2022 h:mm a")})]})]}),(0,re.jsx)(p.A,{onClick:t=>Ee(e.id,t),size:"small",sx:{color:"error.main",flexShrink:0,mt:.5,"&:hover":{backgroundColor:(0,d.X4)(N.palette.error.main,.1)}},children:(0,re.jsx)(Ct.A,{fontSize:"small"})})]})}),t<je.conversations.length-1&&(0,re.jsx)(we.A,{})]},e.id)))})})]})]})})}),ue&&A&&(0,re.jsx)(da.A,{open:pe,onClose:()=>{xe(!1),ge(null)},event:ue,calendarId:A.id,tradeOperations:C,isReadOnly:j}),ve&&fe&&v&&(0,re.jsx)(wa.Ay,{open:ve,onClose:()=>{Ae(!1),ye(null)},note:fe,calendarId:v,onSave:e=>{je.setMessages((t=>t.map((t=>t.embeddedNotes&&t.embeddedNotes[e.id]?(0,n.A)((0,n.A)({},t),{},{embeddedNotes:(0,n.A)((0,n.A)({},t.embeddedNotes),{},{[e.id]:e})}):t))))},onDelete:e=>{je.setMessages((t=>t.map((t=>{if(t.embeddedNotes&&t.embeddedNotes[e]){const r=t.embeddedNotes,{[e]:a}=r,o=(0,Je.A)(r,[e].map(ga.A));return(0,n.A)((0,n.A)({},t),{},{embeddedNotes:o})}return t})))),Ae(!1),ye(null)}})]}):null};var Ca=r(69478),Sa=r(21161),_a=r(94029),Ta=r(41180),Ia=r(76278);var Ma,Ea,za=r(57528),Da=r(83290),Ra=r(88566),Wa=r(431),Pa=r(85821),Na=r(89547),Fa=r(90721),La=r(4362),Xa=r(66935),Oa=r(62706),Ba=r(8872),Ua=r(85085),qa=r(60438),Ga=r(72661),Ha=r(31849),Ya=r(90030),Va=r(1062);const Ka=(0,Da.i7)(Ma||(Ma=(0,za.A)(["\n  0% {\n    opacity: 0;\n    filter: blur(4px);\n  }\n  100% {\n    opacity: 1;\n    filter: blur(0px);\n  }\n"]))),Ja=(0,Da.i7)(Ea||(Ea=(0,za.A)(["\n  0% {\n    transform: translateY(40px);\n  }\n  60% {\n    transform: translateY(-4px);\n  }\n  80% {\n    transform: translateY(2px);\n  }\n  100% {\n    transform: translateY(0);\n  }\n"]))),$a=e=>{let{note:t,index:r,totalCards:a,isHovered:o,hasAnimated:c}=e;const u=(0,s.A)(),g=(e=>({red:e.palette.error.main,pink:Ra.A[500],purple:Wa.A[500],deepPurple:Pa.A[500],indigo:Na.A[500],blue:e.palette.info.main,lightBlue:Fa.A[500],cyan:La.A[500],teal:Xa.A[500],green:e.palette.success.main,lightGreen:Oa.A[500],lime:Ba.A[500],yellow:Ua.A[600],amber:qa.A[500],orange:e.palette.warning.main,deepOrange:Ga.A[500],brown:Ha.A[500],grey:Ya.A[500],blueGrey:Va.A[500]}))(u),h="dark"===u.palette.mode,p=t.color&&g[t.color]||u.palette.grey[700],m="translateY(".concat(6*r,"px) translateX(").concat(3*r,"px)"),x="rotate(".concat(12*(r-Math.floor(a/2)),"deg) translateX(").concat(35*r,"px) translateY(-").concat(5*r,"px)"),f=a-r,y="".concat(.1*r,"s");return(0,re.jsx)(i.A,{sx:(0,n.A)({position:"absolute"},c&&{animation:"".concat(Ja," 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) ").concat(y," both")}),children:(0,re.jsx)(i.A,{sx:(0,n.A)((0,n.A)({width:72,height:90,borderRadius:1.5,overflow:"hidden",backgroundColor:(0,d.X4)(p,h?.85:.9),boxShadow:"0 4px 12px ".concat(h?(0,d.X4)(u.palette.common.black,.4):(0,d.X4)(u.palette.common.black,.15)),border:"1px solid ".concat((0,d.X4)(u.palette.common.white,.1)),transform:o?x:m,transition:"transform 0.2s cubic-bezier(0.4, 0, 0.2, 1)",zIndex:f,cursor:"pointer",opacity:c?1:0,filter:c?"blur(0px)":"blur(4px)"},c&&{animation:"".concat(Ka," 0.6s cubic-bezier(0.4, 0, 0.2, 1) ").concat(y," both")}),{},{"&:hover":{boxShadow:"0 6px 16px ".concat(h?(0,d.X4)(u.palette.common.black,.5):(0,d.X4)(u.palette.common.black,.2))}}),children:(0,re.jsxs)(i.A,{sx:{p:1,display:"flex",flexDirection:"column",height:"100%"},children:[(0,re.jsx)(l.A,{variant:"caption",sx:{fontWeight:600,color:u.palette.common.white,fontSize:"0.65rem",lineHeight:1.3,display:"-webkit-box",WebkitLineClamp:4,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",flex:1,textShadow:"0 1px 2px rgba(0,0,0,0.3)"},children:t.title||"Untitled"}),a>1&&0===r&&(0,re.jsxs)(l.A,{variant:"caption",sx:{fontSize:"0.6rem",color:(0,d.X4)(u.palette.common.white,.8),mt:"auto",textShadow:"0 1px 2px rgba(0,0,0,0.3)"},children:["+",a-1," more"]})]})})})};var Qa,Za;const eo=(0,Da.i7)(Qa||(Qa=(0,za.A)(["\n  0% {\n    opacity: 0;\n    filter: blur(4px);\n  }\n  100% {\n    opacity: 1;\n    filter: blur(0px);\n  }\n"]))),to=(0,Da.i7)(Za||(Za=(0,za.A)(["\n  0% {\n    transform: translateY(40px);\n  }\n  60% {\n    transform: translateY(-4px);\n  }\n  80% {\n    transform: translateY(2px);\n  }\n  100% {\n    transform: translateY(0);\n  }\n"]))),ro=e=>{let{index:t,totalCards:r,isHovered:a,hasAnimated:o}=e;const l=(0,s.A)(),c="dark"===l.palette.mode,u=l.palette.grey[c?700:400],g="translateY(".concat(6*t,"px) translateX(").concat(3*t,"px)"),h="rotate(".concat(12*(t-Math.floor(r/2)),"deg) translateX(").concat(35*t,"px) translateY(-").concat(5*t,"px)"),p=r-t,m="".concat(.1*t,"s");return(0,re.jsx)(i.A,{sx:(0,n.A)({position:"absolute"},o&&{animation:"".concat(to," 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) ").concat(m," both")}),children:(0,re.jsx)(i.A,{sx:(0,n.A)({width:72,height:90,borderRadius:1.5,overflow:"hidden",backgroundColor:(0,d.X4)(u,c?.3:.2),boxShadow:"0 4px 12px ".concat(c?(0,d.X4)(l.palette.common.black,.3):(0,d.X4)(l.palette.common.black,.1)),border:"2px  ".concat((0,d.X4)(c?l.palette.common.white:l.palette.common.black,.3)),transform:a?h:g,transition:"transform 0.2s cubic-bezier(0.4, 0, 0.2, 1)",zIndex:p,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:o?1:0,filter:o?"blur(0px)":"blur(4px)"},o&&{animation:"".concat(eo," 0.6s cubic-bezier(0.4, 0, 0.2, 1) ").concat(m," both")})})})};var no=r(77328);const ao=e=>{let{open:t,onClose:r,notes:o,initialIndex:c=0,calendarId:u,fullDayName:g,onNoteSaved:h,onNoteDeleted:m}=e;const x=(0,s.A)(),f="dark"===x.palette.mode,y=(e=>({red:e.palette.error.main,pink:Ra.A[500],purple:Wa.A[500],deepPurple:Pa.A[500],indigo:Na.A[500],blue:e.palette.info.main,lightBlue:Fa.A[500],cyan:La.A[500],teal:Xa.A[500],green:e.palette.success.main,lightGreen:Oa.A[500],lime:Ba.A[500],yellow:Ua.A[600],amber:qa.A[500],orange:e.palette.warning.main,deepOrange:Ga.A[500],brown:Ha.A[500],grey:Ya.A[500],blueGrey:Va.A[500]}))(x),[v,A]=(0,a.useState)(c),[b,w]=(0,a.useState)(!1),k=(0,a.useRef)(null);(0,a.useEffect)((()=>{t&&A(Math.min(c,Math.max(0,o.length-1)))}),[t,c,o.length]),(0,a.useEffect)((()=>{k.current&&(k.current.scrollTop=0)}),[v]),(0,a.useEffect)((()=>{if(!t)return;const e=e=>{"Escape"===e.key&&r()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[t,r,o.length]);const _=(0,a.useCallback)((()=>{A((e=>e>0?e-1:o.length-1))}),[o.length]),T=(0,a.useCallback)((()=>{A((e=>e<o.length-1?e+1:0))}),[o.length]),I=(0,a.useCallback)((()=>{w(!0)}),[]),M=(0,a.useCallback)((()=>{w(!1)}),[]),E=(0,a.useCallback)(((e,t)=>{null===h||void 0===h||h(e,t)}),[h]),z=(0,a.useCallback)((()=>{null===m||void 0===m||m((null===D||void 0===D?void 0:D.id)||""),o.length<=1&&r()}),[m,o.length,r]),D=o[v],R=o.length>1;if(!D)return null;const W=D.color&&y[D.color]||x.palette.info.main;return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(i.A,{onClick:r,sx:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:(0,d.X4)(x.palette.common.black,.5),backdropFilter:"blur(4px)",zIndex:In.M.AI_DRAWER_BACKDROP,opacity:t?1:0,pointerEvents:t?"auto":"none",transition:"opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"}}),(0,re.jsx)(i.A,{sx:{position:"fixed",bottom:0,left:{xs:0,sm:20},right:{xs:0,sm:"auto"},zIndex:In.M.AI_DRAWER,height:t?500:0,maxHeight:"70vh",width:"100%",maxWidth:{xs:"100%",sm:"420px"},borderTopLeftRadius:20,borderTopRightRadius:20,background:f?"linear-gradient(135deg, rgba(18, 18, 18, 0.98) 0%, rgba(30, 30, 30, 0.98) 100%)":"linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%)",backdropFilter:"blur(20px)",boxShadow:f?"0 -8px 32px rgba(0, 0, 0, 0.6)":"0 -8px 32px rgba(0, 0, 0, 0.15)",border:"1px solid ".concat((0,d.X4)(x.palette.divider,.1)),borderBottom:"none",transition:"height 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:t?"translateY(0)":"translateY(100%)",overflow:"hidden",pointerEvents:t?"auto":"none"},children:(0,re.jsxs)(i.A,{sx:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,pb:1.5,borderBottom:"1px solid ".concat((0,d.X4)(x.palette.divider,.1)),background:(0,d.X4)(W,f?.1:.15),borderLeft:"4px solid ".concat(W)},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,re.jsx)(Gn.A,{sx:{fontSize:"1.25rem",color:W}}),(0,re.jsxs)(i.A,{children:[(0,re.jsxs)(l.A,{variant:"subtitle2",sx:{fontSize:"0.875rem",color:W,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px"},children:[g," Reminder"]}),R&&(0,re.jsxs)(l.A,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.75rem"},children:[v+1," of ",o.length]})]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[R&&(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(p.A,{size:"small",onClick:_,sx:{color:W},title:"Previous (\u2190)",children:(0,re.jsx)(C.A,{})}),(0,re.jsx)(p.A,{size:"small",onClick:T,sx:{color:W},title:"Next (\u2192)",children:(0,re.jsx)(S.A,{})})]}),(0,re.jsx)(p.A,{size:"small",onClick:I,sx:{color:"text.secondary"},title:"Edit note",children:(0,re.jsx)(j.A,{fontSize:"small"})}),(0,re.jsx)(p.A,{size:"small",onClick:r,sx:{color:"text.secondary"},title:"Close (Esc)",children:(0,re.jsx)(Ue.A,{fontSize:"small"})})]})]}),(0,re.jsxs)(i.A,{ref:k,sx:(0,n.A)({flex:1,overflow:"auto"},(0,he.J)(x)),children:[D.cover_image&&(0,re.jsx)(i.A,{sx:{width:"100%",height:160,backgroundImage:"url(".concat(D.cover_image,")"),backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}),(0,re.jsxs)(i.A,{sx:{p:2},children:[D.title&&""!==D.title.trim()&&(0,re.jsx)(l.A,{variant:"h6",sx:{fontWeight:600,color:"text.primary",mb:2},children:D.title}),(0,re.jsx)(i.A,{sx:{"& .DraftEditor-root":{fontSize:"0.95rem",lineHeight:1.6}},children:(0,re.jsx)(no.A,{value:D.content,disabled:!0,hideCharacterCount:!0,minHeight:200})})]})]})]})}),(0,re.jsx)(wa.Ay,{open:b,onClose:M,note:D,calendarId:u,onSave:E,onDelete:z})]})},oo=e=>{let{calendarId:t}=e;const{notes:r,isLoading:n,fullDayName:o,updateNote:s,removeNote:l}=function(e){const[t,r]=(0,a.useState)([]),[n,o]=(0,a.useState)(!0),s=(0,P.A)(new Date,"EEE"),i=(0,P.A)(new Date,"EEEE"),l=(0,a.useCallback)((async()=>{o(!0);try{const t=await(0,Ta.vP)(e,s);r(t)}catch(t){ee.logger.error("Error loading reminder notes:",t),r([])}finally{o(!1)}}),[e,s]);(0,a.useEffect)((()=>{l()}),[l]);const c=(0,a.useCallback)((e=>{var t;return!(!e||!e.is_reminder_active||e.is_archived)&&!("weekly"!==e.reminder_type||null===(t=e.reminder_days)||void 0===t||!t.includes(s))}),[s]);(0,Ia.M)({channelName:"calendar-reminders-".concat(e),enabled:!0,onChannelCreated:t=>{ee.logger.log("\ud83d\udd27 Setting up reminder notes broadcast subscription for calendar-".concat(e)),t.on("broadcast",{event:"INSERT"},(e=>{var t;if(null!==(t=e.payload)&&void 0!==t&&t.record){const t=e.payload.record;ee.logger.log("\u2795 Note added via broadcast: ".concat(t.id)),c(t)&&r((e=>e.some((e=>e.id===t.id))?e:[t,...e]))}})),t.on("broadcast",{event:"UPDATE"},(e=>{var t;if(null!==(t=e.payload)&&void 0!==t&&t.record){const t=e.payload.record,n=e.payload.old_record;ee.logger.log("\u270f\ufe0f Note updated via broadcast: ".concat(t.id));const a=c(t),o=!!n&&c(n);a?r((e=>{const r=e.findIndex((e=>e.id===t.id));if(r>=0){const n=[...e];return n[r]=t,n}return[t,...e]})):o&&!a&&r((e=>e.filter((e=>e.id!==t.id))))}})),t.on("broadcast",{event:"DELETE"},(e=>{var t;if(null!==(t=e.payload)&&void 0!==t&&t.old_record){const t=e.payload.old_record;ee.logger.log("\ud83d\uddd1\ufe0f Note deleted via broadcast: ".concat(t.id)),r((e=>e.filter((e=>e.id!==t.id))))}}))},onSubscribed:()=>{ee.logger.log("\u2705 Reminder notes broadcast subscription ACTIVE for calendar-".concat(e))},onError:t=>{ee.logger.error("\u274c Reminder notes broadcast subscription ERROR for calendar-".concat(e,":"),t)}});const d=(0,a.useCallback)((e=>{r((t=>{const r=t.findIndex((t=>t.id===e.id));if(r>=0){const n=[...t];return n[r]=e,n}return t}))}),[]),u=(0,a.useCallback)((e=>{r((t=>t.filter((t=>t.id!==e))))}),[]);return{notes:t,isLoading:n,currentDayAbbr:s,fullDayName:i,reloadNotes:l,updateNote:d,removeNote:u}}(t),[c,d]=(0,a.useState)(!1),[u,g]=(0,a.useState)(!1),[h,p]=(0,a.useState)(0),[m,x]=(0,a.useState)(!1);(0,a.useEffect)((()=>{!n&&r.length>0&&!m&&x(!0)}),[n,r.length,m]);const f=r.slice(0,3),y=(0,a.useCallback)((()=>{p(0),g(!0)}),[]),v=(0,a.useCallback)((()=>{g(!1)}),[]),A=(0,a.useCallback)((e=>{s(e)}),[s]),b=(0,a.useCallback)((e=>{l(e)}),[l]);return n||0===r.length?null:(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)(i.A,{onClick:y,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),sx:{position:"fixed",bottom:{xs:16,sm:24},left:{xs:16,sm:24},zIndex:In.M.FLOAT_NAVIGATION,cursor:"pointer",width:c?180:90,height:110,transition:"width 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[1===f.length&&(0,re.jsx)(re.Fragment,{children:(0,re.jsx)(ro,{index:1,totalCards:2,isHovered:c,hasAnimated:m})}),[...f].reverse().map(((e,t)=>{const r=f.length-1-t,n=1===f.length?0:r,a=1===f.length?3:f.length;return(0,re.jsx)($a,{note:e,index:n,totalCards:a,isHovered:c,hasAnimated:m},e.id)}))]}),(0,re.jsx)(ao,{open:u,onClose:v,notes:r,initialIndex:h,calendarId:t,fullDayName:o,onNoteSaved:A,onNoteDeleted:b})]})};var so=r(50460),io=r(84339);const lo=e=>{let{currentDate:t,isVisible:r,onPrevMonth:n,onNextMonth:o,onMonthClick:c}=e;const u=(0,s.A)(),[h,m]=((0,W.A)(t),(0,a.useState)(!1));(0,a.useEffect)((()=>{const e=()=>{const e=document.documentElement,t=Math.max(0,e.scrollHeight-window.innerHeight);if(t<=0)return void m(!0);const r=Math.max(0,Math.min(1,window.scrollY/t));m(r<=.2)};return e(),window.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}}),[]);const x=r&&!h;return(0,re.jsx)(io.A,{direction:"left",in:x,mountOnEnter:!0,unmountOnExit:!0,children:(0,re.jsx)(i.A,{sx:{position:"fixed",top:{xs:80,sm:88},right:{xs:16,sm:24},zIndex:1300,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:(0,re.jsxs)(i.A,{sx:{backgroundColor:(0,d.X4)(u.palette.background.paper,.95),backdropFilter:"blur(20px)",borderRadius:"24px",boxShadow:"0 8px 32px ".concat((0,d.X4)(u.palette.common.black,.12)),border:"1px solid ".concat((0,d.X4)(u.palette.divider,.1)),p:.5,display:"flex",alignItems:"center",gap:.5,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:x?"translateY(0)":"translateY(-10px)",opacity:x?1:0,"&:hover":{boxShadow:"0 12px 40px ".concat((0,d.X4)(u.palette.common.black,.15)),transform:"translateY(-2px)"}},children:[(0,re.jsx)(g.A,{title:"Previous month",placement:"bottom",children:(0,re.jsx)(p.A,{onClick:n,size:"small",sx:{width:36,height:36,color:"text.secondary",transition:"all 0.2s ease","&:hover":{color:"primary.main",bgcolor:(0,d.X4)(u.palette.primary.main,.1),transform:"scale(1.05)"}},children:(0,re.jsx)(C.A,{fontSize:"small"})})}),(0,re.jsxs)(i.A,{onClick:c,sx:{cursor:"pointer",px:2,py:1,borderRadius:"16px",textAlign:"center",transition:"all 0.2s ease",position:"relative","&:hover":{bgcolor:(0,d.X4)(u.palette.primary.main,.08),transform:"scale(1.02)"}},children:[(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:700,fontSize:"0.9rem",color:"text.primary",letterSpacing:"0.5px",lineHeight:1.2},children:(0,P.A)(t,"MMM")}),(0,re.jsx)(l.A,{variant:"caption",sx:{fontSize:"0.75rem",color:"text.secondary",fontWeight:500,display:"block",lineHeight:1},children:(0,P.A)(t,"yyyy")})]}),(0,re.jsx)(g.A,{title:"Next month",placement:"bottom",children:(0,re.jsx)(p.A,{onClick:o,size:"small",sx:{width:36,height:36,color:"text.secondary",transition:"all 0.2s ease","&:hover":{color:"primary.main",bgcolor:(0,d.X4)(u.palette.primary.main,.1),transform:"scale(1.05)"}},children:(0,re.jsx)(S.A,{fontSize:"small"})})})]})})})};var co=r(15515),uo=r(46087);const go={currencies:["USD","EUR","GBP"],impacts:["High","Medium","Low"],viewType:"day"},ho={refreshOnStart:!0,maxRefreshAge:3e5};const po=new class{constructor(){this.watchedEventGroups=new Map,this.callbacks=null,this.isActive=!1,this.eventQueues=new Map}getRefreshKey(e){return"economicEventWatcher_lastRefresh_".concat(e)}shouldRefreshData(e){try{if(!ho.refreshOnStart)return!1;const t=localStorage.getItem(this.getRefreshKey(e));if(!t)return!0;const r=parseInt(t,10),n=Date.now()-r,a=n>ho.maxRefreshAge;return ee.logger.log("\ud83d\udcca Last refresh for calendar ".concat(e,": ").concat(Math.round(n/1e3/60)," minutes ago. Should refresh: ").concat(a)),a}catch(t){return ee.logger.warn("\u26a0\ufe0f Error checking refresh time from localStorage:",t),!0}}saveRefreshTime(e){try{localStorage.setItem(this.getRefreshKey(e),Date.now().toString())}catch(t){ee.logger.warn("\u26a0\ufe0f Error saving refresh time to localStorage:",t)}}initialize(e){this.callbacks=e,ee.logger.log("\ud83d\udcca Economic Event Watcher initialized")}async startWatching(e,t){if(!this.callbacks)return void ee.logger.warn("\u26a0\ufe0f Event watcher not initialized");this.isActive=!0,ee.logger.log("\ud83d\udd0d Starting event watching for calendar: ".concat(e));const r=(null===t||void 0===t?void 0:t.currencies)||go.currencies,n=(null===t||void 0===t?void 0:t.impacts)||go.impacts;try{this.shouldRefreshData(e)?this.refreshCalendarData(r,e):(0,ee.log)("\u23ed\ufe0f Skipping refresh for calendar ".concat(e," - data is still fresh")),await this.initializeEventQueue(e,r,n),this.watchNextEventFromQueue(e)}catch(a){(0,ee.error)("\u274c Error starting event watcher:",a),this.callbacks.onError(a,e)}}async refreshCalendarData(e,t){try{var r;(0,ee.log)("\ud83d\udd04 Refreshing economic calendar data for calendar ".concat(t,", currencies: ").concat(e.join(", ")));const n=new Date,a=(0,P.A)(n,"yyyy-MM-dd"),{data:o,error:s}=await gn.N.functions.invoke("refresh-economic-calendar",{body:{targetDate:a,currencies:e}});if(s)return void ee.logger.error("\u274c Error calling refresh-economic-calendar function:",s);const i=o,l=(null===i||void 0===i?void 0:i.updatedCount)||0,c=(null===i||void 0===i||null===(r=i.foundEvents)||void 0===r?void 0:r.length)||0;ee.logger.log("\u2705 Economic calendar refreshed for calendar ".concat(t,": ").concat(l," total events updated")),c>0&&ee.logger.log("\ud83d\udcca Found ".concat(c," events with current data")),this.saveRefreshTime(t)}catch(n){ee.logger.error("\u274c Error refreshing economic calendar data:",n)}}async initializeEventQueue(e,t,r){const n=Date.now(),a=this.eventQueues.get(e);if(!a||!this.arraysEqual(a.currencies,t)||!this.arraysEqual(a.impacts,r)){ee.logger.log("\ud83d\udcca Fetching fresh events for calendar: ".concat(e));const a=new Date,o=(0,V.A)(a),s=(0,uo.A)(a),i={start:(0,P.A)(o,"yyyy-MM-dd"),end:(0,P.A)(s,"yyyy-MM-dd")},l=await co.$.fetchEventsPaginated(i,{pageSize:50},{currencies:t,impacts:r,onlyUpcoming:!0}),c=l.events.sort(((e,t)=>new Date(e.time_utc).getTime()-new Date(t.time_utc).getTime()));this.eventQueues.set(e,{events:c,lastFetched:n,currencies:t,impacts:r}),ee.logger.log("\ud83d\udccb Cached ".concat(c.length," upcoming events for calendar: ").concat(e," ").concat(l.events.length))}else ee.logger.log("\ud83d\udccb Using cached events for calendar: ".concat(e))}watchNextEventFromQueue(e){const t=this.eventQueues.get(e);if(!t||0===t.events.length)return ee.logger.log("\ud83d\udcc5 No more events to watch for calendar: ".concat(e)),void(this.isActive=!1);const r=this.getNextEventGroup(t);if(0===r.events.length)return ee.logger.log("\ud83d\udcc5 No more event groups to watch for calendar: ".concat(e)),void(this.isActive=!1);this.watchEventGroup(r,e),ee.logger.log("\u23f0 Watching ".concat(r.events.length," event(s) releasing at ").concat(r.releaseTime," for calendar: ").concat(e)),r.events.forEach(((e,t)=>{ee.logger.log("   ".concat(t+1,". ").concat(e.event_name))}))}getNextEventGroup(e){if(0===e.events.length)return{releaseTime:"",events:[]};const t=e.events[0].time_utc;return{releaseTime:t,events:e.events.filter((e=>e.time_utc===t))}}arraysEqual(e,t){return e.length===t.length&&e.every(((e,r)=>e===t[r]))}stopWatching(e){const t="".concat(e),r=this.watchedEventGroups.get(t);r&&(clearTimeout(r.timeoutId),this.watchedEventGroups.delete(t)),this.eventQueues.delete(e),0===this.watchedEventGroups.size&&(this.isActive=!1)}stopAllWatching(){this.watchedEventGroups.forEach((e=>{clearTimeout(e.timeoutId)})),this.watchedEventGroups.clear(),this.eventQueues.clear(),this.isActive=!1,ee.logger.log("\ud83d\uded1 Stopped all event watching")}clearRefreshCache(e){try{localStorage.removeItem(this.getRefreshKey(e)),ee.logger.log("\ud83d\uddd1\ufe0f Cleared refresh cache for calendar: ".concat(e))}catch(t){ee.logger.warn("\u26a0\ufe0f Error clearing refresh cache:",t)}}clearAllRefreshCaches(){try{const e=[];for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t);r&&r.startsWith("economicEventWatcher_lastRefresh_")&&e.push(r)}e.forEach((e=>localStorage.removeItem(e))),ee.logger.log("\ud83d\uddd1\ufe0f Cleared ".concat(e.length," refresh cache entries"))}catch(e){ee.logger.warn("\u26a0\ufe0f Error clearing all refresh caches:",e)}}watchEventGroup(e,t){const r=new Date(e.releaseTime),n=new Date,a=r.getTime()-n.getTime();if(a<=0)return void this.triggerEventGroupUpdate(e.events,t);const o="".concat(t),s=this.watchedEventGroups.get(o);s&&clearTimeout(s.timeoutId);const i=setTimeout((()=>{this.triggerEventGroupUpdate(e.events,t)}),a);this.watchedEventGroups.set(o,{events:e.events,timeoutId:i,calendarId:t,releaseTime:e.releaseTime}),ee.logger.log("\u23f0 Event group (".concat(e.events.length," events) will be updated in ").concat(Math.round(a/1e3/60)," minutes"))}async triggerEventGroupUpdate(e,t){if(this.callbacks&&0!==e.length)try{ee.logger.log("\ud83d\udd04 Triggering batch update for ".concat(e.length," event(s) releasing at the same time"));const r=e.map((e=>{const t=e.country||this.currencyToCountry(e.currency);return{event_name:e.event_name,country:t||"Unknown",originalEvent:e}})).filter((e=>"Unknown"!==e.country)),a=e.length-r.length;a>0&&ee.logger.warn("\u26a0\ufe0f Could not determine country for ".concat(a," event(s)"));const o=[];if(r.length>0){const{data:t,error:a}=await gn.N.functions.invoke("fetch-mql5-event",{body:{events:r.map((e=>{let{event_name:t,country:r}=e;return{event_name:t,country:r}}))}});if(a)ee.logger.error("\u274c Error fetching batch events:",a),o.push(...e);else{const e=t,a=(null===e||void 0===e?void 0:e.results)||[];ee.logger.log("\ud83d\udcca Batch fetch complete: ".concat((null===e||void 0===e?void 0:e.succeeded)||0," succeeded, ").concat((null===e||void 0===e?void 0:e.failed)||0," failed"));for(const t of r){const e=a.find((e=>e.event_name===t.event_name&&e.country===t.country));if(null!==e&&void 0!==e&&e.success&&e.data){const r=e.data,a=(0,n.A)((0,n.A)({},t.originalEvent),{},{actual_value:r.actual_value||t.originalEvent.actual_value,forecast_value:r.forecast_value||t.originalEvent.forecast_value,previous_value:r.previous_value||t.originalEvent.previous_value,impact:r.impact||t.originalEvent.impact});o.push(a);const s=r.cached?" (cached)":" (fresh from MQL5)";ee.logger.log('\ud83d\udcca Event "'.concat(t.event_name,'"').concat(s,":")),ee.logger.log("   Actual: ".concat(t.originalEvent.actual_value," \u2192 ").concat(r.actual_value))}else ee.logger.warn('\u26a0\ufe0f Failed to fetch "'.concat(t.event_name,'": ').concat((null===e||void 0===e?void 0:e.error)||"Unknown error")),o.push(t.originalEvent)}}}const s=e.filter((e=>!e.country&&!this.currencyToCountry(e.currency)));o.push(...s);const i=this.eventQueues.get(t);if(i){const t=e.map((e=>e.id));i.events=i.events.filter((e=>!t.includes(e.id)))||[]}this.callbacks.onEventsUpdated(o,o,t),this.watchedEventGroups.delete(t),this.isActive&&setTimeout((()=>{this.continueWatching(t)}),5e3)}catch(r){(0,ee.error)("\u274c Error updating event group:",r),this.callbacks.onError(r,t)}}currencyToCountry(e){return{USD:"United States",EUR:"Euro Area",GBP:"United Kingdom",JPY:"Japan",CHF:"Switzerland",CAD:"Canada",AUD:"Australia",NZD:"New Zealand",CNY:"China",CNH:"China",HKD:"Hong Kong",SGD:"Singapore",INR:"India",KRW:"South Korea",MXN:"Mexico",BRL:"Brazil",ZAR:"South Africa",TRY:"Turkey",RUB:"Russia",SEK:"Sweden",NOK:"Norway",DKK:"Denmark",PLN:"Poland"}[e]||null}async continueWatching(e){if(this.callbacks){(0,ee.log)("\ud83d\udd04 Continuing to watch next event for calendar: ".concat(e));try{const t=this.eventQueues.get(e);if(!t)return void ee.logger.log("\ud83d\udcc5 No event queue found for calendar: ".concat(e));if(t.events.length>0)this.watchNextEventFromQueue(e);else{ee.logger.log("\ud83d\udccb Event queue exhausted for calendar: ".concat(e,", refreshing...")),await this.initializeEventQueue(e,t.currencies,t.impacts);const r=this.eventQueues.get(e);r&&r.events.length>0?this.watchNextEventFromQueue(e):(ee.logger.log("\ud83d\udcc5 No more upcoming events found for today"),this.isActive=!1)}}catch(t){(0,ee.error)("\u274c Error continuing event watching:",t),this.callbacks.onError(t,e)}}}getWatchingStatus(){const e=Array.from(this.eventQueues.entries()).map((e=>{let[t,r]=e;const n=localStorage.getItem(this.getRefreshKey(t)),a=n?parseInt(n,10):null,o=a?Date.now()-a:null;return{calendarId:t,totalEvents:r.events.length,lastFetched:new Date(r.lastFetched).toISOString(),lastRefresh:a?new Date(a).toISOString():null,minutesSinceRefresh:o?Math.round(o/1e3/60):null,needsRefresh:!a||o>ho.maxRefreshAge}}));return{isActive:this.isActive,watchedEventsCount:this.watchedEventGroups.size,watchedEventGroups:Array.from(this.watchedEventGroups.values()).map((e=>({eventCount:e.events.length,events:e.events.map((e=>e.event_name)),releaseTime:e.releaseTime,calendarId:e.calendarId}))),eventQueues:e,config:ho}}};var mo=r(18837),xo=r(5093);const fo=e=>{let{event:t,onClose:r,autoHideDuration:o=5e3,isRemoving:c=!1}=e;const u=(0,s.A)(),[g,h]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(t&&!c){h(!0);const e=setTimeout((()=>{m()}),o);return()=>clearTimeout(e)}}),[t,o,c]);const m=()=>{c||(h(!1),setTimeout((()=>{r()}),300))};if((0,a.useEffect)((()=>{c&&h(!1)}),[c]),!t)return null;const x=e=>{switch(e.toLowerCase()){case"high":return u.palette.error.main;case"medium":return u.palette.warning.main;case"low":return u.palette.info.main;default:return u.palette.grey[500]}},f=(()=>{if(!t.actual_value)return{icon:(0,re.jsx)(mo.A,{}),color:u.palette.grey[500],text:"Updated"};if(t.actual_result_type)switch(t.actual_result_type){case"good":return{icon:(0,re.jsx)(oe.A,{}),color:u.palette.success.main,text:"Good Result"};case"bad":return{icon:(0,re.jsx)(_r.A,{}),color:u.palette.error.main,text:"Bad Result"};case"neutral":return{icon:(0,re.jsx)(mo.A,{}),color:u.palette.info.main,text:"As Expected"};default:return{icon:(0,re.jsx)(mo.A,{}),color:u.palette.grey[500],text:"Updated"}}if(!t.forecast_value)return{icon:(0,re.jsx)(mo.A,{}),color:u.palette.grey[500],text:"Updated"};const e=parseFloat(t.actual_value.replace(/[^\d.-]/g,"")),r=parseFloat(t.forecast_value.replace(/[^\d.-]/g,""));return isNaN(e)||isNaN(r)?{icon:(0,re.jsx)(mo.A,{}),color:u.palette.grey[500],text:"Updated"}:e>r?{icon:(0,re.jsx)(oe.A,{}),color:u.palette.success.main,text:"Above Forecast"}:e<r?{icon:(0,re.jsx)(_r.A,{}),color:u.palette.error.main,text:"Below Forecast"}:{icon:(0,re.jsx)(mo.A,{}),color:u.palette.info.main,text:"As Expected"}})();return(0,re.jsx)(i.A,{sx:{pointerEvents:"auto"},children:(0,re.jsx)(io.A,{direction:"right",in:g,mountOnEnter:!0,unmountOnExit:!0,children:(0,re.jsxs)(ae.A,{elevation:8,sx:{width:320,maxWidth:"calc(100vw - 24px)",borderRadius:1,overflow:"hidden",background:"dark"===u.palette.mode?u.palette.background.default:"linear-gradient(135deg, ".concat(u.palette.background.paper," 0%, ").concat(u.palette.background.default," 100%)"),border:"1px solid ".concat((0,d.X4)(u.palette.divider,"dark"===u.palette.mode?.3:.15)),boxShadow:u.shadows[8],borderLeft:"4px solid ".concat(x(t.impact)),pointerEvents:"auto"},children:[(0,re.jsxs)(i.A,{sx:{background:"linear-gradient(90deg, ".concat(x(t.impact)," 0%, ").concat((0,d.X4)(x(t.impact),.8)," 100%)"),color:u.palette.getContrastText(x(t.impact)),p:1,display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:32},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.75},children:[f.icon,(0,re.jsx)(l.A,{variant:"caption",fontWeight:"bold",sx:{fontSize:"0.8rem"},children:"Economic Event Updated"})]}),(0,re.jsx)(p.A,{size:"small",onClick:m,sx:{color:"white","&:hover":{backgroundColor:"rgba(255,255,255,0.1)"},p:.25},children:(0,re.jsx)(Ue.A,{sx:{fontSize:"1rem"}})})]}),(0,re.jsx)(i.A,{sx:{p:1.5},children:(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,width:"100%"},children:[(0,re.jsxs)(i.A,{sx:{minWidth:32,mt:.25,display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[(0,re.jsx)("img",{src:t.flag_url,alt:t.country,style:{width:20,height:15,borderRadius:2,objectFit:"cover",border:"1px solid ".concat((0,d.X4)(u.palette.divider,.2))}}),(0,re.jsx)(l.A,{variant:"caption",sx:{fontWeight:700,textAlign:"center",fontSize:"0.7rem",color:"text.primary",minWidth:32},children:t.currency})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:.5,width:"100%",flex:1},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,re.jsx)(l.A,{variant:"caption",sx:{fontWeight:600,color:"text.primary",fontSize:"0.75rem",minWidth:80},children:(0,P.A)((0,xo.A)(t.time_utc),"h:mm a")}),(0,re.jsx)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:24},children:(0,re.jsx)(l.A,{variant:"caption",sx:{color:f.color,fontWeight:700,fontSize:"0.65rem"},children:f.text})}),(0,re.jsx)(i.A,{sx:{flex:1}}),(0,re.jsx)(me.A,{label:t.impact.toUpperCase(),size:"small",sx:{height:20,fontSize:"0.6rem",fontWeight:700,backgroundColor:x(t.impact),color:"white",minWidth:40,borderRadius:1,"& .MuiChip-label":{px:.75,py:.25}}})]}),(0,re.jsx)(l.A,{variant:"body2",sx:{fontWeight:600,fontSize:"0.9rem",color:"text.primary",lineHeight:1.3,mb:.5},children:t.event_name}),(t.actual_value||t.forecast_value||t.previous_value)&&(0,re.jsxs)(i.A,{sx:{display:"flex",gap:1.5,alignItems:"center",flexWrap:"wrap"},children:[t.actual_value&&(0,re.jsxs)(l.A,{variant:"caption",sx:(0,n.A)({fontWeight:700,fontSize:"0.7rem",px:1,py:.25,borderRadius:1},(e=>{switch(e){case"good":return{backgroundColor:(0,d.X4)(u.palette.success.main,.15),border:"1px solid ".concat((0,d.X4)(u.palette.success.main,.3)),color:u.palette.success.dark};case"bad":return{backgroundColor:(0,d.X4)(u.palette.error.main,.15),border:"1px solid ".concat((0,d.X4)(u.palette.error.main,.3)),color:u.palette.error.dark};case"neutral":return{backgroundColor:(0,d.X4)(u.palette.info.main,.1),border:"1px solid ".concat((0,d.X4)(u.palette.info.main,.2)),color:u.palette.info.dark};default:return{backgroundColor:(0,d.X4)(u.palette.success.main,.1),border:"1px solid ".concat((0,d.X4)(u.palette.success.main,.2)),color:"text.primary"}}})(t.actual_result_type)),children:["A: ",t.actual_value]}),t.forecast_value&&(0,re.jsxs)(l.A,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.7rem",fontWeight:600,backgroundColor:(0,d.X4)(u.palette.info.main,.1),px:1,py:.25,borderRadius:1,border:"1px solid ".concat((0,d.X4)(u.palette.info.main,.2))},children:["F: ",t.forecast_value]}),t.previous_value&&(0,re.jsxs)(l.A,{variant:"caption",sx:{color:"text.disabled",fontSize:"0.7rem",fontWeight:600,backgroundColor:(0,d.X4)(u.palette.grey[500],.1),px:1,py:.25,borderRadius:1,border:"1px solid ".concat((0,d.X4)(u.palette.grey[500],.2))},children:["P: ",t.previous_value]})]})]})]})})]})})})},yo="highImpactEvents",vo=e=>{let{currentDate:t,calendarId:r,currencies:n=te.C.currencies,enabled:o=!0}=e;const[s,i]=(0,a.useState)(new Map),[l,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(null),[g,h]=(0,a.useState)(null),p=n.join(",");return(0,a.useEffect)((()=>{if(!o||!r)return;const e="highImpactEvents_lastCleanup",a=localStorage.getItem(e),s=Date.now();(!a||s-parseInt(a)>864e5)&&(bo(),localStorage.setItem(e,s.toString())),r&&Ao(r,n);(async()=>{const e=(0,P.A)(t,"yyyy-MM"),a=n.sort().join("-"),o="".concat(yo,"_").concat(e,"_").concat(r,"_").concat(a),s="".concat(o,"_expiry"),l="".concat(o,"_meta"),d=localStorage.getItem(o),g=localStorage.getItem(s),p=localStorage.getItem(l),m=Date.now(),x=((e=>{const t=new Date,r=t.getMonth(),n=t.getFullYear(),a=e.getMonth(),o=e.getFullYear();(o<n||o===n&&a<r)&&Number.MAX_SAFE_INTEGER})(t),t<new Date((new Date).getFullYear(),(new Date).getMonth(),1));if(d&&g&&m<parseInt(g)){const t=m-(p&&JSON.parse(p).lastUpdated||0),r=Math.round(t/36e5),a=n.join(", ");(0,ee.log)("\ud83d\udccb Using cached high-impact events for ".concat(e," [").concat(a,"] (").concat(r,"h old, ").concat(x?"permanent":"expires "+new Date(parseInt(g)).toLocaleString(),")"));try{const e=new Map(JSON.parse(d)),t=p?JSON.parse(p):{};return i(e),h(t.lastUpdated||m),void u(null)}catch(f){(0,ee.warn)("Failed to parse cached data, fetching fresh data")}}c(!0),u(null);try{const r=(0,N.A)(t),a=(0,F.A)(t),c={start:(0,P.A)(r,"yyyy-MM-dd"),end:(0,P.A)(a,"yyyy-MM-dd")};(0,ee.log)("\ud83d\udd04 Fetching fresh high-impact events for ".concat(e," [").concat(n.join(", "),"]"));const d=await co.$.fetchEvents(c,{currencies:n,impacts:["High"],onlyUpcoming:!1,limit:500}),u=new Map;d.forEach((e=>{u.set(e.event_date,!0)})),i(u),h(m);const g=JSON.stringify(Array.from(u.entries())),p=JSON.stringify({lastUpdated:m,eventCount:d.length,currencies:n.join(","),monthType:x?"previous":t.getMonth()===(new Date).getMonth()?"current":"future"});let f;f=x?m+31536e6:t.getMonth()===(new Date).getMonth()&&t.getFullYear()===(new Date).getFullYear()?(()=>{const e=new Date,t=(7-e.getDay())%7,r=new Date(e);return r.setDate(e.getDate()+(0===t?7:t)),r.setHours(0,0,0,0),r.getTime()})():m+864e5,localStorage.setItem(o,g),localStorage.setItem(s,f.toString()),localStorage.setItem(l,p);const y=x?"permanently":t.getMonth()===(new Date).getMonth()?"until next Sunday":"for 1 day";(0,ee.log)("\ud83d\udccd Found ".concat(d.length," high-impact events for ").concat(e," [").concat(n.join(", "),"] (cached ").concat(y,")"))}catch(y){if((0,ee.error)("\u274c Error fetching high-impact events:",y),u(y instanceof Error?y.message:"Failed to fetch events"),d){(0,ee.log)("\ud83d\udd04 Using expired cache as fallback for ".concat(e));try{const e=new Map(JSON.parse(d));i(e),u("Using cached data (may be outdated)")}catch(f){(0,ee.error)("Failed to parse fallback cache data")}}}finally{c(!1)}})()}),[t,r,p,o]),{highImpactEventDates:s,isLoading:l,error:d,lastUpdated:g}},Ao=(e,t)=>{const r=Object.keys(localStorage),n=t.sort().join("-"),a=r.filter((t=>!!t.startsWith(yo)&&(!!t.includes("_".concat(e,"_"))&&!t.includes("_".concat(n)))));a.forEach((e=>localStorage.removeItem(e))),a.length>0&&(0,ee.log)("\ud83e\uddf9 Cleared ".concat(a.length," old currency cache entries for calendar ").concat(e))},bo=()=>{const e=Object.keys(localStorage),t=Date.now();let r=0,n=0;e.forEach((e=>{if(e.startsWith(yo)&&e.includes("_expiry")){const a=localStorage.getItem(e);if(a){const o=parseInt(a);if(o>t+31536e6)return void n++;if(t>o){const t=e.replace("_expiry","");localStorage.removeItem(e),localStorage.removeItem(t),localStorage.removeItem("".concat(t,"_meta")),r++}}}})),(r>0||n>0)&&(0,ee.log)("\ud83e\uddf9 Cleaned up ".concat(r," expired cache entries, preserved ").concat(n," permanent entries"))},jo=async()=>{try{const e=new Audio("/notification.mp3");e.volume=.6;const t=e.play();void 0!==t&&await t}catch(e){try{await new Promise((t=>{try{const e=new(window.AudioContext||window.webkitAudioContext),r=e.createOscillator(),n=e.createGain();r.connect(n),n.connect(e.destination),r.frequency.setValueAtTime(800,e.currentTime),r.frequency.exponentialRampToValueAtTime(1e3,e.currentTime+.1),r.type="sine",n.gain.setValueAtTime(0,e.currentTime),n.gain.linearRampToValueAtTime(.3,e.currentTime+.01),n.gain.exponentialRampToValueAtTime(.001,e.currentTime+.2),r.start(e.currentTime),r.stop(e.currentTime+.2),setTimeout((()=>{e.close(),t()}),250)}catch(e){t()}}))}catch(t){ee.logger.debug("Could not play notification sound:",e)}}};function wo(e){const{calendarId:t,selectedCalendar:r,enableRealtime:o=!0,setLoading:s}=e,i=(0,Kn.eq)(),[l,c]=(0,a.useState)(new Map),[d,u]=(0,a.useState)(null),[g,h]=(0,a.useState)(!1),[p,m]=(0,a.useState)(null),[x,f]=(0,a.useState)(null),[y,v]=(0,a.useState)(new Set),[A]=(0,a.useState)(new Map),b=(0,a.useRef)([]),j=(0,a.useRef)(null),w=(0,a.useRef)(null),[,k]=(0,a.useTransition)(),C=(0,a.useMemo)((()=>Array.from(l.values())),[l]),S=(0,a.useCallback)((e=>{c((t=>e(t)))}),[]),_=(0,a.useCallback)((()=>f(null)),[]),T=(0,a.useCallback)((e=>y.has(e)),[y]),I=(0,a.useCallback)((e=>{const t=new Map;for(const r of e)t.set(r.id,r);c(t)}),[]),M=(0,a.useCallback)(((e,t)=>"month:".concat(e,"-").concat(String(t+1).padStart(2,"0"))),[]),E=(0,a.useCallback)(((e,t)=>"range:".concat(e.toISOString(),"-").concat(t.toISOString())),[]),z=(0,a.useCallback)((e=>{const t=A.get(e);if(t){const r=b.current,n=r.indexOf(e);return n>-1&&r.splice(n,1),r.push(e),ee.logger.log("\ud83d\udce6 Cache HIT for ".concat(e," (").concat(t.size," trades)")),t}return ee.logger.log("\ud83d\udce6 Cache MISS for ".concat(e)),null}),[A]),D=(0,a.useCallback)(((e,t)=>{A.set(e,new Map(t));const r=b.current,n=r.indexOf(e);for(n>-1&&r.splice(n,1),r.push(e);r.length>12;){const e=r.shift();e&&(A.delete(e),ee.logger.log("\ud83d\udce6 Cache EVICTED ".concat(e," (exceeded ").concat(12," limit)")))}ee.logger.log("\ud83d\udce6 Cache SET ".concat(e," (").concat(t.size," trades, total cached: ").concat(A.size,")"))}),[A,12]),R=(0,a.useCallback)((()=>{A.clear(),b.current=[],ee.logger.log("\ud83d\udce6 Cache CLEARED")}),[A]),W=(0,a.useCallback)((e=>{const t=new Date(e.trade_date);let r=0,n=0;A.forEach(((a,o)=>{const s=a.has(e.id);let i=!1;if(o.startsWith("month:")){const[,e]=o.split(":"),[r,n]=e.split("-").map(Number);i=t.getFullYear()===r&&t.getMonth()===n-1}else if(o.startsWith("range:")){const[,e]=o.split("range:"),[r,n]=e.split("-"),a=new Date(r),s=new Date(n);i=t>=a&&t<=s}i&&!s||i&&s?(a.set(e.id,e),n++):!i&&s&&(a.delete(e.id),r++)})),(n>0||r>0)&&ee.logger.log("\ud83d\udce6 Cache UPDATED trade ".concat(e.id,": added to ").concat(n,", removed from ").concat(r," cached entries"))}),[A]),P=(0,a.useCallback)(((e,t)=>{let r=0;A.forEach(((t,n)=>{t.has(e)&&(t.delete(e),r++)})),r>0&&ee.logger.log("\ud83d\udce6 Cache REMOVED trade ".concat(e," from ").concat(r," cached entries"))}),[A]),N=(0,a.useCallback)((async()=>{if(u(r||null),t){h(!0),m(null);try{const[e,r]=await Promise.all([it.getCalendar(t),it.getAllTrades(t)]);u(e),I(r),ee.logger.log("\u2705 Loaded all ".concat(r.length," trades for calendar ").concat(t))}catch(e){const t=e instanceof Error?e:new Error("Failed to fetch trades");ee.logger.error("Error fetching trades:",t),m(t),c(new Map)}finally{h(!1)}}else c(new Map)}),[t,I,r]);(0,a.useEffect)((()=>{s(g,"loading")}),[g]),(0,a.useEffect)((()=>{r&&u(r)}),[r]),(0,a.useEffect)((()=>()=>{j.current&&clearTimeout(j.current),R()}),[t]);const F=(0,a.useCallback)((async e=>{if(!t)throw new Error("Calendar ID is required");v((t=>{const r=new Set(t);return r.add(e.id),r})),null===i||void 0===i||i.setTradeUpdating(e.id,!0),S((t=>{const r=new Map(t);return r.set(e.id,e),r}));try{await it.addTrade(t,e),ee.logger.log("\u2705 Trade added: ".concat(e.id)),W(e),null===i||void 0===i||i.broadcastTradeInsert(e),f({message:"Trade added successfully",type:"success"})}catch(r){throw S((t=>{const r=new Map(t);return r.delete(e.id),r})),ee.logger.error("Error adding trade:",r),f({message:r instanceof Error?r.message:"Failed to add trade",type:"error"}),r}finally{v((t=>{const r=new Set(t);return r.delete(e.id),r})),null===i||void 0===i||i.setTradeUpdating(e.id,!1)}}),[t,S,W,i]),L=(0,a.useCallback)((async e=>{if(!t)throw new Error("Calendar ID is required");v((t=>{const r=new Set(t);return e.forEach((e=>r.add(e))),r})),e.forEach((e=>null===i||void 0===i?void 0:i.setTradeUpdating(e,!0)));let r=new Map;const n=[];S((t=>{r=t;const a=new Map(t);for(const r of e){const e=t.get(r);e&&n.push(e),a.delete(r)}return a}));try{await Promise.all(e.map((e=>it.deleteTrade(e)))),ee.logger.log("\u2705 Deleted ".concat(e.length," trade(s)")),e.forEach((e=>P(e))),n.forEach((e=>null===i||void 0===i?void 0:i.broadcastTradeDelete(e))),f({message:"Deleted ".concat(e.length," trade(s)"),type:"success"})}catch(a){throw c(r),ee.logger.error("Error deleting trades:",a),f({message:a instanceof Error?a.message:"Failed to delete trades",type:"error"}),a}finally{v((t=>{const r=new Set(t);return e.forEach((e=>r.delete(e))),r})),e.forEach((e=>null===i||void 0===i?void 0:i.setTradeUpdating(e,!1)))}}),[t,S,P,i]),X=(0,a.useCallback)((async e=>{if(!d)return;if(e)return ee.logger.log("Resetting to actual trade amounts..."),void N();ee.logger.log("Loading all trades for dynamic risk recalculation..."),h(!0);const t=await it.getAllTrades(d.id);I(t),h(!1);h(!0),await(async()=>{if(!d.risk_per_trade||!t.length)return;ee.logger.log("Recalculating ALL trades based on risk to reward to show potential...");const e=[...t].sort(((e,t)=>new Date(e.trade_date).getTime()-new Date(t.trade_date).getTime())),r={account_balance:d.account_balance,risk_per_trade:d.risk_per_trade,dynamic_risk_enabled:d.dynamic_risk_enabled,increased_risk_percentage:d.increased_risk_percentage,profit_threshold_percentage:d.profit_threshold_percentage},a=[];let o=0;const s=Math.ceil(e.length/50);for(let t=0;t<s;t++){const i=50*t,l=Math.min(i+50,e.length),c=e.slice(i,l);for(let e=0;e<c.length;e++){const t=c[e];if(!t.risk_to_reward||"breakeven"===t.trade_type){o+=t.amount,a.push(t);continue}const s=await(0,Q.zH)(new Date(t.trade_date),d,r,a),i=(0,Q.GU)(s,d.account_balance,o);let l=0;"win"===t.trade_type?l=Math.round(i*t.risk_to_reward):"loss"===t.trade_type&&(l=-Math.round(i)),o+=l,a.push((0,n.A)((0,n.A)({},t),{},{amount:l}))}t<s-1&&(await new Promise((e=>setTimeout(e,0))),ee.logger.log("Processed batch ".concat(t+1,"/").concat(s," (").concat(a.length,"/").concat(e.length," trades)")))}ee.logger.log("\u2705 Completed recalculation of ".concat(a.length," trades"));const i=await it.calculateCalendarStats(d.id,a);k((()=>{I(a),u((0,n.A)((0,n.A)({},d),i))}))})(),h(!1)}),[d,C,N,k,I]),O=(0,a.useCallback)((async e=>{if(!d)throw new Error("Calendar with ID ".concat(t," not found"));try{h(!0);const t=await it.importTrades(d.id,C,e);I(t),R()}catch(p){throw ee.logger.error("Error importing trades:",p),p}finally{h(!1)}}),[d,t,C,I,R]);(0,Ia.M)({channelName:"calendar-".concat(t),enabled:o&&!!t,onChannelCreated:e=>{ee.logger.log("\ud83d\udd27 Setting up calendar broadcast subscription for calendar-".concat(t)),e.on("broadcast",{event:"*"},(e=>{var r;if(ee.logger.log("\ud83d\udce1 Broadcast event received on calendar-".concat(t,":"),e),"UPDATE"===e.event&&null!==(r=e.payload)&&void 0!==r&&r.record){const t=e.payload.record;w.current=t,j.current&&clearTimeout(j.current),j.current=setTimeout((()=>{w.current&&(ee.logger.log("\ud83d\udce1 Applying debounced calendar update"),u(w.current),w.current=null)}),150)}}))},onSubscribed:()=>{ee.logger.log("\u2705 Calendar broadcast subscription ACTIVE for calendar-".concat(t))},onError:e=>{ee.logger.error("\u274c Calendar broadcast subscription ERROR for calendar-".concat(t,":"),e)}}),(0,Ia.M)({channelName:"trades-".concat(t),enabled:o&&!!t,onChannelCreated:e=>{e.on("broadcast",{event:"INSERT"},(e=>{var t;if(null!==(t=e.payload)&&void 0!==t&&t.record){const t=e.payload.record;c((e=>{if(e.has(t.id))return e;const r=new Map(e);return r.set(t.id,t),r})),W(t),ee.logger.log("\u2795 Trade added via broadcast: ".concat(t.id))}})),e.on("broadcast",{event:"UPDATE"},(e=>{var t;if(null!==(t=e.payload)&&void 0!==t&&t.record){const t=e.payload.record;c((e=>{const r=new Map(e);return r.set(t.id,t),r})),W(t),ee.logger.log("\u270f\ufe0f Trade updated via broadcast: ".concat(t.id))}})),e.on("broadcast",{event:"DELETE"},(e=>{var t;if(null!==(t=e.payload)&&void 0!==t&&t.old_record){const t=e.payload.old_record;c((e=>{const r=new Map(e);return r.delete(t.id),r})),P(t.id),ee.logger.log("\ud83d\uddd1\ufe0f Trade deleted via broadcast: ".concat(t.id))}}))},onSubscribed:()=>{ee.logger.log("\u2705 Trade broadcast subscription ACTIVE for calendar-".concat(t))},onError:e=>{ee.logger.error("\u274c Trade broadcast subscription ERROR for calendar-".concat(t,":"),e)}});const B=(0,a.useCallback)((async e=>{if(!d)throw new Error("Calendar with ID ".concat(t," not found"));try{await it.updateCalendar(d.id,{account_balance:e}),u((t=>t?(0,n.A)((0,n.A)({},t),{},{account_balance:e}):t))}catch(p){throw ee.logger.error("Error updating account balance:",p),p}}),[d,t]),U=(0,a.useCallback)((async(e,r)=>{if(!d)throw new Error("Calendar with ID ".concat(t," not found"));try{const t=[];c((n=>{const a=new Map;return n.forEach(((n,o)=>{const s=new Date(n.trade_date);s.getFullYear()===r&&s.getMonth()===e?t.push(n):a.set(o,n)})),a})),await it.getTradeRepository().bulkDelete(t),t.forEach((e=>P(e.id)))}catch(p){ee.logger.error("Error clearing month trades:",p)}}),[d,t,P]),q=(0,a.useCallback)((async e=>{if(!d)throw new Error("Calendar with ID ".concat(t," not found"));try{const t=await it.updateCalendar(d.id,e(d));if(t)return u(t),t}catch(p){throw ee.logger.error("Error updating calendar:",p),p}}),[d,t]),G=(0,a.useCallback)((async(e,r)=>{if(!t)return ee.logger.error("Cannot update tag: calendarId is undefined"),{success:!1,tradesUpdated:0};try{ee.logger.log('\ud83c\udff7\ufe0f Updating tag via edge function: "'.concat(e,'" \u2192 "').concat(r,'"'));const{data:n,error:a}=await gn.N.functions.invoke("update-tag",{body:{calendar_id:t,old_tag:e,new_tag:r}});if(a)throw ee.logger.error("Edge function error:",a),a;return n&&n.success?(ee.logger.log("\u2705 Tag updated successfully: ".concat(n.tradesUpdated," trades affected")),{success:!0,tradesUpdated:n.tradesUpdated||0}):(ee.logger.error("Tag update failed:",(null===n||void 0===n?void 0:n.message)||"Unknown error"),ee.logger.error("Full response data:",n),{success:!1,tradesUpdated:0})}catch(p){return ee.logger.error("Error updating tag:",p),{success:!1,tradesUpdated:0}}}),[t]),H=(0,a.useCallback)((async(e,r)=>{if(!t)return void ee.logger.error("Cannot load month trades: calendarId is undefined");const n=M(e,r),a=z(n);if(a)return c(a),void ee.logger.log("\u2705 Using cached trades for ".concat(e,"-").concat(r+1," (").concat(a.size," trades)"));h(!0),m(null);try{ee.logger.log("\ud83d\udcc5 Loading trades for ".concat(e,"-").concat(r+1," from database"));const a=await it.getTradeRepository().getTradesByMonth(t,e,r),o=new Map;for(const e of a)o.set(e.id,e);D(n,o),I(a),ee.logger.log("\u2705 Loaded ".concat(a.length," trades for ").concat(e,"-").concat(r+1))}catch(o){const e=o instanceof Error?o:new Error("Failed to load month trades");ee.logger.error("Error loading month trades:",e),m(e),c(new Map)}finally{h(!1)}}),[t,I,M,z,D]),Y=(0,a.useCallback)((async(e,r)=>{if(!t)return void ee.logger.error("Cannot load visible range trades: calendarId is undefined");const n=E(e,r),a=z(n);if(a)return c(a),void ee.logger.log("\u2705 Using cached trades for visible range (".concat(a.size," trades)"));h(!0),m(null);try{ee.logger.log("\ud83d\udcc5 Loading visible calendar range from database");const a=await it.getTradeRepository().getTradesByDateRange(t,e,r),o=new Map;for(const e of a)o.set(e.id,e);D(n,o),I(a),ee.logger.log("\u2705 Loaded ".concat(a.length," trades for visible range"))}catch(o){const e=o instanceof Error?o:new Error("Failed to load visible range trades");ee.logger.error("Error loading visible range trades:",e),m(e),c(new Map)}finally{h(!1)}}),[t,I,E,z,D]);return{trades:C,calendar:d,isLoading:g,error:p,addTrade:F,deleteTrades:L,loadMonthTrades:H,loadVisibleRangeTrades:Y,handleUpdateTradeProperty:async(e,r,n)=>{if(!d)throw new Error("Calendar with ID ".concat(t," not found"));v((t=>{const r=new Set(t);return r.add(e),r})),null===i||void 0===i||i.setTradeUpdating(e,!0);try{let t=l.get(e)||await it.getTrade(d.id,e);if(!t&&n){const t=await it.addTrade(d.id,r(n(e)));return S((e=>{const r=new Map(e);return r.set(t.id,t),r})),W(t),null===i||void 0===i||i.broadcastTradeInsert(t),f({message:"Trade created successfully",type:"success"}),t}if(!t)throw new Error("Trade with ID ".concat(e," not found"));const a=await it.updateTrade(t,r);if(!a)return;return S((t=>{const r=new Map(t);return r.set(e,a),r})),W(a),null===i||void 0===i||i.broadcastTradeUpdate(a),f({message:"Trade updated successfully",type:"success"}),a}catch(p){throw ee.logger.error("Error updating trade:",p),f({message:p instanceof Error?p.message:"Failed to update trade",type:"error"}),p}finally{v((t=>{const r=new Set(t);return r.delete(e),r})),null===i||void 0===i||i.setTradeUpdating(e,!1)}},onTagUpdated:G,handleToggleDynamicRisk:X,handleImportTrades:O,handleAccountBalanceChange:B,handleClearMonthTrades:U,handleUpdateCalendarProperty:q,notification:x,clearNotification:_,isTradeUpdating:T}}const ko=a.memo((e=>{let{trade_date:t,weekIndex:r,weeklyTarget:a,sx:o,weekStats:h,accountBalance:p}=e;const m=(0,s.A)(),{weekTrades:x,netAmount:f,percentage:y,targetProgressValue:v}=h,A=v.toFixed(0),b=!!a&&parseFloat(y)>=a,j=(0,D.A)(t,new Date,{weekStartsOn:0}),w=a?p*a/100:0,k=Math.max(0,w-f),C=Math.min(Math.max(v,0),100),S=j&&a?(0,re.jsxs)(i.A,{sx:{p:1,minWidth:220},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[(0,re.jsx)(l.A,{variant:"subtitle2",sx:{fontWeight:600,color:"info.light"},children:"Weekly Target"}),(0,re.jsxs)(l.A,{variant:"caption",sx:{fontWeight:700,color:"white"},children:[a,"% ($",w.toLocaleString(void 0,{maximumFractionDigits:0}),")"]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1},children:[(0,re.jsx)(i.A,{sx:{flex:1},children:(0,re.jsx)(c.A,{variant:"determinate",value:C,sx:{height:6,borderRadius:3,bgcolor:(0,d.X4)(m.palette.common.white,.1),"& .MuiLinearProgress-bar":{borderRadius:3,bgcolor:b?"success.light":"info.main"}}})}),(0,re.jsxs)(l.A,{variant:"caption",sx:{fontWeight:700,color:b?"success.light":"info.light"},children:[A,"%"]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,re.jsx)(l.A,{variant:"caption",sx:{color:"text.secondary"},children:"Remaining:"}),(0,re.jsxs)(l.A,{variant:"caption",sx:{fontWeight:600,color:"white"},children:["$",k.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}):"",_=(0,re.jsx)(gt,{sx:(0,n.A)({bgcolor:"background.paper",borderRadius:1,border:"2px solid ".concat(f>0?(0,d.X4)(m.palette.success.main,.3):f<0?(0,d.X4)(m.palette.error.main,.3):(0,d.X4)(m.palette.divider,.2)),justifyContent:"center",alignItems:"center",position:"relative"},o),children:(0,re.jsxs)(u.A,{spacing:.5,sx:{alignItems:"center",p:1},children:[(0,re.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:(0,re.jsxs)(l.A,{variant:"caption",sx:{fontSize:"0.8rem",fontWeight:600,color:"text.primary"},children:["Week ",r+1]})}),(0,re.jsx)(l.A,{variant:"h6",sx:{fontWeight:700,color:f>0?"success.main":f<0?"error.main":"text.primary",fontSize:{xs:"0.9rem",md:"1rem"},textAlign:"center"},children:(0,G.vv)(f)}),(0,re.jsxs)(u.A,{direction:"row",spacing:.5,alignItems:"center",justifyContent:"center",children:[(0,re.jsxs)(l.A,{variant:"body2",sx:{color:f>0?"success.main":f<0?"error.main":"text.secondary",fontSize:"0.8rem",fontWeight:600,textAlign:"center"},children:[y,"%"]}),a&&(0,re.jsx)(ge,{progress:parseFloat(A),isMet:b,tooltipText:j?"":"".concat(b?"Weekly target achieved":"Progress towards weekly target",": ").concat(A,"%")})]}),(0,re.jsxs)(l.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",color:"text.secondary",fontWeight:500},children:[x.length," trade",1!==x.length?"s":""]})]})});return j&&a?(0,re.jsx)(g.A,{title:S,arrow:!0,placement:"left",children:_}):_})),Co=()=>({id:(0,o.A)(),name:"",amount:0,trade_type:"win",entry_price:0,trade_date:null,exit_price:0,stop_loss:0,take_profit:0,tags:[],risk_to_reward:0,partials_taken:!1,session:"",notes:"",pending_images:[],uploaded_images:[],economic_events:[]}),So=a.memo((e=>{let{allTags:t,selectedTags:r,onTagsChange:a,onOpenDrawer:o}=e;const l=(0,s.A)();return(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:{xs:.5,sm:1},flex:{xs:1,sm:"none"}},children:[(0,re.jsx)(g.A,{title:"Filter by tags",arrow:!0,children:(0,re.jsx)(h.A,{variant:r.length>0?"contained":"outlined",size:"small",startIcon:(0,re.jsx)(A.A,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}}),onClick:o,sx:(0,n.A)((0,n.A)({flex:1,minWidth:{xs:"auto",sm:"120px"},borderRadius:2,fontWeight:600,textTransform:"none",fontSize:{xs:"0.8125rem",sm:"0.875rem"},py:{xs:.75,sm:1},px:{xs:1.5,sm:2}},r.length>0?{bgcolor:(0,d.X4)(l.palette.info.main,.9),color:"white",boxShadow:"0 4px 12px ".concat((0,d.X4)(l.palette.info.main,.3)),"&:hover":{bgcolor:l.palette.info.main,boxShadow:"0 6px 16px ".concat((0,d.X4)(l.palette.info.main,.4))}}:{borderColor:(0,d.X4)(l.palette.text.secondary,.3),color:"text.secondary","&:hover":{borderColor:"info.main",bgcolor:(0,d.X4)(l.palette.info.main,.1),color:"info.main"}}),{},{transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"}),children:r.length>0?"".concat(r.length," tag").concat(r.length>1?"s":""):"Search & Filter"})}),r.length>0&&(0,re.jsx)(g.A,{title:"Clear all filters",arrow:!0,children:(0,re.jsx)(p.A,{size:"small",onClick:()=>{a([])},sx:{bgcolor:(0,d.X4)(l.palette.error.main,.1),color:"error.main",borderRadius:2,p:{xs:.5,sm:.75},"&:hover":{bgcolor:(0,d.X4)(l.palette.error.main,.2)},transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"},children:(0,re.jsx)(b.A,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}})})})]})})),_o=a.memo((e=>{let{day:t,dayTrades:r,currentDate:n,monthlyHighImpactEvents:a,onDayClick:o,isMdDown:c,dayStats:u}=e;const g=(0,s.A)(),h=(0,R.A)(t,n),p=(0,W.A)(t),m=(0,P.A)(t,"yyyy-MM-dd"),x=a.get(m)||!1;return(0,re.jsx)(gt,{children:(0,re.jsxs)(pt.eR,{onClick:()=>o(t),$isCurrentMonth:h,$isCurrentDay:p,$dayStatus:u.status,children:[(0,re.jsx)(pt.kL,{$isCurrentMonth:h,children:(0,P.A)(t,"d")}),x&&(0,re.jsx)(i.A,{sx:{position:"absolute",top:4,right:4,width:8,height:8,m:1,borderRadius:"50%",bgcolor:"error.main",border:"2px solid ".concat((0,d.X4)(g.palette.background.paper,.8)),boxShadow:"0 0 0 1px ".concat((0,d.X4)(g.palette.error.main,.3))}}),r.length>0&&(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[!c&&(0,re.jsx)(pt.B2,{$dayStatus:u.status,children:(0,G.vv)(Math.abs(u.netAmount))}),(0,re.jsxs)(pt.uk,{children:[r.length," trade",1!==r.length?"s":""]}),(0,re.jsxs)(l.A,{variant:"caption",sx:{color:"win"===u.status?"success.main":"loss"===u.status?"error.main":"text.secondary",fontSize:"0.75rem",fontWeight:500},children:[u.percentage,"%"]}),u.isDrawdownViolation&&(0,re.jsx)(l.A,{variant:"caption",sx:{color:"error.main",fontSize:"0.75rem",fontWeight:700,textTransform:"uppercase"},children:"VIOLATED"})]})]})})})),To=e=>{var t,r;const{calendar:o,setLoading:c,onToggleTheme:u,mode:A,isReadOnly:b=!1}=e,{calendarId:W}=(0,mt.g)(),G=W||(null===o||void 0===o?void 0:o.id),{trades:H,calendar:Y,isLoading:K,addTrade:J,deleteTrades:Z,handleUpdateTradeProperty:ae,onTagUpdated:oe,handleToggleDynamicRisk:se,handleImportTrades:ie,handleAccountBalanceChange:le,handleClearMonthTrades:ce,handleUpdateCalendarProperty:de,notification:ue,clearNotification:ge,isTradeUpdating:he,loadMonthTrades:me,loadVisibleRangeTrades:xe}=wo({calendarId:G,selectedCalendar:o,setLoading:c,enableRealtime:!b});(0,a.useEffect)((()=>{ue&&(Sr(ue.message,"success"===ue.type?"success":"error"),ge())}),[ue,ge]);const fe=Y||o,ye=fe.account_balance,ve=fe.max_daily_drawdown,Ae=fe.weekly_target,be=fe.monthly_target,je=fe.yearly_target,we=fe.required_tag_groups,ke=fe.name,Ce=fe.hero_image_url,Se=fe.hero_image_attribution,_e=fe.score_settings,Te=fe.total_pnl,Ie=(0,a.useMemo)((()=>({account_balance:fe.account_balance,risk_per_trade:fe.risk_per_trade,dynamic_risk_enabled:fe.dynamic_risk_enabled,increased_risk_percentage:fe.increased_risk_percentage,profit_threshold_percentage:fe.profit_threshold_percentage})),[fe.account_balance,fe.risk_per_trade,fe.dynamic_risk_enabled,fe.increased_risk_percentage,fe.profit_threshold_percentage]),Me=(0,a.useCallback)((async e=>{try{await ie(e)}catch(t){throw console.error("Error importing trades:",t),t}}),[ie]),Ee=(0,a.useCallback)((async(e,t)=>await de(t)),[de]),[De,Re]=(0,a.useState)(new Date),[We,Pe]=(0,a.useState)(null),[Ne,Fe]=(0,a.useState)(!1),[Le,Xe]=(0,a.useState)([]),[Oe,Be]=(0,a.useState)(null),[Ue,qe]=(0,a.useState)(null),[Ge,He]=(0,a.useState)(null),[Ye,Ve]=(0,a.useState)([]),[Je,$e]=(0,a.useState)(!1),[Qe,Ze]=(0,a.useState)([]),[et,tt]=(0,a.useState)(null),[rt,nt]=(0,a.useState)({open:!1,tradeIds:[],title:"",expandedTradeId:null}),at=(0,a.useCallback)(((e,t,r)=>{He({selectetdImageIndex:r||0,allImages:t||[e]})}),[]),[ot,st]=(0,a.useState)(!1),[it,lt]=(0,a.useState)(!1),[ct,ut]=(0,a.useState)(!1),[gt,pt]=(0,a.useState)(!0),[vt,At]=(0,a.useState)(!1),[bt,jt]=(0,a.useState)(""),[wt,kt]=(0,a.useState)("warning"),[Ct,St]=(0,a.useState)(!1),[_t,Tt]=(0,a.useState)(!1),[It,Et]=(0,a.useState)({open:!1,trades:[],initialTradeId:void 0,title:void 0,aiOnlyMode:!1,fetchYear:void 0}),[zt,Dt]=(0,a.useState)(!1),[Rt,Wt]=(0,a.useState)(!1),[Pt,Nt]=(0,a.useState)(!1),[Ft,Lt]=(0,a.useState)(!1),[Xt,Ot]=(0,a.useState)(!1),[Bt,Ut]=(0,a.useState)([]),[qt,Gt]=(0,a.useState)(new Set),[Ht,Yt]=(0,a.useState)(null),[Vt,Kt]=(0,a.useState)([]);(0,a.useEffect)((()=>{(async()=>{if(null!==fe&&void 0!==fe&&fe.user_id)try{const e=new yt.t,t=await e.findByUserId(fe.user_id);Kt(t)}catch(e){ee.logger.error("Error loading user calendars for dropdown:",e)}})()}),[null===fe||void 0===fe?void 0:fe.user_id]);const Jt=(0,a.useMemo)((()=>[...b?[]:[{key:"edit",icon:(0,re.jsx)(j.A,{fontSize:"small"}),onClick:()=>Dt(!0),tooltip:"Edit calendar settings"}]]),[b]),$t=!b&&fe&&Ee?(0,re.jsx)(Ca.A,{type:"calendar",item:fe,onUpdateItemProperty:Ee,size:"small"}):null,Qt=(0,s.A)(),Zt=(0,m.A)(Qt.breakpoints.down("md")),er=(0,a.useMemo)((()=>{const e=Vt.map((e=>({label:e.name,path:"/calendar/".concat(e.id),active:e.id===G,totalTrades:e.total_trades,pnl:e.total_pnl})));return[{label:"Home",path:"/",icon:(0,re.jsx)(w.A,{sx:{fontSize:18}})},{label:"Calendars",path:"/dashboard",icon:(0,re.jsx)(k.A,{sx:{fontSize:18}})},{label:ke||"Calendar",path:"/calendar/".concat(G),dropdown:e.length>0?e:void 0}]}),[ke,G,Vt]),{highImpactEventDates:tr}=vo({currentDate:De,calendarId:G,currencies:null===fe||void 0===fe||null===(t=fe.economic_calendar_filters)||void 0===t?void 0:t.currencies,enabled:!(null===fe||void 0===fe||!fe.economic_calendar_filters)}),{watchingStatus:rr}=(e=>{var t,r;let{calendarId:n,economic_calendar_filters:o,isActive:s=!0}=e;const i=(0,a.useRef)(!1),l=(0,a.useMemo)((()=>{if(o)return{currencies:o.currencies,impacts:o.impacts,viewType:o.viewType}}),[null===o||void 0===o||null===(t=o.currencies)||void 0===t?void 0:t.join(","),null===o||void 0===o||null===(r=o.impacts)||void 0===r?void 0:r.join(","),null===o||void 0===o?void 0:o.viewType]);(0,a.useEffect)((()=>{i.current||(po.initialize({onEventsUpdated:(e,t,r)=>{(0,ee.log)("\ud83d\udcca ".concat(e.length," events updated simultaneously for calendar ").concat(r)),window.dispatchEvent(new CustomEvent("economicEventsUpdated",{detail:{events:e,allEvents:t,calendarId:r}}))},onError:(e,t)=>{(0,ee.error)("\u274c Economic event watcher error for calendar ".concat(t,":"),e),window.dispatchEvent(new CustomEvent("economicEventWatcherError",{detail:{error:e.message,calendarId:t}}))}}),i.current=!0)}),[]);const c=(0,a.useCallback)((()=>{n&&s&&po.startWatching(n,l)}),[n,l,s]),d=(0,a.useCallback)((()=>{n&&po.stopWatching(n)}),[n]);(0,a.useEffect)((()=>(s&&n?c():d(),()=>{d()})),[s,n,c,d]);const u=po.getWatchingStatus();return{startWatching:c,stopWatching:d,watchingStatus:{isActive:u.isActive,watchedEventsCount:u.watchedEventsCount}}})({calendarId:G,economic_calendar_filters:null===fe||void 0===fe?void 0:fe.economic_calendar_filters,isActive:!0});var nr;(0,a.useEffect)((()=>{if(!G)return;const e=(0,N.A)(De),t=(0,F.A)(De),r=(0,L.A)(e,{weekStartsOn:0}),n=(0,X.A)(t,{weekStartsOn:0});xe(r,n)}),[De,G,xe]),nr=(e,t,r)=>{var n,a;r===G&&((0,ee.log)("\ud83d\udcca ".concat(e.length," economic events were updated simultaneously for this calendar")),null===(n=null===fe||void 0===fe||null===(a=fe.economic_calendar_filters)||void 0===a?void 0:a.notificationsEnabled)||void 0===n||n?((0,ee.log)("\ud83d\udd14 Notifications enabled - showing ".concat(e.length," event notification(s)")),e.forEach((e=>{ar(e)}))):(0,ee.log)("\ud83d\udd15 Notifications disabled - skipping ".concat(e.length," event notification(s)")),Pt&&(Yt({updatedEvents:e,allEvents:t}),setTimeout((()=>{Yt(null)}),1e3)))},(0,a.useEffect)((()=>{const e=e=>{nr(e.detail.events,e.detail.allEvents,e.detail.calendarId)};return window.addEventListener("economicEventsUpdated",e),()=>{window.removeEventListener("economicEventsUpdated",e)}}),[nr]);const ar=e=>{jo().catch((e=>{ee.logger.warn("Failed to play notification sound:",e)})),Ut((t=>{if(t.length>=3){const e=t[0];Gt((t=>{const r=new Set(t);return r.add(e.id),r})),setTimeout((()=>{Ut((t=>t.filter((t=>t.id!==e.id)))),Gt((t=>{const r=new Set(t);return r.delete(e.id),r}))}),300)}return[...t,e]}))},or=(0,a.useCallback)((()=>{Nt(!0)}),[]),sr=(0,a.useCallback)((()=>{Lt(!0)}),[]);(0,a.useEffect)((()=>{let e=!1;const t=()=>{e||(requestAnimationFrame((()=>{const t=document.querySelector('[data-testid="month-nav-section"]');if(t){const e=t.getBoundingClientRect();St(!(e.top<=window.innerHeight&&e.bottom>=0))}e=!1})),e=!0)};return window.addEventListener("scroll",t,{passive:!0}),t(),()=>window.removeEventListener("scroll",t)}),[]);const ir=(0,a.useMemo)((()=>fe.tags||[]),[fe.tags,H]),lr=(0,a.useMemo)((()=>0===Le.length?H:H.filter((e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.some((e=>Le.includes(e)))}))),[H,Le]),cr=(0,a.useMemo)((()=>{const e=new Map;return lr.forEach((t=>{var r;const n=(0,P.A)(new Date(t.trade_date),"yyyy-MM-dd");e.has(n)||e.set(n,[]),null===(r=e.get(n))||void 0===r||r.push(t)})),e}),[lr]),dr=(0,a.useMemo)((()=>{if(!We)return[];const e=(0,P.A)(We,"yyyy-MM-dd");return cr.get(e)||[]}),[We,cr]),ur=(0,a.useMemo)((()=>rt.tradeIds.length?rt.tradeIds.map((e=>lr.find((t=>t.id===e)))).filter((e=>void 0!==e)):[]),[rt.tradeIds,lr]),gr=(0,a.useMemo)((()=>0===Le.length&&void 0!==Te?Te:lr.length>0?lr.reduce(((e,t)=>e+t.amount),0):0),[lr,Le,Te]),hr=(0,a.useMemo)((()=>{const e=new Map,t=(0,N.A)(De),r=(0,F.A)(De),n=(0,L.A)(t,{weekStartsOn:0}),a=(0,X.A)(r,{weekStartsOn:0});return(0,O.A)({start:n,end:a}).forEach((t=>{const r=(0,P.A)(t,"yyyy-MM-dd"),n=((e,t,r,n,a,o)=>{const s=e.reduce(((e,t)=>e+t.amount),0),i=a&&o?(0,Q.eJ)(s,t,a,(0,V.A)(o)).toFixed(1):t>0?(s/t*100).toFixed(1):"0";let l="neutral";e.length>0&&(l=s>0?"win":s<0?"loss":e.find((e=>"breakeven"===e.trade_type))?"breakeven":"neutral");let c=r;n&&a&&(c=(0,Q.Pp)(r,a,n));const d=parseFloat(i);return{netAmount:s,status:l,percentage:i,isDrawdownViolation:"loss"===l&&Math.abs(d)>c}})(cr.get(r)||[],ye,ve||0,Ie,lr,t);e.set(r,n)})),e}),[De,cr,ye,ve,Ie,lr]),pr=(0,a.useMemo)((()=>{const e=new Map,t=(0,N.A)(De),r=(0,F.A)(De),n=(0,L.A)(t,{weekStartsOn:0}),a=(0,X.A)(r,{weekStartsOn:0});return(0,B.A)({start:n,end:a},{weekStartsOn:0}).forEach((t=>{const r=(0,P.A)(t,"yyyy-MM-dd"),n=lr.filter((e=>(0,D.A)(new Date(e.trade_date),t,{weekStartsOn:0}))),a=n.reduce(((e,t)=>e+t.amount),0),o=lr?(0,Q.eJ)(a,ye,lr,t).toFixed(1):ye>0?(a/ye*100).toFixed(1):"0",s=Ae&&Ae>0?Mt(n,ye,Ae,t,lr):0;e.set(r,{weekTrades:n,netAmount:a,percentage:o,targetProgressValue:s})})),e}),[De,lr,ye,Ae]),mr=(0,a.useMemo)((()=>((e,t,r,n)=>{const a=ln(e,t,r).filter((e=>void 0!==e.session));return["Asia","London","NY AM","NY PM"].map((e=>{const t=a.filter((t=>t.session===e)),r=t.length,o=t.filter((e=>"win"===e.trade_type)).length,s=t.filter((e=>"loss"===e.trade_type)).length,i=t.filter((e=>"breakeven"===e.trade_type)).length,l=o+s,c=l>0?o/l*100:0,d=t.reduce(((e,t)=>e+t.amount),0);return{session:e,total_trades:r,winners:o,losers:s,breakevens:i,win_rate:c,total_pnl:d,averagePnL:r>0?d/r:0,pnlPercentage:n>0?d/n*100:0}}))})(lr,De,"month",ye)),[lr,De,ye]),xr=()=>{Re((e=>(0,U.A)(e,1)))},fr=()=>{Re((e=>(0,q.A)(e,1)))},yr=()=>{Re(new Date)},vr=e=>{Ve([e]),$e(!0),tt(null)},Ar=e=>{Ve(e),$e(!0),tt(null)},br=async()=>{if(0!==Ye.length){$e(!1),tt(null),Ze((e=>[...e,...Ye]));try{await Z(Ye);const e=1===Ye.length?"Trade deleted successfully.":"Successfully deleted ".concat(Ye.length," trades.");Sr(e,"success")}catch(e){ee.logger.error("Error deleting trades:",e);const t=1===Ye.length?"Failed to delete trade. Please try again.":"Failed to delete some trades. Please try again.";tt(t),Sr(t,"error")}finally{Ze((e=>e.filter((e=>!Ye.includes(e))))),Ve([])}}},jr=(0,a.useCallback)((e=>{if(b){const t=(0,P.A)(e,"yyyy-MM-dd");return void((cr.get(t)||[]).length>0&&Pe(e))}if(K)return(0,ee.log)("Cannot add trade while trades are loading"),void Sr("Cannot add trade while trades are loading. Please wait...","warning");if(e>new Date)return(0,ee.log)("Cannot add trade in the future"),void Sr("Cannot add trade in the future. Please select a valid date.","warning");if(!gt)return pt(!0),void se(!0);const t=(0,P.A)(e,"yyyy-MM-dd");0!==(cr.get(t)||[]).length||Ae?Pe(e):(Be(Co),qe({open:!0,trade_date:e,showDayDialogWhenDone:!0}))}),[b,cr,K,gt,se,Ae]),wr=()=>{Fe(!0)},kr=e=>{Xe(e)},Cr=()=>{At(!1)},Sr=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning";jt(e),kt(t),At(!0)},_r=(e,t,r,n)=>{Et({open:!0,trades:e,initialTradeId:t,title:r,aiOnlyMode:!1,fetchYear:n})},Tr=(e,t,r)=>{Et({open:!0,trades:e,initialTradeId:t,title:r,aiOnlyMode:!0})},Ir=(0,a.useCallback)((e=>{Be((()=>(0,$.fJ)(e))),qe({open:!0,trade_date:new Date(e.trade_date),editTrade:e,createTempTrade:!1,showDayDialogWhenDone:!1})}),[]),Mr=(0,a.useMemo)((()=>({onUpdateTradeProperty:b?void 0:ae,onEditTrade:b?void 0:Ir,onDeleteTrade:b?void 0:vr,onDeleteMultipleTrades:b?void 0:Ar,onZoomImage:at,onOpenGalleryMode:_r,onOpenAIChat:b?void 0:e=>Tr(H,e.id,e.name),onUpdateCalendarProperty:b?void 0:Ee,isTradeUpdating:he,deletingTradeIds:Qe,calendarId:G||void 0,calendar:fe,isReadOnly:b,economicFilter:e=>(null===fe||void 0===fe?void 0:fe.economic_calendar_filters)||te.C})),[b,ae,Ir,vr,Ar,at,_r,Tr,H,Ee,he,Qe,G,fe]);return(0,re.jsxs)(i.A,{sx:{minHeight:"100vh",bgcolor:"custom.pageBackground",position:"relative",overflow:"hidden"},children:[(0,re.jsx)(so.A,{}),(0,re.jsx)(lo,{currentDate:De,isVisible:Ct,onPrevMonth:xr,onNextMonth:fr,onMonthClick:wr,onTodayClick:yr}),Ce&&(0,re.jsxs)(i.A,{sx:{position:"relative",height:{xs:140,sm:180,md:220},overflow:"hidden",borderRadius:0},children:[(0,re.jsx)(i.A,{sx:{position:"absolute",inset:0,backgroundImage:"url(".concat(Ce,")"),backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:0}}),(0,re.jsx)(i.A,{sx:{position:"absolute",inset:0,background:e=>"linear-gradient(180deg, ".concat((0,d.X4)(e.palette.common.black,.25)," 0%, ").concat((0,d.X4)(e.palette.common.black,.8)," 100%)"),zIndex:2}}),(0,re.jsx)(x.A,{in:!!Se,timeout:300,children:(0,re.jsx)(i.A,{sx:{position:"absolute",bottom:{xs:6,sm:8},right:{xs:8,sm:12},zIndex:3,px:1,py:.5,borderRadius:.75,bgcolor:e=>(0,d.X4)(e.palette.common.black,.7),color:"common.white"},children:(0,re.jsxs)(l.A,{variant:"caption",sx:{fontSize:"0.7rem"},children:["Photo by ",null===Se||void 0===Se?void 0:Se.photographer," on Unsplash"]})})})]}),(0,re.jsx)(ft.A,{items:er,buttons:Jt,rightContent:$t}),G&&!b&&(0,re.jsx)(oo,{calendarId:G}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:{xs:2,sm:2.5,md:3},p:{xs:1.5,sm:2,md:3},mt:{xs:.5,sm:1}},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:{xs:2,md:3},maxWidth:"1400px",margin:"0 auto",width:"100%",position:"relative"},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",gap:{xs:2,md:3},flexDirection:{xs:"column",lg:"row"},justifyContent:"center",alignItems:"stretch",width:"100%"},children:[(0,re.jsx)(i.A,{sx:{flex:1,height:"100%"},children:(0,re.jsx)(oa,{balance:ye,totalProfit:gr,trades:lr,risk_per_trade:null===Ie||void 0===Ie?void 0:Ie.risk_per_trade,dynamicRiskSettings:Ie,onToggleDynamicRisk:e=>{pt(e),se(e)},isDynamicRiskToggled:gt,isReadOnly:b,max_daily_drawdown:ve})}),(0,re.jsx)(i.A,{sx:{flex:1,height:"100%"},children:(0,re.jsx)(ra,{trades:lr,accountBalance:ye,onImportTrades:Me,onDeleteTrade:vr,currentDate:De,monthlyTarget:be,onClearMonthTrades:ce,isReadOnly:b,onOpenGalleryMode:_r,calendarId:G,scoreSettings:_e,dynamicRiskSettings:Ie,onUpdateTradeProperty:ae,onUpdateCalendarProperty:Ee,onEditTrade:Ir,economicFilter:e=>(null===fe||void 0===fe?void 0:fe.economic_calendar_filters)||te.C,maxDailyDrawdown:ve})})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:{xs:1.5,sm:2,md:3},flexDirection:{xs:"column",lg:"row"},gap:{xs:1.5,sm:2,lg:1}},children:[(0,re.jsxs)(i.A,{"data-testid":"month-nav-section",sx:{display:"flex",alignItems:"center",gap:{xs:1,sm:1.5,md:2},order:{xs:1,lg:0}},children:[(0,re.jsx)(p.A,{onClick:xr,size:"small",sx:{bgcolor:(0,d.X4)(Qt.palette.primary.main,.1),color:"primary.main",p:{xs:.75,sm:1},"&:hover":{bgcolor:(0,d.X4)(Qt.palette.primary.main,.2),transform:"scale(1.05)"},transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"},children:(0,re.jsx)(C.A,{sx:{fontSize:{xs:"1.25rem",sm:"1.5rem"}}})}),(0,re.jsx)(l.A,{variant:"h4",sx:{fontWeight:700,cursor:"pointer",minWidth:{xs:"180px",sm:"220px",md:"250px"},textAlign:"center",fontSize:{xs:"1.25rem",sm:"1.5rem",md:"1.8rem",lg:"2rem"},letterSpacing:"-0.5px",color:"text.primary",background:"linear-gradient(135deg, ".concat(Qt.palette.primary.main," 0%, ").concat(Qt.palette.secondary.main," 100%)"),backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{transform:"scale(1.02)",filter:"brightness(1.1)"}},onClick:wr,children:(0,P.A)(De,"MMMM yyyy")}),(0,re.jsx)(p.A,{onClick:fr,size:"small",sx:{bgcolor:(0,d.X4)(Qt.palette.primary.main,.1),color:"primary.main",p:{xs:.75,sm:1},"&:hover":{bgcolor:(0,d.X4)(Qt.palette.primary.main,.2),transform:"scale(1.05)"},transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"},children:(0,re.jsx)(S.A,{sx:{fontSize:{xs:"1.25rem",sm:"1.5rem"}}})})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:1.5,md:2},flexWrap:"wrap",order:{xs:0,lg:1},width:{xs:"100%",lg:"auto"}},children:[(0,re.jsxs)(i.A,{sx:{display:"flex",gap:{xs:.75,sm:1},flexWrap:"wrap",width:{xs:"100%",sm:"auto"}},children:[!(0,R.A)(De,new Date)&&(0,re.jsx)(h.A,{startIcon:(0,re.jsx)(_.A,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}}),onClick:yr,variant:"contained",size:"small",sx:{flex:{xs:1,sm:"none"},minWidth:{xs:"auto",sm:"100px"},borderRadius:2,fontWeight:600,textTransform:"none",fontSize:{xs:"0.8125rem",sm:"0.875rem"},py:{xs:.75,sm:1},px:{xs:1.5,sm:2},boxShadow:"0 4px 12px ".concat((0,d.X4)(Qt.palette.primary.main,.3)),"&:hover":{transform:"translateY(-1px)",boxShadow:"0 6px 16px ".concat((0,d.X4)(Qt.palette.primary.main,.4))},transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"},children:"Today"}),(0,re.jsx)(g.A,{title:"Notes for this calendar",arrow:!0,children:(0,re.jsx)(h.A,{startIcon:(0,re.jsx)(T.A,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}}),onClick:()=>Ot(!0),variant:"outlined",size:"small",sx:{flex:{xs:1,sm:"none"},minWidth:{xs:"auto",sm:"100px"},borderRadius:2,fontWeight:600,textTransform:"none",fontSize:{xs:"0.8125rem",sm:"0.875rem"},py:{xs:.75,sm:1},px:{xs:1.5,sm:2},borderColor:(0,d.X4)(Qt.palette.text.secondary,.3),color:"text.secondary","&:hover":{borderColor:"info.main",bgcolor:(0,d.X4)(Qt.palette.info.main,.1),color:"info.main",transform:"translateY(-1px)"},transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"},children:"Notes"})})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",gap:{xs:.75,sm:1},flexWrap:"wrap",width:{xs:"100%",sm:"auto"}},children:[(0,re.jsx)(h.A,{startIcon:(0,re.jsx)(I.A,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}}),onClick:()=>Tt(!0),variant:"outlined",size:"small",sx:(0,n.A)((0,n.A)({flex:{xs:1,sm:"none"},minWidth:{xs:"auto",sm:"100px"},borderRadius:2,fontWeight:600,textTransform:"none",fontSize:{xs:"0.8125rem",sm:"0.875rem"},py:{xs:.75,sm:1},px:{xs:1.5,sm:2}},{borderColor:(0,d.X4)(Qt.palette.text.secondary,.3),color:"text.secondary","&:hover":{borderColor:"info.main",bgcolor:(0,d.X4)(Qt.palette.info.main,.1),color:"info.main",transform:"translateY(-1px)"}}),{},{transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"}),children:"Pinned"}),(0,re.jsx)(So,{allTags:ir,selectedTags:Le,onTagsChange:kr,onOpenDrawer:()=>ut(!0)}),(0,re.jsx)(g.A,{title:b?"View tags and definitions":"Manage tags and required tag groups",arrow:!0,children:(0,re.jsx)(h.A,{variant:"outlined",size:"small",startIcon:(0,re.jsx)(M.A,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}}),onClick:()=>lt(!0),sx:{flex:{xs:1,sm:"none"},minWidth:{xs:"auto",sm:"120px"},borderRadius:2,fontWeight:600,textTransform:"none",fontSize:{xs:"0.8125rem",sm:"0.875rem"},py:{xs:.75,sm:1},px:{xs:1.5,sm:2},borderColor:(0,d.X4)(Qt.palette.text.secondary,.3),color:"text.secondary","&:hover":{borderColor:"info.main",bgcolor:(0,d.X4)(Qt.palette.info.main,.1),color:"info.main",transform:"translateY(-1px)"},transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"},children:"Tags"})})]})]})]}),(0,re.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:{xs:1,md:2}},children:[(0,re.jsx)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(7, 1fr)",sm:"repeat(8, 1fr)"},gap:{xs:1,md:1.5},mb:{xs:1,md:2}},children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Week"].map(((e,t)=>(0,re.jsx)(ht,{sx:{display:7===t?{xs:"none",sm:"flex"}:"flex",cursor:"default",position:"relative",justifyContent:"center",alignItems:"center",p:{xs:1,md:1.5},fontWeight:600,fontSize:{xs:"0.875rem",md:"1rem"},color:"text.secondary",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"},children:e},e)))}),(0,re.jsx)(i.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(7, 1fr)",sm:"repeat(8, 1fr)"},gap:{xs:1,md:1.5},minHeight:{xs:"auto",md:"400px"}},children:(0,B.A)({start:(0,N.A)(De),end:(0,F.A)(De)},{weekStartsOn:0}).map(((e,t)=>{var r;const n=(0,O.A)({start:e,end:(0,X.A)(e,{weekStartsOn:0})});return(0,re.jsxs)(a.Fragment,{children:[n.map((e=>{var t;const r=(0,P.A)(e,"yyyy-MM-dd"),n=cr.get(r)||[],a=null!==(t=hr.get(r))&&void 0!==t?t:{netAmount:0,percentage:"0",status:"none",isDrawdownViolation:!1};return(0,re.jsx)(_o,{day:e,dayTrades:n,currentDate:De,monthlyHighImpactEvents:tr,onDayClick:jr,isMdDown:Zt,dayStats:a},e.toISOString())})),(0,re.jsx)(ko,{trade_date:e,weekIndex:t,weeklyTarget:Ae,sx:{display:{xs:"none",sm:"flex"}},weekStats:null!==(r=pr.get((0,P.A)(e,"yyyy-MM-dd")))&&void 0!==r?r:{weekTrades:[],netAmount:0,percentage:"0",targetProgressValue:0},accountBalance:ye+gr})]},e.toISOString())}))})]}),!Zt&&(0,re.jsx)(Ln,{sessionStats:mr,trades:lr,selectedDate:De,timePeriod:"month",setMultipleTradesDialog:nt}),rt.open&&(0,re.jsx)(Bn,{open:rt.open,onClose:()=>nt((e=>(0,n.A)((0,n.A)({},e),{},{open:!1}))),trades:ur,title:rt.title,expandedTradeId:rt.expandedTradeId,onTradeExpand:e=>nt((t=>(0,n.A)((0,n.A)({},t),{},{expandedTradeId:t.expandedTradeId===e?null:e}))),account_balance:ye,tradeOperations:Mr})]}),(0,re.jsx)(ne,{open:!!We&&!(null!==Ue&&void 0!==Ue&&Ue.open),onClose:()=>{Pe(null)},showAddForm:b?()=>{}:e=>{null!==e&&Be((()=>(0,$.fJ)(e))),qe({open:!0,trade_date:We,editTrade:e,createTempTrade:null===e,showDayDialogWhenDone:!0})},date:We||new Date,trades:We?dr:[],onDateChange:e=>{Pe(e)},account_balance:ye,tradeOperations:Mr,onOpenAIChatMode:b?void 0:Tr,weekTrades:We?null===(r=pr.get((0,P.A)((0,L.A)(We,{weekStartsOn:0}),"yyyy-MM-dd")))||void 0===r?void 0:r.weekTrades:void 0}),!b&&(0,re.jsx)($.Ay,{open:!(null===Ue||void 0===Ue||!Ue.trade_date)&&(null===Ue||void 0===Ue?void 0:Ue.open)||!1,onClose:()=>{Pe(null),qe(null),null!=Oe&&Oe.pending_images&&(Oe.pending_images.forEach((e=>{URL.revokeObjectURL(e.preview)})),Be(null))},onCancel:()=>{null!==Ue&&void 0!==Ue&&Ue.showDayDialogWhenDone&&(Pe(null),Pe(null===Ue||void 0===Ue?void 0:Ue.trade_date)),qe(null)},showForm:{open:(null===Ue||void 0===Ue?void 0:Ue.open)||!1,editTrade:(null===Ue||void 0===Ue?void 0:Ue.editTrade)||null,createTempTrade:(null===Ue||void 0===Ue?void 0:Ue.createTempTrade)||!1},trade_date:(null===Ue||void 0===Ue?void 0:Ue.trade_date)||new Date,onAddTrade:J,newMainTrade:Oe,setNewMainTrade:e=>Be(e(Oe)),onTagUpdated:oe,onUpdateTradeProperty:ae,onDeleteTrades:Z,setZoomedImage:at,account_balance:ye,onAccountBalanceChange:le,calendar:fe,tags:ir,dynamicRiskSettings:Ie,requiredTagGroups:we,onOpenGalleryMode:_r}),Ge&&(0,re.jsx)(xt.A,{open:!!Ge,onClose:()=>He(null),imageProp:Ge}),(0,re.jsx)(pe,{open:Ne,onClose:()=>Fe(!1),onDateSelect:e=>{Re(e)},initialDate:We||void 0,accountBalance:ye,monthlyTarget:be,yearlyTarget:je,yearStats:(null===fe||void 0===fe?void 0:fe.year_stats)||{},onOpenGalleryMode:_r}),(0,re.jsx)(Ke,{open:it,onClose:()=>lt(!1),allTags:ir,calendarId:G,onTagUpdated:oe,requiredTagGroups:we,onUpdateCalendarProperty:Ee,isReadOnly:b,calendarOwnerId:null===fe||void 0===fe?void 0:fe.user_id}),(0,re.jsx)(ze,{open:ot,onClose:()=>st(!1),allTags:ir,calendarId:G,onTagUpdated:oe,requiredTagGroups:we,onUpdateCalendarProperty:Ee}),(0,re.jsx)(ia.A,{open:Je,title:1===Ye.length?"Delete Trade":"Delete ".concat(Ye.length," Trades"),message:1===Ye.length?"Are you sure you want to delete this trade? This action cannot be undone.":"Are you sure you want to delete ".concat(Ye.length," trades? This action cannot be undone."),confirmText:"Delete",cancelText:"Cancel",onConfirm:br,onCancel:()=>{$e(!1),Ve([]),tt(null)},confirmColor:"error",isSubmitting:Qe.some((e=>Ye.includes(e)))}),(0,re.jsx)(f.A,{open:vt,autoHideDuration:"success"===wt?3e3:et?6e3:4e3,onClose:Cr,anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{zIndex:In.M.SNACKBAR},children:(0,re.jsx)(y.A,{onClose:Cr,severity:wt,variant:"filled",sx:{width:"100%"},action:et&&Ye.length>0?(0,re.jsx)(h.A,{color:"inherit",size:"small",onClick:()=>{Cr(),(async()=>{et&&Ye.length>0&&(tt(null),await br())})()},sx:{color:"inherit"},children:"Retry"}):void 0,children:bt})}),!b&&(0,re.jsx)(g.A,{title:"AI Trading Assistant",placement:"left",children:(0,re.jsx)(v.A,{color:"secondary","aria-label":"open ai chat",onClick:sr,size:"medium",sx:{position:"fixed",bottom:{xs:80,sm:96},right:{xs:16,sm:24},zIndex:1200,width:{xs:48,sm:56},height:{xs:48,sm:56}},children:(0,re.jsx)(E.A,{sx:{fontSize:{xs:"1.25rem",sm:"1.5rem"}}})})}),!b&&(0,re.jsx)(g.A,{title:"Economic Calendar",placement:"left",children:(0,re.jsx)(v.A,{color:"primary","aria-label":"open economic calendar",onClick:or,size:"medium",sx:{position:"fixed",bottom:{xs:16,sm:24},right:{xs:16,sm:24},zIndex:1200,width:{xs:48,sm:56},height:{xs:48,sm:56}},children:(0,re.jsx)(z.A,{sx:{fontSize:{xs:"1.25rem",sm:"1.5rem"}}})})}),fe&&G&&(0,re.jsx)(dt,{open:ct,onClose:()=>ut(!1),calendarId:G,allTags:ir,selectedTags:Le,onTagsChange:kr,onTradeClick:e=>{ut(!1),_r(H,e.id,"Search Results")}}),(0,re.jsx)(ua,{open:_t,onClose:()=>Tt(!1),calendarId:G,onTradeClick:(e,t,r)=>{Tt(!1),_r(t,e.id,r)},tradeOperations:Mr}),(0,re.jsx)(ka,{open:It.open,onClose:()=>{Et({open:!1,trades:[],initialTradeId:void 0,title:void 0,aiOnlyMode:!1,fetchYear:void 0})},trades:It.trades,initialTradeId:It.initialTradeId,setZoomedImage:at,title:It.title,calendarId:G,calendar:fe,aiOnlyMode:It.aiOnlyMode,isReadOnly:b,fetchYear:It.fetchYear,tradeOperations:Mr}),(0,re.jsx)(sa.A,{open:zt,onClose:()=>Dt(!1),onSubmit:async e=>{if(Ee&&G){Wt(!0);try{await Ee(G,(t=>(0,n.A)((0,n.A)({},t),{},{name:e.name,account_balance:e.account_balance,max_daily_drawdown:e.max_daily_drawdown,weekly_target:e.weekly_target,monthly_target:e.monthly_target,yearly_target:e.yearly_target,risk_per_trade:e.risk_per_trade,dynamic_risk_enabled:e.dynamic_risk_enabled,increased_risk_percentage:e.increased_risk_percentage,profit_threshold_percentage:e.profit_threshold_percentage,hero_image_url:e.hero_image_url,hero_image_attribution:e.hero_image_attribution}))),Kt((t=>t.map((t=>t.id===G?(0,n.A)((0,n.A)({},t),{},{name:e.name}):t)))),Dt(!1),Sr("Calendar updated successfully","success")}catch(t){ee.logger.error("Error updating calendar:",t),Sr("Failed to update calendar","error")}finally{Wt(!1)}}},initialData:fe,isSubmitting:Rt,mode:"edit",title:"Edit Calendar",submitButtonText:"Save"})]}),(0,re.jsx)(te.A,{open:Pt,onClose:()=>Nt(!1),calendar:fe,payload:Ht,isReadOnly:b,tradeOperations:Mr}),(0,re.jsx)(Sa.A,{open:Ft,onClose:()=>Lt(!1),trades:H,calendar:fe,isReadOnly:b,tradeOperations:Mr}),(0,re.jsx)(_a.A,{open:Xt,onClose:()=>Ot(!1),calendarId:G,isReadOnly:b}),(0,re.jsx)(i.A,{sx:{position:"fixed",bottom:{xs:16,sm:24},left:{xs:8,sm:12},right:{xs:8,sm:"auto"},zIndex:1400,display:"flex",flexDirection:"column",gap:{xs:1.5,sm:2},pointerEvents:"none",maxWidth:{xs:"calc(100% - 16px)",sm:"400px"}},children:Bt.map((e=>(0,re.jsx)(fo,{event:e,onClose:()=>{return t=e.id,Gt((e=>{const r=new Set(e);return r.add(t),r})),void setTimeout((()=>{Ut((e=>e.filter((e=>e.id!==t)))),Gt((e=>{const r=new Set(e);return r.delete(t),r}))}),300);var t},autoHideDuration:3e4,isRemoving:qt.has(e.id)},e.id)))})]})},Io=To},23893:(e,t,r)=>{r.d(t,{Fl:()=>n,vv:()=>a});const n=e=>{if(void 0===e||null===e||isNaN(e))return"$0.00";return Math.abs(e)>=1e3?"$".concat((e/1e3).toFixed(1),"k"):"$".concat(e.toFixed(2))},a=e=>void 0===e||null===e||isNaN(e)?"$0.00":"$".concat(e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))},28262:(e,t,r)=>{r.d(t,{o:()=>v});var n=r(89379),a=r(19495),o=r(65043),s=r(45852),i=r(26080),l=r(8060),c=r(78018),d=r(35054);const u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;if(!e)return t;const r=new Date(e);return isNaN(r.getTime())?t:r},g=e=>(0,n.A)((0,n.A)({},e),{},{created_at:u(e.created_at),updated_at:u(e.updated_at),messages:e.messages?e.messages.map((e=>(0,n.A)((0,n.A)({},e),{},{timestamp:u(e.timestamp)}))):[]}),h=e=>e.map((e=>(0,n.A)((0,n.A)({},e),{},{timestamp:e.timestamp.toISOString()}))),p=e=>{const t=e.find((e=>"user"===e.role));if(t&&t.content){const e=t.content.substring(0,50);return e.length<t.content.length?"".concat(e,"..."):e}return"Conversation on ".concat((new Date).toLocaleDateString())};class m extends l.I{constructor(e){super(e)}async findById(e){try{const{data:t,error:r}=await d.N.from("ai_conversations").select("*").eq("id",e).single();return r?(c.logger.error("Error finding conversation by ID:",r),null):t?g(t):null}catch(t){return c.logger.error("Error finding conversation by ID:",t),null}}async findByCalendarId(e,t){var r,n;const a=null!==(r=null===t||void 0===t?void 0:t.limit)&&void 0!==r?r:15,o=null!==(n=null===t||void 0===t?void 0:t.offset)&&void 0!==n?n:0;try{const{count:t,error:r}=await d.N.from("ai_conversations").select("*",{count:"exact",head:!0}).eq("calendar_id",e).is("trade_id",null);if(r)return c.logger.error("Error counting conversations by calendar ID:",r),{conversations:[],totalCount:0,hasMore:!1};const n=null!==t&&void 0!==t?t:0,{data:s,error:i}=await d.N.from("ai_conversations").select("*").eq("calendar_id",e).is("trade_id",null).order("updated_at",{ascending:!1}).range(o,o+a-1);if(i)return c.logger.error("Error finding conversations by calendar ID:",i),{conversations:[],totalCount:0,hasMore:!1};const l=s?s.map((e=>g(e))):[];return{conversations:l,totalCount:n,hasMore:o+l.length<n}}catch(s){return c.logger.error("Error finding conversations by calendar ID:",s),{conversations:[],totalCount:0,hasMore:!1}}}async findByTradeId(e,t){var r,n;const a=null!==(r=null===t||void 0===t?void 0:t.limit)&&void 0!==r?r:15,o=null!==(n=null===t||void 0===t?void 0:t.offset)&&void 0!==n?n:0;try{const{count:t,error:r}=await d.N.from("ai_conversations").select("*",{count:"exact",head:!0}).eq("trade_id",e);if(r)return c.logger.error("Error counting conversations by trade ID:",r),{conversations:[],totalCount:0,hasMore:!1};const n=null!==t&&void 0!==t?t:0,{data:s,error:i}=await d.N.from("ai_conversations").select("*").eq("trade_id",e).order("updated_at",{ascending:!1}).range(o,o+a-1);if(i)return c.logger.error("Error finding conversations by trade ID:",i),{conversations:[],totalCount:0,hasMore:!1};const l=s?s.map((e=>g(e))):[];return{conversations:l,totalCount:n,hasMore:o+l.length<n}}catch(s){return c.logger.error("Error finding conversations by trade ID:",s),{conversations:[],totalCount:0,hasMore:!1}}}async findByUserId(e){try{const{data:t,error:r}=await d.N.from("ai_conversations").select("*").eq("user_id",e).order("updated_at",{ascending:!1});return r?(c.logger.error("Error finding conversations by user ID:",r),[]):t?t.map((e=>g(e))):[]}catch(t){return c.logger.error("Error finding conversations by user ID:",t),[]}}async findAll(){try{const{data:e,error:t}=await d.N.from("ai_conversations").select("*").order("updated_at",{ascending:!1});return t?(c.logger.error("Error finding all conversations:",t),[]):e?e.map((e=>g(e))):[]}catch(e){return c.logger.error("Error finding all conversations:",e),[]}}async createInSupabase(e){const t=new Date,r=e.title||p(e.messages),n={calendar_id:e.calendar_id,user_id:e.user_id,title:r.substring(0,100),messages:h(e.messages),message_count:e.message_count,created_at:t,updated_at:t};e.trade_id&&(n.trade_id=e.trade_id);const{data:a,error:o}=await d.N.from("ai_conversations").insert(n).select().single();if(o)throw o;return g(a)}async updateInSupabase(e,t){const r={updated_at:new Date};void 0!==t.title&&(r.title=t.title.substring(0,100)),void 0!==t.messages&&(r.messages=h(t.messages),r.message_count=t.messages.length),void 0!==t.message_count&&(r.message_count=t.message_count);const{data:n,error:a}=await d.N.from("ai_conversations").update(r).eq("id",e).select();if(a)throw a;if(!n||0===n.length)throw new Error("Conversation not found: ".concat(e));return g(n[0])}async deleteInSupabase(e){const{error:t}=await d.N.from("ai_conversations").delete().eq("id",e);if(t)throw t;return!0}async saveConversation(e,t,n,a,o,s){try{const r=o||p(a);if(e){var i,l;const o=await this.update(e,{messages:a,message_count:a.length,title:r});return!o.success&&null!==(i=o.error)&&void 0!==i&&null!==(l=i.message)&&void 0!==l&&l.includes("not found")?(c.logger.warn("Conversation ".concat(e," not found, creating new conversation")),await this.create({calendar_id:t,user_id:n,trade_id:s||null,title:r,messages:a,message_count:a.length})):o}return await this.create({calendar_id:t,user_id:n,trade_id:s||null,title:r,messages:a,message_count:a.length})}catch(d){c.logger.error("Error saving conversation:",d);const{parseSupabaseError:t}=await Promise.resolve().then(r.bind(r,28042));return{success:!1,error:t(d,"Saving conversation"),timestamp:new Date,operation:e?"update":"create"}}}async deleteByCalendarId(e){try{const{error:t}=await d.N.from("ai_conversations").delete().eq("calendar_id",e);if(t)throw t;return{success:!0,data:!0,timestamp:new Date,operation:"deleteByCalendarId"}}catch(t){c.logger.error("Error deleting conversations by calendar ID:",t);const{parseSupabaseError:e}=await Promise.resolve().then(r.bind(r,28042));return{success:!1,error:e(t,"Deleting conversations by calendar ID"),timestamp:new Date,operation:"deleteByCalendarId"}}}}var x=r(6483);const f=15,y=50;function v(e){let{userId:t,calendar:r,trade:l,messageLimit:d=y,autoSaveConversation:u=!0}=e;const[g,h]=(0,o.useState)([]),[p,v]=(0,o.useState)(!1),[A,b]=(0,o.useState)(!1),[j,w]=(0,o.useState)(""),[k,C]=(0,o.useState)(null),[S,_]=(0,o.useState)([]),[T,I]=(0,o.useState)(!1),[M,E]=(0,o.useState)(!1),[z,D]=(0,o.useState)(!1),[R,W]=(0,o.useState)(0),[P,N]=(0,o.useState)(!1),[F,L]=(0,o.useState)(null),X=(0,o.useRef)(new m).current,O=(0,o.useRef)(null),B=(0,o.useRef)(!1),U=(0,o.useRef)(null),q=(0,o.useRef)(null),G=(0,o.useRef)("");(0,o.useEffect)((()=>{N(g.length>=d)}),[g.length,d]);const H=(0,o.useCallback)((e=>{let t="",r="";try{const o=e.match(/\{[\s\S]*\}/);if(o){const e=JSON.parse(o[0]);var n,a;if(e.error)t=String(e.error.code||""),r=(null===(n=e.error.details)||void 0===n||null===(a=n[0])||void 0===a?void 0:a.reason)||""}}catch(d){}const o=e.toLowerCase().includes("api key expired")||e.toLowerCase().includes("api key invalid")||e.toLowerCase().includes("api_key_invalid")||"API_KEY_INVALID"===r||"400"===t;if(!(e.toLowerCase().includes("quota")||e.includes("429")||e.toUpperCase().includes("RESOURCE_EXHAUSTED")||e.toLowerCase().includes("rate limit"))&&!o)return{isQuotaError:!1,userMessage:e};const s=e.match(/retry in (\d+\.?\d*)\s*s/i)||e.match(/retryDelay["\s:]+(\d+)s/i),i=s?s[1]:void 0,l=(0,x.u2)();let c="";if(o)c="\u26a0\ufe0f **API Key Error**\n\n",l?(c+="Your Gemini API key has expired or is invalid.\n\n",c+="**What you can do:**\n",c+="\u2022 Go to [Google AI Studio](https://aistudio.google.com/app/apikey)\n",c+="\u2022 Generate a new API key\n",c+="\u2022 Click the \u2699\ufe0f Settings button above to update your key\n"):(c+="The shared API key has expired.\n\n",c+="**Solution: Use Your Own API Key**\n",c+="\u2022 Click the \u2699\ufe0f Settings button above\n",c+="\u2022 Add your free Gemini API key from [Google AI Studio](https://aistudio.google.com/app/apikey)\n",c+="\u2022 Get unlimited usage with your own quota\n");else if(c="\u26a0\ufe0f **API Quota Exceeded**\n\n",l){if(c+="Your Gemini API key has reached its quota limit.\n\n",c+="**What you can do:**\n",c+="\u2022 Wait for your quota to reset (usually 24 hours)\n",c+="\u2022 Check your usage at [Google AI Studio](https://aistudio.google.com/app/apikey)\n",c+="\u2022 Upgrade to a paid plan for higher limits\n",i){const e=Math.ceil(parseFloat(i));c+="\n*You can retry in ".concat(e," seconds*")}}else if(c+="The shared API key has reached its quota limit.\n\n",c+="**Solution: Use Your Own API Key**\n",c+="\u2022 Click the \u2699\ufe0f Settings button above\n",c+="\u2022 Add your free Gemini API key from [Google AI Studio](https://aistudio.google.com/app/apikey)\n",c+="\u2022 Get unlimited usage with your own quota\n",i){const e=Math.ceil(parseFloat(i));c+="\n*Or wait ".concat(e," seconds to retry with the shared key*")}return{isQuotaError:!0,userMessage:c,retryDelay:i}}),[]),Y=(0,o.useCallback)((async()=>{if(null!==l&&void 0!==l&&l.id){I(!0);try{const e=await X.findByTradeId(l.id,{limit:f,offset:0});_(e.conversations),D(e.hasMore),W(e.totalCount)}catch(e){c.logger.error("Error loading trade conversations:",e)}finally{I(!1)}}else if(null!==r&&void 0!==r&&r.id){I(!0);try{const e=await X.findByCalendarId(r.id,{limit:f,offset:0});_(e.conversations),D(e.hasMore),W(e.totalCount)}catch(e){c.logger.error("Error loading conversations:",e)}finally{I(!1)}}}),[null===r||void 0===r?void 0:r.id,null===l||void 0===l?void 0:l.id,X]),V=(0,o.useCallback)((async()=>{if(M||!z)return;const e=S.length;if(null!==l&&void 0!==l&&l.id){E(!0);try{const t=await X.findByTradeId(l.id,{limit:f,offset:e});_((e=>[...e,...t.conversations])),D(t.hasMore)}catch(t){c.logger.error("Error loading more trade conversations:",t)}finally{E(!1)}}else if(null!==r&&void 0!==r&&r.id){E(!0);try{const t=await X.findByCalendarId(r.id,{limit:f,offset:e});_((e=>[...e,...t.conversations])),D(t.hasMore)}catch(t){c.logger.error("Error loading more conversations:",t)}finally{E(!1)}}}),[null===r||void 0===r?void 0:r.id,null===l||void 0===l?void 0:l.id,S.length,M,z,X]),K=(0,o.useCallback)((async e=>{if(t&&null!==r&&void 0!==r&&r.id&&0!==e.length&&u)try{const n=await X.saveConversation(k,r.id,t,e,void 0,(null===l||void 0===l?void 0:l.id)||null);n.success&&n.data&&(C(n.data.id),c.logger.log("Conversation saved successfully:",n.data.id,null!==l&&void 0!==l&&l.id?"(trade-specific)":"(calendar-level)"),await Y())}catch(n){c.logger.error("Error saving conversation:",n)}}),[t,null===r||void 0===r?void 0:r.id,null===l||void 0===l?void 0:l.id,k,u,X,Y]),J=(0,o.useCallback)((async()=>{g.length>0&&await K(g),h([]),C(null),N(!1),L(null),c.logger.log("Started new conversation")}),[g,K]),$=(0,o.useCallback)((e=>{h(e.messages),C(e.id),N(e.message_count>=d),L(null),c.logger.log("Loaded conversation:",e.id)}),[d]),Q=(0,o.useCallback)((async e=>{try{return!!(await X.delete(e)).success&&(c.logger.log("Conversation deleted:",e),e===k&&await J(),_((t=>t.filter((t=>t.id!==e)))),!0)}catch(t){return c.logger.error("Error deleting conversation:",t),!1}}),[X,k,J]),Z=(0,o.useCallback)((()=>{const e=U.current;(O.current||e)&&(B.current=!0,O.current&&(O.current.abort(),O.current=null),e&&(h((t=>t.filter((t=>t.id!==e.userId&&t.id!==e.aiId)))),U.current=null),v(!1),b(!1),w(""))}),[]),ee=(0,o.useCallback)((async(e,o)=>{const d=e.trim();if(!d&&(!o||0===o.length)||p||!t)return;let u,m;if(B.current=!1,F){const e=g.findIndex((e=>e.id===F&&"user"===e.role));if(-1===e)u=g,m={id:(0,s.A)(),role:"user",content:d,images:o,timestamp:new Date,status:"sent"},h((e=>[...e,m]));else{u=g.slice(0,e);const t=g[e];m=(0,n.A)((0,n.A)({},t),{},{content:d,images:o,timestamp:new Date,status:"sent"});const r=[...u,m];h(r)}L(null)}else u=g,m={id:(0,s.A)(),role:"user",content:d,images:o,timestamp:new Date,status:"sent"},h((e=>[...e,m]));v(!0),b(!0),w("");const x=(0,s.A)();let f=!1;U.current={userId:m.id,aiId:x};try{O.current&&O.current.abort();const e=new AbortController;O.current=e;let s,g,p,v,b="",_="",T=[];var y,A=!1,j=!1;try{for(var k,C=(0,a.A)(i.Q.sendMessageStreaming(d,t,r,u,e.signal,null===l||void 0===l?void 0:l.id,o));A=!(k=await C.next()).done;A=!1){const e=k.value;switch(e.type){case"text_chunk":b+=e.data.text,G.current=b,q.current&&clearTimeout(q.current),q.current=setTimeout((()=>{if(f)h((e=>e.map((e=>e.id===x?(0,n.A)((0,n.A)({},e),{},{content:G.current,status:"receiving"}):e))));else{const e={id:x,role:"assistant",content:G.current,timestamp:new Date,status:"receiving"};h((t=>[...t,e])),f=!0}}),100);break;case"tool_call":c.logger.log("Tool called: ".concat(e.data.name)),T.push(e.data.name),w(T.join(", "));break;case"tool_result":c.logger.log("Tool result: ".concat(e.data.name)),T=T.filter((t=>t!==e.data.name)),T.length>0?w(T.join(", ")):w("");break;case"citation":s=e.data.citations;break;case"embedded_data":g=e.data.embeddedTrades,p=e.data.embeddedEvents,v=e.data.embeddedNotes;break;case"done":_=e.data.messageHtml||"",c.logger.log("AI response streaming complete");break;case"error":throw new Error(e.data.error||"Streaming error")}}}catch(S){j=!0,y=S}finally{try{A&&null!=C.return&&await C.return()}finally{if(j)throw y}}if(q.current&&(clearTimeout(q.current),q.current=null),B.current||!f&&!b)return;const I={id:x,role:"assistant",content:b,messageHtml:_,citations:s,embeddedTrades:g,embeddedEvents:p,embeddedNotes:v,timestamp:new Date,status:"received"};h(f?e=>e.map((e=>e.id===x?I:e)):e=>[...e,I]);const M=[...u,m,I];await K(M)}catch(_){if("object"===typeof _&&null!==_&&"name"in _&&"AbortError"===_.name||B.current)return void c.logger.log("AI chat request cancelled by user");c.logger.error("Error sending message to Supabase AI agent:",_);const e=_ instanceof Error?_.message:"Unknown error",t=H(e),r={type:t.isQuotaError?"rate_limit":"network_error",message:t.isQuotaError?"API Quota Exceeded":"Failed to send message",details:e,retryable:!0},n={id:x,role:"assistant",content:t.isQuotaError?t.userMessage:"Sorry, I encountered an error processing your message. Please try again.",timestamp:new Date,status:"error",error:r.message};h(f?e=>e.map((e=>e.id===x?n:e)):e=>[...e,n])}finally{q.current&&(clearTimeout(q.current),q.current=null),O.current=null,U.current=null,B.current=!1,v(!1),b(!1),w("")}}),[t,r,l,g,F,p,H,K]),te=(0,o.useCallback)((e=>{const t=g.find((t=>t.id===e));return t&&"user"===t.role?(L(e),{content:t.content,images:t.images}):null}),[g]),re=(0,o.useCallback)((e=>{const t=te(e);return t?t.content:null}),[te]),ne=(0,o.useCallback)((()=>{L(null)}),[]),ae=(0,o.useCallback)((()=>{if(l){const e=l.name||"this trade",t=l.trade_type,r="win"===t,n="loss"===t,a=r?"winning":n?"losing":"";return{id:"welcome",role:"assistant",content:"".concat(r?"\u2705":n?"\u274c":"\u2796"," I'm ready to analyze your ").concat(a," trade on **").concat(e,"**.\n\nI can help you understand what worked").concat(n?" or didn't work":"",", identify patterns, and provide insights to improve your trading.\n\nWhat would you like to know about this trade?"),timestamp:new Date,status:"received"}}const e=r?"You're working with the \"".concat(r.name,'" calendar. '):"You can ask me about your trading performance across all your calendars. ",t=r?"":"\n\n\ud83d\udcdd Note: Conversation history is only available when working with a specific calendar.";return{id:"welcome",role:"assistant",content:"\ud83d\udc4b Hello! I'm your AI trading analyst. ".concat(e,"I can help you analyze your trading performance, identify patterns, and provide insights to improve your trading.\n\n\ud83d\udca1 I'll analyze your trading data to give you focused and accurate insights!").concat(t,"\n\nWhat would you like to know about your trading?"),timestamp:new Date,status:"received"}}),[r,l]);return{messages:g,isLoading:p,isTyping:A,toolExecutionStatus:j,currentConversationId:k,conversations:S,loadingConversations:T,loadingMoreConversations:M,hasMoreConversations:z,totalConversationsCount:R,isAtMessageLimit:P,editingMessageId:F,sendMessage:ee,cancelRequest:Z,editMessage:re,setInputForEdit:te,clearEditingState:ne,loadConversations:Y,loadMoreConversations:V,selectConversation:$,deleteConversation:Q,startNewChat:J,setMessages:h,getWelcomeMessage:ae,parseQuotaError:H}}},28518:(e,t,r)=>{r.d(t,{A:()=>w,w:()=>j});var n=r(65043),a=r(60267),o=r(78403),s=r(29651),i=r(53969),l=r(70298),c=r(55895),d=r(83759),u=r(42579),g=r(3830),h=r(36131),p=r(1422),m=r(102),x=r(92968),f=r(72422),y=r(39963),v=r(54410),A=r(62720),b=r(70579);const j=e=>{let{note:t,onClick:r,onPin:j,onArchive:w,onUnarchive:k,calendar:C,showCalendarBadge:S=!1}=e;const _=(0,a.A)(),[T,I]=(0,n.useState)(!1),M=(e=>{if(!e)return"";try{return(0,v.convertFromRaw)(JSON.parse(e)).getPlainText()}catch(t){return e}})(t.content),E=M.length>80?M.substring(0,80)+"...":M;return(0,b.jsxs)(o.A,{onClick:()=>r(t),onMouseEnter:()=>I(!0),onMouseLeave:()=>I(!1),sx:{borderRadius:1,mb:.5,p:1.5,border:"1px solid ".concat((0,s.X4)(_.palette.divider,.1)),bgcolor:t.is_pinned?(0,s.X4)(_.palette.primary.main,.03):"transparent","&:hover":{bgcolor:t.is_pinned?(0,s.X4)(_.palette.primary.main,.08):(0,s.X4)(_.palette.action.hover,.05),boxShadow:1},transition:"all 0.2s ease"},children:[(0,b.jsxs)(i.A,{sx:{flex:1,minWidth:0,mr:1},children:[(0,b.jsxs)(l.A,{direction:"row",alignItems:"center",spacing:.5,sx:{mb:.5},children:[t.is_pinned&&(0,b.jsx)(g.A,{fontSize:"small",sx:{color:"primary.main",fontSize:"0.9rem"}}),t.is_reminder_active&&t.reminder_type&&"none"!==t.reminder_type&&(0,b.jsx)(h.A,{fontSize:"small",sx:{color:"info.main",fontSize:"0.9rem"},titleAccess:"".concat("weekly"===t.reminder_type?"Weekly":"One-time"," reminder")}),t.by_assistant&&(0,b.jsx)(p.A,{fontSize:"small",sx:{color:"primary.main",fontSize:"0.9rem"},titleAccess:"AI-generated note"}),(0,b.jsx)(c.A,{variant:"subtitle2",sx:{fontWeight:600,fontSize:"0.9rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1},children:t.title})]}),S&&C&&(0,b.jsx)(d.A,{label:C.name,size:"small",sx:{height:18,fontSize:"0.7rem",bgcolor:(0,s.X4)(_.palette.secondary.main,.1),color:"secondary.main",fontWeight:600,alignSelf:"flex-start",mb:.5}}),E&&(0,b.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.4,fontSize:"0.8rem",mb:.5},children:E}),t.tags&&t.tags.length>0&&(0,b.jsxs)(l.A,{direction:"row",spacing:.5,sx:{mb:.5,flexWrap:"wrap",gap:.25},children:[(0,b.jsx)(m.A,{sx:{fontSize:"0.75rem",color:"text.disabled",mt:.25}}),t.tags.slice(0,3).map((e=>(0,b.jsx)(d.A,{label:(0,A.Vy)(e),size:"small",sx:{height:16,fontSize:"0.65rem",bgcolor:(0,s.X4)(_.palette.secondary.main,.1),color:"text.secondary","& .MuiChip-label":{px:.75}}},e))),t.tags.length>3&&(0,b.jsxs)(c.A,{variant:"caption",color:"text.disabled",sx:{fontSize:"0.65rem"},children:["+",t.tags.length-3]})]}),(0,b.jsxs)(c.A,{variant:"caption",color:"text.disabled",sx:{fontSize:"0.7rem"},children:["Last updated: ",new Date(t.updated_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),(0,b.jsxs)(l.A,{direction:"row",spacing:.5,sx:{opacity:T||t.is_pinned?1:0,transition:"opacity 0.15s ease"},children:[j&&(0,b.jsx)(u.A,{size:"small",onClick:e=>{e.stopPropagation(),j&&j(t)},sx:{p:.5,color:t.is_pinned?"primary.main":"text.secondary","&:hover":{bgcolor:(0,s.X4)(_.palette.primary.main,.1),color:"primary.main"}},children:t.is_pinned?(0,b.jsx)(g.A,{sx:{fontSize:"1.1rem"}}):(0,b.jsx)(x.A,{sx:{fontSize:"1.1rem"}})}),(w||k)&&(0,b.jsx)(u.A,{size:"small",onClick:e=>{e.stopPropagation(),t.is_archived&&k?k(t):!t.is_archived&&w&&w(t)},sx:{p:.5,color:"text.secondary","&:hover":{bgcolor:(0,s.X4)(_.palette.warning.main,.1),color:"warning.main"}},children:t.is_archived?(0,b.jsx)(f.A,{sx:{fontSize:"1.1rem"}}):(0,b.jsx)(y.A,{sx:{fontSize:"1.1rem"}})})]}),t.cover_image&&(0,b.jsx)(i.A,{sx:{width:80,height:80,borderRadius:1,backgroundImage:"url(".concat(t.cover_image,")"),backgroundSize:"cover",backgroundPosition:"center",ml:1.5,flexShrink:0,border:"1px solid ".concat((0,s.X4)(_.palette.divider,.1))}})]})},w=j},32515:(e,t,r)=>{r.d(t,{A:()=>f});var n=r(89379),a=r(65043),o=r(60267),s=r(38517),i=r(53969),l=r(42579),c=r(92490),d=r(22038),u=r(369),g=r(151),h=r(27421),p=r(46577),m=r(55467),x=r(70579);const f=e=>{var t;let{open:r,onClose:f,imageProp:y}=e;const v=(null===y||void 0===y?void 0:y.allImages)||[],A=null===y||void 0===y?void 0:y.allImages[(null===y||void 0===y?void 0:y.selectetdImageIndex)||0],b=v.length>0?v:A?[A]:[],[j,w]=(0,a.useState)(y);null==j&&y&&w(y);const k=(0,o.A)(),C=b[(null===j||void 0===j?void 0:j.selectetdImageIndex)||0],S=null===C||void 0===C?void 0:C.includes("quickchart.io"),_=null!==(t=null===y||void 0===y?void 0:y.useSolidBackground)&&void 0!==t?t:S,[T,I]=(0,a.useState)(1),[M,E]=(0,a.useState)({x:0,y:0}),[z,D]=(0,a.useState)(!1),[R,W]=(0,a.useState)({x:0,y:0}),P=(0,a.useRef)(null),N=(0,a.useRef)(null),F=()=>{I(1),E({x:0,y:0})},L=(0,a.useCallback)((()=>{b.length<=1||w((e=>e?(0,n.A)((0,n.A)({},e),{},{selectetdImageIndex:(e.selectetdImageIndex+1)%b.length}):e))}),[b.length]),X=(0,a.useCallback)((()=>{b.length<=1||w((e=>e?(0,n.A)((0,n.A)({},e),{},{selectetdImageIndex:(e.selectetdImageIndex-1+b.length)%b.length}):e))}),[b.length]);return(0,a.useEffect)((()=>{r&&F()}),[r,j]),(0,a.useEffect)((()=>{const e=e=>{r&&("ArrowLeft"===e.key?(e.preventDefault(),e.stopPropagation(),X()):"ArrowRight"===e.key?(e.preventDefault(),e.stopPropagation(),L()):"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),f()))};return window.addEventListener("keydown",e,!0),()=>{window.removeEventListener("keydown",e,!0)}}),[r,j,b.length,X,L,f]),(0,a.useEffect)((()=>{const e=()=>{D(!1)};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}}),[]),(0,x.jsx)(s.A,{open:r,onClose:f,maxWidth:"md",fullWidth:!0,sx:{zIndex:m.M.DIALOG_POPUP},PaperProps:{sx:{boxShadow:"none",backgroundColor:_?k.palette.background.paper:"transparent",overflow:"hidden",maxWidth:"80%",borderRadius:_?2:0,"& .MuiDialogContent-root":(0,n.A)({},(0,p.J)(k))}},children:b.length>0&&(0,x.jsxs)(x.Fragment,{children:[b.length>1&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(i.A,{sx:{position:"absolute",left:16,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1200},children:(0,x.jsx)(l.A,{onClick:X,sx:{color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:(0,x.jsx)(c.A,{})})}),(0,x.jsx)(i.A,{sx:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1200},children:(0,x.jsx)(l.A,{onClick:L,sx:{color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:(0,x.jsx)(d.A,{})})})]}),b.length>1&&(0,x.jsxs)(i.A,{sx:{position:"absolute",bottom:16,left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",borderRadius:1,px:1.5,py:.5,fontSize:"0.875rem",fontWeight:500,zIndex:1200},children:[(null===j||void 0===j?void 0:j.selectetdImageIndex)+1," / ",b.length]}),(0,x.jsxs)(i.A,{ref:N,sx:{position:"relative",width:"100%",height:"80vh",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",cursor:T>1?"grab":"default",backgroundColor:_?k.palette.background.default:"transparent",padding:_?2:0,"&:active":{cursor:T>1?"grabbing":"default"}},onWheel:e=>{e.preventDefault();const t=e.deltaY>0?Math.max(1,T-.1):Math.min(3,T+.1);I(t)},onMouseDown:e=>{T>1&&(e.preventDefault(),D(!0),W({x:e.clientX-M.x,y:e.clientY-M.y}))},onMouseMove:e=>{if(!z||T<=1)return;e.preventDefault();const t=e.clientX-R.x,r=e.clientY-R.y;if(P.current&&N.current){const e=P.current.getBoundingClientRect(),n=e.width*(T-1)/2,a=e.height*(T-1)/2,o=Math.min(Math.max(-n,t),n),s=Math.min(Math.max(-a,r),a);E({x:o,y:s})}},onMouseUp:e=>{e.preventDefault(),D(!1)},onMouseLeave:e=>{e.preventDefault(),D(!1)},children:[(0,x.jsx)(i.A,{sx:{position:"relative",transform:"scale(".concat(T,") translate(").concat(M.x,"px, ").concat(M.y,"px)"),transition:z?"none":"transform 0.1s ease-out"},children:(0,x.jsx)("img",{ref:P,src:b[(null===j||void 0===j?void 0:j.selectetdImageIndex)||0],alt:"Trade ".concat((null===j||void 0===j?void 0:j.selectetdImageIndex)+1," of ").concat(b.length),style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",userSelect:"none",pointerEvents:"none"}})}),(0,x.jsxs)(i.A,{sx:{position:"absolute",top:16,right:16,display:"flex",gap:1,backgroundColor:"rgba(0, 0, 0, 0.5)",borderRadius:1,p:.5},children:[(0,x.jsx)(l.A,{onClick:()=>I(Math.max(1,T-.1)),disabled:T<=1,sx:{color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:(0,x.jsx)(u.A,{sx:{transform:"rotate(45deg)"}})}),(0,x.jsx)(l.A,{onClick:()=>I(Math.min(3,T+.1)),disabled:T>=3,sx:{color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:(0,x.jsx)(u.A,{})}),(0,x.jsx)(l.A,{onClick:F,disabled:1===T,sx:{color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:(0,x.jsx)(g.A,{})}),(0,x.jsx)(l.A,{onClick:f,sx:{color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:(0,x.jsx)(h.A,{})})]})]})]})})}},38508:(e,t,r)=>{r.d(t,{A:()=>M});var n=r(89379),a=r(65043),o=r(60267),s=r(38517),i=r(81911),l=r(53969),c=r(55895),d=r(42579),u=r(78776),g=r(24343),h=r(41859),p=r(80172),m=r(83759),x=r(91244),f=r(74956),y=r(88578),v=r(31202),A=r(29651),b=r(27421),j=r(63745),w=r(39367),k=r(73200),C=r(75565),S=r(78018),_=r(46577),T=r(75499);var I=r(70579);const M=e=>{let{open:t,onClose:r,onImageSelect:M,title:E="Choose a cover image"}=e;const z=(0,o.A)(),[D,R]=(0,a.useState)(""),[W,P]=(0,a.useState)([]),[N,F]=(0,a.useState)(!1),[L,X]=(0,a.useState)(!1),O=(e=>(0,n.A)((0,n.A)({},T.z),{},{PaperProps:{sx:{borderRadius:2,boxShadow:"none",border:"1px solid ".concat(e.palette.divider),maxHeight:"90vh",overflow:"hidden","& .MuiDialogContent-root":(0,n.A)({},(0,_.J)(e))}}}))(z),B="zyA74qKSAGOPf2LOsdY7TLvO3d-YfOs3XXPfPinia-A",U=["trading charts","financial markets","business success","growth analytics","stock market","cryptocurrency","investment","profit growth"],q=e=>{const t=["trading","finance","business","charts","success","growth"].find((t=>e.toLowerCase().includes(t)))||"business";return Array.from({length:24},((e,r)=>({id:"placeholder-".concat(r),urls:{small:"https://picsum.photos/400/200?random=".concat(r,"&blur=1"),regular:"https://picsum.photos/800/400?random=".concat(r),full:"https://picsum.photos/1200/600?random=".concat(r)},links:{download_location:"",html:""},alt_description:"".concat(t," image ").concat(r+1),user:{name:"Demo User",username:"demo_user",links:{html:""}}})))},G=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D;if(e.trim()){F(!0),X(!1);try{const t=C.X.getCachedImages(e);if(t)return S.logger.log("Loading ".concat(t.length,' images from cache for query: "').concat(e,'"')),P(t),X(!0),void F(!1);0,S.logger.log('Fetching images from Unsplash API for query: "'.concat(e,'"'));const r=await fetch("https://api.unsplash.com/search/photos?query=".concat(encodeURIComponent(e),"&per_page=24&orientation=landscape"),{headers:{Authorization:"Client-ID ".concat(B)}});if(r.ok){const t=await r.json();P(t.results),C.X.cacheImages(e,t.results),S.logger.log("Cached ".concat(t.results.length,' images for query: "').concat(e,'"'))}else{S.logger.error("Failed to fetch images from Unsplash");const t=q(e);P(t),C.X.cacheImages(e,t)}}catch(t){S.logger.error("Error fetching images:",t);const r=q(e);P(r),C.X.cacheImages(e,r)}finally{F(!1)}}};return a.useEffect((()=>{if(t){const e=C.X.removeExpiredEntries();e>0&&S.logger.log("Removed ".concat(e," expired cache entries")),0===W.length&&(R("trading charts"),G("trading charts"))}}),[t]),(0,I.jsxs)(s.A,(0,n.A)((0,n.A)({open:t,onClose:r,maxWidth:"lg",fullWidth:!0},O),{},{sx:(0,n.A)((0,n.A)({},O.sx||{}),{},{zIndex:e=>e.zIndex.modal+200}),children:[(0,I.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",py:2,px:2.5,borderBottom:"1px solid",borderColor:"divider"},children:[(0,I.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,I.jsx)(c.A,{variant:"h6",sx:{fontWeight:600},children:E}),(0,I.jsx)(c.A,{variant:"body2",sx:{color:"text.secondary"},children:"Choose a clean cover image from curated Unsplash photos"})]}),(0,I.jsx)(d.A,{onClick:r,size:"small",sx:{color:"text.secondary","&:hover":{bgcolor:(0,A.X4)(z.palette.error.main,.08),color:"error.main"}},children:(0,I.jsx)(b.A,{})})]}),(0,I.jsxs)(u.A,{sx:{pt:2,px:2.5},children:[(0,I.jsxs)(l.A,{sx:{display:"flex",gap:1.5,mt:1,mb:2,alignItems:"center",flexDirection:{xs:"column",sm:"row"}},children:[(0,I.jsx)(g.A,{fullWidth:!0,size:"small",placeholder:"Search for trading charts, financial markets, business...",value:D,onChange:e=>R(e.target.value),onKeyDown:e=>"Enter"===e.key&&G(),slotProps:{input:{startAdornment:(0,I.jsx)(j.A,{sx:{mr:1.5,color:"primary.main"}}),sx:{borderRadius:1}}},sx:{"& .MuiOutlinedInput-root":{borderRadius:1},bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"}}),(0,I.jsx)(h.A,{variant:"contained",onClick:()=>G(),disabled:N,sx:{minWidth:120,borderRadius:1,background:e=>"linear-gradient(135deg, ".concat(e.palette.primary.main," 0%, ").concat(e.palette.primary.light," 100%)"),"&:hover":{background:e=>"linear-gradient(135deg, ".concat(e.palette.primary.dark," 0%, ").concat(e.palette.primary.main," 100%)"),transform:"translateY(-1px)",boxShadow:e=>"0 4px 12px ".concat((0,A.X4)(e.palette.primary.main,.3))}},children:N?(0,I.jsx)(p.A,{size:20,color:"inherit"}):"Search"})]}),L&&(0,I.jsx)(l.A,{sx:{mb:2},children:(0,I.jsx)(m.A,{icon:(0,I.jsx)(w.A,{}),label:"Loaded from cache",size:"small",color:"success",variant:"outlined",sx:{fontSize:"0.75rem",height:24,"& .MuiChip-icon":{fontSize:"0.9rem"}}})}),(0,I.jsxs)(l.A,{sx:{mb:3},children:[(0,I.jsx)(c.A,{variant:"subtitle2",sx:{color:"text.primary",mb:1.5,display:"block",fontWeight:600},children:"\u2728 Popular searches"}),(0,I.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:(()=>{const e=[...C.X.getPopularQueries(3)];return U.forEach((t=>{e.some((e=>e.toLowerCase()===t.toLowerCase()))||e.push(t)})),e.slice(0,8)})().map(((e,t)=>{const r=C.X.isCached(e);return(0,I.jsx)(h.A,{size:"small",variant:"outlined",onClick:()=>(e=>{R(e),G(e)})(e),startIcon:r?(0,I.jsx)(w.A,{sx:{fontSize:"0.8rem"}}):void 0,sx:{fontSize:"0.8rem",textTransform:"none",borderRadius:1,minWidth:"auto",px:2,py:.5,borderColor:r?"success.main":"divider",color:r?"success.main":"text.primary",background:e=>r?"linear-gradient(135deg, ".concat((0,A.X4)(e.palette.success.main,.05)," 0%, ").concat((0,A.X4)(e.palette.success.light,.05)," 100%)"):"dark"===e.palette.mode?"linear-gradient(135deg, ".concat((0,A.X4)(e.palette.background.paper,.8)," 0%, ").concat((0,A.X4)(e.palette.background.default,.9)," 100%)"):"linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(248,250,252,0.9) 100%)","&:hover":{borderColor:r?"success.main":"primary.main",color:r?"success.main":"primary.main",background:e=>r?"linear-gradient(135deg, ".concat((0,A.X4)(e.palette.success.main,.1)," 0%, ").concat((0,A.X4)(e.palette.success.light,.1)," 100%)"):"linear-gradient(135deg, ".concat((0,A.X4)(e.palette.primary.main,"dark"===e.palette.mode?.15:.05)," 0%, ").concat((0,A.X4)(e.palette.primary.light,"dark"===e.palette.mode?.15:.05)," 100%)"),transform:"translateY(-1px)",boxShadow:e=>"0 2px 8px ".concat((0,A.X4)(r?e.palette.success.main:e.palette.primary.main,.25))}},children:e},"".concat(e,"-").concat(t))}))})]}),(0,I.jsxs)(l.A,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,I.jsx)(c.A,{variant:"caption",sx:{color:"text.secondary"},children:(()=>{const e=C.X.getCacheStats();return"".concat(e.totalEntries," cached searches \u2022 ").concat((e.totalSize/1024).toFixed(1),"KB")})()}),(0,I.jsx)(h.A,{size:"small",variant:"text",onClick:()=>{C.X.clearCache(),P([]),X(!1)},sx:{fontSize:"0.75rem",textTransform:"none",color:"text.secondary","&:hover":{color:"error.main"}},children:"Clear cache"})]}),(0,I.jsx)(l.A,{sx:(0,n.A)({maxHeight:380,overflowY:"auto",overflowX:"hidden",borderRadius:1,border:"1px solid ".concat(z.palette.divider),bgcolor:"dark"===z.palette.mode?(0,A.X4)(z.palette.background.paper,.9):(0,A.X4)(z.palette.background.default,.9),p:1.5},(0,_.J)(z)),children:N?(0,I.jsx)(l.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(3, 1fr)",md:"repeat(4, 1fr)",lg:"repeat(5, 1fr)"},gap:1.5},children:Array.from({length:20}).map(((e,t)=>(0,I.jsx)(k.A,{height:140,borderRadius:1,variant:"wave",intensity:"medium"},t)))}):(0,I.jsx)(l.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(3, 1fr)",md:"repeat(4, 1fr)",lg:"repeat(5, 1fr)"},gap:1.5},children:W.map((e=>(0,I.jsx)(x.A,{sx:{borderRadius:1,transition:"transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease",cursor:"pointer",position:"relative",overflow:"hidden",border:"1px solid",borderColor:(0,A.X4)(z.palette.divider,.7),"&:hover":{transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0,0,0,0.18)",borderColor:z.palette.primary.main,"& .image-overlay":{opacity:1}}},children:(0,I.jsxs)(f.A,{onClick:()=>(async e=>{if(e.links.download_location&&B)try{await fetch(e.links.download_location,{headers:{Authorization:"Client-ID ".concat(B)}})}catch(n){S.logger.error("Error triggering download endpoint:",n)}const t="".concat(e.urls.full,"&q=85&fm=jpg&fit=crop&w=1200&h=600");M(t,{id:e.id,photographer:e.user.name,photographerUsername:e.user.username,photographerUrl:"".concat(e.user.links.html,"?utm_source=trade-tracker&utm_medium=referral"),unsplashUrl:"".concat(e.links.html,"?utm_source=trade-tracker&utm_medium=referral"),altDescription:e.alt_description}),r()})(e),sx:{position:"relative","&:hover .MuiCardActionArea-focusHighlight":{opacity:0}},children:[(0,I.jsx)(y.A,{component:"img",height:"120",image:e.urls.small,alt:e.alt_description||"Cover image",sx:{objectFit:"cover"}}),(0,I.jsx)(l.A,{className:"image-overlay",sx:{position:"absolute",inset:0,backgroundColor:(0,A.X4)(z.palette.common.black,.4),opacity:0,transition:"opacity 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",color:"common.white"},children:(0,I.jsx)(c.A,{variant:"body2",sx:{fontWeight:600},children:"Select Image"})}),"demo_user"!==e.user.username&&(0,I.jsx)(l.A,{sx:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",p:1,fontSize:"0.7rem"},children:(0,I.jsxs)(c.A,{variant:"caption",sx:{fontSize:"0.7rem",fontWeight:500,textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:["\ud83d\udcf8 ",e.user.name]})})]})},e.id)))})}),(0,I.jsx)(l.A,{sx:{mt:3,pt:3,borderTop:"1px solid",borderColor:"divider",textAlign:"center",background:e=>"linear-gradient(135deg, ".concat((0,A.X4)(e.palette.primary.main,.02)," 0%, ").concat((0,A.X4)(e.palette.primary.light,.02)," 100%)"),borderRadius:1,mx:-1,px:2},children:(0,I.jsxs)(c.A,{variant:"body2",sx:{color:"text.secondary",display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[(0,I.jsx)(l.A,{component:"span",sx:{fontSize:"1.2rem"},children:"\ud83d\udcf7"}),(0,I.jsx)(v.A,{href:"https://unsplash.com/?utm_source=trade-tracker&utm_medium=referral",target:"_blank",rel:"noopener noreferrer",sx:{color:"primary.main",textDecoration:"none",fontWeight:600,borderBottom:"1px solid transparent",transition:"border-color 0.2s ease","&:hover":{borderBottomColor:"primary.main"}},children:"Photo by Unsplash"})]})})]})]}))}},41180:(e,t,r)=>{r.d(t,{Dh:()=>A,p4:()=>f,Iy:()=>v,M8:()=>p,vW:()=>x,ZF:()=>h,vP:()=>k,t0:()=>u,uA:()=>j,g2:()=>m,do:()=>g,C8:()=>b,xU:()=>w,w3:()=>y});var n=r(89379),a=r(78018),o=r(8060),s=r(35054);const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;if(!e)return t;const r=new Date(e);return isNaN(r.getTime())?t:r},l=e=>(0,n.A)((0,n.A)({},e),{},{created_at:i(e.created_at),updated_at:i(e.updated_at),archived_at:e.archived_at?i(e.archived_at):null});class c extends o.I{constructor(e){super(e)}async findById(e){try{const{data:t,error:r}=await s.N.from("notes").select("*").eq("id",e).single();return r?(a.logger.error("Error finding note by ID:",r),null):t?l(t):null}catch(t){return a.logger.error("Error finding note by ID:",t),null}}async findByUserId(e){try{const{data:t,error:r}=await s.N.from("notes").select("*").eq("user_id",e).order("updated_at",{ascending:!1});return r?(a.logger.error("Error finding notes by user ID:",r),[]):t?t.map((e=>l(e))):[]}catch(t){return a.logger.error("Exception finding notes by user ID:",t),[]}}async findByTag(e,t){try{const{data:r,error:n}=await s.N.from("notes").select("*").eq("user_id",e).contains("tags",[t]);return n?(a.logger.error("Error finding notes by tag:",n),[]):r?r.map((e=>l(e))):[]}catch(r){return a.logger.error("Error finding notes by tag:",r),[]}}async queryByUserId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const{isPinned:r,isArchived:n,byAssistant:o,searchQuery:i,limit:c=20,offset:d=0}=t;let u=s.N.from("notes").select("*",{count:"exact"}).eq("user_id",e);void 0!==r&&(u=u.eq("is_pinned",r)),void 0!==n&&(u=u.eq("is_archived",n)),void 0!==o&&(u=u.eq("by_assistant",o)),i&&""!==i.trim()&&(u=u.or("title.ilike.%".concat(i,"%,content.ilike.%").concat(i,"%"))),u=u.order("updated_at",{ascending:!1}).range(d,d+c-1);const{data:g,error:h,count:p}=await u;if(h)return a.logger.error("Error querying notes by user ID:",h),{notes:[],total:0,hasMore:!1};const m=g?g.map((e=>l(e))):[],x=p||0;return{notes:m,total:x,hasMore:d+c<x}}catch(r){return a.logger.error("Exception querying notes by user ID:",r),{notes:[],total:0,hasMore:!1}}}async findByCalendarId(e){try{const{data:t,error:r}=await s.N.from("notes").select("*").or("calendar_id.eq.".concat(e,",calendar_id.is.null")).order("updated_at",{ascending:!1});return r?(a.logger.error("Error finding notes by calendar ID:",r),[]):t?t.map((e=>l(e))):[]}catch(t){return a.logger.error("Exception finding notes by calendar ID:",t),[]}}async queryByCalendarId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const{isPinned:r,isArchived:n,byAssistant:o,searchQuery:i,limit:c=20,offset:d=0}=t;let u=s.N.from("notes").select("*",{count:"exact"}).or("calendar_id.eq.".concat(e,",calendar_id.is.null"));void 0!==r&&(u=u.eq("is_pinned",r)),void 0!==n&&(u=u.eq("is_archived",n)),void 0!==o&&(u=u.eq("by_assistant",o)),i&&""!==i.trim()&&(u=u.or("title.ilike.%".concat(i,"%,content.ilike.%").concat(i,"%"))),u=u.order("updated_at",{ascending:!1}).range(d,d+c-1);const{data:g,error:h,count:p}=await u;if(h)return a.logger.error("Error querying notes by calendar ID:",h),{notes:[],total:0,hasMore:!1};const m=g?g.map((e=>l(e))):[],x=p||0;return{notes:m,total:x,hasMore:d+c<x}}catch(r){return a.logger.error("Exception querying notes by calendar ID:",r),{notes:[],total:0,hasMore:!1}}}async findAll(){try{const{data:e,error:t}=await s.N.from("notes").select("*").order("updated_at",{ascending:!1});return t?(a.logger.error("Error finding all notes:",t),[]):e?e.map((e=>l(e))):[]}catch(e){return a.logger.error("Error finding all notes:",e),[]}}async archiveNote(e){try{const{error:t}=await s.N.from("notes").update({is_archived:!0,updated_at:new Date}).eq("id",e);return!t||(a.logger.error("Error archiving note:",t),!1)}catch(t){return a.logger.error("Exception archiving note:",t),!1}}async unarchiveNote(e){try{const{error:t}=await s.N.from("notes").update({is_archived:!1,updated_at:new Date}).eq("id",e);return!t||(a.logger.error("Error unarchiving note:",t),!1)}catch(t){return a.logger.error("Exception unarchiving note:",t),!1}}async moveNoteToCalendar(e,t){try{const{error:r}=await s.N.from("notes").update({calendar_id:t,updated_at:new Date}).eq("id",e);return!r||(a.logger.error("Error moving note to calendar:",r),!1)}catch(r){return a.logger.error("Exception moving note to calendar:",r),!1}}async pinNote(e){try{const{error:t}=await s.N.from("notes").update({is_pinned:!0,updated_at:new Date}).eq("id",e);return!t||(a.logger.error("Error pinning note:",t),!1)}catch(t){return a.logger.error("Exception pinning note:",t),!1}}async unpinNote(e){try{const{error:t}=await s.N.from("notes").update({is_pinned:!1,updated_at:new Date}).eq("id",e);return!t||(a.logger.error("Error unpinning note:",t),!1)}catch(t){return a.logger.error("Exception unpinning note:",t),!1}}async findRemindersByDay(e,t){try{const{data:r,error:n}=await s.N.from("notes").select("*").or("calendar_id.eq.".concat(e,",calendar_id.is.null")).eq("reminder_type","weekly").eq("is_reminder_active",!0).eq("is_archived",!1).contains("reminder_days",[t]).order("created_at",{ascending:!1});return n?(a.logger.error("Error finding reminders by day:",n),[]):r?r.map((e=>l(e))):[]}catch(r){return a.logger.error("Exception finding reminders by day:",r),[]}}async findRemindersByDate(e,t){try{const r=t.toISOString().split("T")[0],{data:n,error:o}=await s.N.from("notes").select("*").or("calendar_id.eq.".concat(e,",calendar_id.is.null")).eq("reminder_type","once").eq("is_reminder_active",!0).eq("is_archived",!1).eq("reminder_date",r).order("created_at",{ascending:!1});return o?(a.logger.error("Error finding reminders by date:",o),[]):n?n.map((e=>l(e))):[]}catch(r){return a.logger.error("Exception finding reminders by date:",r),[]}}async createInSupabase(e){const t=new Date,r=(0,n.A)((0,n.A)({},e),{},{title:e.title||"Untitled",content:e.content||"",is_archived:!1,is_pinned:!1,archived_at:null,created_at:t,updated_at:t}),{data:a,error:o}=await s.N.from("notes").insert(r).select().single();if(o)throw o;return l(a)}async updateInSupabase(e,t){const r=(0,n.A)((0,n.A)({},t),{},{updated_at:new Date}),{data:a,error:o}=await s.N.from("notes").update(r).eq("id",e).select().single();if(o)throw o;return l(a)}async deleteInSupabase(e){const{error:t}=await s.N.from("notes").delete().eq("id",e);if(t)throw t;return!0}}const d=new c,u=async e=>{try{return await d.findByUserId(e)}catch(t){return a.logger.error("Error getting user notes:",t),[]}},g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await d.queryByUserId(e,t)}catch(r){return a.logger.error("Error querying user notes:",r),{notes:[],total:0,hasMore:!1}}},h=async(e,t)=>{try{return await d.findByTag(e,t)}catch(r){return a.logger.error("Error getting notes by tag:",r),[]}},p=async e=>{try{return await d.findByCalendarId(e)}catch(t){return a.logger.error("Error getting calendar notes:",t),[]}},m=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await d.queryByCalendarId(e,t)}catch(r){return a.logger.error("Error querying calendar notes:",r),{notes:[],total:0,hasMore:!1}}},x=async e=>{try{return await d.findById(e)}catch(t){return a.logger.error("Error getting note:",t),null}},f=async e=>{try{var t,r;const a=(0,n.A)((0,n.A)({},e),{},{title:e.title||"Untitled",content:e.content||"",cover_image:null!==(t=e.cover_image)&&void 0!==t?t:null,is_archived:!1,is_pinned:!1,archived_at:null,by_assistant:null!==(r=e.by_assistant)&&void 0!==r&&r}),s=await d.create(a);var o;if(!s.success||!s.data)throw new Error((null===(o=s.error)||void 0===o?void 0:o.message)||"Failed to create note");return s.data}catch(s){throw a.logger.error("Error creating note:",s),s}},y=async(e,t)=>{try{const n=await d.update(e,t);var r;if(!n.success)throw new Error((null===(r=n.error)||void 0===r?void 0:r.message)||"Failed to update note")}catch(n){throw a.logger.error("Error updating note:",n),n}},v=async e=>{try{const r=await d.delete(e);var t;if(!r.success)throw new Error((null===(t=r.error)||void 0===t?void 0:t.message)||"Failed to delete note")}catch(r){throw a.logger.error("Error deleting note:",r),r}},A=async e=>{try{if(!await d.archiveNote(e))throw new Error("Failed to archive note")}catch(t){throw a.logger.error("Error archiving note:",t),t}},b=async e=>{try{if(!await d.unarchiveNote(e))throw new Error("Failed to unarchive note")}catch(t){throw a.logger.error("Error unarchiving note:",t),t}},j=async e=>{try{if(!await d.pinNote(e))throw new Error("Failed to pin note")}catch(t){throw a.logger.error("Error pinning note:",t),t}},w=async e=>{try{if(!await d.unpinNote(e))throw new Error("Failed to unpin note")}catch(t){throw a.logger.error("Error unpinning note:",t),t}},k=async(e,t)=>{try{return await d.findRemindersByDay(e,t)}catch(r){return a.logger.error("Error getting reminder notes for day:",r),[]}}},49221:(e,t,r)=>{r.d(t,{G7:()=>d,GU:()=>c,Pp:()=>g,eJ:()=>l,jp:()=>a,zH:()=>o});var n=r(41831);const a=async(e,t,r)=>{var a,o;const s=e.getFullYear(),i=e.getMonth(),l=null===(a=t.year_stats)||void 0===a?void 0:a[s.toString()],c=null===l||void 0===l||null===(o=l.monthly_stats)||void 0===o?void 0:o[i];let d;if(void 0!==(null===c||void 0===c?void 0:c.account_value_at_start))d=Number(c.account_value_at_start);else if(l)d=Number(t.account_balance);else{let e=0;if(t.year_stats)for(const[r,n]of Object.entries(t.year_stats)){parseInt(r,10)<s&&void 0!==n.yearly_pnl&&(e+=Number(n.yearly_pnl))}d=Number(t.account_balance)+e}const u=d-Number(t.account_balance);let g;if(r)g=r.filter((e=>{const t=new Date(e.trade_date);return t.getFullYear()===s&&t.getMonth()===i})).map((e=>({trade_date:e.trade_date,amount:e.amount})));else{const e=new n.P;g=await e.getTradesByMonth(t.id,s,i,["trade_date","amount"])}const h=e.getTime();return u+g.filter((e=>new Date(e.trade_date).getTime()<h)).reduce(((e,t)=>e+Number(t.amount)),0)},o=async(e,t,r,n)=>{if(!r.risk_per_trade)return 0;if(!r.dynamic_risk_enabled||!r.increased_risk_percentage||!r.profit_threshold_percentage||r.account_balance<=0)return r.risk_per_trade;return await a(e,t,n)/r.account_balance*100>=r.profit_threshold_percentage?r.increased_risk_percentage:r.risk_per_trade},s=(e,t)=>{if(!t.risk_per_trade)return 0;if(0===e.length)return t.risk_per_trade||0;if(!t.dynamic_risk_enabled||!t.increased_risk_percentage||!t.profit_threshold_percentage||t.account_balance<=0)return t.risk_per_trade;return e.reduce(((e,t)=>e+t.amount),0)/t.account_balance*100>=t.profit_threshold_percentage?t.increased_risk_percentage:t.risk_per_trade},i=(e,t)=>e+t.reduce(((e,t)=>e+t.amount),0),l=(e,t,r,n)=>{const a=n.getTime(),o=r.filter((e=>new Date(e.trade_date).getTime()<a)),s=i(Number(t),o);return s>0?Number(e)/s*100:0},c=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(Number(t)+Number(r))*Number(e)/100},d=(e,t,r)=>{if(!e.risk_to_reward||e.partials_taken||"breakeven"===e.trade_type)return Math.abs(e.amount);if(!r.risk_per_trade)return Math.abs(e.amount);let n=r.risk_per_trade;if(r.dynamic_risk_enabled&&r.increased_risk_percentage&&r.profit_threshold_percentage&&r.account_balance>0){const a=new Date(e.trade_date).getTime();t.filter((e=>new Date(e.trade_date).getTime()<a)).reduce(((e,t)=>e+Number(t.amount)),0)/r.account_balance*100>=r.profit_threshold_percentage&&(n=r.increased_risk_percentage)}if(0===n)return Math.abs(e.amount);const a=r.risk_per_trade||1;return Math.abs(e.amount)*a/n},u=(e,t)=>{if(!t.dynamic_risk_enabled||!t.increased_risk_percentage||!t.profit_threshold_percentage||t.account_balance<=0)return!1;return s(e,t)===t.increased_risk_percentage},g=(e,t,r)=>{if(!u(t,r))return e;return e*(r.increased_risk_percentage/(r.risk_per_trade||1))}},50460:(e,t,r)=>{r.d(t,{A:()=>i});r(65043);var n=r(60267),a=r(53969),o=r(29651),s=r(70579);const i=e=>{let{children:t}=e;const r=(0,n.A)(),i="dark"===r.palette.mode;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.A,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:0,bgcolor:i?"background.default":"#f8fafc",background:i?"radial-gradient(circle at 20% 20%, ".concat((0,o.X4)(r.palette.primary.main,.12)," 0%, transparent 40%),\n               radial-gradient(circle at 80% 80%, ").concat((0,o.X4)(r.palette.secondary.main,.12)," 0%, transparent 40%),\n               radial-gradient(circle at 50% 50%, ").concat((0,o.X4)(r.palette.primary.dark,.05)," 0%, transparent 60%)"):"linear-gradient(180deg, #f0f4f8 0%, #ffffff 50%, #f8fafc 100%),\n               radial-gradient(ellipse at 20% 0%, ".concat((0,o.X4)(r.palette.primary.main,.08)," 0%, transparent 50%),\n               radial-gradient(ellipse at 80% 100%, ").concat((0,o.X4)(r.palette.secondary.main,.06)," 0%, transparent 50%)"),"&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:i?"url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2v-4h4v-2h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2v-4h4v-2H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")":"url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232d3748' fill-opacity='0.08'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2v-4h4v-2h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2v-4h4v-2H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")"},pointerEvents:"none"}}),t]})}},58309:(e,t,r)=>{r.d(t,{Ay:()=>E,b4:()=>I,fJ:()=>M});var n=r(89379),a=r(65043),o=r(53969),s=r(10256),i=r(3353),l=r(67203),c=r(47471),d=r(32911),u=r(91449),g=r(407),h=r(46087),p=r(39993),m=r(94808),x=r(87498),f=r(77409),y=r(45852),v=r(76675),A=r(22011),b=r(49221),j=r(78018),w=r(635),k=r(81084),C=r(55467),S=r(41831),_=r(70579);const T=e=>{const t=document.getElementById("trade-tags-input");let r="";return t&&t.value.trim()&&(r=t.value.trim()),r?[...e,r]:e},I=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),t},M=e=>({id:e.id,name:e.name?e.name.replace(/^\ud83d\udcc8 /,""):"",amount:Math.abs(e.amount),trade_type:e.trade_type,entry_price:e.entry_price||0,trade_date:e.trade_date,exit_price:e.exit_price||0,stop_loss:e.stop_loss||0,take_profit:e.take_profit||0,tags:e.tags||[],risk_to_reward:e.risk_to_reward||0,partials_taken:e.partials_taken||!1,session:e.session||"",notes:e.notes||"",pending_images:[],is_temporary:e.is_temporary,economic_events:e.economic_events||[],uploaded_images:Array.isArray(e.images)?e.images.filter((e=>e)).map(((e,t)=>(0,n.A)((0,n.A)({},e),{},{id:e.id||x.generateImageId(),row:void 0!==e.row?e.row:t,column:void 0!==e.column?e.column:0,column_width:void 0!==e.column_width?e.column_width:100}))):[]}),E=e=>{let{open:t,onClose:r,newMainTrade:I,setNewMainTrade:E,trade_date:z,account_balance:D,showForm:R,onCancel:W,onAddTrade:P,onTagUpdated:N,onUpdateTradeProperty:F,onDeleteTrades:L,dynamicRiskSettings:X,calendar:O,tags:B=[],requiredTagGroups:U=[],onOpenGalleryMode:q,calendars:G,onCalendarChange:H}=e;const[Y,V]=(0,a.useState)(null),[K,J]=(0,a.useState)(!1),[$,Q]=(0,a.useState)(!1),[Z,ee]=(0,a.useState)(null),[te,re]=(0,a.useState)(""),[ne,ae]=(0,a.useState)(!1),[oe,se]=(0,a.useState)(0),[ie,le]=(0,a.useState)(0),[ce,de]=(0,a.useState)(!1),[ue,ge]=(0,a.useState)(0),[he,pe]=(0,a.useState)(null),me=(0,a.useRef)(!0);(0,a.useEffect)((()=>(me.current=!0,()=>{me.current=!1})),[]);const xe=(0,a.useRef)(!1),fe=!!G,ye=!fe||!(null===O||void 0===O||!O.id),ve=z instanceof Date?z.getTime():new Date(z).getTime(),Ae=(null===Z||void 0===Z?void 0:Z.trade_date)instanceof Date?Z.trade_date.getTime():null!==Z&&void 0!==Z&&Z.trade_date?new Date(Z.trade_date).getTime():null,be=null===O||void 0===O?void 0:O.id;(0,a.useEffect)((()=>{(async()=>{if(t&&O&&be){de(!0);try{let e=(null===Z||void 0===Z?void 0:Z.trade_date)||z;if(!R.editTrade&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()){const t=new Date;e=(0,g.A)(e,t)?t:(0,h.A)(e)}const[t,r]=await Promise.all([(0,b.jp)(e,O),(0,b.zH)(e,O,X)]);me.current&&(se(t),le(r))}catch(e){j.logger.error("Error fetching precalculated values:",e)}finally{me.current&&de(!1)}}})()}),[t,be,ve,Ae,R.editTrade]),(0,a.useEffect)((()=>{(async()=>{if(t&&O&&be)try{const e=new S.P,t=(await e.getTradesByDay(be,z,["amount"])).reduce(((e,t)=>e+t.amount),0);me.current&&ge(t)}catch(e){j.logger.error("Error fetching day total P&L:",e),me.current&&ge(0)}})()}),[t,ve,be]);const je=(0,a.useRef)(null),we=(0,a.useCallback)((async()=>{if(xe.current)j.logger.warn("createEmptyTrade already in progress, skipping");else{xe.current=!0,V(null),pe(null),Q(!0);try{const e=(0,A.createNewTradeData)(),t=(0,y.A)();ee((()=>(0,n.A)((0,n.A)({},e),{},{id:t,is_temporary:!1,name:"New Trade",trade_date:z})))}catch(e){j.logger.error("Error initializing empty trade:",e),ee((e=>(0,n.A)((0,n.A)({},e),{},{is_temporary:!1})))}finally{Q(!1),xe.current=!1}}}),[z]);(0,a.useEffect)((()=>{var e,t;const r=R.open&&R.createTempTrade,n=(null===(e=je.current)||void 0===e?void 0:e.open)&&(null===(t=je.current)||void 0===t?void 0:t.createTempTrade);if(!r||je.current&&n){if(R.editTrade){var a,o,s;const e=null===(a=je.current)||void 0===a||null===(o=a.editTrade)||void 0===o?void 0:o.id,t=R.editTrade.id;if(!(null!==(s=je.current)&&void 0!==s&&s.open)&&R.open||e!==t){const e=R.editTrade;if(V(e),ee(M(e)),e.risk_to_reward&&e.risk_to_reward>0){const t="win"===e.trade_type?Math.abs(e.amount)/e.risk_to_reward:Math.abs(e.amount);pe(t)}else pe(null)}}}else we();je.current=R}),[R,we]),(0,a.useEffect)((()=>{I&&ee(I)}),[I]);const ke=(0,a.useMemo)((()=>B.filter((e=>!e.startsWith("Partials:")))),[B]),Ce=e=>{re(e),ae(!0)},Se=()=>{ae(!1)},_e=()=>{Z&&Z.pending_images.forEach((e=>{URL.revokeObjectURL(e.preview)})),V(null),pe(null),E((()=>null))},Te=async(e,t,r)=>{if(F)try{return F(e,t,r)}catch(n){j.logger.error("Error updating trade property:",n)}},Ie=e=>{if(X.risk_per_trade&&X.risk_per_trade>0&&e.risk_to_reward&&e.risk_to_reward>0&&!e.partials_taken){const t=e.risk_to_reward;if(!isNaN(t)){const r=Me(t);return"loss"===e.trade_type?-Math.abs(r):Math.abs(r)}}const t=e.amount||0;return"loss"===e.trade_type?-Math.abs(t):Math.abs(t)},Me=(e,t)=>{if(!Z||!e||!D||"breakeven"===Z.trade_type)return 0;let r;if(null!==he)r=he;else{const e=ie||X.risk_per_trade||0,n=void 0!==t?t:oe;r=(0,b.GU)(e,D,n)}const n=Number(e);return"win"===Z.trade_type?Math.round(r*n):Math.round(r)},Ee=async(e,t,r)=>{try{const t=await x.uploadTradeImage(O.id,e.id,e.file,e.width,e.height,e.caption),a=r.find((t=>t.id===e.id)),o=(0,n.A)((0,n.A)({},t),{},{caption:e.caption,row:(null===a||void 0===a?void 0:a.row)||0,column:(null===a||void 0===a?void 0:a.column)||0,column_width:(null===a||void 0===a?void 0:a.column_width)||100});let s=!1;return ee((t=>{const r=[...t.pending_images],a=r.findIndex((t=>t.id===e.id));if(-1===a)return s=!0,j.logger.log("Image ".concat(e.id," was deleted during upload, skipping")),t;r.splice(a,1);const i=[...t.uploaded_images],l=i.findIndex((t=>t.id===e.id));return-1!==l&&i[l].pending&&i.splice(l,1),(0,n.A)((0,n.A)({},t),{},{pending_images:r,uploaded_images:[...i,o]})})),s?null:o}catch(a){return j.logger.error("Error uploading image ".concat(e.id,":"),a),ee((t=>(0,n.A)((0,n.A)({},t),{},{pending_images:t.pending_images.filter((t=>t.id!==e.id))}))),null!==Z&&void 0!==Z&&Z.id&&Te(Z.id,(t=>(0,n.A)((0,n.A)({},t),{},{images:(t.images||[]).filter((t=>t&&t.id!==e.id))}))).then((()=>{j.logger.log("Removed failed upload ".concat(e.id," from database"))})).catch((t=>{j.logger.error("Failed to remove failed upload ".concat(e.id," from database:"),t)})),null}},ze=()=>Z.pending_images.length>0,De=e=>{const t=[...U||[]];if(t.includes(v.h)||t.push(v.h),0===t.length)return{valid:!0,missingGroups:[]};const r=new Set;e.forEach((e=>{if(e.includes(":")){const t=e.split(":")[0];r.add(t)}}));const n=t.filter((e=>!r.has(e)));return{valid:0===n.length,missingGroups:n}},Re=async e=>{if(e&&e.preventDefault(),!P)return;if(!Z)return void j.logger.error("Form state not initialized");if(ce)return j.logger.warn("Precalculated values still loading, prevented submission"),void Ce("Please wait for risk calculations to complete");if(!Z.amount)return j.logger.error("Validation error: Amount is required"),void Ce("Amount is required");if(!Z.session)return j.logger.error("Validation error: Session is required"),void Ce("Session is required. Please select a trading session.");if(!Z.risk_to_reward||Z.risk_to_reward<=0)return j.logger.error("Validation error: Risk to reward is required"),void Ce("Risk to reward is required");const{valid:t,missingGroups:r}=De(Z.tags);if(!t)return j.logger.error("Validation error: Missing required tag groups: ".concat(r.join(", "))),void Ce("Missing required tag groups: ".concat(r.join(", ")));if(ze())return j.logger.warn("Image uploads pending, prevented submission"),void Ce("Please wait for images to finish uploading");const a=((e,t)=>{let r=Ie(e);j.logger.log("trade final amount ".concat(r));let a=T([...e.tags]);e.partials_taken&&(a=a.filter((e=>!e.startsWith("Partials:"))),a.push("Partials:Yes"));const o=new Date,s=e.trade_date||t;return(0,n.A)((0,n.A)((0,n.A)((0,n.A)((0,n.A)((0,n.A)((0,n.A)((0,n.A)((0,n.A)((0,n.A)({id:e.id||(0,y.A)(),is_temporary:e.is_temporary,trade_date:new Date(s.getFullYear(),s.getMonth(),s.getDate(),o.getHours(),o.getMinutes(),o.getSeconds()),trade_type:e.trade_type,amount:r},e.name&&{name:e.name}),e.entry_price&&{entry_price:e.entry_price}),e.exit_price&&{exit_price:e.exit_price}),e.stop_loss&&{stop_loss:e.stop_loss}),e.take_profit&&{take_profit:e.take_profit}),a.length>0&&{tags:a}),e.risk_to_reward&&{risk_to_reward:e.risk_to_reward}),{},{partials_taken:e.partials_taken,session:e.session||""},e.notes&&{notes:e.notes}),{},{images:e.uploaded_images||[]},e.economic_events&&e.economic_events.length>0&&{economic_events:e.economic_events}),{},{calendar_id:O.id,user_id:"",created_at:new Date,updated_at:new Date})})(Z,z),o=Z.is_temporary,s=Z.id;_e(),W();try{o&&s?await(null===F||void 0===F?void 0:F(s,(()=>(0,n.A)((0,n.A)({},a),{},{is_temporary:!1,updated_at:new Date})))):await P(a),j.logger.log("Trade saved successfully")}catch(i){if((0,j.error)("Error in trade submission:",i),o&&s&&L)try{await L([s]),(0,j.log)("Cleaned up temporary trade after failed update")}catch(l){(0,j.error)("Failed to cleanup temporary trade:",l)}me.current&&j.logger.error(i instanceof Error?i.message:"Failed to save trade.")}},We=async e=>{if(e&&e.preventDefault(),!Y)return;if(!Z)return void j.logger.error("Form state not initialized");if(!Z.amount)return j.logger.error("Validation error: Amount is required"),void Ce("Amount is required");if(!Z.session)return j.logger.error("Validation error: Session is required"),void Ce("Session is required. Please select a trading session.");const{valid:t,missingGroups:r}=De(Z.tags);if(!t)return j.logger.error("Validation error: Missing required tag groups: ".concat(r.join(", "))),void Ce("Missing required tag groups: ".concat(r.join(", ")));if(Z.trade_date&&Z.trade_date>new Date)return j.logger.error("Validation error: Trade date cannot be in the future"),void Ce("Trade date cannot be in the future");if(ze())return j.logger.warn("Image uploads pending, prevented update"),void Ce("Please wait for images to finish uploading");const a=Y.id,o=Ie(Z);let s=T([...Z.tags]);Z.partials_taken?(s=s.filter((e=>!e.startsWith("Partials:"))),s.push("Partials:Yes")):s=s.filter((e=>!e.startsWith("Partials:")));const i=[...Z.pending_images.map((e=>({url:e.preview||"",id:e.id,calendar_id:O.id,pending:!0,caption:e.caption||"",width:e.width||0,height:e.height||0,row:void 0!==e.row?e.row:0,column:void 0!==e.column?e.column:0,column_width:void 0!==e.column_width?e.column_width:100}))),...Z.uploaded_images.map((e=>({url:e.url||"",id:e.id,calendar_id:O.id,pending:e.pending,caption:e.caption||"",width:e.width||0,height:e.height||0,row:void 0!==e.row?e.row:0,column:void 0!==e.column?e.column:0,column_width:void 0!==e.column_width?e.column_width:100})))],l={trade_type:Z.trade_type,amount:o,name:Z.name||"",entry_price:Z.entry_price||void 0,exit_price:Z.exit_price||void 0,stop_loss:Z.stop_loss||void 0,take_profit:Z.take_profit||void 0,trade_date:Z.trade_date,is_temporary:(null===Z||void 0===Z?void 0:Z.is_temporary)&&!Z.name,tags:s||[],risk_to_reward:Z.risk_to_reward||1,partials_taken:Z.partials_taken,session:Z.session||"London",notes:Z.notes||"",images:i};_e(),W();try{if(!a)throw new Error("Cannot update trade: Missing trade ID");await(null===F||void 0===F?void 0:F(a,(e=>{const t=new Date,r=l.trade_date||e.trade_date,a=new Date(r.getFullYear(),r.getMonth(),r.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return(0,n.A)((0,n.A)((0,n.A)({},e),l),{},{trade_date:a,updated_at:new Date})}))),j.logger.log("Trade updated successfully")}catch(c){j.logger.error("Error editing trade:",c),me.current&&j.logger.error(c instanceof Error?c.message:"Failed to update trade.")}};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(m.mY,{open:t,onClose:()=>{$||ce||(Y&&_e(),r())},title:"Daily Trades",maxWidth:"md",fullWidth:!0,hideCloseButton:$||ce,primaryButtonText:Y?"Update Trade":"Add Trade",primaryButtonAction:Y?e=>We(e):e=>Re(e),isSubmitting:K||$||ce,cancelButtonAction:()=>{$||ce||(_e(),W())},hideFooterCancelButton:!1,sx:{zIndex:C.M.DIALOG_POPUP},children:(0,_.jsxs)(o.A,{sx:{p:3},children:[fe&&(0,_.jsx)(o.A,{sx:{mb:3},children:(0,_.jsxs)(s.A,{fullWidth:!0,required:!0,children:[(0,_.jsx)(i.A,{id:"trade-calendar-select-label",children:"Calendar"}),(0,_.jsx)(l.A,{labelId:"trade-calendar-select-label",id:"trade-calendar-select",value:(null===O||void 0===O?void 0:O.id)||"",label:"Calendar",onChange:e=>null===H||void 0===H?void 0:H(e.target.value),disabled:K||$,MenuProps:{sx:{zIndex:C.M.DIALOG_POPUP}},children:null===G||void 0===G?void 0:G.map((e=>(0,_.jsx)(c.A,{value:e.id,children:e.name},e.id)))})]})}),(0,_.jsx)(f.A1,{title:(0,p.A)(z,"EEEE, MMMM d, yyyy"),account_balance:D+oe,formInputVisible:!0,total_pnl:ue,onPrevDay:()=>{},onNextDay:()=>{}}),(0,_.jsx)(o.A,{sx:{opacity:ye?1:.5,pointerEvents:ye?"auto":"none"},children:(0,_.jsx)(f.TQ,{accountBalance:D,calculateCumulativePnl:()=>oe,dynamicRiskSettings:X,calendarId:(null===O||void 0===O?void 0:O.id)||"",requiredTagGroups:U,onTagUpdated:async(e,t)=>(Z&&Z.tags.includes(e)&&ee((r=>r?(0,n.A)((0,n.A)({},r),{},{tags:r.tags.map((r=>r===e?t:r)).filter((e=>""!==e))}):r)),N?await N(e,t):{success:!0,tradesUpdated:0}),newTrade:Z,editingTrade:Y,allTags:ke,isSubmitting:K,calculateAmountFromRiskToReward:Me,onNameChange:e=>{ee((t=>(0,n.A)((0,n.A)({},t),{},{name:e.target.value})))},onAmountChange:e=>{ee((t=>(0,n.A)((0,n.A)({},t),{},{amount:e})))},onTypeChange:e=>{ee((t=>(0,n.A)((0,n.A)({},t),{},{trade_type:e.target.value})))},onEntryChange:e=>{ee((t=>(0,n.A)((0,n.A)({},t),{},{entry_price:parseFloat(e.target.value)||0})))},onExitChange:e=>{ee((t=>(0,n.A)((0,n.A)({},t),{},{exit_price:parseFloat(e.target.value)||0})))},onStopLossChange:e=>{ee((t=>(0,n.A)((0,n.A)({},t),{},{stop_loss:parseFloat(e.target.value)||0})))},onTakeProfitChange:e=>{ee((t=>(0,n.A)((0,n.A)({},t),{},{take_profit:parseFloat(e.target.value)||0})))},onRiskToRewardChange:e=>{ee((t=>(0,n.A)((0,n.A)({},t),{},{risk_to_reward:e})))},onPartialsTakenChange:e=>{const t=e.target.checked;ee((e=>(0,n.A)((0,n.A)({},e),{},{partials_taken:t})))},onSessionChange:e=>{ee((t=>(0,n.A)((0,n.A)({},t),{},{session:e.target.value})))},onNotesChange:e=>{ee((t=>(0,n.A)((0,n.A)({},t),{},{notes:e})))},onTagsChange:(e,t)=>{const r=(0,k.dR)(t);ee((e=>(0,n.A)((0,n.A)({},e),{},{tags:r})))},onDateChange:e=>{e&&ee((t=>(0,n.A)((0,n.A)({},t),{},{trade_date:e})))},onImageUpload:async e=>{const{validFiles:t,oversizedFiles:r,invalidTypeFiles:a}=(0,w.kc)(e,w.Q6.IMAGE_1MB),o=[];if(r.length>0&&o.push("The following files exceed the 1MB size limit: ".concat(r.join(", "))),a.length>0&&o.push("The following files are not supported image types: ".concat(a.join(", "))),o.length>0&&j.logger.error("File validation errors:",o.join(" ")),0===t.length)return;const s=await Promise.all(t.map((async e=>{const t=URL.createObjectURL(e),r=await(n=t,new Promise((e=>{const t=new Image;t.onload=()=>{e({width:t.width,height:t.height})},t.src=n})));var n;return{id:x.generateImageId(e),file:e,preview:t,caption:"",width:r.width,height:r.height}})));let i=[];ee((e=>{const t=e.pending_images,r=e.uploaded_images;let a=-1;[...t,...r].forEach((e=>{void 0!==e.row&&e.row>a&&(a=e.row)}));const o=s.map(((e,t)=>{const r=a+1+t;return(0,n.A)((0,n.A)({},e),{},{row:r,column:0,column_width:100})}));return i=[...t,...o],(0,n.A)((0,n.A)({},e),{},{pending_images:i})}));try{const e=await Te(Z.id,(e=>{const t=e.images||[];let r=-1;t.forEach((e=>{void 0!==e.row&&e.row>r&&(r=e.row)}));const a=s.map(((e,t)=>{const n=r+1+t;return{url:e.preview,pending:!0,calendar_id:O.id,id:e.id,width:e.width,height:e.height,caption:e.caption,row:n,column:0,column_width:100}}));return(0,n.A)((0,n.A)({},e),{},{images:[...t,...a]})}),(e=>{const t=new Date,r=Z.trade_date||z,a=Ie(Z);let o=T([...Z.tags]);return Z.partials_taken&&(o=o.filter((e=>!e.startsWith("Partials:"))),o.push("Partials:Yes")),(0,n.A)((0,n.A)((0,n.A)((0,n.A)((0,n.A)((0,n.A)((0,n.A)((0,n.A)({id:e,is_temporary:!0,trade_date:new Date(r.getFullYear(),r.getMonth(),r.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()),trade_type:Z.trade_type,amount:a,name:Z.name||"New Trade"},Z.entry_price&&{entry_price:Z.entry_price}),Z.exit_price&&{exit_price:Z.exit_price}),Z.stop_loss&&{stop_loss:Z.stop_loss}),Z.take_profit&&{take_profit:Z.take_profit}),o.length>0&&{tags:o}),Z.risk_to_reward&&{risk_to_reward:Z.risk_to_reward}),{},{partials_taken:Z.partials_taken,session:Z.session||""},Z.notes&&{notes:Z.notes}),{},{images:Z.uploaded_images||[],calendar_id:O.id,user_id:"",created_at:new Date,updated_at:new Date})}));e&&e.is_temporary&&ee((e=>(0,n.A)((0,n.A)({},e),{},{is_temporary:!0})));const t=s.map((e=>Ee(e,Z.id,i))),r=(await Promise.all(t)).filter((e=>null!==e));if(r.length>0&&null!==O&&void 0!==O&&O.id&&Z.id)try{await Te(Z.id,(e=>{const t=e.images||[],a=new Map(r.map((e=>[e.id,e]))),o=new Set(t.map((e=>e.id))),s=t.map((e=>{if(a.has(e.id)){const t=a.get(e.id);return(0,n.A)((0,n.A)({},t),{},{row:void 0!==e.row?e.row:t.row,column:void 0!==e.column?e.column:t.column,column_width:void 0!==e.column_width?e.column_width:t.column_width})}return e})),i=r.filter((e=>!o.has(e.id)));return i.length>0&&j.logger.log("Adding ".concat(i.length," images that weren't in database yet (race condition protection)")),(0,n.A)((0,n.A)({},e),{},{images:[...s,...i]})})),j.logger.log("Updated trade with ".concat(r.length," uploaded images"))}catch(l){j.logger.error("Error batch updating trade with new images:",l)}}catch(c){j.logger.error("Error processing image uploads:",c)}},onImageCaptionChange:async(e,t,r)=>{try{ee(r?r=>(0,n.A)((0,n.A)({},r),{},{pending_images:r.pending_images.map(((r,a)=>a===e?(0,n.A)((0,n.A)({},r),{},{caption:t}):r))}):r=>(0,n.A)((0,n.A)({},r),{},{uploaded_images:r.uploaded_images.map(((r,a)=>a===e?(0,n.A)((0,n.A)({},r),{},{caption:t}):r))}))}catch(a){j.logger.error("Error in handleImageCaptionChange:",a)}},onImageRemove:async(e,t)=>{try{if(e<0)return void j.logger.error("handleImageRemove called with invalid index:",e,"isPending:",t);if(t){const t=Z.pending_images[e];if(!t)return void j.logger.error("Pending image not found at index:",e);const r=t.id;URL.revokeObjectURL(t.preview),ee((t=>(0,n.A)((0,n.A)({},t),{},{pending_images:t.pending_images.filter(((t,r)=>r!==e))}))),r&&null!==Z&&void 0!==Z&&Z.id&&Te(Z.id,(e=>(0,n.A)((0,n.A)({},e),{},{images:(e.images||[]).filter((e=>e&&e.id!==r))}))).then((()=>{j.logger.log("Removed pending image ".concat(r," from database"))})).catch((e=>{j.logger.error("Failed to remove pending image ".concat(r," from database:"),e)}))}else{const t=Z.uploaded_images[e];if(!t)return void j.logger.error("Uploaded image not found at index:",e);ee((t=>(0,n.A)((0,n.A)({},t),{},{uploaded_images:t.uploaded_images.filter(((t,r)=>r!==e))}))),j.logger.log("Image ".concat(t.id," removed from UI - will be deleted from storage on save"))}}catch(r){j.logger.error("Error in handleImageRemove:",r)}},onImagesReordered:async e=>{j.logger.log("handleImagesReordered called with images:",e.map((e=>({id:e.id,row:e.row,column:e.column,column_width:e.column_width}))));const t=e.filter((e=>"file"in e)),r=e.filter((e=>!("file"in e)));ee((e=>(0,n.A)((0,n.A)({},e),{},{pending_images:t,uploaded_images:r})))},onSubmit:Y?We:Re,onOpenGalleryMode:q})})]})}),(0,_.jsx)(d.A,{open:ne,autoHideDuration:4e3,onClose:Se,anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{zIndex:C.M.SNACKBAR},children:(0,_.jsx)(u.A,{onClose:Se,severity:"error",variant:"filled",sx:{width:"100%"},children:te})})]})}},62720:(e,t,r)=>{r.d(t,{Ay:()=>ye,Vy:()=>xe});var n=r(89379),a=r(65043),o=r(60267),s=r(86995),i=r(38517),l=r(23182),c=r(29651),d=r(55895),u=r(42579),g=r(78776),h=r(53969),p=r(19e3),m=r(37567),x=r(82332),f=r(52956),y=r(83759),v=r(26529),A=r(1725),b=r(85030),j=r(17060),w=r(24343),k=r(91449),C=r(41859),S=r(88566),_=r(431),T=r(85821),I=r(89547),M=r(90721),E=r(4362),z=r(66935),D=r(62706),R=r(8872),W=r(85085),P=r(60438),N=r(72661),F=r(31849),L=r(90030),X=r(1062),O=r(27421),B=r(20312),U=r(36131),q=r(3383),G=r(64),H=r(25272),Y=r(3830),V=r(92968),K=r(72422),J=r(39963),$=r(5362),Q=r(22950),Z=r(95156),ee=r(97250),te=r(102),re=r(68545),ne=r(58390),ae=r(59163),oe=r(77328),se=r(55467),ie=r(64014),le=r(38508),ce=r(32396),de=r(74675),ue=r(41180),ge=r(46577),he=r(78018),pe=r(70579);const me={STRATEGY:{label:"Strategy",subtitle:"Long-term trading approach and rules"},GAME_PLAN:{label:"Game Plan",subtitle:"Specific plan for the upcoming session"},INSIGHT:{label:"Insight",subtitle:"Market observations and patterns"},LESSON_LEARNED:{label:"Lesson Learned",subtitle:"Review of mistakes and successes"},GENERAL:{label:"General",subtitle:"General notes and thoughts"},RISK_MANAGEMENT:{label:"Risk Management",subtitle:"Position sizing and stop-loss rules"},PSYCHOLOGY:{label:"Psychology",subtitle:"Mental state and emotional control"},GUIDELINE:{label:"Guideline",subtitle:"Instructions for the AI Assistant (Max 1)"}},xe=e=>{var t;return(null===(t=me[e])||void 0===t?void 0:t.label)||e},fe=e=>{var t;return(null===(t=me[e])||void 0===t?void 0:t.subtitle)||""},ye=e=>{let{open:t,onClose:r,note:ye,calendarId:ve,onSave:Ae,onDelete:be}=e;const je=(0,o.A)(),{user:we}=(0,de.h)(),ke=(0,s.A)(je.breakpoints.down("md")),Ce=(0,a.useRef)(null),[Se,_e]=(0,a.useState)(!1),[Te,Ie]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(t){const e=setTimeout((()=>Ie(!0)),50);return()=>clearTimeout(e)}Ie(!1)}),[t]);const[Me,Ee]=(0,a.useState)(null),[ze,De]=(0,a.useState)(""),[Re,We]=(0,a.useState)(""),[Pe,Ne]=(0,a.useState)(null),[Fe,Le]=(0,a.useState)(!1),[Xe,Oe]=(0,a.useState)(!1),[Be,Ue]=(0,a.useState)(!1),[qe,Ge]=(0,a.useState)(!1),[He,Ye]=(0,a.useState)("none"),[Ve,Ke]=(0,a.useState)(null),[Je,$e]=(0,a.useState)([]),[Qe,Ze]=(0,a.useState)(!1),[et,tt]=(0,a.useState)(!1),[rt,nt]=(0,a.useState)(null===ye||void 0===ye?void 0:ye.color),[at,ot]=(0,a.useState)(null),[st,it]=(0,a.useState)([]),[lt,ct]=(0,a.useState)(""),[dt,ut]=(0,a.useState)(!1),[gt,ht]=(0,a.useState)(!1),[pt,mt]=(0,a.useState)(!1),xt=Object.keys(me);(0,a.useEffect)((()=>{(async()=>{if(t&&null!==we&&void 0!==we&&we.id)try{const e=(await ue.ZF(we.id,"GUIDELINE")).find((e=>e.id!==(null===ye||void 0===ye?void 0:ye.id)));ht(!!e)}catch(e){console.error("Error checking for existing guideline:",e)}})()}),[t,null===we||void 0===we?void 0:we.id,null===ye||void 0===ye?void 0:ye.id]),(0,a.useEffect)((()=>{t&&(ye?(Ee(ye),De(ye.title),We(ye.content),Ne(ye.cover_image),Ye(ye.reminder_type||"none"),Ke(ye.reminder_date||null),$e(ye.reminder_days||[]),Ze(ye.is_reminder_active||!1),tt(!1),nt(ye.color),it(ye.tags||[]),ut(!1),mt(null===ye.calendar_id)):(Ee(null),De(""),We(""),Ne(null),Ye("none"),Ke(null),$e([]),Ze(!1),tt(!1),nt(void 0),it([]),ut(!1),ct(""),mt(!1)))}),[t,ye]);const ft=async()=>{if(null!==we&&void 0!==we&&we.uid)try{if(Oe(!0),Me){const e={title:ze,content:Re,cover_image:Pe,reminder_type:He,reminder_date:Ve,reminder_days:Je,is_reminder_active:Qe,color:null!==rt&&void 0!==rt?rt:null,calendar_id:pt?null:ve};Me.by_assistant||(e.tags=st),await ue.w3(Me.id,e);const t=await ue.vW(Me.id);t&&(Ee(t),Ae&&Ae(t,!1))}else{const e=await ue.p4({user_id:we.uid,calendar_id:pt?null:ve,title:ze,content:Re,cover_image:Pe,reminder_type:He,reminder_date:Ve,reminder_days:Je,is_reminder_active:Qe,color:null!==rt&&void 0!==rt?rt:null,tags:st});Ee(e),Ae&&Ae(e,!0)}}catch(e){he.logger.error("Error saving note:",e)}finally{Oe(!1)}},yt=()=>{if(Me){const e=ze!==Me.title,t=Re!==Me.content,r=Pe!==Me.cover_image,n=He!==(Me.reminder_type||"none"),a=Ve!==(Me.reminder_date||null),o=JSON.stringify(Je)!==JSON.stringify(Me.reminder_days||[]),s=Qe!==(Me.is_reminder_active||!1),i=JSON.stringify(st)!==JSON.stringify(Me.tags||[]),l=rt!==Me.color,c=pt!==(null===Me.calendar_id);return e||t||r||n||a||o||s||i||l||c}{const e=ze&&""!==ze.trim(),t=Re&&""!==Re.trim(),r=null!==Pe,n="none"!==He&&Qe,a=st.length>0;return e||t||r||n||a||void 0!==rt}};(0,a.useEffect)((()=>{if(!t)return;if(!Me)return;if(!yt())return;const e=setTimeout((()=>{ft()}),6e4);return()=>clearTimeout(e)}),[ze,Re,Pe,st,pt,t,Me]);const vt=async()=>{yt()&&await ft(),r()},At=async()=>{if(Me)try{Me.is_archived?(await ue.C8(Me.id),Ae&&Ae((0,n.A)((0,n.A)({},Me),{},{is_archived:!Me.is_archived,archived_at:Me.is_archived?null:new Date})),Ee((e=>e?(0,n.A)((0,n.A)({},e),{},{is_archived:!1}):null))):(await ue.Dh(Me.id),Ee((e=>e?(0,n.A)((0,n.A)({},e),{},{is_archived:!0,archived_at:new Date}):null)),vt())}catch(e){he.logger.error("Error toggling archive:",e)}},bt=!(null!==Me&&void 0!==Me&&Me.by_assistant);return(0,pe.jsxs)(pe.Fragment,{children:[(0,pe.jsxs)(i.A,{open:t,onClose:vt,fullScreen:ke,maxWidth:"md",sx:{zIndex:e=>e.zIndex.modal+100},PaperProps:{sx:{height:ke?"100%":"90vh",m:ke?0:2}},children:[(0,pe.jsxs)(l.A,{sx:{borderBottom:"1px solid ".concat((0,c.X4)(je.palette.divider,.1)),gap:1},children:[(0,pe.jsx)(d.A,{variant:"h6",sx:{flex:1},children:Me?"Edit Note":"New Note"}),(0,pe.jsx)(u.A,{size:"small",onClick:vt,children:(0,pe.jsx)(O.A,{})})]}),Te&&Ce.current&&(0,pe.jsx)(ie.A,{editorState:Ce.current.editorState,disabled:!1,variant:"sticky",stickyPosition:"top",toolbarRef:Ce.current.toolbarRef,onToggleInlineStyle:e=>{var t;return null===(t=Ce.current)||void 0===t?void 0:t.toggleInlineStyle(e)},onToggleBlockType:e=>{var t;return null===(t=Ce.current)||void 0===t?void 0:t.toggleBlockType(e)},onApplyTextColor:e=>{var t;return null===(t=Ce.current)||void 0===t?void 0:t.applyTextColor(e)},onApplyBackgroundColor:e=>{var t;return null===(t=Ce.current)||void 0===t?void 0:t.applyBackgroundColor(e)},onApplyHeading:e=>{var t;return null===(t=Ce.current)||void 0===t?void 0:t.applyHeading(e)},onClearFormatting:()=>{var e;return null===(e=Ce.current)||void 0===e?void 0:e.clearFormatting()},onLinkClick:()=>{var e;return null===(e=Ce.current)||void 0===e?void 0:e.handleLinkClick()},onImageClick:()=>{var e;return null===(e=Ce.current)||void 0===e?void 0:e.handleImageClick()},onMenuOpenChange:e=>{var t;_e(e),null===(t=Ce.current)||void 0===t||t.setIsMenuOpen(e)}}),(0,pe.jsxs)(g.A,{sx:(0,n.A)({p:0,overflowY:"auto",bgcolor:"background.default"},(0,ge.J)(je)),children:[Pe&&(0,pe.jsx)(h.A,{sx:{position:"relative",width:"100%",height:260,backgroundImage:"url(".concat(Pe,")"),backgroundSize:"cover",backgroundPosition:"center","&:hover .cover-actions":{opacity:1}},children:(0,pe.jsxs)(h.A,{className:"cover-actions",sx:{position:"absolute",bottom:16,left:16,display:"flex",gap:1,opacity:0,transition:"opacity 0.2s"},children:[(0,pe.jsx)(u.A,{onClick:()=>Le(!0),sx:{bgcolor:(0,c.X4)(je.palette.background.paper,.9),"&:hover":{bgcolor:je.palette.background.paper}},children:(0,pe.jsx)(B.A,{})}),(0,pe.jsx)(u.A,{onClick:()=>{Ne(null)},sx:{bgcolor:(0,c.X4)(je.palette.background.paper,.9),"&:hover":{bgcolor:je.palette.background.paper}},children:(0,pe.jsx)(O.A,{})})]})}),(0,pe.jsxs)(h.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:3,py:1,bgcolor:(0,c.X4)(je.palette.info.main,.04),borderBottom:"1px solid ".concat((0,c.X4)(je.palette.divider,.1))},children:[(0,pe.jsxs)(h.A,{onClick:()=>tt(!et),sx:{display:"flex",alignItems:"center",gap:1,cursor:"pointer",py:.5,"&:hover":{opacity:.8}},children:[Qe?(0,pe.jsx)(U.A,{sx:{color:"info.main",fontSize:"1.1rem"}}):(0,pe.jsx)(q.A,{sx:{color:"text.secondary",fontSize:"1.1rem"}}),(0,pe.jsx)(d.A,{variant:"subtitle2",fontWeight:600,sx:{color:Qe?"info.main":"text.secondary"},children:"Reminder"}),Qe&&"none"!==He&&(0,pe.jsx)(d.A,{variant:"caption",color:"text.secondary",children:"weekly"===He?"".concat(Je.length," day").concat(1!==Je.length?"s":""):"One-time"}),(0,pe.jsx)(u.A,{size:"small",sx:{color:"text.secondary",ml:-.5},children:et?(0,pe.jsx)(G.A,{fontSize:"small"}):(0,pe.jsx)(H.A,{fontSize:"small"})})]}),(0,pe.jsxs)(h.A,{sx:{display:"flex",gap:.5},children:[(0,pe.jsx)(u.A,{size:"small",onClick:()=>Le(!0),title:Pe?"Change cover":"Add cover image",children:(0,pe.jsx)(B.A,{fontSize:"small"})}),Me&&(0,pe.jsxs)(pe.Fragment,{children:[(0,pe.jsx)(u.A,{size:"small",onClick:async()=>{if(Me)try{Me.is_pinned?await ue.xU(Me.id):await ue.uA(Me.id),Ee((e=>e?(0,n.A)((0,n.A)({},e),{},{is_pinned:!e.is_pinned}):null)),Ae&&Ae((0,n.A)((0,n.A)({},Me),{},{is_pinned:!Me.is_pinned}))}catch(e){he.logger.error("Error toggling pin:",e)}},title:Me.is_pinned?"Unpin note":"Pin note",sx:{color:Me.is_pinned?"primary.main":"inherit"},children:Me.is_pinned?(0,pe.jsx)(Y.A,{fontSize:"small"}):(0,pe.jsx)(V.A,{fontSize:"small"})}),(0,pe.jsx)(u.A,{size:"small",onClick:At,title:Me.is_archived?"Unarchive note":"Archive note",children:Me.is_archived?(0,pe.jsx)(K.A,{fontSize:"small"}):(0,pe.jsx)(J.A,{fontSize:"small"})}),(0,pe.jsx)(u.A,{size:"small",onClick:()=>{Me&&Ue(!0)},title:"Delete note",sx:{color:"error.main"},children:(0,pe.jsx)($.A,{fontSize:"small"})})]})]})]}),(0,pe.jsx)(p.A,{in:et,children:(0,pe.jsxs)(h.A,{sx:{px:3,py:2,bgcolor:(0,c.X4)(je.palette.info.main,.02)},children:[(0,pe.jsx)(d.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Set a reminder to display this note on specific days. Perfect for game plans, daily routines, or weekly trading strategies."}),(0,pe.jsxs)(h.A,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[(0,pe.jsxs)(m.A,{value:He,exclusive:!0,onChange:(e,t)=>{null!==t&&(Ye(t),Ze("none"!==t),"none"===t?(Ke(null),$e([])):"once"===t?$e([]):"weekly"===t&&Ke(null))},size:"small",children:[(0,pe.jsxs)(x.A,{value:"none",children:[(0,pe.jsx)(q.A,{sx:{mr:1,fontSize:"1.2rem"}}),"None"]}),(0,pe.jsx)(x.A,{value:"once",children:"Once"}),(0,pe.jsx)(x.A,{value:"weekly",children:"Weekly"})]}),(0,pe.jsxs)(h.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center",ml:{xs:0,sm:2}},children:[(0,pe.jsx)(d.A,{variant:"caption",color:"text.secondary",sx:{mr:1},children:"Color:"}),(()=>{const e=[{value:void 0,label:"Default",color:je.palette.background.paper},{value:"red",label:"Red",color:je.palette.error.main},{value:"pink",label:"Pink",color:S.A[500]},{value:"purple",label:"Purple",color:_.A[500]},{value:"deepPurple",label:"Deep Purple",color:T.A[500]},{value:"indigo",label:"Indigo",color:I.A[500]},{value:"blue",label:"Blue",color:je.palette.info.main},{value:"lightBlue",label:"Light Blue",color:M.A[500]},{value:"cyan",label:"Cyan",color:E.A[500]},{value:"teal",label:"Teal",color:z.A[500]},{value:"green",label:"Green",color:je.palette.success.main},{value:"lightGreen",label:"Light Green",color:D.A[500]},{value:"lime",label:"Lime",color:R.A[500]},{value:"yellow",label:"Yellow",color:W.A[600]},{value:"amber",label:"Amber",color:P.A[500]},{value:"orange",label:"Orange",color:je.palette.warning.main},{value:"deepOrange",label:"Deep Orange",color:N.A[500]},{value:"brown",label:"Brown",color:F.A[500]},{value:"grey",label:"Grey",color:L.A[500]},{value:"blueGrey",label:"Blue Grey",color:X.A[500]}],t=e.slice(0,5),r=e.slice(5);return(0,pe.jsxs)(pe.Fragment,{children:[t.map((e=>(0,pe.jsx)(h.A,{onClick:()=>nt(e.value),sx:{width:24,height:24,borderRadius:"50%",bgcolor:e.value?(0,c.X4)(e.color,.2):(0,c.X4)(je.palette.divider,.1),border:"2px solid ".concat(rt===e.value?je.palette.primary.main:(0,c.X4)(je.palette.divider,.2)),cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"scale(1.1)",border:"2px solid ".concat(je.palette.primary.main)}},title:e.label},e.label))),(0,pe.jsx)(h.A,{onClick:e=>ot(e.currentTarget),sx:{width:24,height:24,borderRadius:"50%",border:"1px dashed ".concat(je.palette.text.secondary),display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s","&:hover":{borderColor:je.palette.primary.main,color:je.palette.primary.main,bgcolor:(0,c.X4)(je.palette.primary.main,.05)}},title:"More colors",children:(0,pe.jsx)(Q.A,{sx:{fontSize:16}})}),(0,pe.jsxs)(f.Ay,{open:Boolean(at),anchorEl:at,onClose:()=>ot(null),anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{p:2,maxWidth:320}},sx:{zIndex:se.M.DIALOG_POPUP},children:[(0,pe.jsx)(d.A,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:1.5,px:.5},children:"More Colors"}),(0,pe.jsx)(h.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:r.map((e=>(0,pe.jsx)(h.A,{onClick:()=>{nt(e.value),ot(null)},sx:{width:24,height:24,borderRadius:"50%",bgcolor:e.value?(0,c.X4)(e.color,.2):(0,c.X4)(je.palette.divider,.1),border:"2px solid ".concat(rt===e.value?je.palette.primary.main:(0,c.X4)(je.palette.divider,.2)),cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"scale(1.1)",border:"2px solid ".concat(je.palette.primary.main)}},title:e.label},e.label)))})]})]})})()]})]}),"once"===He&&(0,pe.jsx)(ne.$,{dateAdapter:ae.h,children:(0,pe.jsx)(re.l,{label:"Reminder Date",value:Ve,onChange:e=>Ke(e),slotProps:{textField:{fullWidth:!0,size:"small"},popper:{sx:{zIndex:se.M.RICH_TEXT_DIALOG}}}})}),"weekly"===He&&(0,pe.jsxs)(h.A,{children:[(0,pe.jsx)(d.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Select days to show this reminder:"}),(0,pe.jsx)(h.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((e=>(0,pe.jsx)(y.A,{label:e,onClick:()=>(e=>{$e((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))})(e),color:Je.includes(e)?"primary":"default",variant:Je.includes(e)?"filled":"outlined",sx:{fontWeight:Je.includes(e)?600:400,cursor:"pointer"}},e)))}),0===Je.length&&(0,pe.jsx)(d.A,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:"Please select at least one day"})]})]})}),(0,pe.jsxs)(h.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:3,py:1,bgcolor:(0,c.X4)(je.palette.primary.main,.04),borderBottom:"1px solid ".concat((0,c.X4)(je.palette.divider,.1))},children:[(0,pe.jsxs)(h.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[pt?(0,pe.jsx)(Z.A,{sx:{color:"primary.main",fontSize:"1.1rem"}}):(0,pe.jsx)(ee.A,{sx:{color:"text.secondary",fontSize:"1.1rem"}}),(0,pe.jsx)(d.A,{variant:"subtitle2",fontWeight:600,sx:{color:pt?"primary.main":"text.secondary"},children:pt?"Global Note":"Calendar Note"})]}),(0,pe.jsx)(v.A,{title:pt?"This note is visible in all calendars":"This note is only visible in the current calendar",placement:"left",children:(0,pe.jsx)(A.A,{control:(0,pe.jsx)(b.A,{checked:pt,onChange:e=>mt(e.target.checked),size:"small",color:"primary"}),label:(0,pe.jsx)(d.A,{variant:"caption",color:"text.secondary",children:pt?"All calendars":"This calendar only"}),labelPlacement:"start",sx:{mr:0}})})]}),(0,pe.jsxs)(h.A,{onClick:()=>ut(!dt),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:3,py:1,bgcolor:(0,c.X4)(je.palette.secondary.main,.04),borderBottom:"1px solid ".concat((0,c.X4)(je.palette.divider,.1)),cursor:"pointer","&:hover":{opacity:.8}},children:[(0,pe.jsxs)(h.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,pe.jsx)(te.A,{sx:{color:st.length>0?"secondary.main":"text.secondary",fontSize:"1.1rem"}}),(0,pe.jsx)(d.A,{variant:"subtitle2",fontWeight:600,sx:{color:st.length>0?"secondary.main":"text.secondary"},children:"Tags"}),(null===Me||void 0===Me?void 0:Me.by_assistant)&&(0,pe.jsx)(d.A,{variant:"caption",color:"text.disabled",children:"(read-only)"})]}),(0,pe.jsxs)(h.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[st.length>0&&(0,pe.jsxs)(d.A,{variant:"caption",color:"text.secondary",children:[st.length," tag",1!==st.length?"s":""]}),(0,pe.jsx)(u.A,{size:"small",sx:{color:"text.secondary"},children:dt?(0,pe.jsx)(G.A,{fontSize:"small"}):(0,pe.jsx)(H.A,{fontSize:"small"})})]})]}),(0,pe.jsx)(p.A,{in:dt,children:(0,pe.jsxs)(h.A,{sx:{px:3,py:2,bgcolor:(0,c.X4)(je.palette.secondary.main,.02)},children:[st.length>0&&(0,pe.jsx)(h.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:st.map((e=>(0,pe.jsx)(y.A,{label:xe(e),size:"small",onDelete:bt?()=>{return t=e,void it((e=>e.filter((e=>e!==t))));var t}:void 0,sx:{bgcolor:(0,c.X4)(je.palette.secondary.main,.1),color:"secondary.main",fontWeight:500}},e)))}),bt?(0,pe.jsx)(h.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:(0,pe.jsx)(j.A,{size:"small",options:xt.filter((e=>!st.includes(e)&&("GUIDELINE"!==e||!gt))),getOptionLabel:e=>xe(e),value:null,inputValue:lt,onInputChange:(e,t,r)=>{"reset"!==r&&ct(t)},onChange:(e,t)=>{var r;t&&"string"===typeof t&&(r=t)&&!st.includes(r)&&(it((e=>[...e,r])),ct("")),ct("")},renderOption:(e,t)=>(0,pe.jsx)("li",(0,n.A)((0,n.A)({},e),{},{style:{display:"block"},children:(0,pe.jsxs)(h.A,{children:[(0,pe.jsx)(d.A,{variant:"body2",sx:{fontWeight:500},children:xe(t)}),(0,pe.jsx)(d.A,{variant:"caption",color:"text.secondary",children:fe(t)})]})})),sx:{flex:1},ListboxProps:{sx:(0,n.A)((0,n.A)({},(0,ge.J)(je)),{},{maxHeight:250})},slotProps:{popper:{sx:{zIndex:e=>e.zIndex.modal+200}}},renderInput:e=>(0,pe.jsx)(w.A,(0,n.A)((0,n.A)({},e),{},{placeholder:"Add a tag...",InputProps:(0,n.A)((0,n.A)({},e.InputProps),{},{sx:{borderRadius:2}})}))})}):0===st.length&&(0,pe.jsx)(d.A,{variant:"body2",color:"text.secondary",children:"No tags on this note."}),(0,pe.jsx)(d.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Select a tag from the list"})]})}),(0,pe.jsxs)(h.A,{sx:{maxWidth:900,margin:"0 auto",px:{xs:2,md:6},py:4},children:[Me&&Me.is_archived&&(0,pe.jsxs)(k.A,{severity:"warning",sx:{mb:2},children:["This note is archived.",(0,pe.jsx)(C.A,{onClick:At,size:"small",variant:"outlined",sx:{ml:2},children:"Unarchive"})]}),(0,pe.jsx)(w.A,{value:ze,onChange:e=>De(e.target.value),placeholder:"Untitled",fullWidth:!0,multiline:!0,variant:"standard",InputProps:{disableUnderline:!0,sx:{fontSize:"2.5rem",fontWeight:700,lineHeight:1.2,"& textarea":{padding:0}}},sx:{mb:3,mt:3}}),(0,pe.jsx)(oe.A,{ref:Ce,value:Re,onChange:We,placeholder:"Document your emotions, game plan, lessons learned, or trading insights...",minHeight:300,maxLength:5e3,hideCharacterCount:!0,toolbarVariant:"none"})]})]})]}),(0,pe.jsx)(le.A,{open:Fe,onClose:()=>Le(!1),onImageSelect:e=>{Ne(e),Le(!1)},title:"Choose a cover image"}),(0,pe.jsx)(ce.A,{open:Be,title:"Delete Note",message:"Are you sure you want to permanently delete this note? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",confirmColor:"error",onConfirm:async()=>{if(Me)try{Ge(!0),await ue.Iy(Me.id),be&&be(Me.id),Ue(!1),r()}catch(e){he.logger.error("Error deleting note:",e),Ge(!1)}},onCancel:()=>{Ue(!1)},isSubmitting:qe,sx:{zIndex:se.M.LOADING_PROGRESS}})]})}},68165:(e,t,r)=>{r.d(t,{A:()=>j});var n=r(89379),a=r(65043),o=r(60267),s=r(41859),i=r(80172),l=r(53969),c=r(29651),d=r(55895),u=r(83759),g=r(24343),h=r(5362),p=r(95007),m=r(81084),x=r(94808),f=r(78018),y=r(46577),v=r(16476),A=r(74675),b=r(70579);const j=e=>{let{open:t,onClose:r,tag:j,calendarId:w,onSuccess:k,onDelete:C,onTagUpdated:S,initialDefinition:_}=e;const T=(0,o.A)(),{user:I}=(0,A.h)(),[M,E]=(0,a.useState)(j),[z,D]=(0,a.useState)(!1),[R,W]=(0,a.useState)(!1),[P,N]=(0,a.useState)(null),[F,L]=(0,a.useState)(""),[X,O]=(0,a.useState)(""),[B,U]=(0,a.useState)(!1),q=(0,a.useCallback)((async e=>{if(null!==I&&void 0!==I&&I.id&&e){U(!0);try{const t=await v.G.fetchTagDefinition(I.id,e);L(t),O(t)}catch(t){f.logger.error("Error fetching tag definition:",t)}finally{U(!1)}}}),[null===I||void 0===I?void 0:I.id]),G=async e=>{if(e.preventDefault(),!M.trim()||H&&!V.trim())return void N("Tag cannot be empty");if((M.match(/:/g)||[]).length>1)return void N("Tags can only contain one colon (:) for category formatting");const t=M!==j,n=F.trim()!==X;if(t||n){D(!0),N(null);try{const e=j.trim(),a=(0,m.$4)(M.trim());if(t&&S){const t=await S(e,a);t.success?(null!==I&&void 0!==I&&I.id&&await v.G.saveTagDefinition(I.id,a,F,X),k&&k(e,a,t.tradesUpdated||0),r(n)):N("Failed to update tag")}else null!==I&&void 0!==I&&I.id&&await v.G.saveTagDefinition(I.id,e,F,X),r(!0)}catch(P){f.logger.error("Error updating tag:",P),N(P instanceof Error?P.message:"An unknown error occurred")}finally{D(!1)}}else r()},H=(0,m.dn)(j),Y=e=>(0,m.dn)(e)?e.split(":")[1]:e,[V,K]=(0,a.useState)(Y(j)),[J,$]=(0,a.useState)(H?(0,m.Oo)(j):"");(0,a.useEffect)((()=>{t&&j&&(E(j),K(Y(j)),$((0,m.dn)(j)?(0,m.Oo)(j):""),N(null),void 0!==_?(L(_),O(_)):q(j))}),[j,t,q,_]);const Q=()=>{z||R||r()};return(0,b.jsx)(x.mY,{open:t,onClose:Q,maxWidth:"sm",fullWidth:!0,title:"Edit Tag",primaryButtonText:z?"Updating...":"Update Tag",primaryButtonAction:e=>{e&&e.preventDefault(),G(e)},isSubmitting:z||R,cancelButtonText:"Cancel",cancelButtonAction:Q,hideCloseButton:z||R,actions:C&&(0,b.jsx)(s.A,{variant:"outlined",color:"error",startIcon:R?(0,b.jsx)(i.A,{size:16}):(0,b.jsx)(h.A,{}),onClick:async()=>{if(C){W(!0),N(null);try{const e=j.trim();if(S){const t=await S(e,"");t.success?(C(e,t.tradesUpdated||0),r()):N("Failed to delete tag")}else N("No tag update handler provided")}catch(P){f.logger.error("Error deleting tag:",P),N(P instanceof Error?P.message:"An unknown error occurred")}finally{W(!1)}}},disabled:z||R,sx:{mr:1},children:R?"Deleting...":"Delete Tag"}),children:(0,b.jsxs)(l.A,{component:"form",onSubmit:G,sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,b.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",gap:2,p:1,mt:1,borderRadius:1,bgcolor:(0,c.X4)(T.palette.primary.main,.05),border:"1px solid ".concat((0,c.X4)(T.palette.primary.main,.1))},children:[(0,b.jsx)(d.A,{variant:"body2",color:"text.secondary",children:"This will update all trades that use this tag across all years in the calendar."}),(0,b.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1.5,p:1,borderRadius:1,bgcolor:T.palette.background.paper,border:"1px solid ".concat(T.palette.divider)},children:[(0,b.jsx)(d.A,{variant:"body2",fontWeight:500,children:"Current tag:"}),(0,b.jsx)(u.A,{label:(0,m.t)(j),size:"small",sx:(0,n.A)((0,n.A)({},(0,m.dO)(j,T)),{},{fontWeight:600,boxShadow:T.shadows[1]})})]})]}),H?(0,b.jsxs)(l.A,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[(0,b.jsx)(g.A,{label:"Group",value:J,onChange:e=>{const t=e.target.value;(t.match(/:/g)||[]).length>0||($(t),E("".concat(t,":").concat(V)))},fullWidth:!0,autoFocus:!0,error:!!P,helperText:P,disabled:z,size:"medium",sx:{"& .MuiFormHelperText-root":{color:T.palette.error.main,fontWeight:500,marginTop:1}}}),(0,b.jsx)(g.A,{label:"Tag Name",value:V,onChange:e=>{const t=e.target.value;(t.match(/:/g)||[]).length>0||(K(t),E("".concat(J,":").concat(t)))},fullWidth:!0,autoFocus:!0,error:!!P,helperText:P,disabled:z,size:"medium",sx:{"& .MuiFormHelperText-root":{color:T.palette.error.main,fontWeight:500,marginTop:1}}})]}):(0,b.jsx)(g.A,{label:"Tag Name",value:M,onChange:e=>{const t=e.target.value;(t.match(/:/g)||[]).length>1||(E(t),K(t))},fullWidth:!0,autoFocus:!0,error:!!P,helperText:P,disabled:z,size:"medium",sx:{"& .MuiFormHelperText-root":{color:T.palette.error.main,fontWeight:500,marginTop:1}}}),(0,b.jsx)(g.A,{label:"Definition (optional)",value:F,onChange:e=>{e.target.value.length<=2024&&L(e.target.value)},fullWidth:!0,multiline:!0,rows:2,disabled:z||B,placeholder:"What does this tag mean? e.g., 'Trade taken at 0.62 Fibonacci retracement level'",size:"medium",inputProps:{maxLength:2024},InputProps:{startAdornment:B?(0,b.jsx)(i.A,{size:16,sx:{mr:1}}):void 0},helperText:(0,b.jsxs)(l.A,{component:"span",sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,b.jsx)(p.A,{sx:{fontSize:14}}),"This definition helps the AI assistant understand your custom tags"]}),sx:{"& .MuiInputBase-input":(0,n.A)({},(0,y.J)(T)),"& .MuiFormHelperText-root":{color:T.palette.text.secondary,display:"flex",alignItems:"center"}}})]})})}},75576:(e,t,r)=>{r.d(t,{A:()=>Fe});var n=r(89379),a=r(65043),o=r(60267),s=r(53969),i=r(29651),l=r(55895),c=r(41859),d=r(80172),u=r(94527),g=r(91449),h=r(42579),p=r(10947),m=r(19181),x=r(94799),f=r(95315),y=r(78403),v=r(3377),A=r(27421),b=r(20312),j=r(62680),w=r(91537),k=r(17171),C=r(83759),S=r(33539),_=r(26529),T=r(70579);const I=e=>{let{text:t,speed:r=150,onComplete:o,isAnimating:i=!0,component:c="span",sx:d}=e;const[u,g]=(0,a.useState)(""),[h,p]=(0,a.useState)(0);(0,a.useEffect)((()=>{if(!i)return g(t),void p(t.length);if(h<t.length){const e=setTimeout((()=>{g(t.slice(0,h+1)),p(h+1)}),1e3/r);return()=>clearTimeout(e)}h===t.length&&o&&o()}),[h,t,r,i,o]),(0,a.useEffect)((()=>{i?(g(""),p(0)):(g(t),p(t.length))}),[t,i]);return(0,T.jsx)(l.A,{component:c,sx:(0,n.A)({whiteSpace:"pre-wrap",wordBreak:"break-word"},d),children:(e=>{if(!e.includes("```")&&!e.includes("`")&&!e.includes("**"))return e;return e.split(/(```[\s\S]*?```|`[^`]+`|\*\*[^*]+\*\*)/).map(((e,t)=>{if(e.startsWith("```")&&e.endsWith("```")){var r;const n=e.slice(3,-3).trim().split("\n"),a=null!==(r=n[0])&&void 0!==r&&r.match(/^[a-zA-Z]+$/)?n.shift():"",o=n.join("\n");return(0,T.jsxs)(s.A,{component:"pre",sx:{backgroundColor:"grey.100",p:1.5,borderRadius:1,fontFamily:"monospace",fontSize:"0.875rem",overflow:"auto",my:1,whiteSpace:"pre-wrap",border:"1px solid",borderColor:"grey.300"},children:[a&&(0,T.jsxs)(s.A,{component:"span",sx:{color:"primary.main",fontSize:"0.75rem",fontWeight:"bold"},children:[a,"\n"]}),o]},t)}return e.startsWith("`")&&e.endsWith("`")?(0,T.jsx)(s.A,{component:"code",sx:{backgroundColor:"grey.100",px:.75,py:.25,borderRadius:.5,fontFamily:"monospace",fontSize:"0.875em",border:"1px solid",borderColor:"grey.300"},children:e.slice(1,-1)},t):e.startsWith("**")&&e.endsWith("**")?(0,T.jsx)(s.A,{component:"strong",sx:{fontWeight:"bold"},children:e.slice(2,-2)},t):e}))})(u)})};var M=r(87977),E=r(32515),z=r(86296),D=r(6013),R=r(92248),W=r(18837),P=r(85465),N=r(36642),F=r(19934),L=r(5093),X=r(98349),O=r(39993),B=r(15515),U=r(78018);const q=e=>{if(!e)return e;const t=parseFloat(e.replace(/[^\d.-]/g,""));if(isNaN(t))return e;const r=e.replace(/[0-9.-]/g,"").trim(),n=t.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2});return r?"".concat(n).concat(r):n},G=(e,t)=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"high":return t.palette.error.main;case"medium":return t.palette.warning.main;case"low":return t.palette.info.main;default:return t.palette.success.main}},H=e=>{let{eventId:t,eventData:r,compact:n=!1,onClick:c,tradeCount:d=0}=e;const u=(0,o.A)(),[g,h]=(0,a.useState)(r||null),[p,m]=(0,a.useState)(null);if((0,a.useEffect)((()=>{if(r)return void h(r);(async()=>{try{m(null);const e=await B.$.getEventById(t);e?h(e):m("Event not found")}catch(e){U.logger.error("Failed to fetch economic event:",e),m("Failed to load event")}})()}),[t,r]),p||!g)return(0,T.jsx)(x.A,{elevation:0,sx:{p:n?1.5:2,border:"1px solid",borderColor:(0,i.X4)(u.palette.error.main,.3),borderRadius:2,backgroundColor:(0,i.X4)(u.palette.error.main,.05),minHeight:n?80:100},children:(0,T.jsx)(l.A,{variant:"body2",color:"error",sx:{textAlign:"center"},children:p||"Event not found"})});const f=(e=>{const t=(0,L.A)(e),r=new Date,n=(0,X.A)(r,t);return{time:(0,O.A)(t,"MMM dd, h:mm a"),isPassed:n,isUpcoming:!n}})(g.time_utc),y=((e,t,r)=>{if(!e||!t)return null;const n=parseFloat(e.replace(/[^\d.-]/g,"")),a=parseFloat(t.replace(/[^\d.-]/g,""));return isNaN(n)||isNaN(a)?null:n>a?{icon:(0,T.jsx)(D.A,{sx:{fontSize:16,color:r.palette.success.main}}),text:"Above",color:r.palette.success.main}:n<a?{icon:(0,T.jsx)(R.A,{sx:{fontSize:16,color:r.palette.error.main}}),text:"Below",color:r.palette.error.main}:{icon:(0,T.jsx)(W.A,{sx:{fontSize:16,color:r.palette.text.secondary}}),text:"As Expected",color:r.palette.text.secondary}})(g.actual_value,g.forecast_value,u);return(0,T.jsx)(x.A,{elevation:0,sx:{p:n?1.5:2,border:"1px solid",borderColor:(0,i.X4)(u.palette.divider,.3),borderRadius:2,backgroundColor:(0,i.X4)(u.palette.background.paper,.8),cursor:c?"pointer":"default",transition:"all 0.2s ease-in-out","&:hover":c?{borderColor:(0,i.X4)(u.palette.primary.main,.5),backgroundColor:(0,i.X4)(u.palette.primary.main,.02),transform:"translateY(-1px)",boxShadow:u.shadows[2]}:{}},onClick:()=>null===c||void 0===c?void 0:c(g),children:(0,T.jsxs)(s.A,{sx:{display:"flex",alignItems:"flex-start",gap:.5,width:"100%"},children:[(0,T.jsxs)(s.A,{sx:{minWidth:32,maxWidth:32,mt:.25,display:"flex",flexDirection:"column",alignItems:"center",gap:.5,alignSelf:"flex-start"},children:[g.flag_url&&(0,T.jsx)("img",{src:g.flag_url,alt:g.country,style:{width:20,height:15,maxHeight:15,minHeight:15,display:"block",borderRadius:2,objectFit:"cover",border:"1px solid ".concat((0,i.X4)(u.palette.divider,.2))}}),(0,T.jsx)(l.A,{variant:"caption",sx:{fontWeight:700,textAlign:"center",fontSize:"0.7rem",color:"text.primary",minWidth:32},children:g.currency})]}),(0,T.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",width:"100%",flex:1},children:[(0,T.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,T.jsx)(l.A,{variant:"caption",sx:{fontWeight:600,color:f.isUpcoming?"text.primary":"text.secondary",fontSize:"0.75rem",minWidth:80},children:f.time}),(0,T.jsx)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:24},children:f.isPassed?(0,T.jsx)(P.A,{sx:{color:"success.main",fontSize:"1rem"}}):(0,T.jsx)(N.A,{sx:{color:"warning.main",fontSize:"1rem"}})}),(0,T.jsx)(s.A,{sx:{flex:1}}),d>0&&(0,T.jsx)(_.A,{title:"You've traded this event ".concat(d," time").concat(d>1?"s":""),arrow:!0,placement:"top",children:(0,T.jsx)(C.A,{icon:(0,T.jsx)(F.A,{sx:{fontSize:"0.7rem !important",color:"white !important"}}),label:d,size:"small",sx:{height:20,fontSize:"0.6rem",fontWeight:700,backgroundColor:(0,i.X4)(u.palette.primary.main,.9),color:"white",minWidth:40,borderRadius:1,cursor:"pointer","& .MuiChip-label":{px:.5,py:.25},"& .MuiChip-icon":{ml:.5,mr:-.25}}})}),(0,T.jsx)(C.A,{label:g.impact.toUpperCase(),size:"small",sx:{height:20,fontSize:"0.6rem",fontWeight:700,backgroundColor:G(g.impact,u),color:"white",minWidth:40,borderRadius:1,"& .MuiChip-label":{px:.75,py:.25}}})]}),(0,T.jsx)(l.A,{variant:"body2",sx:{fontWeight:600,fontSize:n?"0.85rem":"0.9rem",color:"text.primary",lineHeight:1.3},children:g.event_name}),!n&&(g.actual_value||g.forecast_value||g.previous_value)&&(0,T.jsxs)(s.A,{sx:{display:"flex",gap:1.5,alignItems:"center",flexWrap:"wrap"},children:[g.actual_value&&(0,T.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,T.jsx)(l.A,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.7rem"},children:"A:"}),(0,T.jsx)(l.A,{variant:"caption",sx:{fontWeight:600,fontSize:"0.7rem"},children:q(g.actual_value)}),y&&y.icon]}),g.forecast_value&&(0,T.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,T.jsx)(l.A,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.7rem"},children:"F:"}),(0,T.jsx)(l.A,{variant:"caption",sx:{fontWeight:600,fontSize:"0.7rem"},children:q(g.forecast_value)})]}),g.previous_value&&(0,T.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,T.jsx)(l.A,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.7rem"},children:"P:"}),(0,T.jsx)(l.A,{variant:"caption",sx:{fontWeight:600,fontSize:"0.7rem"},children:q(g.previous_value)})]})]})]})]})})};var Y=r(28518),V=r(46577);const K=e=>{let{items:t,defaultVisibleCount:r=4,itemType:l}=e;const d=(0,o.A)(),[u,g]=(0,a.useState)(0),h=t.length;if((0,a.useEffect)((()=>{g(0!==h?e=>0===e?Math.min(r,h):Math.min(e,h):0)}),[h,r]),0===h)return null;const p=t.slice(0,u),m=u>=h,x=h>r&&m;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(s.A,{sx:(0,n.A)({mt:1},x?(0,n.A)({maxHeight:350,overflowY:"auto",pr:1,border:"1px solid",borderColor:(0,i.X4)(d.palette.divider,.3),borderRadius:.5,backgroundColor:(0,i.X4)(d.palette.primary.main,.02),p:1.5},(0,V.J)(d)):{}),children:p}),h>r&&u>0&&(0,T.jsx)(s.A,{sx:{mt:2,textAlign:"center"},children:(0,T.jsx)(c.A,{size:"small",variant:"outlined",onClick:()=>g(m?r:h),children:m?"Collapse ".concat(l):"Load ".concat(h-u," more ").concat(l)})})]})};var J=r(76494);const $=e=>{let{html:t,textColor:r="text.primary",embeddedTrades:n,embeddedEvents:c,embeddedNotes:d,onTradeClick:u,onEventClick:g,onNoteClick:h,trades:p=[]}=e;const m=(0,o.A)(),x=(0,a.useRef)(null),[f,y]=(0,a.useState)(!1),[v,A]=(0,a.useState)(null),b=(0,a.useMemo)((()=>{const e=new Map;return p.forEach((t=>{e.set(t.id,t)})),e}),[p]),j=(0,a.useMemo)((()=>{if(!n)return;const e={};return Object.entries(n).forEach((t=>{let[r,n]=t;const a=b.get(r);e[r]=a||n})),e}),[n,b]),w=(0,a.useMemo)((()=>{const e=new Map;return c&&0!==p.length?(Object.entries(c).forEach((t=>{let[r,n]=t;const a=p.filter((e=>!(!e.economic_events||0===e.economic_events.length)&&e.economic_events.some((e=>(0,J.Xy)(e,n))))).length;e.set(r,a)})),e):e}),[c,p]),k=(0,a.useMemo)((()=>{if(!n&&!c&&!d)return[{type:"html",content:t}];const e=[];let r=0,a=t;const o=[],s=/<trade-ref\s+id="([a-zA-Z0-9-_]+)"(?:\s*\/)?>(?:<\/trade-ref>)?/g;let i;for(;null!==(i=s.exec(a));){const e=i[1];null!==n&&void 0!==n&&n[e]&&o.push({type:"trade",id:e,index:i.index,length:i[0].length})}const l=/<event-ref\s+id="([a-zA-Z0-9-_]+)"(?:\s*\/)?>(?:<\/event-ref>)?/g;for(;null!==(i=l.exec(a));){const e=i[1];null!==c&&void 0!==c&&c[e]&&o.push({type:"event",id:e,index:i.index,length:i[0].length})}const u=/<note-ref\s+id="([a-zA-Z0-9-_]+)"(?:\s*\/)?>(?:<\/note-ref>)?/g;for(;null!==(i=u.exec(a));){const e=i[1];null!==d&&void 0!==d&&d[e]&&o.push({type:"note",id:e,index:i.index,length:i[0].length})}if(o.sort(((e,t)=>e.index-t.index)),o.forEach((t=>{if(t.index>r){const n=a.substring(r,t.index);n.trim()&&e.push({type:"html",content:n})}e.push({type:t.type,content:"",id:t.id}),r=t.index+t.length})),r<a.length){const t=a.substring(r);t.trim()&&e.push({type:"html",content:t})}return e.length>0?e:[{type:"html",content:t}]}),[t,n,c,d]),C=e=>(0,M.A)(window).sanitize(e,{ALLOWED_TAGS:["p","br","strong","em","u","h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","code","pre","a","span","div","img"],ALLOWED_ATTR:["href","target","rel","class","style","src","alt","width","height"],KEEP_CONTENT:!0}),S=(0,a.useMemo)((()=>k.filter((e=>"html"===e.type)).map((e=>C(e.content))).join("")),[k]),_=(0,a.useMemo)((()=>{const e=(new DOMParser).parseFromString(S,"text/html").querySelectorAll("img");return Array.from(e).map((e=>e.src))}),[S]);(0,a.useEffect)((()=>{const e=x.current;if(!e)return;const t=t=>{const r=t.target;if("IMG"===r.tagName){t.preventDefault(),t.stopPropagation();const a=e.querySelectorAll("img"),o=Array.from(a).indexOf(r);if(-1!==o){var n;const e=null===(n=_[o])||void 0===n?void 0:n.includes("quickchart.io");A({selectetdImageIndex:o,allImages:_,useSolidBackground:e}),y(!0)}}};return e.addEventListener("click",t),()=>{e.removeEventListener("click",t)}}),[_]),(0,a.useEffect)((()=>{if(!x.current)return;const e=setTimeout((()=>{if(!x.current)return;x.current.querySelectorAll("img").forEach((e=>{e.style.cursor="pointer",e.style.userSelect="none"}))}),100);return()=>clearTimeout(e)}),[S]);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(s.A,{ref:x,sx:{"& p":{margin:"0.5rem 0",lineHeight:1.5},"& strong":{fontWeight:600},"& em":{fontStyle:"italic"},"& h1, & h2, & h3, & h4, & h5, & h6":{margin:"1rem 0 0.5rem 0",fontWeight:600},"& h1":{fontSize:"1.5rem"},"& h2":{fontSize:"1.25rem"},"& h3":{fontSize:"1.1rem"},"& h4":{fontSize:"1rem"},"& h5":{fontSize:"0.95rem"},"& h6":{fontSize:"0.9rem"},"& ul, & ol":{margin:"0.5rem 0",paddingLeft:"1.5rem"},"& li":{margin:"0.25rem 0"},"& blockquote":{margin:"0.5rem 0",paddingLeft:"1rem",borderLeft:"3px solid ".concat((0,i.X4)(m.palette.text.primary,.3)),opacity:.8},"& code":{backgroundColor:(0,i.X4)(m.palette.text.primary,.1),padding:"2px 4px",borderRadius:1,fontFamily:"monospace",fontSize:"0.9em"},"& pre":{backgroundColor:(0,i.X4)(m.palette.text.primary,.05),padding:"1rem",borderRadius:1,overflowX:"auto",margin:"0.5rem 0"},"& pre code":{backgroundColor:"transparent",padding:0},"& a":{color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{opacity:.8}},"& img":{maxWidth:"100%",height:"auto",minHeight:100,backgroundColor:"dark"===m.palette.mode?(0,i.X4)(m.palette.background.paper,.8):(0,i.X4)(m.palette.grey[100],.8),maxHeight:"300px",borderRadius:2,display:"block",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"scale(1.02)",boxShadow:m.shadows[4]}},"& sup":{fontSize:"0.8em",verticalAlign:"super"}},children:(()=>{const e=[];let t=[];const n=()=>{0!==t.length&&(e.push((0,T.jsx)(K,{items:t,itemType:"trades"},"trade-list-".concat(e.length))),t=[])};return k.forEach(((a,o)=>{if("trade"===a.type&&a.id&&null!==j&&void 0!==j&&j[a.id]){const e=j[a.id],r=Object.values(j);t.push((0,T.jsx)(s.A,{sx:{my:1},children:(0,T.jsx)(z.A,{trade:e,showTags:!0,onClick:()=>null===u||void 0===u?void 0:u(e.id,r)})},"trade-".concat(o)))}else if("html"!==a.type){if("event"===a.type&&a.id&&null!==c&&void 0!==c&&c[a.id]){n();const t=c[a.id],r=w.get(a.id)||0;e.push((0,T.jsx)(s.A,{sx:{my:1},children:(0,T.jsx)(H,{eventId:a.id,eventData:t,onClick:g,compact:!1,tradeCount:r})},"event-".concat(o)))}if("note"===a.type&&a.id&&null!==d&&void 0!==d&&d[a.id]){n();const t=d[a.id];e.push((0,T.jsx)(s.A,{sx:{my:1},children:(0,T.jsx)(Y.w,{note:t,onClick:()=>null===h||void 0===h?void 0:h(a.id)})},"note-".concat(o)))}}else{const t=a.content.replace(/<[^>]*>/g,"").replace(/&nbsp;/gi," ").trim().length>0;if(t&&n(),!t)return;e.push((0,T.jsx)(l.A,{component:"div",sx:{color:r,whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"anywhere"},dangerouslySetInnerHTML:{__html:C(a.content)}},"html-".concat(o)))}})),n(),e})()}),v&&(0,T.jsx)(E.A,{open:f,onClose:()=>y(!1),imageProp:v})]})};var Q=r(40549),Z=r(52956),ee=r(19e3),te=r(15939),re=r(60894),ne=r(25272);const ae=e=>{let{citations:t,compact:r=!1}=e;const n=(0,o.A)(),[c,d]=(0,a.useState)(!1),[u,g]=(0,a.useState)(null),[h,p]=(0,a.useState)(new Set);if(!t||0===t.length)return null;const m=e=>{switch(e){case"search_web":return"primary";case"scrape_url":return"secondary";case"execute_sql":return"info";case"price_data":return"success";default:return"default"}},f=e=>{switch(e){case"search_web":return"Web";case"scrape_url":return"Article";case"execute_sql":return"DB";case"price_data":return"Price";default:return e}},y=e=>{try{return new URL(e).hostname.replace(/^www\./,"")}catch(t){return e}},v=e=>{try{const t=y(e);return"https://www.google.com/s2/favicons?domain=".concat(t,"&sz=32")}catch(t){return""}},A=e=>{p((t=>new Set(t).add(e)))},b=Boolean(u),j=t.reduce(((e,t)=>{const r=y(t.url);return e.some((e=>y(e.url)===r))||e.push(t),e}),[]).slice(0,4),w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;const r=v(e);return h.has(e)||!r?(0,T.jsx)(S.A,{sx:{width:t,height:t,backgroundColor:(0,i.X4)(n.palette.primary.main,.15),color:"primary.main"},children:(0,T.jsx)(te.A,{sx:{fontSize:.6*t}})}):(0,T.jsx)(S.A,{src:r,sx:{width:t,height:t,backgroundColor:(0,i.X4)(n.palette.background.paper,.9),border:"1px solid ".concat((0,i.X4)(n.palette.divider,.3))},onError:()=>A(e),children:(0,T.jsx)(te.A,{sx:{fontSize:.6*t}})})},k=()=>(0,T.jsx)(s.A,{sx:{display:"flex",flexDirection:"column",gap:.5,p:r?1.5:0,maxWidth:r?350:"none",maxHeight:r?300:"none",overflow:"auto"},children:t.map((e=>(0,T.jsxs)(x.A,{variant:"outlined",sx:{px:1.5,py:1,borderRadius:2,backgroundColor:(0,i.X4)(n.palette.background.paper,.8),border:"1px solid ".concat((0,i.X4)(n.palette.divider,.5)),display:"flex",alignItems:"center",gap:1.5,cursor:"pointer",transition:"all 0.15s ease","&:hover":{backgroundColor:(0,i.X4)(n.palette.action.hover,.6),borderColor:(0,i.X4)(n.palette.primary.main,.5)}},onClick:()=>{return t=e.url,void window.open(t,"_blank","noopener,noreferrer");var t},children:[w(e.url,22),(0,T.jsxs)(s.A,{sx:{flex:1,minWidth:0},children:[(0,T.jsx)(l.A,{variant:"body2",sx:{fontWeight:500,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem"},children:e.title||y(e.url)}),(0,T.jsx)(l.A,{variant:"caption",sx:{display:"block",color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.7rem"},children:y(e.url)})]}),e.toolName&&(0,T.jsx)(C.A,{label:f(e.toolName),size:"small",color:m(e.toolName),variant:"outlined",sx:{height:18,fontSize:"0.6rem",flexShrink:0,borderRadius:999,"& .MuiChip-label":{px:.75}}}),(0,T.jsx)(re.A,{sx:{fontSize:14,color:"text.secondary",flexShrink:0}})]},e.id)))});return(0,T.jsxs)(s.A,{sx:{mt:1.5,display:"inline-block"},children:[(0,T.jsxs)(s.A,{onClick:e=>{r?g(e.currentTarget):d(!c)},sx:{display:"inline-flex",alignItems:"center",gap:.75,height:28,px:1,borderRadius:999,backgroundColor:(0,i.X4)(n.palette.background.paper,.6),border:"1px solid ".concat((0,i.X4)(n.palette.divider,.5)),cursor:"pointer",transition:"all 0.15s ease","&:hover":{backgroundColor:(0,i.X4)(n.palette.action.hover,.6),borderColor:(0,i.X4)(n.palette.primary.main,.4)}},children:[(0,T.jsx)(Q.A,{max:4,sx:{"& .MuiAvatar-root":{width:18,height:18,fontSize:"0.6rem",border:"1px solid ".concat(n.palette.background.paper),backgroundColor:(0,i.X4)(n.palette.primary.main,.15),color:"primary.main"},"& .MuiAvatarGroup-avatar":{marginLeft:-.75}},children:j.map((e=>(0,T.jsx)(S.A,{src:v(e.url),sx:{width:18,height:18,backgroundColor:(0,i.X4)(n.palette.background.paper,.9)},onError:()=>A(e.url),children:(0,T.jsx)(te.A,{sx:{fontSize:10}})},e.id)))}),(0,T.jsx)(l.A,{variant:"caption",sx:{fontSize:"0.75rem",fontWeight:500,color:"text.secondary"},children:"Sources"}),(0,T.jsx)(ne.A,{sx:{fontSize:16,color:"text.secondary",transform:c||b?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})]}),r&&(0,T.jsx)(Z.Ay,{open:b,anchorEl:u,onClose:()=>{g(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{mt:1,borderRadius:2,boxShadow:n.shadows[8]}},children:k()}),!r&&(0,T.jsx)(ee.A,{in:c,timeout:"auto",children:(0,T.jsx)(s.A,{sx:{mt:1},children:k()})})]})};var oe=r(80045),se=r(55263),ie=r(29285),le=r(28259),ce=r(87443),de=r(10756),ue=r(34375),ge=r(86172),he=r(81341);const pe=["inline","className","children"],me=e=>{let{content:t}=e;const r=(0,o.A)();return(0,T.jsx)(se.oz,{remarkPlugins:[ie.A],components:{table:e=>{let{children:t}=e;return(0,T.jsx)(le.A,{component:x.A,variant:"outlined",sx:{my:2,maxWidth:"100%",overflow:"auto",backgroundColor:"dark"===r.palette.mode?"grey.900":"grey.50",border:"1px solid ".concat((0,i.X4)(r.palette.divider,.2)),borderRadius:2},children:(0,T.jsx)(ce.A,{size:"small",sx:{minWidth:300},children:t})})},thead:e=>{let{children:t}=e;return(0,T.jsx)(de.A,{sx:{backgroundColor:"dark"===r.palette.mode?(0,i.X4)(r.palette.primary.main,.15):(0,i.X4)(r.palette.primary.main,.08)},children:t})},tbody:e=>{let{children:t}=e;return(0,T.jsx)(ue.A,{children:t})},tr:e=>{let{children:t}=e;return(0,T.jsx)(ge.A,{children:t})},th:e=>{let{children:t}=e;return(0,T.jsx)(he.A,{sx:{fontWeight:700,fontSize:"0.875rem",color:"primary.main",borderBottom:"2px solid ".concat(r.palette.primary.main),py:1.5,px:2},children:t})},td:e=>{let{children:t}=e;return(0,T.jsx)(he.A,{sx:{fontSize:"0.85rem",py:1.5,px:2,borderBottom:"1px solid ".concat((0,i.X4)(r.palette.divider,.1))},children:t})},code:e=>{let{inline:t,className:a,children:o}=e,c=(0,oe.A)(e,pe);const d=/language-(\w+)/.exec(a||""),u=d?d[1]:"";return!t&&u?(0,T.jsxs)(x.A,{variant:"outlined",sx:{p:2,my:1,backgroundColor:"dark"===r.palette.mode?"grey.900":"grey.50",fontFamily:"monospace",fontSize:"0.875rem",overflow:"auto"},children:[u&&(0,T.jsx)(C.A,{label:u,size:"small",sx:{mb:1,fontSize:"0.75rem"}}),(0,T.jsx)(l.A,{component:"pre",sx:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"anywhere",fontFamily:"inherit"},children:o})]}):(0,T.jsx)(s.A,(0,n.A)((0,n.A)({component:"code",sx:{backgroundColor:(0,i.X4)(r.palette.text.primary,.1),padding:"2px 4px",borderRadius:1,fontFamily:"monospace",fontSize:"0.875em"}},c),{},{children:o}))},p:e=>{let{children:t}=e;return(0,T.jsx)(l.A,{component:"p",sx:{mb:1.5,lineHeight:1.6,whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"anywhere"},children:t})},h1:e=>{let{children:t}=e;return(0,T.jsx)(l.A,{variant:"h5",sx:{fontWeight:700,mt:2,mb:1.5},children:t})},h2:e=>{let{children:t}=e;return(0,T.jsx)(l.A,{variant:"h6",sx:{fontWeight:600,mt:2,mb:1},children:t})},h3:e=>{let{children:t}=e;return(0,T.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:600,mt:1.5,mb:1},children:t})},ul:e=>{let{children:t}=e;return(0,T.jsx)(s.A,{component:"ul",sx:{pl:3,mb:1.5},children:t})},ol:e=>{let{children:t}=e;return(0,T.jsx)(s.A,{component:"ol",sx:{pl:3,mb:1.5},children:t})},li:e=>{let{children:t}=e;return(0,T.jsx)(s.A,{component:"li",sx:{mb:.5,lineHeight:1.6,"& > p":{mb:0}},children:t})},blockquote:e=>{let{children:t}=e;return(0,T.jsx)(s.A,{component:"blockquote",sx:{borderLeft:"4px solid ".concat(r.palette.primary.main),pl:2,py:.5,my:1.5,fontStyle:"italic",color:"text.secondary",backgroundColor:(0,i.X4)(r.palette.primary.main,.05),borderRadius:1},children:t})},hr:()=>(0,T.jsx)(s.A,{component:"hr",sx:{border:"none",borderTop:"1px solid ".concat((0,i.X4)(r.palette.divider,.2)),my:2}}),strong:e=>{let{children:t}=e;return(0,T.jsx)(s.A,{component:"strong",sx:{fontWeight:700},children:t})},em:e=>{let{children:t}=e;return(0,T.jsx)(s.A,{component:"em",sx:{fontStyle:"italic"},children:t})}},children:t})};var xe=r(27496),fe=r(93201),ye=r(89935),ve=r(90160),Ae=r(1422),be=r(61773),je=r(19817);const we=e=>{let{message:t,showTimestamp:r=!0,isLatestMessage:n=!1,enableAnimation:c=!0,onTradeClick:d,onEventClick:u,onNoteClick:p,onEdit:m,trades:f=[]}=e;const y=(0,o.A)(),[v,A]=(0,a.useState)(!1),b="user"===t.role,j="assistant"===t.role;return(0,T.jsxs)(s.A,{sx:{display:"flex",flexDirection:b?"row-reverse":"row",gap:1.5,mb:3,alignItems:"flex-start",px:1,animation:n&&j?"fadeInUp 0.3s ease-out":"none","@keyframes fadeInUp":{"0%":{opacity:0,transform:"translateY(10px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:[(0,T.jsx)(S.A,{sx:{width:36,height:36,backgroundColor:b?"primary.main":"secondary.main",flexShrink:0,boxShadow:1},children:b?(0,T.jsx)(ve.A,{sx:{fontSize:20}}):(0,T.jsx)(Ae.A,{sx:{fontSize:20}})}),(0,T.jsxs)(s.A,{sx:{maxWidth:b?"80%":"95%",minWidth:0,flex:1},children:[(0,T.jsxs)(x.A,{elevation:0,sx:{p:2.5,backgroundColor:b?y.palette.primary.main:"error"===t.status?(0,i.X4)(y.palette.error.main,.1):"dark"===y.palette.mode?(0,i.X4)(y.palette.background.paper,.8):(0,i.X4)(y.palette.grey[100],.8),color:b?y.palette.primary.contrastText:y.palette.text.primary,borderRadius:4,borderTopLeftRadius:b?4:1,borderTopRightRadius:b?1:4,borderBottomLeftRadius:4,borderBottomRightRadius:4,position:"relative",maxWidth:"100%",wordBreak:"break-word",overflowWrap:"anywhere",boxShadow:b?"0 2px 8px rgba(0,0,0,0.1)":"0 1px 4px rgba(0,0,0,0.05)",border:b?"none":"1px solid",borderColor:b?"transparent":(0,i.X4)(y.palette.divider,.3),"&:hover .message-actions":{opacity:1}},children:[b&&Array.isArray(t.images)&&t.images.length>0&&(0,T.jsx)(s.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:t.content?1.5:0},children:t.images.map(((e,t)=>(0,T.jsx)(s.A,{component:"img",src:e.url,alt:e.name||"Attached image ".concat(t+1),sx:{maxWidth:"100%",maxHeight:200,borderRadius:2,objectFit:"contain",backgroundColor:(0,i.X4)(y.palette.common.black,.1),cursor:"pointer","&:hover":{opacity:.9}},onClick:()=>window.open(e.url,"_blank")},e.id||t)))}),(0,T.jsx)(s.A,{sx:{mb:t.error?1:0,animation:"receiving"===t.status&&j?"subtlePulse 0.5s ease-in-out":"none","@keyframes subtlePulse":{"0%":{opacity:.85},"50%":{opacity:1},"100%":{opacity:.95}},transition:"opacity 0.5s ease-in-out"},children:t.messageHtml?(0,T.jsx)($,{html:t.messageHtml,embeddedTrades:t.embeddedTrades,embeddedEvents:t.embeddedEvents,embeddedNotes:t.embeddedNotes,onTradeClick:d,onEventClick:u,onNoteClick:p,trades:f}):j&&c&&n?(0,T.jsx)(I,{text:t.content,speed:200,isAnimating:"received"===t.status}):(0,T.jsx)(s.A,{sx:{"& > *":{animation:"receiving"===t.status&&j?"fadeIn 0.3s ease-in":"none","@keyframes fadeIn":{"0%":{opacity:0},"100%":{opacity:1}}}},children:(0,T.jsx)(me,{content:t.content})})}),j&&t.citations&&t.citations.length>0&&(0,T.jsx)(s.A,{sx:{mt:2},children:(0,T.jsx)(ae,{citations:t.citations})}),t.error&&(0,T.jsx)(g.A,{severity:"error",sx:{mt:1,fontSize:"0.875rem"},children:t.error}),(0,T.jsxs)(s.A,{className:"message-actions",sx:{position:"absolute",top:4,right:4,opacity:0,transition:"opacity 0.2s",display:"flex",gap:.5},children:[b&&m&&(0,T.jsx)(_.A,{title:"Edit message",children:(0,T.jsx)(h.A,{size:"small",onClick:()=>m(t.id),sx:{backgroundColor:(0,i.X4)(y.palette.background.paper,.8),"&:hover":{backgroundColor:(0,i.X4)(y.palette.background.paper,.9)}},children:(0,T.jsx)(be.A,{sx:{fontSize:16}})})}),!b&&(0,T.jsx)(_.A,{title:v?"Copied!":"Copy message",children:(0,T.jsx)(h.A,{size:"small",onClick:async()=>{try{await navigator.clipboard.writeText(t.content),A(!0),setTimeout((()=>A(!1)),2e3),U.logger.log("Message copied to clipboard")}catch(e){U.logger.error("Failed to copy message:",e)}},sx:{backgroundColor:(0,i.X4)(y.palette.background.paper,.8),"&:hover":{backgroundColor:(0,i.X4)(y.palette.background.paper,.9)}},children:v?(0,T.jsx)(fe.A,{sx:{fontSize:16}}):(0,T.jsx)(je.A,{sx:{fontSize:16}})})})]})]}),(0,T.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5,px:1,justifyContent:b?"flex-end":"flex-start"},children:[r&&(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:(0,O.A)(t.timestamp,"HH:mm")}),(()=>{switch(t.status){case"sending":return(0,T.jsx)(xe.A,{sx:{fontSize:14,color:"text.secondary"}});case"sent":case"received":return(0,T.jsx)(fe.A,{sx:{fontSize:14,color:"success.main"}});case"error":return(0,T.jsx)(ye.A,{sx:{fontSize:14,color:"error.main"}});default:return null}})()]})]})]})};var ke=r(54410),Ce=r(57401),Se=r(36081),_e=r(81084),Te=r(55467);const Ie=()=>{const e=e=>{let{contentState:t,entityKey:r}=e;const a=(0,o.A)(),{tag:s}=t.getEntity(r).getData();return(0,T.jsx)(C.A,{size:"small",label:(0,_e.t)(s,!0),contentEditable:!1,onMouseDown:e=>e.preventDefault(),sx:(0,n.A)((0,n.A)({},(0,_e.dO)(s,a)),{},{height:22,fontSize:"0.75rem",userSelect:"none",verticalAlign:"middle",display:"inline-flex"})})};return e.displayName="TagMentionEntity",e},Me=()=>{const e=e=>{let{contentState:t,entityKey:r}=e;const n=(0,o.A)(),{noteTitle:a}=t.getEntity(r).getData();return(0,T.jsx)(C.A,{size:"small",label:a,contentEditable:!1,onMouseDown:e=>e.preventDefault(),sx:{height:22,fontSize:"0.75rem",userSelect:"none",verticalAlign:"middle",display:"inline-flex",backgroundColor:(0,i.X4)(n.palette.info.main,.1),color:n.palette.info.main,border:"1px solid ".concat((0,i.X4)(n.palette.info.main,.3)),"&:hover":{backgroundColor:(0,i.X4)(n.palette.info.main,.2)}}})};return e.displayName="NoteMentionEntity",e},Ee=e=>{let{children:t}=e;return(0,T.jsx)("span",{style:{opacity:0},children:t})},ze=()=>new ke.CompositeDecorator([{strategy:(e,t,r)=>{e.findEntityRanges((e=>{const t=e.getEntity();return!!t&&"TAG_MENTION"===r.getEntity(t).getType()}),((e,r)=>t(e,r)))},component:Ie()},{strategy:(e,t,r)=>{e.findEntityRanges((e=>{const t=e.getEntity();return!!t&&"NOTE_MENTION"===r.getEntity(t).getType()}),((e,r)=>t(e,r)))},component:Me()},{strategy:(e,t)=>{const r=e.getText();for(let n=0;n<r.length;n+=1)if("@"===r[n]){const e=r[n+1];e&&!/\s/.test(e)||t(n,n+1)}},component:Ee}]),De=(0,a.forwardRef)(((e,t)=>{let{value:r,onChange:c,onKeyDown:d,placeholder:u,disabled:g,allTags:h,maxRows:p=4,sx:v}=e;const A=(0,o.A)(),b=(0,a.useRef)(null),[j,w]=(0,a.useState)((()=>ke.EditorState.createWithContent(ke.ContentState.createFromText(r||""),ze()))),k=(0,a.useRef)(j),[S,_]=(0,a.useState)(null),[I,M]=(0,a.useState)(null),[E,z]=(0,a.useState)(0),D=(0,a.useRef)(null),R=(0,a.useRef)(!1);(0,a.useImperativeHandle)(t,(()=>({focus:()=>{var e,t;return b.current&&(null===(e=(t=b.current).focus)||void 0===e?void 0:e.call(t))},moveCursorToEnd:()=>{R.current=!0;const e=k.current.getCurrentContent().getLastBlock(),t=e.getKey(),r=e.getLength(),n=ke.SelectionState.createEmpty(t).merge({anchorOffset:r,focusOffset:r}),a=ke.EditorState.forceSelection(k.current,n);w(a),setTimeout((()=>{var e,t;null===(e=b.current)||void 0===e||null===(t=e.focus)||void 0===t||t.call(e)}),0)},insertNote:e=>{const t=k.current,r=t.getSelection(),n=t.getCurrentContent(),a=r.getStartKey();let o=n;const s=r.getStartOffset(),i=n.getBlockForKey(a).getText();if(s>0&&!/\s/.test(i[s-1])){const e=ke.SelectionState.createEmpty(a).merge({anchorOffset:s,focusOffset:s});o=ke.Modifier.insertText(o,e," ")}const l="note:".concat(e),d=s+(s>0&&!/\s/.test(i[s-1])?1:0),u=ke.SelectionState.createEmpty(a).merge({anchorOffset:d,focusOffset:d});o=ke.Modifier.insertText(o,u,l),o=o.createEntity("NOTE_MENTION","IMMUTABLE",{noteTitle:e});const g=o.getLastCreatedEntityKey(),h=ke.SelectionState.createEmpty(a).merge({anchorOffset:d,focusOffset:d+l.length});o=ke.Modifier.applyEntity(o,h,g);const p=ke.SelectionState.createEmpty(a).merge({anchorOffset:d+l.length,focusOffset:d+l.length});o=ke.Modifier.insertText(o,p," ");let m=ke.EditorState.push(t,o,"insert-characters");const x=ke.SelectionState.createEmpty(a).merge({anchorOffset:d+l.length+1,focusOffset:d+l.length+1});m=ke.EditorState.forceSelection(m,x),w(m),c(m.getCurrentContent().getPlainText()),setTimeout((()=>{var e,t;null===(e=b.current)||void 0===e||null===(t=e.focus)||void 0===t||t.call(e)}),0)}}))),(0,a.useEffect)((()=>{const e=j.getCurrentContent().getPlainText();if(console.log("useEffect - value prop:",r,"current text:",e),r!==e){console.log("useEffect - recreating editor state from value:",r);const e=ke.ContentState.createFromText(r||"");let t=ke.EditorState.createWithContent(e,ze());if(R.current){const r=e.getLastBlock(),n=r.getKey(),a=r.getLength(),o=ke.SelectionState.createEmpty(n).merge({anchorOffset:a,focusOffset:a});t=ke.EditorState.forceSelection(t,o),R.current=!1,setTimeout((()=>{var e,t;null===(e=b.current)||void 0===e||null===(t=e.focus)||void 0===t||t.call(e)}),0)}w(t)}}),[r]),(0,a.useEffect)((()=>{k.current=j}),[j]);const W=(0,a.useMemo)((()=>h.sort()),[h]),P=(0,a.useMemo)((()=>(null!==S&&void 0!==S&&S.term?W.filter((e=>e.toLowerCase().includes(S.term.toLowerCase()))):W).slice(0,50)),[W,S]);function N(e){const t=e.getCurrentContent().getPlainText();console.log("handleChange - plain text:",t),w(e),c(t),function(e){const t=e.getSelection();if(!t.isCollapsed())return _(null);const r=e.getCurrentContent(),n=t.getStartKey(),a=r.getBlockForKey(n),o=t.getStartOffset(),s=a.getText().slice(0,o),i=s.lastIndexOf("@");if(-1===i)return _(null);if(i>0&&/[^\s]/.test(s[i-1]))return _(null);const l=s.slice(i+1);if(/[^A-Za-z0-9:_.-]/.test(l))return _(null);_({open:!0,term:l,start:i,blockKey:n}),M(D.current),z(0)}(e)}function F(e){const t=k.current||j,r=t.getSelection();if(!r.isCollapsed())return void _(null);const n=t.getCurrentContent(),a=r.getStartKey(),o=n.getBlockForKey(a).getText(),s=r.getStartOffset();let i=-1;for(let x=s-1;x>=0;x-=1){const e=o[x];if("@"===e){(0===x||/\s/.test(o[x-1]))&&(i=x);break}if(/\s/.test(e))break}if(-1===i)return void _(null);const l=e,c=ke.SelectionState.createEmpty(a).merge({anchorOffset:i,focusOffset:s});let d=ke.Modifier.replaceText(n,c,l);d=d.createEntity("TAG_MENTION","IMMUTABLE",{tag:e});const u=d.getLastCreatedEntityKey(),g=ke.SelectionState.createEmpty(a).merge({anchorOffset:i,focusOffset:i+l.length});d=ke.Modifier.applyEntity(d,g,u);const h=ke.SelectionState.createEmpty(a).merge({anchorOffset:i+l.length,focusOffset:i+l.length});d=ke.Modifier.insertText(d,h," ");let p=ke.EditorState.push(t,d,"insert-characters");const m=ke.SelectionState.createEmpty(a).merge({anchorOffset:i+l.length+1,focusOffset:i+l.length+1});p=ke.EditorState.forceSelection(p,m),console.log("Final text:",p.getCurrentContent().getBlockForKey(a).getText()),console.log("=== END INSERT TAG DEBUG ==="),_(null),N(p),setTimeout((()=>{try{var e,t;null===(e=b.current)||void 0===e||null===(t=e.focus)||void 0===t||t.call(e)}catch(r){}}),0)}function L(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=k.current||j,n=r.getCurrentContent(),a=n.getBlocksAsArray();for(const o of a){let a=-1,s=-1;if(o.findEntityRanges((t=>t.getEntity()===e),((e,t)=>{a=e,s=t})),a>=0){let e=s;if(t){" "===o.getText()[s]&&(e=s+1)}const i=ke.SelectionState.createEmpty(o.getKey()).merge({anchorOffset:a,focusOffset:e}),l=ke.Modifier.removeRange(n,i,"backward");return void N(ke.EditorState.push(r,l,"remove-range"))}}}return(0,T.jsxs)(s.A,{ref:D,sx:{position:"relative",width:"100%"},children:[(0,T.jsx)(s.A,{onClick:()=>{var e,t;return b.current&&(null===(e=(t=b.current).focus)||void 0===e?void 0:e.call(t))},onKeyDown:function(e){if(null!==S&&void 0!==S&&S.open){if("ArrowDown"===e.key)return e.preventDefault(),void z((e=>Math.min(e+1,P.length-1)));if("ArrowUp"===e.key)return e.preventDefault(),void z((e=>Math.max(e-1,0)));if("Enter"===e.key)return e.preventDefault(),void(P[E]&&F(P[E]));if("Escape"===e.key)return e.preventDefault(),void _(null)}"@"===e.key&&!e.ctrlKey&&!e.metaKey&&e.altKey;const t=j.getSelection();if(t.isCollapsed()){const r=j.getCurrentContent(),n=r.getBlockForKey(t.getStartKey()),a=t.getStartOffset();if("Backspace"===e.key&&a>0){if(" "===n.getText()[a-1]&&a>1){const t=n.getEntityAt(a-2);if(t){const n=r.getEntity(t).getType();if("TAG_MENTION"===n||"NOTE_MENTION"===n)return e.preventDefault(),void L(t,!0)}}const t=n.getEntityAt(a-1);if(t){const n=r.getEntity(t).getType();if("TAG_MENTION"===n||"NOTE_MENTION"===n)return e.preventDefault(),void L(t)}}}null===d||void 0===d||d(e)},sx:(0,n.A)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:.5,px:1,py:.5,border:"none",backgroundColor:"transparent",cursor:"text",width:"100%",maxWidth:"100%",minWidth:0,"& .DraftEditor-root":{width:"100%"},"& .public-DraftEditor-content":(0,n.A)({whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"anywhere",maxHeight:"".concat(1.6*p,"em"),overflowY:"auto"},(0,V.J)(A)),"& .public-DraftEditorPlaceholder-root":{whiteSpace:"pre-wrap"}},v),children:(0,T.jsx)(ke.Editor,{ref:b,editorState:j,onChange:N,readOnly:!!g,placeholder:u})}),(0,T.jsx)(m.A,{open:!(null===S||void 0===S||!S.open),anchorEl:I,placement:"top-start",disablePortal:!0,sx:{zIndex:Te.M.DIALOG},children:(0,T.jsxs)(x.A,{elevation:8,sx:{maxHeight:220,minWidth:250,maxWidth:400,overflow:"hidden",border:"1px solid",borderColor:"divider"},children:[(0,T.jsx)(s.A,{sx:{p:1.5,borderBottom:"1px solid",borderColor:"divider",backgroundColor:(0,i.X4)(A.palette.primary.main,.04)},children:(0,T.jsxs)(l.A,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5,fontWeight:500},children:[(0,T.jsx)(Se.A,{sx:{fontSize:14}})," Select a tag to mention (",P.length," available)"]})}),(0,T.jsx)(f.A,{sx:(0,n.A)({maxHeight:170,overflow:"auto",p:0},(0,V.J)(A)),children:0===P.length?(0,T.jsx)(Ce.Ay,{children:(0,T.jsx)(s.A,{sx:{p:2,textAlign:"center",width:"100%"},children:(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",children:0===h.length?"No tags available. Add tags to your calendar to mention them here.":'No tags found matching "'.concat((null===S||void 0===S?void 0:S.term)||"",'"')})})}):P.map(((e,t)=>(0,T.jsx)(Ce.Ay,{disablePadding:!0,children:(0,T.jsx)(y.A,{selected:t===E,onMouseDown:t=>{t.preventDefault(),F(e)},onClick:t=>{t.preventDefault(),F(e)},sx:{py:1,px:2},children:(0,T.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,T.jsx)(C.A,{label:(0,_e.t)(e,!0),size:"small",sx:(0,n.A)((0,n.A)({},(0,_e.dO)(e,A)),{},{height:20,fontSize:"0.7rem"})}),(0,_e.dn)(e)&&(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:(0,_e.Oo)(e)})]})})},e)))})]})})]})}));De.displayName="AIChatMentionInput";const Re=De;var We=r(41180);const Pe=[{category:"Performance Analysis",questions:["What's my overall win rate by trading session?","Show me my monthly performance trends","Which tags have the highest win rates?"]},{category:"Pattern Discovery",questions:["Find my most profitable trading patterns","Show me trades similar to my best EUR/USD wins","Analyze my performance during high-impact news events"]},{category:"Risk Management",questions:["What's my average trade size by day of week?","Show me trades where I violated my risk management rules","Analyze correlation between trade session and profitability"]},{category:"Advanced Analysis",questions:["How does my trading performance vary across different sessions during high-impact economic events?","Compare my win rate on Mondays vs Fridays for scalping trades","Show me all my losing breakout trades on Tuesdays in the last 6 months"]}],Ne=(0,a.forwardRef)(((e,t)=>{let{messages:r,isLoading:C,isTyping:S,toolExecutionStatus:_,isAtMessageLimit:I,sendMessage:M,cancelRequest:E,setInputForEdit:z,startNewChat:D,setMessages:R,getWelcomeMessage:W,userId:P,calendar:N,trades:F,onTradeClick:L,onEventClick:X,onNoteClick:O,isReadOnly:B=!1,showTemplates:q,autoScroll:G=!0,messageLimit:H=50,questionTemplates:Y=Pe}=e;const K=(0,o.A)(),J=(0,a.useRef)(null),$=(0,a.useRef)(null),[Q,Z]=(0,a.useState)(""),[ee,te]=(0,a.useState)([]),re=(0,a.useRef)(null),[ne,ae]=(0,a.useState)(null),[oe,se]=(0,a.useState)([]),[ie,le]=(0,a.useState)(!1);(0,a.useImperativeHandle)(t,(()=>({focus:()=>{var e;null===(e=$.current)||void 0===e||e.focus()},scrollToBottom:()=>{var e;null===(e=J.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}})));const ce=(0,a.useCallback)((()=>{var e;null===(e=J.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[]);(0,a.useEffect)((()=>{G&&ce()}),[r,ce,G]);const de=async()=>{const e=Q.trim();if(!e&&0===ee.length||C)return;const t=ee.length>0?[...ee]:void 0;Z(""),te([]),await M(e,t)},ue=(0,a.useCallback)((async e=>{var t;const r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;const n=[];for(let o=0;o<r.length;o++){const t=r[o];if(t.type.startsWith("image/")){e.preventDefault();const r=t.getAsFile();if(!r)continue;if(r.size>10485760){U.logger.warn("Skipping large pasted image:",r.size);continue}try{const e=await new Promise(((e,t)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=t,n.readAsDataURL(r)}));n.push({id:crypto.randomUUID(),url:e,mimeType:r.type,name:"pasted-image-".concat(Date.now(),".").concat(r.type.split("/")[1]||"png"),size:r.size})}catch(a){U.logger.error("Error reading pasted image:",a)}}}n.length>0&&te((e=>[...e,...n].slice(0,4)))}),[]),ge=e=>{const t=z(e);t&&(Z(t.content),t.images&&t.images.length>0?te(t.images):te([]),setTimeout((()=>{var e;return null===(e=$.current)||void 0===e?void 0:e.focus()}),100))},he=()=>{ae(null)},pe=0===r.length?[W()]:r,me=void 0!==q?q:0===r.length;return(0,T.jsxs)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,T.jsxs)(s.A,{sx:(0,n.A)({flex:1,overflow:"auto",p:2,pb:1,backgroundColor:(0,i.X4)(K.palette.background.default,.3),backgroundImage:"radial-gradient(circle at 20% 80%, ".concat((0,i.X4)(K.palette.primary.main,.03)," 0%, transparent 50%),\n                           radial-gradient(circle at 80% 20%, ").concat((0,i.X4)(K.palette.secondary.main,.03)," 0%, transparent 50%)")},(0,V.J)(K)),children:[pe.map(((e,t)=>(0,T.jsx)(we,{message:e,showTimestamp:!0,isLatestMessage:t===pe.length-1,enableAnimation:t>0,onTradeClick:(e,t)=>{L?L(e,t):U.logger.log("Trade clicked but handler not provided:",e)},onEventClick:e=>{U.logger.log("Economic event clicked:",e),null===X||void 0===X||X(e)},onNoteClick:async e=>{U.logger.log("Note clicked:",e);const t=r.flatMap((e=>e.embeddedNotes?Object.values(e.embeddedNotes):[])).find((t=>t.id===e));null===O||void 0===O||O(e,t||void 0)},onEdit:ge,trades:F},e.id))),me&&(0,T.jsxs)(s.A,{sx:{mt:3},children:[(0,T.jsx)(l.A,{variant:"h6",sx:{mb:2,color:"text.primary",fontWeight:600},children:"Try these questions:"}),Y.map(((e,t)=>(0,T.jsxs)(s.A,{sx:{mb:3},children:[(0,T.jsx)(l.A,{variant:"subtitle2",sx:{mb:1.5,color:"primary.main",fontWeight:600,fontSize:"0.85rem"},children:e.category}),(0,T.jsx)(s.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.questions.map(((e,t)=>(0,T.jsx)(c.A,{variant:"outlined",size:"small",onClick:()=>(e=>{Z(e),setTimeout((()=>{var e;return null===(e=$.current)||void 0===e?void 0:e.focus()}),100)})(e),sx:{justifyContent:"flex-start",textAlign:"left",py:1.5,px:2,borderRadius:2,textTransform:"none",fontSize:"0.875rem",lineHeight:1.4,borderColor:(0,i.X4)(K.palette.primary.main,.3),backgroundColor:(0,i.X4)(K.palette.background.paper,.8),"&:hover":{borderColor:"primary.main",backgroundColor:(0,i.X4)(K.palette.primary.main,.08),transform:"translateY(-1px)",boxShadow:"0 2px 8px ".concat((0,i.X4)(K.palette.primary.main,.2))},transition:"all 0.2s ease-in-out"},children:e},t)))})]},t))),(0,T.jsx)(s.A,{sx:{mt:3,mb:2,p:2,backgroundColor:(0,i.X4)(K.palette.info.main,.08),borderRadius:2,border:"1px solid",borderColor:(0,i.X4)(K.palette.info.main,.2)},children:(0,T.jsx)(l.A,{variant:"body2",color:"info.main",sx:{fontWeight:500},children:"Pro Tip: You can ask complex questions like \"I've been struggling with my breakout strategy on Tuesdays. Can you show me all my losing trades tagged 'breakout' that occurred on a Tuesday in the last 6 months, and analyze if there were any specific economic events or market conditions that contributed to these losses?\" - I'll analyze your data and provide detailed insights!"})})]}),S&&(0,T.jsx)(s.A,{sx:{display:"flex",alignItems:"center",gap:2,p:2,mb:2},children:(0,T.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,backgroundColor:(0,i.X4)(K.palette.grey[500],.1),borderRadius:2,px:2,py:1},children:[(0,T.jsx)(d.A,{size:16,thickness:4,sx:{color:"text.secondary"}}),(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:_?"AI is thinking... ".concat(_):"AI is thinking..."})]})}),(0,T.jsx)("div",{ref:J})]}),(0,T.jsx)(u.A,{sx:{borderColor:(0,i.X4)(K.palette.divider,.5)}}),I&&(0,T.jsx)(s.A,{sx:{p:2,pb:0},children:(0,T.jsxs)(g.A,{severity:"warning",action:(0,T.jsx)(c.A,{color:"inherit",size:"small",onClick:async()=>{await D()},startIcon:(0,T.jsx)(v.A,{}),sx:{fontWeight:600},children:"Start New Chat"}),sx:{borderRadius:2,"& .MuiAlert-message":{width:"100%"}},children:[(0,T.jsx)(l.A,{variant:"body2",sx:{fontWeight:600},children:"Conversation Limit Reached"}),(0,T.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:["This conversation has reached the maximum length of ",H," messages. Please start a new conversation to continue."]})]})}),(0,T.jsxs)(s.A,{sx:{p:2,backgroundColor:(0,i.X4)(K.palette.background.paper,.8),backdropFilter:"blur(10px)"},children:[ee.length>0&&(0,T.jsxs)(s.A,{sx:{display:"flex",gap:1,mb:1.5,flexWrap:"wrap",alignItems:"center"},children:[(0,T.jsxs)(l.A,{variant:"caption",sx:{color:ee.length>=4?"warning.main":"text.secondary",fontWeight:500,mr:.5},children:[ee.length,"/",4]}),ee.map((e=>(0,T.jsxs)(s.A,{sx:{position:"relative",width:64,height:64,borderRadius:1.5,overflow:"hidden",border:"1px solid",borderColor:"divider"},children:[(0,T.jsx)(s.A,{component:"img",src:e.url,alt:e.name||"Attached image",sx:{width:"100%",height:"100%",objectFit:"cover"}}),(0,T.jsx)(h.A,{size:"small",onClick:()=>{return t=e.id,void te((e=>e.filter((e=>e.id!==t))));var t},sx:{position:"absolute",top:2,right:2,width:18,height:18,backgroundColor:"rgba(0,0,0,0.6)",color:"white","&:hover":{backgroundColor:"rgba(0,0,0,0.8)"}},children:(0,T.jsx)(A.A,{sx:{fontSize:12}})})]},e.id)))]}),(0,T.jsx)("input",{ref:re,type:"file",accept:"image/*",multiple:!0,style:{display:"none"},onChange:async e=>{const t=e.target.files;if(!t||0===t.length)return;const r=[];for(let a=0;a<t.length;a++){const e=t[a];if(e.type.startsWith("image/"))if(e.size>10485760)U.logger.warn("Skipping large file:",e.name,e.size);else try{const t=await new Promise(((t,r)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=r,n.readAsDataURL(e)}));r.push({id:crypto.randomUUID(),url:t,mimeType:e.type,name:e.name,size:e.size})}catch(n){U.logger.error("Error reading file:",n)}else U.logger.warn("Skipping non-image file:",e.name)}r.length>0&&te((e=>[...e,...r].slice(0,4))),re.current&&(re.current.value="")}}),(0,T.jsxs)(s.A,{onPaste:ue,sx:{display:"flex",gap:1,alignItems:"center",backgroundColor:"background.paper",borderRadius:3,p:1,border:"1px solid",borderColor:"divider","&:focus-within":{borderColor:"primary.main",boxShadow:"0 0 0 1px ".concat((0,i.X4)(K.palette.primary.main,.15))}},children:[(0,T.jsx)(Re,{ref:$,value:Q,onChange:Z,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),de())},placeholder:N?"(use @tag to mention tags)":"Ask me anything about your trading...",disabled:C||I,allTags:(null===N||void 0===N?void 0:N.tags)||[],maxRows:4,sx:{flex:1,minWidth:0,fontSize:"0.95rem",lineHeight:1.4}}),(0,T.jsx)(h.A,{"aria-label":"Attach image",onClick:()=>{var e;null===(e=re.current)||void 0===e||e.click()},disabled:B||C||I||ee.length>=4,size:"small",sx:{backgroundColor:ee.length>0?(0,i.X4)(K.palette.primary.main,.1):"background.default",color:ee.length>0?"primary.main":"text.secondary",width:32,height:32,borderRadius:2,border:"1px solid",borderColor:ee.length>0?"primary.main":"divider",transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:(0,i.X4)(K.palette.primary.main,.12),borderColor:"primary.main",color:"primary.main"},"&:disabled":{backgroundColor:"action.disabledBackground",color:"action.disabled",borderColor:"action.disabledBackground"}},children:(0,T.jsx)(b.A,{sx:{fontSize:18}})}),(0,T.jsx)(h.A,{"aria-label":"Insert note context",onClick:async e=>{if(P&&!B)if(ne)he();else if(ae(e.currentTarget),!(oe.length>0||ie))try{le(!0);const e=[...null!==N&&void 0!==N&&N.id?await We.M8(N.id):await We.t0(P)].sort(((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime()));se(e.filter((e=>!e.is_archived&&!e.by_assistant)))}catch(t){U.logger.error("Error loading notes for AI context:",t)}finally{le(!1)}},disabled:B||!P,size:"small",sx:{backgroundColor:"background.default",color:"text.secondary",width:32,height:32,borderRadius:2,border:"1px solid",borderColor:"divider",transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:(0,i.X4)(K.palette.primary.main,.06),borderColor:"primary.main",color:"primary.main"},"&:disabled":{backgroundColor:"action.disabledBackground",color:"action.disabled",borderColor:"action.disabledBackground"}},children:(0,T.jsx)(j.A,{sx:{fontSize:18}})}),(0,T.jsx)(h.A,{onClick:C?()=>{E()}:de,disabled:!Q.trim()&&0===ee.length&&!C||I,size:"small",sx:{backgroundColor:C?"error.main":Q.trim()||ee.length>0?"primary.main":"action.disabledBackground",color:C?"error.contrastText":Q.trim()||ee.length>0?"primary.contrastText":"action.disabled",width:36,height:36,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:C?"error.dark":Q.trim()||ee.length>0?"primary.dark":"action.disabledBackground",transform:(Q.trim()||ee.length>0)&&!C?"scale(1.05)":"none"},"&:disabled":{backgroundColor:"action.disabledBackground",color:"action.disabled"}},children:C?(0,T.jsx)(w.A,{sx:{fontSize:18}}):(0,T.jsx)(k.A,{sx:{fontSize:18}})})]}),(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block",textAlign:"center",opacity:.7},children:"Enter to send \u2022 Shift+Enter newline \u2022 @ for tags \u2022 Up to ".concat(4," images")})]}),ne&&(0,T.jsx)(p.x,{onClickAway:()=>ae(null),children:(0,T.jsx)(m.A,{open:Boolean(ne),anchorEl:ne,placement:"top-end",disablePortal:!0,sx:{zIndex:Te.M.DIALOG_POPUP},children:(0,T.jsxs)(x.A,{elevation:8,sx:{maxWidth:360,maxHeight:320,overflow:"hidden",borderRadius:2,boxShadow:K.shadows[8]},children:[(0,T.jsxs)(s.A,{sx:{p:1.5,borderBottom:"1px solid",borderColor:"divider"},children:[(0,T.jsx)(l.A,{variant:"subtitle2",sx:{fontWeight:600},children:"Add Context"}),(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Select a note to insert into your message."})]}),(0,T.jsx)(s.A,{sx:(0,n.A)({maxHeight:250,overflow:"auto"},(0,V.J)(K)),children:ie?(0,T.jsxs)(s.A,{sx:{p:2,display:"flex",alignItems:"center",gap:1},children:[(0,T.jsx)(d.A,{size:16}),(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Loading notes..."})]}):0===oe.length?(0,T.jsx)(s.A,{sx:{p:2},children:(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No notes found yet."})}):(0,T.jsx)(f.A,{dense:!0,sx:{p:0},children:oe.map((e=>(0,T.jsx)(y.A,{onClick:()=>(e=>{var t;const r=e.title||"Untitled";null!==(t=$.current)&&void 0!==t&&t.insertNote&&$.current.insertNote(r),he()})(e),sx:{px:1.5,py:1,display:"flex",flexDirection:"column",alignItems:"flex-start"},children:(0,T.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,T.jsx)(j.A,{sx:{fontSize:16,color:"text.secondary",flexShrink:0}}),(0,T.jsx)(l.A,{variant:"body2",sx:{fontWeight:600,maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title||"Untitled"})]})},e.id)))})})]})})})]})}));Ne.displayName="AIChatInterface";const Fe=Ne},76675:(e,t,r)=>{r.d(t,{h:()=>Y,A:()=>V});var n=r(80045),a=r(89379),o=r(65043),s=r(60267),i=r(17060),l=r(24343),c=r(53969),d=r(55895),u=r(10256),g=r(43971),h=r(45984),p=r(1725),m=r(68826),x=r(38865),f=r(3353),y=r(67203),v=r(47471),A=r(29651),b=r(83759),j=r(68545),w=r(64924),k=r(77030),C=r(23893),S=r(26529),_=r(41859),T=r(32911),I=r(91449),M=r(81084),E=r(68165),z=r(46577),D=r(55467),R=r(70579);const W=["key"],P=["key"],N=e=>{let{tags:t,allTags:r,onTagsChange:d,calendarId:u,onTagUpdated:g}=e;const h=(0,s.A)(),[p,m]=(0,o.useState)(null),[x,f]=(0,o.useState)(!1);return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(i.A,{multiple:!0,freeSolo:!0,options:r,value:t||[],onChange:(e,t)=>{const r=[];let n=!1;t.forEach((e=>{(e.match(/:/g)||[]).length<=1?r.push(e):n=!0})),n&&f(!0),d(e,r)},slotProps:{popper:{sx:{zIndex:D.M.DIALOG_POPUP}},listbox:{sx:(0,a.A)({},(0,z.J)(h))}},renderTags:(e,t)=>e.map(((e,r)=>{const o=t({index:r}),{key:s}=o,i=(0,n.A)(o,W);return(0,R.jsx)(b.A,(0,a.A)((0,a.A)({label:(0,M.t)(e,!1)},i),{},{sx:(0,M.dO)(e,h),title:(0,M.dn)(e)?"Group: ".concat((0,M.Oo)(e)):void 0}),s)})),renderOption:(e,t)=>{const{key:r}=e,o=(0,n.A)(e,P);return(0,R.jsx)("li",(0,a.A)((0,a.A)({},o),{},{children:(0,R.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,R.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,M.dn)(t)&&(0,R.jsx)(b.A,{label:(0,M.Oo)(t),size:"small",sx:(0,a.A)((0,a.A)({},(0,M.dO)(t,h)),{},{height:"18px",fontSize:"0.7rem"})}),(0,M.t)(t,!0)]}),(0,R.jsx)(S.A,{title:"Edit this tag across all trades",children:(0,R.jsx)(_.A,{size:"small",onClick:e=>{e.stopPropagation(),m(t)},sx:{color:h.palette.text.secondary,"&:hover":{color:h.palette.primary.main}},children:"Edit"})})]})}),r)},renderInput:e=>(0,R.jsx)(l.A,(0,a.A)((0,a.A)({},e),{},{label:"Tags",placeholder:"Add tags",slotProps:{htmlInput:(0,a.A)((0,a.A)({},e.inputProps),{},{id:"trade-tags-input"})}}))}),p&&(0,R.jsx)(E.A,{open:!!p,onClose:()=>m(null),tag:p,calendarId:u,onSuccess:(e,t,r)=>{g&&g(e,t)},onDelete:(e,r)=>{if(t.includes(e)){const r=t.filter((t=>t!==e));d({},r)}g&&g(e,"")},onTagUpdated:g}),(0,R.jsx)(T.A,{open:x,autoHideDuration:4e3,onClose:()=>f(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{zIndex:D.M.DIALOG_POPUP},children:(0,R.jsx)(I.A,{onClose:()=>f(!1),severity:"warning",sx:{width:"100%"},children:"Tags can only contain one colon (:) for category formatting. Invalid tags were removed."})})]})},F=o.memo(N);var L=r(77328),X=r(41831),O=r(78018);const B=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;if(!e||0===e.length)return[];const n=e.map((e=>e.name)).filter((e=>Boolean(e&&e.trim()))).map((e=>e.trim())).filter((e=>"New Trade"!==e)).filter(((e,t,r)=>r.indexOf(e)===t));if(!t.trim()){const e=new Map;return n.forEach((t=>{e.set(t,(e.get(t)||0)+1)})),Array.from(e.entries()).sort(((e,t)=>t[1]-e[1])).map((e=>{let[t]=e;return t})).slice(0,r)}const a=t.toLowerCase(),o=n.filter((e=>e.toLowerCase().includes(a)));return[...o.filter((e=>e.toLowerCase()===a)),...o.filter((e=>e.toLowerCase().startsWith(a)&&e.toLowerCase()!==a)),...o.filter((e=>e.toLowerCase().includes(a)&&!e.toLowerCase().startsWith(a)))].slice(0,r)},U=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;if(!e||0===e.length)return B(e,n,a);const o=e.filter((e=>{if(!e.name||""===e.name.trim()||"New Trade"===e.name)return!1;const n=t.length>0&&e.tags&&e.tags.some((e=>t.includes(e))),a=r&&e.session===r;return n||a}));if(o.length>0){const t=B(o,n,Math.ceil(.7*a)),r=a-t.length;if(r>0){const a=B(e,n,r).filter((e=>!t.includes(e)));return[...t,...a]}return t}return B(e,n,a)},q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=["EURUSD Long","EURUSD Short","GBPUSD Long","GBPUSD Short","USDJPY Long","USDJPY Short","AUDUSD Long","AUDUSD Short","USDCAD Long","USDCAD Short","NZDUSD Long","NZDUSD Short","EURJPY Long","EURJPY Short","GBPJPY Long","GBPJPY Short","Breakout Trade","Reversal Trade","Trend Following","Support Bounce","Resistance Rejection","News Trade","Scalp Trade","Swing Trade","Range Trade","Momentum Trade"];if(!e.trim())return t.slice(0,5);const r=e.toLowerCase();return t.filter((e=>e.toLowerCase().includes(r))).slice(0,5)};var G=r(59168);const H=["key"],Y="Pairs",V=e=>{let{newTrade:t,editingTrade:r,allTags:S,isSubmitting:_,accountBalance:T,dynamicRiskSettings:I,calculateAmountFromRiskToReward:E,calculateCumulativePnl:z,calendarId:W,requiredTagGroups:P=[],onTagUpdated:N,onNameChange:B,onAmountChange:V,onTypeChange:K,onEntryChange:J,onExitChange:$,onStopLossChange:Q,onTakeProfitChange:Z,onRiskToRewardChange:ee,onPartialsTakenChange:te,onSessionChange:re,onNotesChange:ne,onTagsChange:ae,onDateChange:oe,onImageUpload:se,onImageCaptionChange:ie,onImageRemove:le,onImagesReordered:ce,onSubmit:de,trades:ue,onOpenGalleryMode:ge}=e;const he=(0,s.A)(),[pe,me]=(0,o.useState)([]);(0,o.useEffect)((()=>{(async()=>{if(!W)return;const e=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;try{const o=new X.P,s=(new Date).getFullYear(),i=(await o.getTradesForYearPaginated(e,s,1,15)).trades;if(!i||0===i.length)return q(n);const l=U(i,t,r,n,a);if(l.length<5){const e=q(n).filter((e=>!l.includes(e)));return[...l,...e].slice(0,a)}return l}catch(o){return O.logger.error("Error fetching trades for autocomplete:",o),q(n)}}(W,t.tags,t.session||void 0,t.name,8);me(e)})()}),[W,t.tags,t.session,t.name]);const xe=(0,o.useMemo)((()=>Array.from(new Set([...S,...G.Yj.map((e=>"".concat(Y,":").concat(e)))]))),[S]),fe=(0,o.useMemo)((()=>{const e=[...P];return e.includes(Y)||e.push(Y),e}),[P]),ye=(0,o.useMemo)((()=>{if(!fe||0===fe.length)return[];const e=new Set;return t.tags.forEach((t=>{if((0,M.dn)(t)){const r=(0,M.Oo)(t);e.add(r)}})),fe.filter((t=>!e.has(t)))}),[fe,t.tags]),ve=z(t),Ae=(0,o.useCallback)((e=>{const r=e.target.value;if(""===r||/^\d*\.?\d*$/.test(r)){const e=""===r?0:parseFloat(r);if(ee(e),I.risk_per_trade&&e&&!t.partials_taken&&!isNaN(e)){const t=E(e,ve);V(t)}}}),[ee,I.risk_per_trade,t.partials_taken,ve,V]);return(0,R.jsxs)("form",{onSubmit:de,children:[(0,R.jsx)(w.zB,{children:(0,R.jsx)(i.A,{freeSolo:!0,options:pe,value:t.name,onInputChange:(e,t)=>{B({target:{value:t||""}})},slotProps:{popper:{sx:{zIndex:D.M.DIALOG_POPUP}}},renderInput:e=>(0,R.jsx)(l.A,(0,a.A)((0,a.A)({},e),{},{label:"Trade Name",placeholder:"Enter a name for this trade",fullWidth:!0})),renderOption:(e,t)=>{const{key:r}=e,o=(0,n.A)(e,H);return(0,R.jsx)(c.A,(0,a.A)((0,a.A)({component:"li"},o),{},{children:(0,R.jsx)(d.A,{variant:"body2",children:t})}),r)},sx:{"& .MuiAutocomplete-option":{fontSize:"0.875rem"}}})}),(0,R.jsxs)(c.A,{sx:{display:"flex",gap:2,width:"100%"},children:[(0,R.jsx)(w.zB,{sx:{flex:1},children:(0,R.jsx)(l.A,{label:"Entry Price",type:"number",value:0==t.entry_price?void 0:t.entry_price,onChange:J,fullWidth:!0,placeholder:"Optional entry price",slotProps:{htmlInput:{step:1e-5}}})}),(0,R.jsx)(w.zB,{sx:{flex:1},children:(0,R.jsx)(l.A,{label:"Exit Price",type:"number",value:0==t.exit_price?void 0:t.exit_price,onChange:$,fullWidth:!0,placeholder:"Optional exit price",slotProps:{htmlInput:{step:1e-5}}})})]}),(0,R.jsxs)(c.A,{sx:{display:"flex",gap:2,width:"100%"},children:[(0,R.jsx)(w.zB,{sx:{flex:1},children:(0,R.jsx)(l.A,{label:"Stop Loss",type:"number",value:0==t.stop_loss?void 0:t.stop_loss,onChange:Q,fullWidth:!0,placeholder:"Optional stop loss",slotProps:{htmlInput:{step:1e-5}}})}),(0,R.jsx)(w.zB,{sx:{flex:1},children:(0,R.jsx)(l.A,{label:"Take Profit",type:"number",value:0==t.take_profit?void 0:t.take_profit,onChange:Z,fullWidth:!0,placeholder:"Optional take profit",slotProps:{htmlInput:{step:1e-5}}})})]}),r&&oe&&(0,R.jsx)(w.zB,{children:(0,R.jsx)(j.l,{label:"Trade Date",value:t.trade_date,onChange:oe,slotProps:{textField:{fullWidth:!0,helperText:"Change the date of this trade"},popper:{sx:{zIndex:D.M.DIALOG_POPUP}}}})}),(0,R.jsxs)(u.A,{component:"fieldset",sx:{mb:2},children:[(0,R.jsx)(g.A,{component:"legend",children:"Trade Type"}),(0,R.jsxs)(h.A,{row:!0,name:"type",value:t.trade_type,onChange:K,children:[(0,R.jsx)(p.A,{value:"win",control:(0,R.jsx)(m.A,{}),label:"Win"}),(0,R.jsx)(p.A,{value:"loss",control:(0,R.jsx)(m.A,{}),label:"Loss"}),(0,R.jsx)(p.A,{value:"breakeven",control:(0,R.jsx)(m.A,{}),label:"Breakeven"})]})]}),!I.risk_per_trade||I.risk_per_trade&&t.partials_taken?(0,R.jsx)(w.zB,{children:(0,R.jsx)(l.A,{label:"Amount",type:"number",value:0==t.amount?void 0:t.amount,onChange:e=>V(parseFloat(e.target.value)||0),fullWidth:!0,required:!0,helperText:I.risk_per_trade&&t.partials_taken?"Manual entry for partial profits":void 0})}):(0,R.jsx)(w.zB,{children:(0,R.jsx)(l.A,{label:"Amount (Calculated from Risk)",type:"number",value:(()=>{if(!I.risk_per_trade||!t.risk_to_reward)return 0;const e=Number(t.risk_to_reward);if(isNaN(e))return 0;const r=E(e,Number(ve));return!t.partials_taken&&r>0&&setTimeout((()=>V(r)),0),r})(),sx:{"& .MuiInputBase-input":{pointerEvents:"none"}},fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0},helperText:null!==I&&void 0!==I&&I.dynamic_risk_enabled&&I.increased_risk_percentage&&I.profit_threshold_percentage&&Number(ve)/Number(T)*100>=I.profit_threshold_percentage?"Based on ".concat(I.increased_risk_percentage,"% of account balance (INCREASED from ").concat(I.risk_per_trade,"%)"):"Based on ".concat(I.risk_per_trade,"% of account balance (").concat((0,C.vv)(Number(T)*(I.risk_per_trade||0)/100),")")})}),void 0!==I.risk_per_trade&&(0,R.jsx)(w.zB,{children:(0,R.jsx)(p.A,{control:(0,R.jsx)(x.A,{checked:t.partials_taken,onChange:te}),label:(0,R.jsx)(d.A,{variant:"body2",children:"Partials taken (allows manual amount entry)"})})}),(0,R.jsx)(w.zB,{children:(0,R.jsx)(l.A,{label:"Risk to Reward",value:0==t.risk_to_reward?void 0:t.risk_to_reward,onChange:Ae,fullWidth:!0,type:"number",slotProps:{htmlInput:{min:0,step:.1}},sx:{"& input[type=number]::-webkit-outer-spin-button, & input[type=number]::-webkit-inner-spin-button":{WebkitAppearance:"none",margin:0},"& input[type=number]":{MozAppearance:"textfield"}}})}),(0,R.jsx)(w.zB,{children:(0,R.jsxs)(u.A,{fullWidth:!0,required:!0,children:[(0,R.jsx)(f.A,{id:"session-label",children:"Session *"}),(0,R.jsxs)(y.A,{labelId:"session-label",value:t.session,onChange:re,label:"Session *",required:!0,MenuProps:{sx:{zIndex:D.M.DIALOG_POPUP}},children:[(0,R.jsx)(v.A,{value:"",children:"None"}),(0,R.jsx)(v.A,{value:"Asia",children:"Asia"}),(0,R.jsx)(v.A,{value:"London",children:"London"}),(0,R.jsx)(v.A,{value:"NY AM",children:"NY AM"}),(0,R.jsx)(v.A,{value:"NY PM",children:"NY PM"})]})]})}),(0,R.jsxs)(w.zB,{children:[ye.length>0&&(0,R.jsxs)(c.A,{sx:{mb:2,p:2,borderRadius:1,bgcolor:(0,A.X4)(he.palette.warning.main,.1),border:"1px solid ".concat((0,A.X4)(he.palette.warning.main,.3))},children:[(0,R.jsx)(d.A,{variant:"body2",color:"warning.main",sx:{fontWeight:600,mb:1},children:"Required Tag Groups"}),(0,R.jsx)(d.A,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"Please add at least one tag from each required group:"}),(0,R.jsx)(c.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:ye.map((e=>(0,R.jsx)(b.A,{label:e,size:"small",color:"warning",variant:"outlined",sx:{fontWeight:500,"& .MuiChip-label":{fontSize:"0.75rem"}}},e)))})]}),(0,R.jsx)(F,{tags:t.tags,allTags:xe,onTagsChange:ae,calendarId:W,onTagUpdated:N}),(0,R.jsx)(d.A,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:'Pro tip: Categorize tags using the format "Category:Tag" (e.g., "Strategy:Breakout", "Setup:Double Top"). Categorized tags are grouped together in charts, making it easier to filter and analyze your trading patterns and identify which strategies and setups are most profitable. Note: Only one colon (:) is allowed per tag.'})]}),(0,R.jsx)(k.A,{pendingImages:t.pending_images,uploadedImages:t.uploaded_images,editingTrade:null!==r,onImageUpload:se,onImageCaptionChange:ie,onImageRemove:le,onImagesReordered:ce}),(0,R.jsx)(w.zB,{children:(0,R.jsx)(L.A,{label:"Notes",value:t.notes,onChange:ne,placeholder:"Add notes for this trade...",minHeight:150,maxHeight:400,maxLength:1024,toolbarVariant:"sticky",stickyPosition:"bottom",calendarId:W,trades:ue,onOpenGalleryMode:ge})}),(0,R.jsx)(c.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2,gap:1},children:(0,R.jsx)("button",{type:"submit",style:{display:"none"},disabled:_})})]})}},77030:(e,t,r)=>{r.d(t,{A:()=>C});var n,a=r(89379),o=r(65043),s=r(53969),i=r(55895),l=r(41859),c=r(26529),d=r(42579),u=r(93468),g=r(43900),h=r(14540),p=r(57528),m=r(80172),x=r(24343),f=r(83290),y=r(5362),v=r(60267),A=r(29651),b=r(78018),j=r(70579);const w=e=>{let{image:t,theme:r}=e;const o=(0,f.i7)(n||(n=(0,p.A)(["\n    0% {\n      background-position: -200% 0;\n    }\n    100% {\n      background-position: 200% 0;\n    }\n  "])));return(0,j.jsx)(s.A,{sx:(0,a.A)({width:"100%",height:"auto",maxHeight:300,overflow:"hidden",position:"relative"},t.width&&t.height?{paddingTop:"".concat(t.height/t.width*100,"%")}:{}),children:(0,j.jsx)(s.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:()=>{const e="dark"===r.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.04)",t="dark"===r.palette.mode?"rgba(255, 255, 255, 0.15)":"rgba(0, 0, 0, 0.1)";return"linear-gradient(90deg, ".concat(e," 25%, ").concat(t," 50%, ").concat(e," 75%)")},backgroundSize:"200% 100%",animation:"".concat(o," 1.5s infinite linear"),willChange:"background-position",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:(0,j.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[(0,j.jsx)(m.A,{size:24,color:"primary"}),(0,j.jsx)(i.A,{variant:"caption",sx:{color:"text.secondary",fontWeight:500},children:"Uploading..."})]})})})},k=e=>{let{pendingImages:t,uploadedImages:r,editingTrade:n,onImageCaptionChange:l,onImageRemove:c,onImagesReordered:u}=e;const g=(0,v.A)(),[h,p]=(0,o.useState)([]),[f,k]=(0,o.useState)(null),[C,S]=(0,o.useState)(null),[_,T]=(0,o.useState)(null),[I,M]=(0,o.useState)(null),E=(0,o.useRef)(null),z=(0,o.useRef)(null);(0,o.useEffect)((()=>{const e=((e,t)=>{b.logger.log("Input to organizeImagesIntoRows:","Pending:",e.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.column_width}))),"Uploaded:",t.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.column_width}))));const r=[...e.map(((e,t)=>{var r;const n=(0,a.A)((0,a.A)({},e),{},{id:null!==(r=e.id)&&void 0!==r?r:"pending-".concat(t),isPending:!0,row:void 0!==e.row?e.row:void 0,column:void 0!==e.column?e.column:void 0,columnWidth:void 0!==e.column_width?e.column_width:void 0});return b.logger.log("Processed pending image ".concat(t,":"),n.id,n.row,n.column,n.column_width),n})),...t.map(((e,t)=>{var r;const n=(0,a.A)((0,a.A)({},e),{},{id:null!==(r=e.id)&&void 0!==r?r:"uploaded-".concat(t),isPending:!1,row:void 0!==e.row?e.row:void 0,column:void 0!==e.column?e.column:void 0,columnWidth:void 0!==e.column_width?e.column_width:void 0});return b.logger.log("Processed uploaded image ".concat(t,":"),n.id,n.row,n.column,n.column_width),n}))],n={};let o=-1;r.forEach((e=>{void 0!==e.row&&(n[e.row]||(n[e.row]=[]),n[e.row].push(e),o=Math.max(o,e.row))}));let s=o+1;r.filter((e=>void 0===e.row)).forEach(((e,t)=>{const r=s+t;e.row=r,e.column=0,e.column_width=100,n[e.row]||(n[e.row]=[]),n[e.row].push(e)}));const i=Object.entries(n).sort(((e,t)=>{let[r]=e,[n]=t;return Number(r)-Number(n)})).map((e=>{let[t,r]=e;return b.logger.log("Processing row ".concat(t," with ").concat(r.length," images")),r}));i.forEach(((e,t)=>{e.forEach((e=>e.row=t)),e.sort(((e,t)=>{var r,n;return(null!==(r=e.column)&&void 0!==r?r:1/0)-(null!==(n=t.column)&&void 0!==n?n:1/0)}));let r=0,n=0;if(e.forEach(((e,t)=>{e.column=t,void 0===e.column_width?n++:r+=e.column_width})),n>0){const t=Math.max(0,100-r)/n;e.forEach((e=>{void 0===e.column_width&&(e.column_width=t)}))}else if(e.length>0&&Math.abs(r-100)>.1){const t=100/r;e.forEach((e=>{var r;e.column_width=(null!==(r=e.column_width)&&void 0!==r?r:0)*t}))}else if(e.length>0&&0===r){const t=100/e.length;e.forEach((e=>{e.column_width=t}))}}));const l=i.filter((e=>e&&e.length>0));return b.logger.log("Final organized rows:",l.map(((e,t)=>"Row ".concat(t,": ")+e.map((e=>"(id: ".concat(e.id,", col: ").concat(e.column,", width: ").concat(e.column_width,"%)"))).join(", ")))),l})(t,r);b.logger.log("Organizing images with layout info:",t.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.column_width}))),r.map((e=>({id:e.id,row:e.row,column:e.column,columnWidth:e.column_width})))),p(e)}),[t,r]);const D=e=>"isPending"in e?!!e.isPending:"file"in e,R=()=>t.length>0,W=(e,t,r)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",f&&(S(t),T(null!==r&&void 0!==r?r:0))},P=(e,n,a)=>{var o;if(e.preventDefault(),e.stopPropagation(),!f)return;const s=JSON.parse(e.dataTransfer.getData("text/plain")),i=s.sourceRowIndex,l=s.sourceColumnIndex,c=s.id,d=s.isPending;let g,m;if(m=(d?t:r).findIndex((e=>e.id===c)),-1===m)return b.logger.error("Could not find dragged image in original collection!"),void F();if(g=null===(o=h[i])||void 0===o?void 0:o[l],!g){b.logger.error("Inconsistency: Dragged image not found in current rows state at source index");const e=h.flat();if(g=e.find((e=>e.id===c&&D(e)===d)),!g)return b.logger.error("Could not find dragged image anywhere!"),void F();b.logger.warn("Found image via fallback, drag/drop might be slightly off.")}let x=h.map((e=>[...e])),y=-1,v=-1;for(let t=0;t<x.length;t++){const e=x[t].findIndex((e=>e.id===g.id&&D(e)===D(g)));if(-1!==e){y=t,v=e;break}}if(-1===y)return b.logger.error("Cannot find image to remove during drop!"),void F();x[y].splice(v,1);let A=n,j=null!==a&&void 0!==a?a:0;for(n===x.filter((e=>e.length>0)).length&&null===a?(A=x.length,j=0):null===a&&(j=0);x.length<=A;)x.push([]);if(x[A].splice(j,0,g),x=x.filter((e=>e.length>0)),x.forEach(((e,t)=>{const r=100/e.length;e.forEach(((n,a)=>{var o;if(n.row=t,n.column=a,n.id===g.id||1===e.length||y!==t)n.column_width=r;else if(t===A&&e.length>1)n.column_width=r;else if(t===y&&(null===(o=x[t])||void 0===o?void 0:o.length)>0){const e=100/x[t].length;n.column_width=e}(void 0===n.column_width||null===n.column_width||isNaN(n.column_width)||n.column_width<=0)&&(n.column_width=100/e.length)}));const n=e.reduce(((e,t)=>e+(t.column_width||0)),0);if(n>0&&Math.abs(n-100)>.1){const t=100/n;e.forEach((e=>e.column_width=(e.column_width||0)*t))}else if(0===n&&e.length>0){const t=100/e.length;e.forEach((e=>e.column_width=t))}})),p(x),u){const e=x.flat();u(e)}F()},N=()=>{z.current&&document.body.contains(z.current)&&document.body.removeChild(z.current),z.current=null},F=()=>{k(null),S(null),T(null),N()},L=(0,o.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e||0===e.length)return e;const r=e.reduce(((e,t)=>e+(t.column_width||0)),0);if(Math.abs(r-100)<.1)return e;if(0===r){const t=100/e.length;return e.forEach((e=>e.column_width=t)),e}const n=100/r;e.forEach((e=>{e.column_width=(e.column_width||0)*n,e.column_width=Math.max(t,e.column_width)}));const a=e.reduce(((e,t)=>e+(t.column_width||0)),0);if(Math.abs(a-100)>.1){const t=e.reduce(((e,t,r,n)=>(t.column_width||0)>(n[e].column_width||0)?r:e),0);e[t].column_width=(e[t].column_width||0)-(a-100)}return e}),[]),X=(0,o.useCallback)((e=>{if(!I)return;const{rowIndex:t,dividerIndex:r,startX:n,rowElementWidth:o,initialWidths:s}=I,i=(e.clientX-n)/o*100,l=[...h.map((e=>[...e.map((e=>(0,a.A)({},e)))]))],c=l[t];let d=0;for(let a=0;a<=r;a++)d+=s[a];let u=0;for(let a=r+1;a<s.length;a++)u+=s[a];let g=d+i,m=u-i;const x=r+1,f=s.length-x,y=10*x,v=10*f;g=Math.max(y,g),m=Math.max(v,m);const A=g+m;if(Math.abs(A-100)>.1){const e=100/A;g*=e,m*=e,g=Math.max(y,g),m=Math.max(v,m),g===y?m=100-g:m===v&&(g=100-m)}for(let a=0;a<=r;a++){let e=0;if(d>0){e=g*(s[a]/d)}else e=g/x;c[a].column_width=Math.max(10,e)}for(let a=r+1;a<c.length;a++){let e=0;if(u>0){e=m*(s[a]/u)}else e=m/f;c[a].column_width=Math.max(10,e)}L(c),p(l)}),[I,h,L]),O=(0,o.useCallback)((()=>{if(I){if(u){const e=I.rowIndex;if(h[e]){const e=h.flat();u(e)}}M(null)}}),[I,h,u]);return(0,o.useEffect)((()=>(I?(window.addEventListener("mousemove",X),window.addEventListener("mouseup",O),document.body.style.cursor="col-resize"):(window.removeEventListener("mousemove",X),window.removeEventListener("mouseup",O),document.body.style.cursor=""),()=>{window.removeEventListener("mousemove",X),window.removeEventListener("mouseup",O),document.body.style.cursor=""})),[I,X,O]),(0,j.jsxs)(s.A,{sx:{width:"100%"},ref:E,children:[h.map(((e,u)=>(0,j.jsx)(s.A,{className:"image-row-container",sx:{display:"flex",width:"100%",marginBottom:3,position:"relative",gap:1},onDragOver:e=>W(e,u,0),children:e.map(((p,v)=>{const b=D(p),S=b?p:null,T=b?null:p,E=b?S.id:T.id,L=v===e.length-1;return(0,j.jsxs)(o.Fragment,{children:[(0,j.jsxs)(s.A,{sx:(0,a.A)((0,a.A)({position:"relative",width:"".concat(p.column_width||100,"%"),height:"auto",borderRadius:1,overflow:"visible",display:"flex",flexDirection:"column",opacity:f===p?.5:1,backgroundColor:"transparent",transition:"border-color 0.2s, background-color 0.2s, opacity 0.2s, box-shadow 0.2s"},f&&C===u&&_===v&&{backgroundColor:(0,A.X4)(g.palette.primary.main,.1)}),{},{"&:hover .resize-handle":{opacity:R()?.2:1},cursor:R()?"not-allowed":"grab",filter:R()?"grayscale(0.2)":"none"}),draggable:!R(),onDragStart:e=>((e,t,r,n)=>{if(I||R())return void e.preventDefault();k(t),e.dataTransfer.setData("text/plain",JSON.stringify({id:t.id,isPending:D(t),sourceRowIndex:r,sourceColumnIndex:n})),e.dataTransfer.effectAllowed="move";const a=e.currentTarget,o=a.getBoundingClientRect(),s=e.clientX-o.left,i=e.clientY-o.top,l=a.cloneNode(!0);l.style.width="".concat(o.width,"px"),l.style.height="".concat(o.height,"px"),l.style.opacity="0.7",l.style.position="absolute",l.style.top="-1000px",l.style.left="-1000px",l.style.pointerEvents="none",l.style.zIndex="1000",z.current=l,document.body.appendChild(l),e.dataTransfer.setDragImage(l,s,i),setTimeout((()=>{N()}),100)})(e,p,u,v),onDragOver:e=>W(e,u,v),onDrop:e=>P(e,u,v),onDragEnd:F,children:[(0,j.jsxs)(s.A,{sx:{overflow:"hidden",borderRadius:"4px 4px 0 0"},children:[" ",b?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(s.A,{sx:{width:"100%",height:"auto",maxHeight:e.length>1?300:"none",overflow:"hidden",position:"relative",backgroundColor:(0,A.X4)(g.palette.divider,.1),aspectRatio:null!==S&&void 0!==S&&S.width&&null!==S&&void 0!==S&&S.height?"".concat(S.width,"/").concat(S.height):"16/9"},children:[(0,j.jsx)(s.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:2},children:(0,j.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[(0,j.jsx)(m.A,{size:48,sx:{color:"white"}}),(0,j.jsx)(i.A,{variant:"caption",component:"div",sx:{color:"white",fontWeight:"bold"},children:"Uploading..."})]})}),(0,j.jsx)("img",{src:null===S||void 0===S?void 0:S.preview,alt:"Pending Upload",style:{display:"block",width:"100%",height:"100%",objectFit:"contain"}}),(0,j.jsx)(d.A,{size:"small",onClick:()=>c(t.findIndex((e=>e.id===p.id)),!0),sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",zIndex:10,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:(0,j.jsx)(y.A,{fontSize:"small"})})]}),(0,j.jsx)(x.A,{placeholder:"Add a caption...",value:(null===S||void 0===S?void 0:S.caption)||"",onChange:e=>l(t.findIndex((e=>e.id===p.id)),e.target.value,!0),variant:"standard",multiline:!0,minRows:1,maxRows:20,fullWidth:!0,disabled:!0,sx:{px:1,py:.5,backgroundColor:g.palette.background.paper,fontSize:"0.75rem","& .MuiInput-underline:before":{borderBottomColor:"transparent"},"& .MuiInput-underline:after":{borderBottomColor:"transparent"},"& .MuiInput-underline:hover:not(.Mui-disabled):before":{borderBottomColor:"transparent"},"& .MuiInputBase-input":{fontSize:"0.75rem"},"& .MuiInputBase-root":{overflow:"visible"},"&.Mui-disabled":{opacity:.7,"& .MuiInputBase-input":{color:"text.disabled"}}}})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(s.A,{sx:{width:"100%",height:"auto",maxHeight:e.length>1?300:"none",overflow:"hidden",position:"relative",backgroundColor:(0,A.X4)(g.palette.divider,.1),aspectRatio:null!==T&&void 0!==T&&T.width&&null!==T&&void 0!==T&&T.height?"".concat(T.width,"/").concat(T.height):"16/9"},children:[n&&null!==T&&void 0!==T&&T.pending?(0,j.jsx)(w,{image:T,theme:g}):(0,j.jsx)("img",{src:null===T||void 0===T?void 0:T.url,alt:(null===T||void 0===T?void 0:T.caption)||"Uploaded image",style:{display:"block",width:"100%",height:"100%",objectFit:"contain",position:"relative",zIndex:1}}),(0,j.jsx)(d.A,{size:"small",onClick:()=>c(r.findIndex((e=>e.id===p.id)),!1),sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",zIndex:10,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:(0,j.jsx)(y.A,{fontSize:"small"})})]}),(0,j.jsx)(x.A,{placeholder:"Add a caption...",value:(null===T||void 0===T?void 0:T.caption)||"",onChange:e=>l(r.findIndex((e=>e.id===p.id)),e.target.value,!1),variant:"standard",multiline:!0,minRows:1,maxRows:20,fullWidth:!0,disabled:R()||!0===(null===T||void 0===T?void 0:T.pending),sx:{px:1,py:.5,backgroundColor:g.palette.background.paper,fontSize:"0.75rem","& .MuiInput-underline:before":{borderBottomColor:"transparent"},"& .MuiInput-underline:after":{borderBottomColor:"transparent"},"& .MuiInput-underline:hover:not(.Mui-disabled):before":{borderBottomColor:"transparent"},"& .MuiInputBase-input":{fontSize:"0.75rem"},"& .MuiInputBase-root":{overflow:"visible"},"&.Mui-disabled":{opacity:.7,"& .MuiInputBase-input":{color:"text.disabled"}}}})]})]})," "]},"image-".concat(E,"-").concat(u,"-").concat(v)),!L&&e.length>1&&(0,j.jsx)(s.A,{className:"resize-handle",sx:(0,a.A)({width:"8px",position:"relative",cursor:R()?"not-allowed":"col-resize",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,zIndex:10,"&::before":{content:'""',position:"absolute",top:"5%",bottom:"5%",left:"3px",width:"2px",backgroundColor:I&&I.rowIndex===u&&I.dividerIndex===v?g.palette.primary.main:R()?(0,A.X4)(g.palette.divider,.4):(0,A.X4)(g.palette.divider,.8),opacity:I&&I.rowIndex===u&&I.dividerIndex===v?1:0,transition:"opacity 0.2s, background-color 0.2s, width 0.2s"},"&:hover::before":{opacity:R()?.3:1,width:R()?"2px":"3px",backgroundColor:R()?(0,A.X4)(g.palette.divider,.4):g.palette.primary.light}},I&&I.rowIndex===u&&I.dividerIndex===v&&{"&::before":{opacity:1,width:"3px",backgroundColor:g.palette.primary.main}}),onMouseDown:e=>((e,t,r)=>{if(e.preventDefault(),e.stopPropagation(),R())return;const n=e.target.closest(".image-row-container");if(!n)return;const a=n.getBoundingClientRect().width;a<=0||M({rowIndex:t,dividerIndex:r,startX:e.clientX,rowElementWidth:a,initialWidths:h[t].map((e=>e.column_width||0))})})(e,u,v)})]},"image-frag-".concat(E,"-").concat(u,"-").concat(v))}))},"row-".concat(u)))),f&&!R()&&(0,j.jsx)(s.A,{sx:(0,a.A)({width:"100%",height:80,border:"2px dashed ".concat(C===h.length&&0===_?g.palette.primary.main:(0,A.X4)(g.palette.divider,.5)),borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:C===h.length&&0===_?(0,A.X4)(g.palette.primary.main,.1):"transparent",color:g.palette.text.secondary,transition:"all 0.2s ease-in-out",marginBottom:2,position:"relative"},C===h.length&&0===_&&{backgroundColor:(0,A.X4)(g.palette.primary.main,.1),border:"2px solid ".concat(g.palette.primary.main),"&::after":{content:'"New Row"',position:"absolute",top:"-10px",right:"10px",backgroundColor:g.palette.primary.main,color:g.palette.primary.contrastText,padding:"2px 8px",borderRadius:"4px",fontSize:"0.7rem",fontWeight:"bold",zIndex:10,boxShadow:"0 2px 4px ".concat((0,A.X4)(g.palette.common.black,.2))}}),onDragOver:e=>W(e,h.length,0),onDragLeave:()=>{},onDrop:e=>P(e,h.length,null),children:"Drop here to create a new row"})]})},C=e=>{let{pendingImages:t,uploadedImages:r,editingTrade:n,onImageUpload:p,onImageCaptionChange:m,onImageRemove:x,onImagesReordered:f}=e;const y=(0,o.useRef)(null),v=()=>t.length>0,A=e=>{var t;const r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;const n=[];for(let a=0;a<r.length;a++){const e=r[a];if(-1!==e.type.indexOf("image")){const t=e.getAsFile();t&&n.push(t)}}if(n.length>0){const e=new DataTransfer;n.forEach((t=>e.items.add(t))),p(e.files)}};return(0,o.useEffect)((()=>(document.addEventListener("paste",A),()=>{document.removeEventListener("paste",A)})),[p]),(0,j.jsxs)(s.A,{sx:{mt:2},children:[(0,j.jsx)(i.A,{variant:"subtitle1",sx:{mb:1},children:"Images"}),(0,j.jsx)("input",{type:"file",accept:"image/*",multiple:!0,ref:y,style:{display:"none"},onChange:e=>{e.target.files&&e.target.files.length>0&&(p(e.target.files),e.target.value="")}}),(0,j.jsxs)(s.A,{sx:{mb:2},children:[(0,j.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,j.jsx)(l.A,{variant:"outlined",startIcon:(0,j.jsx)(u.A,{}),onClick:()=>{var e;null===(e=y.current)||void 0===e||e.click()},children:"Add Images"}),(0,j.jsx)(s.A,{sx:{flex:1}}),"  ",(0,j.jsx)(c.A,{title:"Arrange images vertically (one per row)",children:(0,j.jsxs)("span",{children:[" ",(0,j.jsx)(d.A,{onClick:()=>{if(!f||v())return;const e=[...[...t,...r]].sort(((e,t)=>{var r,n,a,o;const s=null!==(r=e.row)&&void 0!==r?r:0,i=null!==(n=t.row)&&void 0!==n?n:0,l=null!==(a=e.column)&&void 0!==a?a:0,c=null!==(o=t.column)&&void 0!==o?o:0;return s===i?l-c:s-i})).map(((e,t)=>(0,a.A)((0,a.A)({},e),{},{row:t,column:0,column_width:100}))),n=e.filter((e=>"file"in e)),o=e.filter((e=>!("file"in e)));f([...n,...o])},color:"default",disabled:t.length+r.length<2||v(),children:(0,j.jsx)(g.A,{})})]})}),(0,j.jsx)(c.A,{title:"Arrange images in a grid (max 3 columns)",children:(0,j.jsxs)("span",{children:[" ",(0,j.jsx)(d.A,{onClick:()=>{if(!f||v())return;const e=[...[...t,...r]].sort(((e,t)=>{var r,n,a,o;const s=null!==(r=e.row)&&void 0!==r?r:0,i=null!==(n=t.row)&&void 0!==n?n:0,l=null!==(a=e.column)&&void 0!==a?a:0,c=null!==(o=t.column)&&void 0!==o?o:0;return s===i?l-c:s-i})),n=100/3,o=e.map(((e,t)=>{const r=Math.floor(t/3),o=t%3;return(0,a.A)((0,a.A)({},e),{},{row:r,column:o,columnWidth:n})})),s=o.filter((e=>"file"in e)),i=o.filter((e=>!("file"in e)));f([...s,...i])},color:"default",disabled:t.length+r.length<2||v(),children:(0,j.jsx)(h.A,{})})]})})]}),(0,j.jsx)(i.A,{variant:"caption",color:"text.secondary",display:"block",children:"You can also paste images directly (Ctrl+V). Maximum file size: 1MB per image."})]}),(t.length>0||r.length>0)&&(0,j.jsx)(k,{pendingImages:t,uploadedImages:r,editingTrade:n,onImageCaptionChange:m,onImageRemove:x,onImagesReordered:f})]})}},77409:(e,t,r)=>{r.d(t,{A1:()=>o.A,Ju:()=>k,TQ:()=>n.A,p:()=>a.A});var n=r(76675),a=(r(77030),r(66562)),o=r(90668),s=r(65043),i=r(94799),l=r(55895),c=r(53969),d=r(26020),u=r(93201),g=r(49763),h=r(80696),p=r(74830),m=r(29651),x=r(90238),f=r(31555),y=r(39993),v=r(5780),A=r(41831),b=r(49221),j=r(78018),w=r(70579);const k=e=>{let{calendarId:t,currentBalance:r,currentDate:n,calendar:a,weekTrades:o}=e;const[k,C]=(0,s.useState)([]),[S,_]=(0,s.useState)(0),T=null!==o&&void 0!==o?o:k,I=null===a||void 0===a?void 0:a.weekly_target,M=(null===a||void 0===a?void 0:a.account_balance)||0,E=null===a||void 0===a?void 0:a.risk_per_trade,{weekStart:z,weekEnd:D,weekStartTime:R}=(0,s.useMemo)((()=>{const e=(0,x.A)(n,{weekStartsOn:0});return{weekStart:e,weekEnd:(0,f.A)(n,{weekStartsOn:0}),weekStartTime:e.getTime()}}),[n.getTime()]),W=null===a||void 0===a?void 0:a.id;(0,s.useEffect)((()=>{(async()=>{if(t&&a)try{if(!o){const e=new A.P,r=await e.getTradesByDateRange(t,z,D);C(r)}const e=await(0,b.jp)(z,a);_(e)}catch(e){j.logger.error("Error fetching week data:",e),o||C([]),_(0)}})()}),[t,W,R,o]);const P=new Set(T.map((e=>(0,y.A)((0,v.A)(new Date(e.trade_date)),"yyyy-MM-dd")))).size,N=T.reduce(((e,t)=>e+t.amount),0),F=M+S,L=F>0&&I?I/100*F:0,X=E&&F>0?E/100*F:0,O=Math.min(P/5*100,100),B=L>0?Math.min(N/L*100,100):0,U=N>=L,q=P>=5,G=Math.min(P,5),H=Math.min(N,L),Y=(0,s.useMemo)((()=>((e,t,r,n)=>{if(e<=0)return{message:"You've hit your target!",subMessage:"Outstanding work! Consider locking in your gains or pushing further."};if(!t||t<=0){const e=n>0?Math.round(r/n*100):0;return e>=75?{message:"Almost there!",subMessage:"You're so close to your target. Stay focused and trust your process."}:e>=50?{message:"Halfway there!",subMessage:"Great progress! Keep executing your strategy with discipline."}:{message:"Focus on the process",subMessage:"Take it one trade at a time. Quality setups lead to consistent results."}}const a=e/t,o=[{r2:1,r1:0,total:2},{r2:0,r1:2,total:2},{r2:1,r1:1,total:3},{r2:2,r1:0,total:4},{r2:0,r1:3,total:3},{r2:1,r1:2,total:4},{r2:2,r1:1,total:5},{r2:0,r1:4,total:4},{r2:3,r1:0,total:6}].find((e=>2*e.r2+1*e.r1>=a));if(o){const{r2:e,r1:t}=o,r=e+t,n=["No pressure, you've got this!","Stay patient and wait for your setup.","Trust your process!","One quality trade at a time.","You're closer than you think!","Focus on execution, not the outcome."],a=n[Math.floor(Math.random()*n.length)];return{message:"You need at least ".concat(r," trade").concat(r>1?"s":""),subMessage:a,trades:{r2:e,r1:t}}}const s=Math.ceil(a/2);return{message:"About ".concat(s," solid trades to go."),subMessage:"Break it down into small wins. Every R counts!"}})(L-N,X,N,L)),[L,N,X]);return I&&M?(0,w.jsxs)(i.A,{elevation:0,sx:{p:2,mb:2,backgroundColor:"rgba(255, 255, 255, 0.05)",borderRadius:1},children:[(0,w.jsx)(l.A,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Progress"}),(0,w.jsxs)(c.A,{sx:{mb:3},children:[(0,w.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[q?(0,w.jsx)(u.A,{sx:{color:"success.main",fontSize:20}}):(0,w.jsx)(g.A,{}),(0,w.jsx)(l.A,{variant:"body2",sx:{color:"text.secondary"},children:"Traded days"})]}),(0,w.jsx)(d.A,{variant:"determinate",value:O,sx:{height:8,borderRadius:1,backgroundColor:"rgba(255, 255, 255, 0.1)","& .MuiLinearProgress-bar":{backgroundColor:q?"success.main":"primary.main",borderRadius:1}}}),(0,w.jsxs)(l.A,{variant:"body1",sx:{mt:.5,fontWeight:600},children:[G," / ",5]})]}),(0,w.jsxs)(c.A,{children:[(0,w.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[U?(0,w.jsx)(u.A,{sx:{color:"success.main",fontSize:20}}):(0,w.jsx)(h.A,{}),(0,w.jsxs)(l.A,{variant:"body2",sx:{color:"text.secondary"},children:["Reach your profit target of $",L.toLocaleString()]})]}),(0,w.jsx)(d.A,{variant:"determinate",value:B,sx:{height:8,borderRadius:1,backgroundColor:"rgba(255, 255, 255, 0.1)","& .MuiLinearProgress-bar":{backgroundColor:U?"success.main":"primary.main",borderRadius:1}}}),(0,w.jsxs)(l.A,{variant:"body1",sx:{mt:.5,fontWeight:600,color:N>=0?"success.main":"error.main"},children:["$",H.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," / $",L.toLocaleString()]})]}),Y&&(0,w.jsx)(c.A,{sx:{mt:3,p:2,borderRadius:1,backgroundColor:e=>(0,m.X4)(e.palette.warning.main,.15),border:"1px solid",borderColor:e=>(0,m.X4)(e.palette.warning.main,.3)},children:(0,w.jsxs)(c.A,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[(0,w.jsx)(p.A,{sx:{color:"warning.main",fontSize:22,mt:.25}}),(0,w.jsxs)(c.A,{sx:{flex:1},children:[Y.trades?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(l.A,{variant:"body2",sx:{fontWeight:600,color:"text.primary",mb:1},children:Y.message}),(0,w.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5,flexWrap:"wrap"},children:[Array.from({length:Y.trades.r2}).map(((e,t)=>(0,w.jsx)(c.A,{sx:{px:.75,py:.25,borderRadius:1,backgroundColor:"success.main",color:"success.contrastText",fontSize:"0.6rem",fontWeight:600},children:"2R"},"r2-".concat(t)))),Array.from({length:Y.trades.r1}).map(((e,t)=>(0,w.jsx)(c.A,{sx:{px:.75,py:.25,borderRadius:1,backgroundColor:"primary.main",color:"primary.contrastText",fontSize:"0.6rem",fontWeight:600},children:"1R"},"r1-".concat(t)))),(0,w.jsx)(l.A,{variant:"caption",sx:{color:"text.secondary",fontWeight:400,fontSize:"0.7rem"},children:"to reach your target"})]})]}):(0,w.jsx)(l.A,{variant:"body2",sx:{fontWeight:600,color:"text.primary",mb:.5},children:Y.message}),(0,w.jsx)(l.A,{variant:"caption",sx:{color:"warning.light",display:"block",mt:.5},children:Y.subMessage})]})]})})]}):null}},86296:(e,t,r)=>{r.d(t,{A:()=>k});var n=r(89379),a=(r(65043),r(91244)),o=r(29651),s=r(16128),i=r(70298),l=r(53969),c=r(55895),d=r(26529),u=r(83759),g=r(6013),h=r(92248),p=r(18837),m=r(94045),x=r(20312),f=r(70149),y=r(63898),v=r(27496),A=r(60267),b=r(39993),j=r(81084),w=r(70579);const k=e=>{var t;let{trade:r,onClick:k,showTags:C,showImages:S=!1}=e;const _=(0,A.A)(),T=()=>{switch(r.trade_type){case"win":return _.palette.success.main;case"loss":return _.palette.error.main;case"breakeven":return _.palette.info.main;default:return _.palette.primary.main}},I=(null===(t=r.tags)||void 0===t?void 0:t.reduce(((e,t)=>{if((0,j.dn)(t)){const r=(0,j.Oo)(t);e[r]||(e[r]=[]),e[r].push(t)}else e.Other||(e.Other=[]),e.Other.push(t);return e}),{}))||{},M=Object.entries(I),E=M.slice(0,5),z=M.length-5,D=z>0;return(0,w.jsx)(a.A,{sx:{maxWidth:400,cursor:k?"pointer":"default",transition:"all 0.2s ease-in-out",border:"1px solid",borderColor:(0,o.X4)(T(),.2),backgroundColor:(0,o.X4)(T(),.05),"&:hover":k?{boxShadow:"0 4px 12px ".concat((0,o.X4)(T(),.2)),borderColor:T()}:{}},onClick:k,children:(0,w.jsx)(s.A,{sx:{p:2,pt:1,"&:last-child":{pb:1}},children:(0,w.jsxs)(i.A,{spacing:1,children:[(0,w.jsx)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:(0,w.jsxs)(l.A,{sx:{flex:1},children:[(0,w.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,w.jsx)(l.A,{sx:{flex:1},children:r.name&&(0,w.jsx)(c.A,{variant:"subtitle2",fontWeight:"bold",sx:{mb:.5},children:r.name})}),(0,w.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(()=>{switch(r.trade_type){case"win":return(0,w.jsx)(g.A,{sx:{fontSize:"1rem",color:"success.main"}});case"loss":return(0,w.jsx)(h.A,{sx:{fontSize:"1rem",color:"error.main"}});case"breakeven":return(0,w.jsx)(p.A,{sx:{fontSize:"1rem",color:"info.main"}});default:return null}})(),(0,w.jsx)(c.A,{variant:"h6",fontWeight:"bold",color:"".concat((()=>{switch(r.trade_type){case"win":return"success";case"loss":return"error";case"breakeven":return"info";default:return"primary"}})(),".main"),sx:{fontSize:"1rem"},children:(R=r.amount,"".concat(R>=0?"+":"","$").concat(Math.abs(R).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})))})]})]}),(0,w.jsxs)(l.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[r.notes&&(0,w.jsx)(d.A,{title:"Has notes",children:(0,w.jsx)(m.A,{sx:{fontSize:"1rem",color:"text.secondary"}})}),Array.isArray(r.images)&&r.images.length>0&&S&&(0,w.jsx)(d.A,{title:"".concat(r.images.length," image(s)"),children:(0,w.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,w.jsx)(x.A,{sx:{fontSize:"1rem",color:"text.secondary"}}),(0,w.jsx)(c.A,{variant:"caption",color:"text.secondary",children:r.images.length})]})}),r.risk_to_reward&&(0,w.jsx)(d.A,{title:"Risk to Reward: ".concat(r.risk_to_reward.toFixed(2)),children:(0,w.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,w.jsx)(f.A,{sx:{fontSize:"1rem",color:"text.secondary"}}),(0,w.jsx)(c.A,{variant:"caption",color:"text.secondary",children:r.risk_to_reward.toFixed(2)})]})}),r.partials_taken&&(0,w.jsx)(d.A,{title:"Partials taken",children:(0,w.jsx)(u.A,{label:"Partials",size:"small",variant:"outlined",sx:{height:"18px",fontSize:"0.65rem","& .MuiChip-label":{px:.5}}})}),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(y.A,{sx:{fontSize:"0.875rem",color:"text.secondary"}}),(0,w.jsx)(c.A,{variant:"caption",color:"text.secondary",noWrap:!0,children:(0,b.A)(new Date(r.trade_date),"MMM dd, yyyy")})]}),r.session&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(v.A,{sx:{fontSize:"0.875rem",color:"text.secondary"}}),(0,w.jsx)(c.A,{variant:"caption",color:"text.secondary",children:r.session})]})]})]})}),C&&r.tags&&r.tags.length>0&&(0,w.jsxs)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[E.map((e=>{let[t,r]=e;return(0,w.jsx)(u.A,{label:"".concat(t).concat(r.length>1?" (".concat(r.length,")"):""),size:"small",sx:(0,n.A)((0,n.A)({},(0,j.dO)(r[0],_)),{},{height:"20px",fontSize:"0.7rem","& .MuiChip-label":{px:1}})},t)})),D&&(0,w.jsx)(u.A,{label:"+".concat(z),size:"small",sx:{height:"20px",backgroundColor:"dark"===_.palette.mode?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.08)",color:"text.secondary",fontWeight:600,border:"1px dashed",borderColor:"divider",fontSize:"0.7rem","& .MuiChip-label":{px:1}}})]})]})})});var R}},90668:(e,t,r)=>{r.d(t,{A:()=>u});r(65043);var n=r(60267),a=r(53969),o=r(42579),s=r(55895),i=r(15483),l=r(66370),c=r(29651),d=r(70579);const u=e=>{let{account_balance:t,formInputVisible:r,total_pnl:u,title:g,onPrevDay:h,onNextDay:p}=e;const m=(0,n.A)();return(0,d.jsxs)(a.A,{sx:{mb:3},children:[(0,d.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[!r&&(0,d.jsx)(o.A,{onClick:h,size:"small",children:(0,d.jsx)(i.A,{})}),g&&(0,d.jsx)(s.A,{variant:"h6",sx:{fontWeight:600},children:g}),!r&&(0,d.jsx)(o.A,{onClick:p,size:"small",children:(0,d.jsx)(l.A,{})})]}),(0,d.jsxs)(a.A,{sx:{display:"flex",gap:2},children:[(0,d.jsxs)(a.A,{sx:{flex:1,p:2,borderRadius:1,bgcolor:u>=0?(0,c.X4)(m.palette.success.main,.1):(0,c.X4)(m.palette.error.main,.1),border:"1px solid",borderColor:u>=0?(0,c.X4)(m.palette.success.main,.2):(0,c.X4)(m.palette.error.main,.2)},children:[(0,d.jsx)(s.A,{variant:"body2",color:"text.secondary",children:"Day P&L"}),(0,d.jsxs)(s.A,{variant:"h6",sx:{fontWeight:600,color:u>=0?m.palette.success.main:m.palette.error.main},children:[u>=0?"+":"",u.toLocaleString()]})]}),(0,d.jsxs)(a.A,{sx:{flex:1,p:2,borderRadius:1,bgcolor:(0,c.X4)(m.palette.primary.main,.1),border:"1px solid",borderColor:(0,c.X4)(m.palette.primary.main,.2)},children:[(0,d.jsx)(s.A,{variant:"body2",color:"text.secondary",children:"Balance Of The Day"}),(0,d.jsxs)(s.A,{variant:"h6",sx:{fontWeight:600},children:["$",t.toLocaleString()]})]})]})]})}},94029:(e,t,r)=>{r.d(t,{A:()=>ee});var n=r(89379),a=r(65043),o=r(60267),s=r(53969),i=r(29651),l=r(70298),c=r(41859),d=r(26529),u=r(42579),g=r(10256),h=r(67203),p=r(47471),m=r(55895),x=r(24343),f=r(33699),y=r(80172),v=r(22950),A=r(62680),b=r(63745),j=r(78916),w=r(90160),k=r(1422),C=r(4890),S=r(54521),_=r(28518),T=r(73200),I=r(62720),M=r(86995),E=r(38517),z=r(23182),D=r(83759),R=r(78776),W=r(3830),P=r(27421),N=r(46577),F=r(54410),L=(r(55163),r(15270)),X=r(62764),O=r(2984),B=r(97524),U=r(13138),q=r(70579);const G=e=>{let{block:t,contentState:r}=e;const n=r.getEntity(t.getEntityAt(0)),a=n.getType(),o=n.getData();return"IMAGE"===a?(0,q.jsx)(s.A,{component:"img",src:o.src,alt:o.alt||"",sx:{maxWidth:"100%",height:"auto",borderRadius:1,my:1}}):null},H=e=>{let{content:t,minHeight:r=100}=e;const n=(0,o.A)(),i=(0,a.useMemo)((()=>(0,B.u)()),[]),l=(0,a.useMemo)((()=>{const e=(0,L.Yc)(t);return F.EditorState.set(e,{decorator:i})}),[t,i]),c=(0,a.useMemo)((()=>(0,X.Q)(n,U.VF,U.Qi)),[n]);return(0,q.jsx)(s.A,{sx:{minHeight:r,"& .DraftEditor-root":{fontSize:"1rem",lineHeight:1.7,color:n.palette.text.primary},"& .public-DraftEditorPlaceholder-root":{display:"none"},"& .public-DraftEditor-content":{minHeight:r},"& ul, & ol":{margin:"0.5em 0",paddingLeft:"1.5em"},"& li":{marginBottom:"0.25em"},"& h1":{fontSize:"2rem",fontWeight:700,margin:"1em 0 0.5em"},"& h2":{fontSize:"1.5rem",fontWeight:600,margin:"0.8em 0 0.4em"},"& h3":{fontSize:"1.25rem",fontWeight:600,margin:"0.6em 0 0.3em"},"& blockquote":{borderLeft:"3px solid ".concat(n.palette.primary.main),paddingLeft:"1em",marginLeft:0,color:n.palette.text.secondary,fontStyle:"italic"},"& pre":{backgroundColor:n.palette.action.hover,padding:"1em",borderRadius:1,overflow:"auto",fontFamily:"monospace"},"& a":{color:n.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}}},children:(0,q.jsx)(F.Editor,{editorState:l,onChange:()=>{},readOnly:!0,customStyleMap:c,blockStyleFn:O.js,blockRendererFn:e=>"atomic"===e.getType()?{component:G,editable:!1}:null})})};var Y=r(39993);const V=e=>{let{open:t,onClose:r,note:a}=e;const c=(0,o.A)(),d=(0,M.A)(c.breakpoints.down("md"));if(!a)return null;const g=a.updated_at?(0,Y.A)(new Date(a.updated_at),"MMM d, yyyy"):a.created_at?(0,Y.A)(new Date(a.created_at),"MMM d, yyyy"):"";return(0,q.jsxs)(E.A,{open:t,onClose:r,fullScreen:d,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{height:d?"100%":"85vh",m:d?0:2,borderRadius:d?0:3}},children:[(0,q.jsxs)(z.A,{sx:{borderBottom:"1px solid ".concat((0,i.X4)(c.palette.divider,.1)),gap:1,minHeight:56},children:[(0,q.jsxs)(l.A,{direction:"row",spacing:1,alignItems:"center",sx:{flex:1},children:[(0,q.jsx)(m.A,{variant:"h6",noWrap:!0,children:"View Note"}),a.is_pinned&&(0,q.jsx)(W.A,{sx:{fontSize:"1rem",color:"primary.main"}}),a.by_assistant&&(0,q.jsx)(D.A,{icon:(0,q.jsx)(k.A,{sx:{fontSize:"0.9rem !important"}}),label:"AI",size:"small",sx:{height:20,"& .MuiChip-label":{px:.75,fontSize:"0.7rem"},bgcolor:(0,i.X4)(c.palette.primary.main,.1),color:"primary.main"}})]}),(0,q.jsx)(u.A,{size:"small",onClick:r,children:(0,q.jsx)(P.A,{})})]}),(0,q.jsxs)(R.A,{sx:(0,n.A)({p:0,overflowY:"auto",bgcolor:"background.default"},(0,N.J)(c)),children:[a.cover_image&&(0,q.jsx)(s.A,{sx:{width:"100%",height:220,backgroundImage:"url(".concat(a.cover_image,")"),backgroundSize:"cover",backgroundPosition:"center"}}),(0,q.jsxs)(s.A,{sx:{maxWidth:800,margin:"0 auto",px:{xs:2,md:5},py:4},children:[a.tags&&a.tags.length>0&&(0,q.jsx)(l.A,{direction:"row",spacing:.5,flexWrap:"wrap",sx:{mb:2},children:a.tags.map((e=>(0,q.jsx)(D.A,{label:(0,I.Vy)(e),size:"small",sx:{bgcolor:(0,i.X4)(c.palette.secondary.main,.1),color:"secondary.main",fontWeight:500,fontSize:"0.75rem",height:24}},e)))}),(0,q.jsx)(m.A,{variant:"h3",sx:{fontWeight:700,lineHeight:1.2,mb:2,wordBreak:"break-word"},children:a.title||"Untitled"}),g&&(0,q.jsxs)(m.A,{variant:"caption",color:"text.secondary",sx:{mb:3,display:"block"},children:[a.updated_at?"Updated":"Created"," ",g]}),(0,q.jsx)(s.A,{sx:{mt:3},children:a.content?(0,q.jsx)(H,{content:a.content}):(0,q.jsx)(m.A,{variant:"body1",color:"text.secondary",sx:{fontStyle:"italic"},children:"No content"})})]})]})]})};var K=r(41180),J=r(78018),$=r(74675),Q=r(4239);const Z=()=>{const e=(0,o.A)();return(0,q.jsx)(s.A,{sx:{borderRadius:2,mb:.5,py:1.5,px:2,border:"1px solid ".concat((0,i.X4)(e.palette.divider,.1)),bgcolor:(0,i.X4)(e.palette.background.paper,.6)},children:(0,q.jsxs)(l.A,{direction:"row",spacing:1.5,alignItems:"center",children:[(0,q.jsxs)(s.A,{sx:{flex:1,minWidth:0},children:[(0,q.jsx)(s.A,{sx:{mb:.5},children:(0,q.jsx)(T.A,{height:20,width:"60%",borderRadius:4,variant:"wave",intensity:"medium"})}),(0,q.jsxs)(s.A,{sx:{mb:.5},children:[(0,q.jsx)(T.A,{height:16,width:"100%",borderRadius:4,variant:"wave",intensity:"medium",sx:{mb:.3}}),(0,q.jsx)(T.A,{height:16,width:"80%",borderRadius:4,variant:"wave",intensity:"medium"})]}),(0,q.jsx)(T.A,{height:14,width:"30%",borderRadius:4,variant:"wave",intensity:"medium"})]}),(0,q.jsx)(T.A,{height:60,width:60,borderRadius:1,variant:"wave",intensity:"medium",sx:{flexShrink:0}})]})})},ee=e=>{let{open:t,onClose:r,calendarId:T,showCalendarPicker:M=!1,onNoteClick:E,isReadOnly:z=!1}=e;const D=(0,o.A)(),{user:R}=(0,$.h)(),[W,P]=(0,a.useState)([]),[F,L]=(0,a.useState)(""),[X,O]=(0,a.useState)("all"),[B,U]=(0,a.useState)(!1),[G,H]=(0,a.useState)(),[Y,ee]=(0,a.useState)(T),[te,re]=(0,a.useState)("all"),[ne,ae]=(0,a.useState)("me"),[oe,se]=(0,a.useState)(!1),[ie,le]=(0,a.useState)(null),{notes:ce,loading:de,loadingMore:ue,hasMore:ge,total:he,loadMore:pe,updateNote:me,removeNote:xe,addNote:fe}=function(e){const{userId:t,calendarId:r,isOpen:o,activeTab:s,searchQuery:i=null,selectedCalendarFilter:l="all",creatorFilter:c,notesPerPage:d=20}=e,[u,g]=(0,a.useState)([]),[h,p]=(0,a.useState)(!1),[m,x]=(0,a.useState)(!1),[f,y]=(0,a.useState)(!1),[v,A]=(0,a.useState)(0),b=(0,a.useRef)(0),j=(0,a.useRef)(!1),w=(0,a.useRef)({activeTab:s,selectedCalendarFilter:l,creatorFilter:c,calendarId:r,searchQuery:i}),k=(0,a.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t)try{e?(p(!0),b.current=0):x(!0);const n={limit:d,offset:b.current,searchQuery:(i||"").trim()||void 0};let a;"pinned"===s?(n.isPinned=!0,n.isArchived=!1):n.isArchived="archived"===s,"assistant"===c?n.byAssistant=!0:"me"===c&&(n.byAssistant=!1);const o=r||("all"!==l?l:void 0);a=o?await K.g2(o,n):await K.do(t,n),e?(g(a.notes),b.current=a.notes.length):(g((e=>[...e,...a.notes])),b.current+=a.notes.length),y(a.hasMore),A(a.total)}catch(n){J.logger.error("Error loading notes:",n),g([])}finally{p(!1),x(!1)}}),[t,r,s,i,l,c,d]);(0,a.useEffect)((()=>{o&&!j.current&&(j.current=!0,k(!0))}),[o,k]),(0,a.useEffect)((()=>{if(!o||!j.current)return;const e=w.current;(e.activeTab!==s||e.selectedCalendarFilter!==l||e.creatorFilter!==c||e.calendarId!==r)&&(w.current=(0,n.A)((0,n.A)({},w.current),{},{activeTab:s,selectedCalendarFilter:l,creatorFilter:c,calendarId:r}),k(!0))}),[o,s,l,c,r,k]),(0,a.useEffect)((()=>{if(!o||!j.current)return;if(w.current.searchQuery===i)return;const e=setTimeout((()=>{w.current.searchQuery=i,k(!0)}),500);return()=>clearTimeout(e)}),[i,o,k]);const C=(0,a.useCallback)((()=>{k(!1)}),[k]),S=(0,a.useCallback)(((e,t)=>{g((r=>r.map((r=>r.id===e?(0,n.A)((0,n.A)({},r),t):r))))}),[]),_=(0,a.useCallback)((e=>{g((t=>t.filter((t=>t.id!==e))))}),[]),T=(0,a.useCallback)((e=>{g((t=>[e,...t]))}),[]);return{notes:u,loading:h,loadingMore:m,hasMore:f,total:v,loadNotes:k,loadMore:C,updateNote:S,removeNote:_,addNote:T}}({userId:null===R||void 0===R?void 0:R.uid,calendarId:T,isOpen:t,activeTab:X,searchQuery:F,selectedCalendarFilter:te,creatorFilter:ne});(0,a.useEffect)((()=>{t&&M&&ye()}),[t,M]);const ye=async()=>{if(null!==R&&void 0!==R&&R.uid)try{const e=new Q.t,t=await e.findByUserId(R.uid);P(t)}catch(e){J.logger.error("Error loading calendars:",e),P([])}},ve=()=>{if(M&&!T){if("all"===te)return void J.logger.warn("Please select a calendar to create a note");ee(te),H(void 0),U(!0)}else ee(T),H(void 0),U(!0)},Ae=e=>{var t,r;if(z)return le(e),se(!0),void(E&&E(e));H(e),ee(null!==(t=null!==(r=e.calendar_id)&&void 0!==r?r:T)&&void 0!==t?t:te),U(!0),E&&E(e)},be=async e=>{if(e)try{me(e.id,{is_pinned:!e.is_pinned}),e.is_pinned?await K.xU(e.id):await K.uA(e.id)}catch(t){J.logger.error("Error toggling pin:",t),me(e.id,{is_pinned:e.is_pinned})}},je=async e=>{try{if(!e)return;xe(e.id),e.is_archived?await K.C8(e.id):await K.Dh(e.id)}catch(t){J.logger.error("Error archiving note:",t)}},we=e=>W.find((t=>t.id===e.calendar_id));z||(c.A,v.A,M&&W.length);return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(C.A,{open:t,onClose:r,title:"Notes",icon:(0,q.jsx)(A.A,{}),headerActions:!z&&(0,q.jsx)(d.A,{title:"Create new note",arrow:!0,children:(0,q.jsx)(u.A,{color:"primary",onClick:ve,disabled:M&&(0===W.length||"all"===te),sx:{bgcolor:(0,i.X4)(D.palette.primary.main,.1),"&:hover":{bgcolor:(0,i.X4)(D.palette.primary.main,.2)}},children:(0,q.jsx)(v.A,{})})}),width:{xs:"100%",sm:450},headerVariant:"enhanced",keepMounted:!0,children:(0,q.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[M&&!T&&(0,q.jsx)(s.A,{sx:{p:2,pb:1},children:(0,q.jsx)(g.A,{fullWidth:!0,size:"small",children:(0,q.jsxs)(h.A,{value:te,onChange:e=>re(e.target.value),displayEmpty:!0,sx:{borderRadius:1,bgcolor:(0,i.X4)(D.palette.background.paper,.5)},children:[(0,q.jsx)(p.A,{value:"all",children:(0,q.jsx)(m.A,{variant:"body2",color:"text.secondary",children:"All Calendars"})}),W.map((e=>(0,q.jsx)(p.A,{value:e.id,children:(0,q.jsx)(m.A,{variant:"body2",children:e.name})},e.id)))]})})}),(0,q.jsx)(s.A,{sx:{p:2,pb:1,pt:M&&!T?0:2},children:(0,q.jsx)(S.A,{tabs:[{label:"All"},{label:"Pinned"},{label:"Archived"}],activeTab:["all","pinned","archived"].indexOf(X),onTabChange:(e,t)=>{O(["all","pinned","archived"][t])},size:"small",fullWidth:!0})}),(0,q.jsxs)(s.A,{sx:{px:2,pb:2,display:"flex",gap:1,alignItems:"center"},children:[(0,q.jsx)(x.A,{size:"small",placeholder:"Search notes...",value:F,onChange:e=>L(e.target.value),sx:{flex:1},InputProps:{startAdornment:(0,q.jsx)(f.A,{position:"start",children:(0,q.jsx)(b.A,{sx:{color:"text.secondary"}})}),endAdornment:F&&(0,q.jsx)(f.A,{position:"end",children:(0,q.jsx)(u.A,{size:"small",onClick:()=>L(""),edge:"end",children:(0,q.jsx)(j.A,{fontSize:"small"})})}),sx:{borderRadius:2,bgcolor:(0,i.X4)(D.palette.background.paper,.5)}}}),(0,q.jsx)(g.A,{size:"small",sx:{minWidth:140},children:(0,q.jsxs)(h.A,{value:ne,onChange:e=>ae(e.target.value),sx:{borderRadius:1},children:[(0,q.jsx)(p.A,{value:"me",children:(0,q.jsxs)(l.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,q.jsx)(w.A,{sx:{fontSize:"1rem",color:"text.secondary"}}),(0,q.jsx)(m.A,{variant:"body2",children:"My Notes"})]})}),(0,q.jsx)(p.A,{value:"assistant",children:(0,q.jsxs)(l.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,q.jsx)(k.A,{sx:{fontSize:"1rem",color:"primary.main"}}),(0,q.jsx)(m.A,{variant:"body2",children:"AI Assistant"})]})})]})})]}),(0,q.jsx)(s.A,{sx:(0,n.A)({flex:1,overflowY:"auto",px:2,pb:2},(0,N.J)(D)),children:de?(0,q.jsx)(s.A,{children:Array.from({length:10}).map(((e,t)=>(0,q.jsx)(Z,{},t)))}):0===ce.length?(0,q.jsxs)(l.A,{spacing:2,alignItems:"center",sx:{py:8,textAlign:"center"},children:[(0,q.jsx)(A.A,{sx:{fontSize:64,color:"text.disabled"}}),(0,q.jsx)(m.A,{variant:"h6",color:"text.secondary",children:F?"No notes found":"pinned"===X?"No pinned notes":"archived"===X?"No archived notes":"No notes yet"}),(0,q.jsx)(m.A,{variant:"body2",color:"text.disabled",children:F?"Try a different search term":"all"===X?"Create your first note to get started":""}),!F&&"all"===X&&!z&&(0,q.jsx)(c.A,{variant:"contained",startIcon:(0,q.jsx)(v.A,{}),onClick:ve,sx:{mt:2},children:"Create Note"})]}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(s.A,{children:ce.map((e=>(0,q.jsx)(_.A,{note:e,onClick:Ae,onPin:z?void 0:be,onArchive:z?void 0:je,onUnarchive:z?void 0:je,calendar:we(e),showCalendarBadge:M&&!T},e.id)))}),ge&&(0,q.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",mt:2,mb:1},children:(0,q.jsx)(c.A,{variant:"outlined",onClick:pe,disabled:ue,sx:{borderRadius:2,textTransform:"none",minWidth:120},children:ue?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(y.A,{size:16,sx:{mr:1}}),"Loading..."]}):"Load More (".concat(he-ce.length," remaining)")})})]})})]})}),B&&(Y||G)&&(0,q.jsx)(I.Ay,{open:B,onClose:()=>{U(!1),H(void 0)},note:G,calendarId:Y||(null===G||void 0===G?void 0:G.calendar_id)||T||"",onSave:(e,t)=>t?fe(e):me(e.id,e),onDelete:e=>xe(e)}),(0,q.jsx)(V,{open:oe,onClose:()=>{se(!1),le(null)},note:ie})]})}}}]);
//# sourceMappingURL=727.a98779b8.chunk.js.map